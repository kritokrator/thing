\hypertarget{win_2win32_2mhmenu_8c}{\section{nethack/win/win32/mhmenu.c File Reference}
\label{win_2win32_2mhmenu_8c}\index{nethack/win/win32/mhmenu.\+c@{nethack/win/win32/mhmenu.\+c}}
}
{\ttfamily \#include \char`\"{}win\+M\+S.\+h\char`\"{}}\\*
{\ttfamily \#include $<$assert.\+h$>$}\\*
{\ttfamily \#include \char`\"{}resource.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhmenu.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhmain.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhmsg.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhfont.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhdlg.\+h\char`\"{}}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structmswin__menu__item}{mswin\+\_\+menu\+\_\+item}
\item 
struct \hyperlink{structmswin__nethack__menu__window}{mswin\+\_\+nethack\+\_\+menu\+\_\+window}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}{M\+E\+N\+U\+\_\+\+M\+A\+R\+G\+I\+N}~0
\item 
\#define \hyperlink{win_2win32_2mhmenu_8c_a952b01afec1711bc486a207765acb1a6}{N\+H\+M\+E\+N\+U\+\_\+\+S\+T\+R\+\_\+\+S\+I\+Z\+E}~\hyperlink{wingem1_8c_ab26c26cbf7a0c97d8960c3cfb413f882}{B\+U\+F\+S\+Z}
\item 
\#define \hyperlink{win_2win32_2mhmenu_8c_a511a6820684a87ea7109582ac3f158eb}{M\+I\+N\+\_\+\+T\+A\+B\+S\+T\+O\+P\+\_\+\+S\+I\+Z\+E}~0
\item 
\#define \hyperlink{win_2win32_2mhmenu_8c_a2431d5b90e503a443a8e29c37a5ef549}{N\+U\+M\+T\+A\+B\+S}~15
\item 
\#define \hyperlink{win_2win32_2mhmenu_8c_a2d7b0f76873a47cdd301b0a7c222a681}{T\+A\+B\+\_\+\+S\+E\+P\+A\+R\+A\+T\+I\+O\+N}~10 /$\ast$ \hyperlink{thintile_8c_ad8f8da6572831b2f4d59c3ac23043b69}{pixels} between each tab stop $\ast$/
\item 
\#define \hyperlink{win_2win32_2mhmenu_8c_a31e380304152e012afbd6151c8f4cc70}{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T}~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W
\item 
\#define \hyperlink{win_2win32_2mhmenu_8c_a47fb1e2e86d10f668872ccce87a250f6}{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T}~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T
\item 
\#define \hyperlink{win_2win32_2mhmenu_8c_ac191df8eb452650490d0c60a03ab7f3a}{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+E\+N\+U}~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W
\item 
\#define \hyperlink{win_2win32_2mhmenu_8c_a08fcecfa6bc73cb3245146aa07fe4a02}{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+E\+N\+U}~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T
\item 
\#define \hyperlink{win_2win32_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+A\+B\+L\+E}(item)~((item).identifier.\+a\+\_\+obj!=\hyperlink{uudecode_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{N\+U\+L\+L})
\item 
\#define \hyperlink{win_2win32_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+E\+D}(item)~((item).count!=0)
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \hyperlink{structmswin__menu__item}{mswin\+\_\+menu\+\_\+item} \hyperlink{win_2win32_2mhmenu_8c_a5c437eaf797666e94d39f0393883c161}{N\+H\+Menu\+Item}
\item 
typedef struct \hyperlink{structmswin__menu__item}{mswin\+\_\+menu\+\_\+item} $\ast$ \hyperlink{win_2win32_2mhmenu_8c_aaac97a082e26a50927b1796fd38fc7e2}{P\+N\+H\+Menu\+Item}
\item 
typedef struct \\*
\hyperlink{structmswin__nethack__menu__window}{mswin\+\_\+nethack\+\_\+menu\+\_\+window} \hyperlink{win_2win32_2mhmenu_8c_afae72ef7d34728051a94b6e1f84ccb10}{N\+H\+Menu\+Window}
\item 
typedef struct \\*
\hyperlink{structmswin__nethack__menu__window}{mswin\+\_\+nethack\+\_\+menu\+\_\+window} $\ast$ \hyperlink{win_2win32_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{P\+N\+H\+Menu\+Window}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
B\+O\+O\+L C\+A\+L\+L\+B\+A\+C\+K \hyperlink{win_2win32_2mhmenu_8c_a085082d0591741058c85b4ff41570488}{Menu\+Wnd\+Proc} (H\+W\+N\+D, \hyperlink{def__os2_8h_a36cb3b01d81ffd844bbbfb54003e06ec}{U\+I\+N\+T}, W\+P\+A\+R\+A\+M, L\+P\+A\+R\+A\+M)
\item 
L\+R\+E\+S\+U\+L\+T C\+A\+L\+L\+B\+A\+C\+K \hyperlink{win_2win32_2mhmenu_8c_a98cae3dd2cc1e5ed8696141ea0af9736}{N\+H\+Menu\+List\+Wnd\+Proc} (H\+W\+N\+D, \hyperlink{def__os2_8h_a36cb3b01d81ffd844bbbfb54003e06ec}{U\+I\+N\+T}, W\+P\+A\+R\+A\+M, L\+P\+A\+R\+A\+M)
\item 
L\+R\+E\+S\+U\+L\+T C\+A\+L\+L\+B\+A\+C\+K \hyperlink{win_2win32_2mhmenu_8c_a05d16c255df1c3017ab9d2db72a80352}{N\+H\+Menu\+Text\+Wnd\+Proc} (H\+W\+N\+D, \hyperlink{def__os2_8h_a36cb3b01d81ffd844bbbfb54003e06ec}{U\+I\+N\+T}, W\+P\+A\+R\+A\+M, L\+P\+A\+R\+A\+M)
\item 
static void \hyperlink{win_2win32_2mhmenu_8c_ab1f0aceef05a1dec643246c7cbf5353c}{on\+M\+S\+N\+H\+Command} (H\+W\+N\+D h\+Wnd, W\+P\+A\+R\+A\+M w\+Param, L\+P\+A\+R\+A\+M l\+Param)
\item 
static B\+O\+O\+L \hyperlink{win_2win32_2mhmenu_8c_a527e6fa96e8cf2ebbe785664951555b6}{on\+Measure\+Item} (H\+W\+N\+D h\+Wnd, W\+P\+A\+R\+A\+M w\+Param, L\+P\+A\+R\+A\+M l\+Param)
\item 
static B\+O\+O\+L \hyperlink{win_2win32_2mhmenu_8c_a09526f2ef32277c89886a7b74e5214eb}{on\+Draw\+Item} (H\+W\+N\+D h\+Wnd, W\+P\+A\+R\+A\+M w\+Param, L\+P\+A\+R\+A\+M l\+Param)
\item 
static void \hyperlink{win_2win32_2mhmenu_8c_a4aff550d92784a0c5e7fcb8b9f86a15e}{Layout\+Menu} (H\+W\+N\+D hwnd)
\item 
static void \hyperlink{win_2win32_2mhmenu_8c_a9a4ac79f4c285b52ae25582c25beb82d}{Set\+Menu\+Type} (H\+W\+N\+D hwnd, int \hyperlink{lev__main_8c_ac765329451135abec74c45e1897abf26}{type})
\item 
static void \hyperlink{win_2win32_2mhmenu_8c_a9935a9b932fd4f54e94b72e7cd0dee54}{Set\+Menu\+List\+Type} (H\+W\+N\+D hwnd, int now)
\item 
static H\+W\+N\+D \hyperlink{win_2win32_2mhmenu_8c_a871d7d2f2639f7ebf2e8e9f6f681bd0a}{Get\+Menu\+Control} (H\+W\+N\+D hwnd)
\item 
static void \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{Select\+Menu\+Item} (H\+W\+N\+D hwnd\+List, \hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{P\+N\+H\+Menu\+Window} data, int item, int \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count})
\item 
static void \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\+\_\+menu\+\_\+count} (H\+W\+N\+D hwnd\+List, \hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{P\+N\+H\+Menu\+Window} data)
\item 
static B\+O\+O\+L \hyperlink{win_2win32_2mhmenu_8c_a0fc93365413fa232f797e9bffa6780a9}{on\+List\+Char} (H\+W\+N\+D h\+Wnd, H\+W\+N\+D hwnd\+List, W\+O\+R\+D ch)
\item 
H\+W\+N\+D \hyperlink{win_2win32_2mhmenu_8c_a8c5ddcafb43564d6bbc9a6a422974797}{mswin\+\_\+init\+\_\+menu\+\_\+window} (int \hyperlink{lev__main_8c_ac765329451135abec74c45e1897abf26}{type})
\item 
int \hyperlink{win_2win32_2mhmenu_8c_ad900b8c309861a1826a11b4c49432c2a}{mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu} (H\+W\+N\+D h\+Wnd, int how, \hyperlink{wintype_8h_a56b56557611b7f64f4e6585a1b78c8f9}{M\+E\+N\+U\+\_\+\+I\+T\+E\+M\+\_\+\+P} $\ast$$\ast$\+\_\+selected)
\item 
void \hyperlink{win_2win32_2mhmenu_8c_a522c5050d80d7397e9f59b00c47e13f0}{mswin\+\_\+menu\+\_\+window\+\_\+size} (H\+W\+N\+D h\+Wnd, L\+P\+S\+I\+Z\+E sz)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
short \hyperlink{win_2win32_2mhmenu_8c_a4d61aa736dae8287d97c3a68a3a917c5}{glyph2tile} \mbox{[}$\,$\mbox{]}
\item 
static W\+N\+D\+P\+R\+O\+C \hyperlink{win_2win32_2mhmenu_8c_a34b2053bf1601b3dc7b10796c1040cdc}{wnd\+Proc\+List\+View\+Orig} = \hyperlink{uudecode_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{N\+U\+L\+L}
\item 
static W\+N\+D\+P\+R\+O\+C \hyperlink{win_2win32_2mhmenu_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{edit\+Control\+Wnd\+Proc} = \hyperlink{uudecode_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{N\+U\+L\+L}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{win_2win32_2mhmenu_8c_ac191df8eb452650490d0c60a03ab7f3a}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+E\+N\+U@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+E\+N\+U}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+E\+N\+U@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+E\+N\+U}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+E\+N\+U}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+E\+N\+U~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W}}\label{win_2win32_2mhmenu_8c_ac191df8eb452650490d0c60a03ab7f3a}


Definition at line 22 of file mhmenu.\+c.



Referenced by on\+Draw\+Item(), and Set\+Menu\+List\+Type().

\hypertarget{win_2win32_2mhmenu_8c_a31e380304152e012afbd6151c8f4cc70}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W}}\label{win_2win32_2mhmenu_8c_a31e380304152e012afbd6151c8f4cc70}


Definition at line 20 of file mhmenu.\+c.



Referenced by Menu\+Wnd\+Proc().

\hypertarget{win_2win32_2mhmenu_8c_a08fcecfa6bc73cb3245146aa07fe4a02}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+E\+N\+U@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+E\+N\+U}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+E\+N\+U@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+E\+N\+U}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+E\+N\+U}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+E\+N\+U~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T}}\label{win_2win32_2mhmenu_8c_a08fcecfa6bc73cb3245146aa07fe4a02}


Definition at line 23 of file mhmenu.\+c.



Referenced by on\+Draw\+Item(), and Set\+Menu\+List\+Type().

\hypertarget{win_2win32_2mhmenu_8c_a47fb1e2e86d10f668872ccce87a250f6}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T}}\label{win_2win32_2mhmenu_8c_a47fb1e2e86d10f668872ccce87a250f6}


Definition at line 21 of file mhmenu.\+c.



Referenced by Menu\+Wnd\+Proc().

\hypertarget{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!M\+E\+N\+U\+\_\+\+M\+A\+R\+G\+I\+N@{M\+E\+N\+U\+\_\+\+M\+A\+R\+G\+I\+N}}
\index{M\+E\+N\+U\+\_\+\+M\+A\+R\+G\+I\+N@{M\+E\+N\+U\+\_\+\+M\+A\+R\+G\+I\+N}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{M\+E\+N\+U\+\_\+\+M\+A\+R\+G\+I\+N}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+E\+N\+U\+\_\+\+M\+A\+R\+G\+I\+N~0}}\label{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}


Definition at line 14 of file mhmenu.\+c.



Referenced by Layout\+Menu().

\hypertarget{win_2win32_2mhmenu_8c_a511a6820684a87ea7109582ac3f158eb}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!M\+I\+N\+\_\+\+T\+A\+B\+S\+T\+O\+P\+\_\+\+S\+I\+Z\+E@{M\+I\+N\+\_\+\+T\+A\+B\+S\+T\+O\+P\+\_\+\+S\+I\+Z\+E}}
\index{M\+I\+N\+\_\+\+T\+A\+B\+S\+T\+O\+P\+\_\+\+S\+I\+Z\+E@{M\+I\+N\+\_\+\+T\+A\+B\+S\+T\+O\+P\+\_\+\+S\+I\+Z\+E}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{M\+I\+N\+\_\+\+T\+A\+B\+S\+T\+O\+P\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+I\+N\+\_\+\+T\+A\+B\+S\+T\+O\+P\+\_\+\+S\+I\+Z\+E~0}}\label{win_2win32_2mhmenu_8c_a511a6820684a87ea7109582ac3f158eb}


Definition at line 16 of file mhmenu.\+c.



Referenced by on\+M\+S\+N\+H\+Command().

\hypertarget{win_2win32_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+A\+B\+L\+E@{N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+A\+B\+L\+E}}
\index{N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+A\+B\+L\+E@{N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+A\+B\+L\+E}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+A\+B\+L\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+A\+B\+L\+E(
\begin{DoxyParamCaption}
\item[{}]{item}
\end{DoxyParamCaption}
)~((item).identifier.\+a\+\_\+obj!={\bf N\+U\+L\+L})}}\label{win_2win32_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}


Definition at line 69 of file mhmenu.\+c.



Referenced by Menu\+Wnd\+Proc(), mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu(), on\+Draw\+Item(), and on\+List\+Char().

\hypertarget{win_2win32_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+E\+D@{N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+E\+D}}
\index{N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+E\+D@{N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+E\+D}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+E\+D}]{\setlength{\rightskip}{0pt plus 5cm}\#define N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+E\+D(
\begin{DoxyParamCaption}
\item[{}]{item}
\end{DoxyParamCaption}
)~((item).count!=0)}}\label{win_2win32_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}


Definition at line 70 of file mhmenu.\+c.



Referenced by Menu\+Wnd\+Proc(), mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu(), and on\+List\+Char().

\hypertarget{win_2win32_2mhmenu_8c_a952b01afec1711bc486a207765acb1a6}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!N\+H\+M\+E\+N\+U\+\_\+\+S\+T\+R\+\_\+\+S\+I\+Z\+E@{N\+H\+M\+E\+N\+U\+\_\+\+S\+T\+R\+\_\+\+S\+I\+Z\+E}}
\index{N\+H\+M\+E\+N\+U\+\_\+\+S\+T\+R\+\_\+\+S\+I\+Z\+E@{N\+H\+M\+E\+N\+U\+\_\+\+S\+T\+R\+\_\+\+S\+I\+Z\+E}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{N\+H\+M\+E\+N\+U\+\_\+\+S\+T\+R\+\_\+\+S\+I\+Z\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define N\+H\+M\+E\+N\+U\+\_\+\+S\+T\+R\+\_\+\+S\+I\+Z\+E~{\bf B\+U\+F\+S\+Z}}}\label{win_2win32_2mhmenu_8c_a952b01afec1711bc486a207765acb1a6}


Definition at line 15 of file mhmenu.\+c.



Referenced by on\+M\+S\+N\+H\+Command().

\hypertarget{win_2win32_2mhmenu_8c_a2431d5b90e503a443a8e29c37a5ef549}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!N\+U\+M\+T\+A\+B\+S@{N\+U\+M\+T\+A\+B\+S}}
\index{N\+U\+M\+T\+A\+B\+S@{N\+U\+M\+T\+A\+B\+S}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{N\+U\+M\+T\+A\+B\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define N\+U\+M\+T\+A\+B\+S~15}}\label{win_2win32_2mhmenu_8c_a2431d5b90e503a443a8e29c37a5ef549}


Definition at line 17 of file mhmenu.\+c.



Referenced by on\+M\+S\+N\+H\+Command().

\hypertarget{win_2win32_2mhmenu_8c_a2d7b0f76873a47cdd301b0a7c222a681}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!T\+A\+B\+\_\+\+S\+E\+P\+A\+R\+A\+T\+I\+O\+N@{T\+A\+B\+\_\+\+S\+E\+P\+A\+R\+A\+T\+I\+O\+N}}
\index{T\+A\+B\+\_\+\+S\+E\+P\+A\+R\+A\+T\+I\+O\+N@{T\+A\+B\+\_\+\+S\+E\+P\+A\+R\+A\+T\+I\+O\+N}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{T\+A\+B\+\_\+\+S\+E\+P\+A\+R\+A\+T\+I\+O\+N}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+A\+B\+\_\+\+S\+E\+P\+A\+R\+A\+T\+I\+O\+N~10 /$\ast$ {\bf pixels} between each tab stop $\ast$/}}\label{win_2win32_2mhmenu_8c_a2d7b0f76873a47cdd301b0a7c222a681}


Definition at line 18 of file mhmenu.\+c.



Referenced by mswin\+\_\+menu\+\_\+window\+\_\+size(), and on\+Draw\+Item().



\subsection{Typedef Documentation}
\hypertarget{win_2win32_2mhmenu_8c_a5c437eaf797666e94d39f0393883c161}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!N\+H\+Menu\+Item@{N\+H\+Menu\+Item}}
\index{N\+H\+Menu\+Item@{N\+H\+Menu\+Item}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{N\+H\+Menu\+Item}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf mswin\+\_\+menu\+\_\+item}  {\bf N\+H\+Menu\+Item}}}\label{win_2win32_2mhmenu_8c_a5c437eaf797666e94d39f0393883c161}
\hypertarget{win_2win32_2mhmenu_8c_afae72ef7d34728051a94b6e1f84ccb10}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!N\+H\+Menu\+Window@{N\+H\+Menu\+Window}}
\index{N\+H\+Menu\+Window@{N\+H\+Menu\+Window}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{N\+H\+Menu\+Window}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf mswin\+\_\+nethack\+\_\+menu\+\_\+window}  {\bf N\+H\+Menu\+Window}}}\label{win_2win32_2mhmenu_8c_afae72ef7d34728051a94b6e1f84ccb10}
\hypertarget{win_2win32_2mhmenu_8c_aaac97a082e26a50927b1796fd38fc7e2}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!P\+N\+H\+Menu\+Item@{P\+N\+H\+Menu\+Item}}
\index{P\+N\+H\+Menu\+Item@{P\+N\+H\+Menu\+Item}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{P\+N\+H\+Menu\+Item}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf mswin\+\_\+menu\+\_\+item} $\ast$ {\bf P\+N\+H\+Menu\+Item}}}\label{win_2win32_2mhmenu_8c_aaac97a082e26a50927b1796fd38fc7e2}
\hypertarget{win_2win32_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!P\+N\+H\+Menu\+Window@{P\+N\+H\+Menu\+Window}}
\index{P\+N\+H\+Menu\+Window@{P\+N\+H\+Menu\+Window}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{P\+N\+H\+Menu\+Window}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf mswin\+\_\+nethack\+\_\+menu\+\_\+window} $\ast$ {\bf P\+N\+H\+Menu\+Window}}}\label{win_2win32_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}


\subsection{Function Documentation}
\hypertarget{win_2win32_2mhmenu_8c_a871d7d2f2639f7ebf2e8e9f6f681bd0a}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!Get\+Menu\+Control@{Get\+Menu\+Control}}
\index{Get\+Menu\+Control@{Get\+Menu\+Control}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{Get\+Menu\+Control}]{\setlength{\rightskip}{0pt plus 5cm}H\+W\+N\+D Get\+Menu\+Control (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{hwnd}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmenu_8c_a871d7d2f2639f7ebf2e8e9f6f681bd0a}


Definition at line 714 of file mhmenu.\+c.



References I\+D\+C\+\_\+\+M\+E\+N\+U\+\_\+\+L\+I\+S\+T, I\+D\+C\+\_\+\+M\+E\+N\+U\+\_\+\+T\+E\+X\+T, M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+X\+T, and mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::type.



Referenced by Layout\+Menu(), Menu\+Wnd\+Proc(), mswin\+\_\+menu\+\_\+window\+\_\+size(), and on\+Measure\+Item().


\begin{DoxyCode}
715 \{
716     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
717 
718     data = (\hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
719 
720     \textcolor{keywordflow}{if}(data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type}==\hyperlink{sys_2wince_2mhmenu_8h_ad863ba4d93ea3f9619d1f82c79c620e7}{MENU\_TYPE\_TEXT}) \{
721         \textcolor{keywordflow}{return} GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_add6d9e4e19e8e119d474ba980520a4d2}{IDC\_MENU\_TEXT});
722     \} \textcolor{keywordflow}{else} \{
723         \textcolor{keywordflow}{return} GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a1af3a3967bc3f6d66a75d340c1f56678}{IDC\_MENU\_LIST});
724     \}
725 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a4aff550d92784a0c5e7fcb8b9f86a15e}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!Layout\+Menu@{Layout\+Menu}}
\index{Layout\+Menu@{Layout\+Menu}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{Layout\+Menu}]{\setlength{\rightskip}{0pt plus 5cm}void Layout\+Menu (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{hwnd}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmenu_8c_a4aff550d92784a0c5e7fcb8b9f86a15e}


Definition at line 550 of file mhmenu.\+c.



References Get\+Menu\+Control(), menu\+\_\+cancel(), M\+E\+N\+U\+\_\+\+M\+A\+R\+G\+I\+N, menu\+\_\+ok(), min, S\+I\+Z\+E, and T\+R\+U\+E.



Referenced by Menu\+Wnd\+Proc(), and Set\+Menu\+Type().


\begin{DoxyCode}
551 \{
552     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
553     HWND  \hyperlink{win_2X11_2winmenu_8c_ae055ee6d07dc1f4426e190049c837b90}{menu\_ok};
554     HWND  \hyperlink{win_2X11_2winmenu_8c_ab30dd70724ea5aefd65ee673324e478a}{menu\_cancel};
555     RECT  clrt, rt;
556     POINT pt\_elem, pt\_ok, pt\_cancel;
557     \hyperlink{global_8h_afd2537d19a3cb6556b0f727580ec6ee7}{SIZE}  sz\_elem, sz\_ok, sz\_cancel;
558 
559     data = (\hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
560     menu\_ok = GetDlgItem(hWnd, IDOK);
561     menu\_cancel = GetDlgItem(hWnd, IDCANCEL);
562 
563     \textcolor{comment}{/* get window coordinates */}
564     GetClientRect(hWnd, &clrt );
565     
566     \textcolor{comment}{/* set window placements */}
567     GetWindowRect(menu\_ok, &rt);
568     sz\_ok.cx = (clrt.right - clrt.left)/2 - 2*\hyperlink{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}{MENU\_MARGIN};
569     sz\_ok.cy = rt.bottom-rt.top;
570     pt\_ok.x = clrt.left + \hyperlink{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}{MENU\_MARGIN};
571     pt\_ok.y = clrt.bottom - \hyperlink{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}{MENU\_MARGIN} - sz\_ok.cy;
572 
573     GetWindowRect(menu\_cancel, &rt);
574     sz\_cancel.cx = (clrt.right - clrt.left)/2 - 2*\hyperlink{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}{MENU\_MARGIN};
575     sz\_cancel.cy = rt.bottom-rt.top;
576     pt\_cancel.x = (clrt.left + clrt.right)/2 + \hyperlink{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}{MENU\_MARGIN};
577     pt\_cancel.y = clrt.bottom - \hyperlink{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}{MENU\_MARGIN} - sz\_cancel.cy;
578 
579     pt\_elem.x = clrt.left + \hyperlink{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}{MENU\_MARGIN};
580     pt\_elem.y = clrt.top + \hyperlink{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}{MENU\_MARGIN};
581     sz\_elem.cx = (clrt.right - clrt.left) - 2*\hyperlink{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}{MENU\_MARGIN};
582     sz\_elem.cy = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(pt\_cancel.y, pt\_ok.y) - 2*\hyperlink{win_2win32_2mhmenu_8c_a39692f505d39ae8632a93d9d755c3708}{MENU\_MARGIN};
583 
584     MoveWindow(\hyperlink{win_2win32_2mhmenu_8c_a871d7d2f2639f7ebf2e8e9f6f681bd0a}{GetMenuControl}(hWnd), pt\_elem.x, pt\_elem.y, sz\_elem.cx, sz\_elem.cy, 
      \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
585     MoveWindow(menu\_ok, pt\_ok.x, pt\_ok.y, sz\_ok.cx, sz\_ok.cy, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
586     MoveWindow(menu\_cancel, pt\_cancel.x, pt\_cancel.y, sz\_cancel.cx, sz\_cancel.cy, 
      \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
587 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a085082d0591741058c85b4ff41570488}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!Menu\+Wnd\+Proc@{Menu\+Wnd\+Proc}}
\index{Menu\+Wnd\+Proc@{Menu\+Wnd\+Proc}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{Menu\+Wnd\+Proc}]{\setlength{\rightskip}{0pt plus 5cm}B\+O\+O\+L C\+A\+L\+L\+B\+A\+C\+K Menu\+Wnd\+Proc (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{{\bf U\+I\+N\+T}}]{message, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhmenu_8c_a085082d0591741058c85b4ff41570488}


Definition at line 201 of file mhmenu.\+c.



References A\+T\+R\+\_\+\+N\+O\+N\+E, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::bmp\+Checked, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::bmp\+Checked\+Count, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::bmp\+Not\+Checked, D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T, D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::done, edit\+Control\+Wnd\+Proc, F\+A\+L\+S\+E, free(), sinfo\+::gameover, Get\+Menu\+Control(), Get\+N\+H\+App(), mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::how, I\+D\+B\+\_\+\+M\+E\+N\+U\+\_\+\+S\+E\+L, I\+D\+B\+\_\+\+M\+E\+N\+U\+\_\+\+S\+E\+L\+\_\+\+C\+O\+U\+N\+T, I\+D\+B\+\_\+\+M\+E\+N\+U\+\_\+\+U\+N\+S\+E\+L, I\+D\+C\+\_\+\+M\+E\+N\+U\+\_\+\+L\+I\+S\+T, I\+D\+C\+\_\+\+M\+E\+N\+U\+\_\+\+T\+E\+X\+T, I\+D\+S\+\_\+\+A\+P\+P\+\_\+\+T\+I\+T\+L\+E, Layout\+Menu(), malloc(), M\+A\+X\+\_\+\+L\+O\+A\+D\+S\+T\+R\+I\+N\+G, M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U, M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+X\+T, mswin\+\_\+get\+\_\+font(), N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+A\+B\+L\+E, N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+E\+D, N\+H\+Menu\+Text\+Wnd\+Proc(), N\+H\+W\+\_\+\+M\+E\+N\+U, on\+Draw\+Item(), on\+Measure\+Item(), on\+M\+S\+N\+H\+Command(), P\+I\+C\+K\+\_\+\+A\+N\+Y, P\+I\+C\+K\+\_\+\+N\+O\+N\+E, P\+I\+C\+K\+\_\+\+O\+N\+E, program\+\_\+state, reset\+\_\+menu\+\_\+count(), mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::result, Select\+Menu\+Item(), sinfo\+::stopprint, S\+Y\+S\+C\+L\+R\+\_\+\+T\+O\+\_\+\+B\+R\+U\+S\+H, text\+\_\+bg\+\_\+brush, text\+\_\+bg\+\_\+color, text\+\_\+fg\+\_\+brush, text\+\_\+fg\+\_\+color, T\+R\+U\+E, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::type, and W\+M\+\_\+\+M\+S\+N\+H\+\_\+\+C\+O\+M\+M\+A\+N\+D.


\begin{DoxyCode}
202 \{
203     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
204     HWND control;
205     HDC  hdc;
206     TCHAR title[\hyperlink{sys_2wince_2mhmain_8c_a2b68559d692760680c326428841254d1}{MAX\_LOADSTRING}];
207 
208 
209     data = (\hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
210     \textcolor{keywordflow}{switch} (message) 
211     \{
212     \textcolor{keywordflow}{case} WM\_INITDIALOG:
213         data = (\hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{PNHMenuWindow})\hyperlink{winproto_8h_ab028c02ac00afc0c1d3c568ccad68869}{malloc}(\textcolor{keyword}{sizeof}(\hyperlink{structmswin__nethack__menu__window}{NHMenuWindow}));
214         ZeroMemory(data, \textcolor{keyword}{sizeof}(\hyperlink{structmswin__nethack__menu__window}{NHMenuWindow}));
215         data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type} = \hyperlink{sys_2wince_2mhmenu_8h_ad863ba4d93ea3f9619d1f82c79c620e7}{MENU\_TYPE\_TEXT};
216         data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} = \hyperlink{wintype_8h_a9e3d317126c3eacb6311e15fedaf717c}{PICK\_NONE};
217         data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result} = 0;
218         data->\hyperlink{structmswin__nethack__menu__window_aaeb9b85cb77679ee1b41ac2b0377d90b}{done} = 0;
219         data->\hyperlink{structmswin__nethack__menu__window_a547aec082271327296a222cd550d0339}{bmpChecked} = LoadBitmap(\hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hApp, MAKEINTRESOURCE(
      \hyperlink{sys_2wince_2resource_8h_a90d12d567c7350d9f2898c2d629bb106}{IDB\_MENU\_SEL}));
220         data->\hyperlink{structmswin__nethack__menu__window_a489e74d381e225e45bdcd709b76a9c4a}{bmpCheckedCount} = LoadBitmap(\hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hApp, MAKEINTRESOURCE(
      \hyperlink{sys_2wince_2resource_8h_a8fdb5e8a629c32021045679b730d3a0d}{IDB\_MENU\_SEL\_COUNT}));
221         data->\hyperlink{structmswin__nethack__menu__window_a815f5ad41abbfa599ea0b35ddb7e2742}{bmpNotChecked} = LoadBitmap(\hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hApp, MAKEINTRESOURCE(
      \hyperlink{sys_2wince_2resource_8h_a55cf1ff7c2dfc10d8c35b0b8a238c354}{IDB\_MENU\_UNSEL}));
222         SetWindowLong(hWnd, GWL\_USERDATA, (LONG)data);
223 
224         \textcolor{comment}{/* set font for the text cotrol */}
225         control = GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_add6d9e4e19e8e119d474ba980520a4d2}{IDC\_MENU\_TEXT});
226         hdc = GetDC(control);
227         SendMessage(control, WM\_SETFONT, (WPARAM)\hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(
      \hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU}, \hyperlink{wintype_8h_a20a20b74e8cf84ecfbf3c8665c059636}{ATR\_NONE}, hdc, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}), (LPARAM)0);
228         ReleaseDC(control, hdc);
229 
230         \textcolor{comment}{/* subclass edit control */}
231         \hyperlink{win_2win32_2mhmenu_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{editControlWndProc} = (WNDPROC)GetWindowLong(control, GWL\_WNDPROC);
232         SetWindowLong(control, GWL\_WNDPROC, (LONG)\hyperlink{sys_2wince_2mhmenu_8c_a05d16c255df1c3017ab9d2db72a80352}{NHMenuTextWndProc});
233 
234         \textcolor{comment}{/* Even though the dialog has no caption, you can still set the title }
235 \textcolor{comment}{           which shows on Alt-Tab */}
236         LoadString(\hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hApp, \hyperlink{sys_2wince_2resource_8h_a636c9aea2a8d16b73e43df39b3e0e7bd}{IDS\_APP\_TITLE}, title, 
      \hyperlink{sys_2wince_2mhmain_8c_a2b68559d692760680c326428841254d1}{MAX\_LOADSTRING});
237         SetWindowText(hWnd, title);
238     \textcolor{keywordflow}{break};
239 
240     \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2mhmsg_8h_a55eac656fabe0d462816201ac756eab6}{WM\_MSNH\_COMMAND}:
241         \hyperlink{win_2win32_2mhmenu_8c_ab1f0aceef05a1dec643246c7cbf5353c}{onMSNHCommand}(hWnd, wParam, lParam);
242     \textcolor{keywordflow}{break};
243 
244     \textcolor{keywordflow}{case} WM\_SIZE:
245         \hyperlink{win_2win32_2mhmenu_8c_a4aff550d92784a0c5e7fcb8b9f86a15e}{LayoutMenu}(hWnd);
246     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
247 
248     \textcolor{keywordflow}{case} WM\_CLOSE:
249         \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a91c51d44f2b6e70f8a5d42a5b5218dcd}{program\_state}.\hyperlink{structsinfo_ac1f9d8fcec6871fb805fe566ac8a8823}{gameover}) \{
250         data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result} = -1;
251         data->\hyperlink{structmswin__nethack__menu__window_aaeb9b85cb77679ee1b41ac2b0377d90b}{done} = 1;
252         \hyperlink{decl_8h_a91c51d44f2b6e70f8a5d42a5b5218dcd}{program\_state}.\hyperlink{structsinfo_a722956debc5ac939d455ba63e60fd963}{stopprint}++;
253         \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
254         \} \textcolor{keywordflow}{else}
255             \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
256 
257     \textcolor{keywordflow}{case} WM\_COMMAND: 
258     \{
259         \textcolor{keywordflow}{switch} (LOWORD(wParam)) 
260         \{ 
261         \textcolor{keywordflow}{case} IDCANCEL:
262             \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type} == \hyperlink{sys_2wince_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{MENU\_TYPE\_MENU} && 
263                 (data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} || data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY}) &&
264                 data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.counting) \{
265                 HWND list;
266                 \textcolor{keywordtype}{int} i;
267 
268                 \textcolor{comment}{/* reset counter if counting is in progress */}
269                 list = \hyperlink{win_2win32_2mhmenu_8c_a871d7d2f2639f7ebf2e8e9f6f681bd0a}{GetMenuControl}(hWnd);
270                 i = ListView\_GetNextItem(list, -1,  LVNI\_FOCUSED);
271                 \textcolor{keywordflow}{if}( i>=0 ) \{
272                     \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(list, data, i,  0);
273                 \}
274                 \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
275             \} \textcolor{keywordflow}{else} \{
276                 data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result} = -1;
277                 data->\hyperlink{structmswin__nethack__menu__window_aaeb9b85cb77679ee1b41ac2b0377d90b}{done} = 1;
278             \}
279         \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
280 
281         \textcolor{keywordflow}{case} IDOK:
282             data->\hyperlink{structmswin__nethack__menu__window_aaeb9b85cb77679ee1b41ac2b0377d90b}{done} = 1;
283             data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result} = 0;
284         \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
285 
286         \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2resource_8h_add6d9e4e19e8e119d474ba980520a4d2}{IDC\_MENU\_TEXT}:
287           \textcolor{keywordflow}{switch} (HIWORD(wParam))
288           \{
289             \textcolor{keywordflow}{case} EN\_SETFOCUS:
290               HideCaret((HWND)lParam);
291               \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
292           \}
293         \}
294     \} \textcolor{keywordflow}{break};
295 
296     \textcolor{keywordflow}{case} WM\_NOTIFY:
297     \{
298         LPNMHDR lpnmhdr = (LPNMHDR)lParam;
299         \textcolor{keywordflow}{switch} (LOWORD(wParam)) \{
300         \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2resource_8h_a1af3a3967bc3f6d66a75d340c1f56678}{IDC\_MENU\_LIST}:
301         \{
302             \textcolor{keywordflow}{if}( !data || data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type}!=\hyperlink{sys_2wince_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{MENU\_TYPE\_MENU} ) \textcolor{keywordflow}{break};
303 
304             \textcolor{keywordflow}{switch}(lpnmhdr->code) \{
305             \textcolor{keywordflow}{case} LVN\_ITEMACTIVATE: 
306             \{
307                 LPNMLISTVIEW lpnmlv = (LPNMLISTVIEW)lParam;
308                 \textcolor{keywordflow}{if}(data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE}) \{
309                     \textcolor{keywordflow}{if}( lpnmlv->iItem>=0 &&
310                         lpnmlv->iItem<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size &&
311                         \hyperlink{win_2win32_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{NHMENU\_IS\_SELECTABLE}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[lpnmlv->iItem]) ) \{
312                         \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(
313                             lpnmlv->hdr.hwndFrom, 
314                             data, 
315                             lpnmlv->iItem, 
316                             -1
317                         );
318                         data->\hyperlink{structmswin__nethack__menu__window_aaeb9b85cb77679ee1b41ac2b0377d90b}{done} = 1;
319                         data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result} = 0;
320                         \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
321                     \}
322                 \}
323             \} \textcolor{keywordflow}{break};
324 
325             \textcolor{keywordflow}{case} NM\_CLICK: \{
326                 LPNMLISTVIEW lpnmitem = (LPNMLISTVIEW) lParam;
327                 \textcolor{keywordflow}{if}( lpnmitem->iItem==-1 ) \textcolor{keywordflow}{return} 0;
328                 \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
329                     \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(
330                         lpnmitem->hdr.hwndFrom, 
331                         data, 
332                         lpnmitem->iItem, 
333                         \hyperlink{win_2win32_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{NHMENU\_IS\_SELECTED}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[lpnmitem->iItem])? 0 : -1
334                     );
335                 \}
336             \} \textcolor{keywordflow}{break};
337 
338             \textcolor{keywordflow}{case} LVN\_ITEMCHANGED: 
339             \{
340                 LPNMLISTVIEW lpnmlv = (LPNMLISTVIEW)lParam;
341                 \textcolor{keywordflow}{if}( lpnmlv->iItem==-1 ) \textcolor{keywordflow}{return} 0;
342                 \textcolor{keywordflow}{if}( !(lpnmlv->uChanged & LVIF\_STATE) ) \textcolor{keywordflow}{return} 0;
343 
344                 \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} || data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
345                     data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[lpnmlv->iItem].has\_focus = !!(lpnmlv->uNewState & LVIS\_FOCUSED);
346                     ListView\_RedrawItems(lpnmlv->hdr.hwndFrom, lpnmlv->iItem, lpnmlv->iItem);
347                 \}
348 
349                 \textcolor{comment}{/* update count for single-selection menu (follow the listview selection) */}
350                 \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} ) \{
351                     \textcolor{keywordflow}{if}( lpnmlv->uNewState & LVIS\_SELECTED ) \{
352                         \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(
353                             lpnmlv->hdr.hwndFrom, 
354                             data, 
355                             lpnmlv->iItem, 
356                             -1
357                         );
358                     \}
359                 \}
360 
361                 \textcolor{comment}{/* check item focus */}
362                 \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} || data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
363                     data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[lpnmlv->iItem].has\_focus = !!(lpnmlv->uNewState & LVIS\_FOCUSED);
364                     ListView\_RedrawItems(lpnmlv->hdr.hwndFrom, lpnmlv->iItem, lpnmlv->iItem);
365                 \}
366             \} \textcolor{keywordflow}{break};
367 
368             \textcolor{keywordflow}{case} NM\_KILLFOCUS:
369                 \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(lpnmhdr->hwndFrom, data);
370             \textcolor{keywordflow}{break};
371 
372             \}
373         \} \textcolor{keywordflow}{break};
374         \}
375     \} \textcolor{keywordflow}{break};
376 
377     \textcolor{keywordflow}{case} WM\_SETFOCUS:
378         \textcolor{keywordflow}{if}( hWnd!=\hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hPopupWnd ) \{
379             SetFocus(\hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hPopupWnd );
380         \}
381     \textcolor{keywordflow}{break};
382     
383     \textcolor{keywordflow}{case} WM\_MEASUREITEM: 
384         \textcolor{keywordflow}{if}( wParam==\hyperlink{sys_2wince_2resource_8h_a1af3a3967bc3f6d66a75d340c1f56678}{IDC\_MENU\_LIST} )
385             \textcolor{keywordflow}{return} \hyperlink{win_2win32_2mhmenu_8c_a527e6fa96e8cf2ebbe785664951555b6}{onMeasureItem}(hWnd, wParam, lParam);
386         \textcolor{keywordflow}{else}
387             \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
388 
389     \textcolor{keywordflow}{case} WM\_DRAWITEM:
390         \textcolor{keywordflow}{if}( wParam==\hyperlink{sys_2wince_2resource_8h_a1af3a3967bc3f6d66a75d340c1f56678}{IDC\_MENU\_LIST} )
391             \textcolor{keywordflow}{return} \hyperlink{win_2win32_2mhmenu_8c_a09526f2ef32277c89886a7b74e5214eb}{onDrawItem}(hWnd, wParam, lParam);
392         \textcolor{keywordflow}{else}
393             \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
394 
395     \textcolor{keywordflow}{case} WM\_CTLCOLORSTATIC: \{ \textcolor{comment}{/* sent by edit control before it is drawn */}
396         HDC hdcEdit = (HDC) wParam; 
397         HWND hwndEdit = (HWND) lParam;
398         \textcolor{keywordflow}{if}( hwndEdit == GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_add6d9e4e19e8e119d474ba980520a4d2}{IDC\_MENU\_TEXT}) ) \{
399             SetBkColor(hdcEdit, 
400                 \hyperlink{win_2win32_2mswproc_8c_a25ec9999068f66e88062a207b0b122d8}{text\_bg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_a7101374a4b700d06a6ee6f951f029cd9}{text\_bg\_color} : (COLORREF)GetSysColor(
      \hyperlink{win_2win32_2mhmenu_8c_a31e380304152e012afbd6151c8f4cc70}{DEFAULT\_COLOR\_BG\_TEXT})
401                 );
402             SetTextColor(hdcEdit, 
403                 \hyperlink{win_2win32_2mswproc_8c_ae8798e75c0140495b7d71273b1c5d084}{text\_fg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_a7d6dc4a40034d2d5b6e6cd388d11096b}{text\_fg\_color} : (COLORREF)GetSysColor(
      \hyperlink{win_2win32_2mhmenu_8c_a47fb1e2e86d10f668872ccce87a250f6}{DEFAULT\_COLOR\_FG\_TEXT}) 
404                 ); 
405             \textcolor{keywordflow}{return} (BOOL)(\hyperlink{win_2win32_2mswproc_8c_a25ec9999068f66e88062a207b0b122d8}{text\_bg\_brush} 
406                     ? \hyperlink{win_2win32_2mswproc_8c_a25ec9999068f66e88062a207b0b122d8}{text\_bg\_brush} : \hyperlink{mhcolor_8h_ababa49ed211db00c071857fdd982ece1}{SYSCLR\_TO\_BRUSH}(
      \hyperlink{win_2win32_2mhmenu_8c_a31e380304152e012afbd6151c8f4cc70}{DEFAULT\_COLOR\_BG\_TEXT}));
407         \}
408     \} \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
409 
410     \textcolor{keywordflow}{case} WM\_DESTROY:
411         \textcolor{keywordflow}{if}( data ) \{
412             DeleteObject(data->\hyperlink{structmswin__nethack__menu__window_a547aec082271327296a222cd550d0339}{bmpChecked});
413             DeleteObject(data->\hyperlink{structmswin__nethack__menu__window_a489e74d381e225e45bdcd709b76a9c4a}{bmpCheckedCount});
414             DeleteObject(data->\hyperlink{structmswin__nethack__menu__window_a815f5ad41abbfa599ea0b35ddb7e2742}{bmpNotChecked});
415             \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type} == \hyperlink{sys_2wince_2mhmenu_8h_ad863ba4d93ea3f9619d1f82c79c620e7}{MENU\_TYPE\_TEXT} ) \{
416                 \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text ) \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text);
417             \}
418             \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(data);
419             SetWindowLong(hWnd, GWL\_USERDATA, (LONG)0);
420         \}
421         \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
422     \}
423     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
424 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a8c5ddcafb43564d6bbc9a6a422974797}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!mswin\+\_\+init\+\_\+menu\+\_\+window@{mswin\+\_\+init\+\_\+menu\+\_\+window}}
\index{mswin\+\_\+init\+\_\+menu\+\_\+window@{mswin\+\_\+init\+\_\+menu\+\_\+window}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{mswin\+\_\+init\+\_\+menu\+\_\+window}]{\setlength{\rightskip}{0pt plus 5cm}H\+W\+N\+D mswin\+\_\+init\+\_\+menu\+\_\+window (
\begin{DoxyParamCaption}
\item[{int}]{type}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhmenu_8c_a8c5ddcafb43564d6bbc9a6a422974797}


Definition at line 87 of file mhmenu.\+c.



References Create\+Dialog(), Get\+N\+H\+App(), I\+D\+D\+\_\+\+M\+E\+N\+U, Menu\+Wnd\+Proc(), panic(), and Set\+Menu\+Type().


\begin{DoxyCode}
87                                        \{
88     HWND ret;
89 
90     ret = \hyperlink{dialogs_8c_aaf356545a4c5797e317091864c988de0}{CreateDialog}(
91             \hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hApp,
92             MAKEINTRESOURCE(\hyperlink{sys_2wince_2resource_8h_a7a706fe51baa9204554045ed82ca2c9f}{IDD\_MENU}),
93             \hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hMainWnd,
94             \hyperlink{sys_2wince_2mhmenu_8c_a085082d0591741058c85b4ff41570488}{MenuWndProc}
95     );
96     \textcolor{keywordflow}{if}( !ret ) \{
97         \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Cannot create menu window"});
98     \}
99     
100     \hyperlink{win_2win32_2mhmenu_8c_a9a4ac79f4c285b52ae25582c25beb82d}{SetMenuType}(ret, \hyperlink{lev__main_8c_ac765329451135abec74c45e1897abf26}{type});
101     \textcolor{keywordflow}{return} ret;
102 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_ad900b8c309861a1826a11b4c49432c2a}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu@{mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu}}
\index{mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu@{mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu}]{\setlength{\rightskip}{0pt plus 5cm}int mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{int}]{how, }
\item[{{\bf M\+E\+N\+U\+\_\+\+I\+T\+E\+M\+\_\+\+P} $\ast$$\ast$}]{\+\_\+selected}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhmenu_8c_ad900b8c309861a1826a11b4c49432c2a}


Definition at line 104 of file mhmenu.\+c.



References assert, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::done, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::how, malloc(), mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::menu, M\+E\+N\+U\+\_\+\+F\+I\+R\+S\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+I\+N\+V\+E\+R\+T\+\_\+\+A\+L\+L, M\+E\+N\+U\+\_\+\+I\+N\+V\+E\+R\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+I\+T\+E\+M\+\_\+\+P, M\+E\+N\+U\+\_\+\+L\+A\+S\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+N\+E\+X\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+P\+R\+E\+V\+I\+O\+U\+S\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+S\+E\+A\+R\+C\+H, M\+E\+N\+U\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+A\+L\+L, M\+E\+N\+U\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U, M\+E\+N\+U\+\_\+\+U\+N\+S\+E\+L\+E\+C\+T\+\_\+\+A\+L\+L, M\+E\+N\+U\+\_\+\+U\+N\+S\+E\+L\+E\+C\+T\+\_\+\+P\+A\+G\+E, mswin\+\_\+popup\+\_\+destroy(), mswin\+\_\+popup\+\_\+display(), N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+A\+B\+L\+E, N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+E\+D, N\+U\+L\+L, panic(), P\+I\+C\+K\+\_\+\+A\+N\+Y, P\+I\+C\+K\+\_\+\+N\+O\+N\+E, P\+I\+C\+K\+\_\+\+O\+N\+E, reset\+\_\+menu\+\_\+count(), mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::result, Set\+Menu\+List\+Type(), and mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::type.


\begin{DoxyCode}
105 \{
106     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
107     \textcolor{keywordtype}{int} ret\_val;
108     \hyperlink{wintype_8h_a56b56557611b7f64f4e6585a1b78c8f9}{MENU\_ITEM\_P} *selected = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
109     \textcolor{keywordtype}{int} i;
110     \textcolor{keywordtype}{char}* ap;
111 
112     \hyperlink{assert_8h_a6f56363b38edbe2c8f3f447f891ee2c0}{assert}( \_selected!=\hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} );
113     *\_selected = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
114     ret\_val = -1;
115 
116     data = (\hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
117 
118     \textcolor{comment}{/* set menu type */}
119     \hyperlink{win_2win32_2mhmenu_8c_a9935a9b932fd4f54e94b72e7cd0dee54}{SetMenuListType}(hWnd, how);
120 
121     \textcolor{comment}{/* Ok, now give items a unique accelerators */}
122     \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type} == \hyperlink{sys_2wince_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{MENU\_TYPE\_MENU} ) \{
123         \textcolor{keywordtype}{char} next\_char = \textcolor{charliteral}{'a'};
124 
125         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.gacc[0] = \textcolor{charliteral}{'\(\backslash\)0'};
126         ap = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.gacc;
127         \textcolor{keywordflow}{for}( i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size;  i++) \{
128             \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator!=0 ) \{
129                 next\_char = (char)(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator+1);
130             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{win_2win32_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{NHMENU\_IS\_SELECTABLE}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i]) ) \{
131                 \textcolor{keywordflow}{if} ( (next\_char>=\textcolor{charliteral}{'a'} && next\_char<=\textcolor{charliteral}{'z'}) ||
132                      (next\_char>=\textcolor{charliteral}{'A'} && next\_char<=\textcolor{charliteral}{'Z'}) )  \{
133                      data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator = next\_char;
134                 \} \textcolor{keywordflow}{else} \{
135                     \textcolor{keywordflow}{if}( next\_char > \textcolor{charliteral}{'z'} ) next\_char = \textcolor{charliteral}{'A'};
136                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( next\_char > \textcolor{charliteral}{'Z'} ) \textcolor{keywordflow}{break};
137 
138                     data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator = next\_char;
139                 \}
140 
141                 next\_char ++;
142             \}
143         \}
144 
145         \textcolor{comment}{/* collect group accelerators */}
146         \textcolor{keywordflow}{for}( i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size;  i++) \{
147             \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} != \hyperlink{wintype_8h_a9e3d317126c3eacb6311e15fedaf717c}{PICK\_NONE} ) \{
148                 \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].group\_accel && 
149                     !strchr(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.gacc, data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].group\_accel) ) \{
150                     *ap++ = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].group\_accel;
151                     *ap = \textcolor{stringliteral}{'\(\backslash\)x0'};
152                 \}
153             \}
154         \}
155 
156         \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(\hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, data);
157     \}
158 
159     \hyperlink{sys_2wince_2mswproc_8c_a2a23443a8cfc6b5b41024850877e0f5e}{mswin\_popup\_display}(hWnd, &data->\hyperlink{structmswin__nethack__menu__window_aaeb9b85cb77679ee1b41ac2b0377d90b}{done});
160 
161     \textcolor{comment}{/* get the result */}
162     \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result} != -1 ) \{
163         \textcolor{keywordflow}{if}(how==\hyperlink{wintype_8h_a9e3d317126c3eacb6311e15fedaf717c}{PICK\_NONE}) \{
164             \textcolor{keywordflow}{if}(data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result}>=0) ret\_val=0;
165             \textcolor{keywordflow}{else}                ret\_val=-1;
166         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(how==\hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} || how==\hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY}) \{
167             \textcolor{comment}{/* count selected items */}
168             ret\_val = 0;
169             \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
170                 \textcolor{keywordflow}{if}( \hyperlink{win_2win32_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{NHMENU\_IS\_SELECTABLE}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i]) &&
171                     \hyperlink{win_2win32_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{NHMENU\_IS\_SELECTED}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i]) ) \{
172                     ret\_val++;
173                 \}
174             \}
175             \textcolor{keywordflow}{if}( ret\_val > 0 ) \{
176                 \textcolor{keywordtype}{int} sel\_ind;
177 
178                 selected = (\hyperlink{wintype_8h_a56b56557611b7f64f4e6585a1b78c8f9}{MENU\_ITEM\_P}*)\hyperlink{winproto_8h_ab028c02ac00afc0c1d3c568ccad68869}{malloc}(ret\_val*\textcolor{keyword}{sizeof}(
      \hyperlink{wintype_8h_a56b56557611b7f64f4e6585a1b78c8f9}{MENU\_ITEM\_P}));
179                 \textcolor{keywordflow}{if}( !selected ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"out of memory"});
180 
181                 sel\_ind = 0;
182                 \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
183                     \textcolor{keywordflow}{if}( \hyperlink{win_2win32_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{NHMENU\_IS\_SELECTABLE}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i]) &&
184                         \hyperlink{win_2win32_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{NHMENU\_IS\_SELECTED}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i]) ) \{
185                         selected[sel\_ind].item = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].identifier;
186                         selected[sel\_ind].count = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].count;
187                         sel\_ind++;
188                     \}
189                 \}
190                 ret\_val = sel\_ind;
191                 *\_selected = selected;
192             \}
193         \}
194     \}
195 
196     \hyperlink{sys_2wince_2mswproc_8c_a49804134a4aaa8874010372eae4612f9}{mswin\_popup\_destroy}(hWnd);
197 
198     \textcolor{keywordflow}{return} ret\_val;
199 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a522c5050d80d7397e9f59b00c47e13f0}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!mswin\+\_\+menu\+\_\+window\+\_\+size@{mswin\+\_\+menu\+\_\+window\+\_\+size}}
\index{mswin\+\_\+menu\+\_\+window\+\_\+size@{mswin\+\_\+menu\+\_\+window\+\_\+size}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{mswin\+\_\+menu\+\_\+window\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}void mswin\+\_\+menu\+\_\+window\+\_\+size (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{L\+P\+S\+I\+Z\+E}]{sz}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhmenu_8c_a522c5050d80d7397e9f59b00c47e13f0}


Definition at line 1238 of file mhmenu.\+c.



References A\+T\+R\+\_\+\+N\+O\+N\+E, B\+U\+F\+S\+Z, F\+A\+L\+S\+E, Get\+Menu\+Control(), max, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::menu, M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U, mswin\+\_\+get\+\_\+font(), N\+H\+\_\+\+A2\+W, N\+H\+W\+\_\+\+M\+E\+N\+U, N\+U\+L\+L, T\+A\+B\+\_\+\+S\+E\+P\+A\+R\+A\+T\+I\+O\+N, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::text, T\+I\+L\+E\+\_\+\+X, and mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::type.


\begin{DoxyCode}
1239 \{
1240     TEXTMETRIC \hyperlink{structtm}{tm};
1241     HWND control;
1242     HGDIOBJ saveFont;
1243     HDC hdc;
1244     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
1245     \textcolor{keywordtype}{int} i;
1246     RECT rt, wrt;
1247     \textcolor{keywordtype}{int} extra\_cx;
1248 
1249     GetClientRect(hWnd, &rt);
1250     sz->cx = rt.right - rt.left;
1251     sz->cy = rt.bottom - rt.top;
1252 
1253     GetWindowRect(hWnd, &wrt);
1254     extra\_cx = (wrt.right-wrt.left) - sz->cx;
1255 
1256     data = (\hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
1257     \textcolor{keywordflow}{if}(data) \{
1258         control = \hyperlink{win_2win32_2mhmenu_8c_a871d7d2f2639f7ebf2e8e9f6f681bd0a}{GetMenuControl}(hWnd);
1259         hdc = GetDC(control);
1260 
1261         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type}==\hyperlink{sys_2wince_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{MENU\_TYPE\_MENU} ) \{
1262             \textcolor{comment}{/* Calculate the width of the list box. */}
1263             saveFont = SelectObject(hdc, \hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(\hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU}, 
      \hyperlink{wintype_8h_a20a20b74e8cf84ecfbf3c8665c059636}{ATR\_NONE}, hdc, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}));
1264             GetTextMetrics(hdc, &tm);
1265             \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
1266                 LONG menuitemwidth = 0;
1267                 \textcolor{keywordtype}{int} column;
1268                 \textcolor{keywordtype}{char} *p, *p1;
1269 
1270                 p1 = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].str;
1271                 p = strchr(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].str, \textcolor{charliteral}{'\(\backslash\)t'});
1272                 column = 0;
1273                 \textcolor{keywordflow}{for} (;;) \{
1274                     TCHAR wbuf[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
1275                     RECT tabRect;
1276                     SetRect ( &tabRect, 0, 0, 1, 1 );
1277                     \textcolor{keywordflow}{if} (p != \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}) *p = \textcolor{charliteral}{'\(\backslash\)0'}; \textcolor{comment}{/* for time being, view tab field as zstring */}
1278                     DrawText(hdc,
1279                         \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(p1, wbuf, \hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}),
1280                         strlen(p1),
1281                         &tabRect,
1282                         DT\_CALCRECT | DT\_LEFT | DT\_VCENTER | DT\_SINGLELINE
1283                     );
1284                     \textcolor{comment}{/* it probably isn't necessary to recompute the tab width now, but do so}
1285 \textcolor{comment}{                     * just in case, honoring the previously computed value}
1286 \textcolor{comment}{                     */}
1287                     menuitemwidth += \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.tab\_stop\_size[column],
1288                         tabRect.right - tabRect.left);
1289                     \textcolor{keywordflow}{if} (p != \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}) *p = \textcolor{charliteral}{'\(\backslash\)t'};
1290                     \textcolor{keywordflow}{else} \textcolor{comment}{/* last string so, */} \textcolor{keywordflow}{break};
1291                     \textcolor{comment}{/* add the separation only when not the last item */}
1292                     \textcolor{comment}{/* in the last item, we break out of the loop, in the statement just above */}
1293                     menuitemwidth += \hyperlink{win_2win32_2mhmenu_8c_a2d7b0f76873a47cdd301b0a7c222a681}{TAB\_SEPARATION};
1294                     ++column;
1295                     p1 = p + 1;
1296                     p = strchr(p1, \textcolor{charliteral}{'\(\backslash\)t'});
1297                 \}
1298 
1299                 sz->cx = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(sz->cx, 
1300                     (LONG)(2*\hyperlink{sys_2wince_2winMS_8h_a9f3fae6a9058d02850af5deba9be4544}{TILE\_X} + menuitemwidth + tm.tmAveCharWidth*12 + tm.tmOverhang));
1301             \}
1302             SelectObject(hdc, saveFont);
1303         \} \textcolor{keywordflow}{else} \{
1304             \textcolor{comment}{/* Calculate the width of the text box. */}
1305             RECT text\_rt;
1306             saveFont = SelectObject(hdc, \hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(\hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU}, 
      \hyperlink{wintype_8h_a20a20b74e8cf84ecfbf3c8665c059636}{ATR\_NONE}, hdc, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}));
1307             GetTextMetrics(hdc, &tm);
1308             SetRect(&text\_rt, 0, 0, sz->cx, sz->cy);
1309             DrawText(hdc, data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text, \_tcslen(data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text), &text\_rt, DT\_CALCRECT | DT\_TOP
       | DT\_LEFT | DT\_NOPREFIX);
1310             sz->cx = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(sz->cx, text\_rt.right - text\_rt.left + 5*tm.tmAveCharWidth + tm.tmOverhang);
1311             SelectObject(hdc, saveFont);
1312         \}
1313         sz->cx += extra\_cx;
1314 
1315         ReleaseDC(control, hdc);
1316     \}
1317 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a98cae3dd2cc1e5ed8696141ea0af9736}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!N\+H\+Menu\+List\+Wnd\+Proc@{N\+H\+Menu\+List\+Wnd\+Proc}}
\index{N\+H\+Menu\+List\+Wnd\+Proc@{N\+H\+Menu\+List\+Wnd\+Proc}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{N\+H\+Menu\+List\+Wnd\+Proc}]{\setlength{\rightskip}{0pt plus 5cm}L\+R\+E\+S\+U\+L\+T C\+A\+L\+L\+B\+A\+C\+K N\+H\+Menu\+List\+Wnd\+Proc (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{{\bf U\+I\+N\+T}}]{message, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhmenu_8c_a98cae3dd2cc1e5ed8696141ea0af9736}


Definition at line 1349 of file mhmenu.\+c.



References F\+A\+L\+S\+E, on\+List\+Char(), T\+R\+U\+E, and wnd\+Proc\+List\+View\+Orig.


\begin{DoxyCode}
1350 \{
1351     BOOL bUpdateFocusItem;
1352 
1353     bUpdateFocusItem = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1354 
1355     \textcolor{keywordflow}{switch}(message) \{
1356 
1357     \textcolor{comment}{/* filter keyboard input for the control */}
1358     \textcolor{keywordflow}{case} WM\_KEYDOWN:
1359     \textcolor{keywordflow}{case} WM\_KEYUP: \{
1360         MSG msg;
1361         BOOL processed;
1362 
1363         processed = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1364         \textcolor{keywordflow}{if}( PeekMessage(&msg, hWnd, WM\_CHAR, WM\_CHAR, PM\_REMOVE) ) \{
1365             \textcolor{keywordflow}{if}( \hyperlink{win_2win32_2mhmenu_8c_a0fc93365413fa232f797e9bffa6780a9}{onListChar}(GetParent(hWnd), hWnd, (\textcolor{keywordtype}{char})msg.wParam)==-2 ) \{
1366                 processed = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1367             \}
1368         \}
1369         \textcolor{keywordflow}{if}( processed ) \textcolor{keywordflow}{return} 0;
1370 
1371         \textcolor{keywordflow}{if}( wParam==VK\_LEFT || wParam==VK\_RIGHT )
1372             bUpdateFocusItem = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1373     \} \textcolor{keywordflow}{break};
1374 
1375     \textcolor{keywordflow}{case} WM\_SIZE:
1376     \textcolor{keywordflow}{case} WM\_HSCROLL:
1377         bUpdateFocusItem = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1378     \textcolor{keywordflow}{break};
1379 
1380     \}
1381 
1382     \textcolor{keywordflow}{if}( bUpdateFocusItem ) \{
1383         \textcolor{keywordtype}{int} i;
1384         RECT rt;
1385 
1386         \textcolor{comment}{/* invalidate the focus rectangle */}
1387         i = ListView\_GetNextItem(hWnd, -1,  LVNI\_FOCUSED);
1388         \textcolor{keywordflow}{if}( i!=-1 ) \{
1389             ListView\_GetItemRect(hWnd, i, &rt, LVIR\_BOUNDS);
1390             InvalidateRect(hWnd, &rt, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
1391         \}
1392     \}
1393 
1394     \textcolor{keywordflow}{if}( \hyperlink{win_2win32_2mhmenu_8c_a34b2053bf1601b3dc7b10796c1040cdc}{wndProcListViewOrig} ) 
1395         \textcolor{keywordflow}{return} CallWindowProc(\hyperlink{win_2win32_2mhmenu_8c_a34b2053bf1601b3dc7b10796c1040cdc}{wndProcListViewOrig}, hWnd, message, wParam, lParam);
1396     \textcolor{keywordflow}{else} 
1397         \textcolor{keywordflow}{return} 0;
1398 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a05d16c255df1c3017ab9d2db72a80352}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!N\+H\+Menu\+Text\+Wnd\+Proc@{N\+H\+Menu\+Text\+Wnd\+Proc}}
\index{N\+H\+Menu\+Text\+Wnd\+Proc@{N\+H\+Menu\+Text\+Wnd\+Proc}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{N\+H\+Menu\+Text\+Wnd\+Proc}]{\setlength{\rightskip}{0pt plus 5cm}L\+R\+E\+S\+U\+L\+T C\+A\+L\+L\+B\+A\+C\+K N\+H\+Menu\+Text\+Wnd\+Proc (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{{\bf U\+I\+N\+T}}]{message, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhmenu_8c_a05d16c255df1c3017ab9d2db72a80352}


Definition at line 1401 of file mhmenu.\+c.



References edit\+Control\+Wnd\+Proc, and Get\+N\+H\+App().


\begin{DoxyCode}
1402 \{
1403     \textcolor{keywordflow}{switch}(message) \{
1404 
1405     \textcolor{keywordflow}{case} WM\_KEYDOWN:
1406         \textcolor{keywordflow}{switch} (wParam)
1407         \{
1408         \textcolor{comment}{/* close on space in Windows mode}
1409 \textcolor{comment}{           page down on space in NetHack mode */}
1410         \textcolor{keywordflow}{case} VK\_SPACE:
1411         \{   
1412             SCROLLINFO si;
1413 
1414             si.cbSize = \textcolor{keyword}{sizeof}(SCROLLINFO);
1415             si.fMask = SIF\_POS | SIF\_RANGE | SIF\_PAGE;
1416             GetScrollInfo(hWnd, SB\_VERT, &si);
1417             \textcolor{comment}{/* If nethackmode and not at the end of the list */}
1418             \textcolor{keywordflow}{if} (\hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->regNetHackMode &&
1419                     (si.nPos + (\textcolor{keywordtype}{int})si.nPage) <= (si.nMax - si.nMin))
1420                 SendMessage(hWnd, EM\_SCROLL, SB\_PAGEDOWN, 0);
1421             \textcolor{keywordflow}{else}
1422                 PostMessage(GetParent(hWnd), WM\_COMMAND, MAKELONG(IDOK, 0), 0);
1423             \textcolor{keywordflow}{return} 0;
1424         \}
1425         \textcolor{keywordflow}{case} VK\_NEXT:
1426             SendMessage(hWnd, EM\_SCROLL, SB\_PAGEDOWN, 0);
1427             \textcolor{keywordflow}{return} 0;
1428         \textcolor{keywordflow}{case} VK\_PRIOR:
1429             SendMessage(hWnd, EM\_SCROLL, SB\_PAGEUP, 0);
1430             \textcolor{keywordflow}{return} 0;
1431         \textcolor{keywordflow}{case} VK\_UP:
1432             SendMessage(hWnd, EM\_SCROLL, SB\_LINEUP, 0);
1433             \textcolor{keywordflow}{return} 0;
1434         \textcolor{keywordflow}{case} VK\_DOWN:
1435             SendMessage(hWnd, EM\_SCROLL, SB\_LINEDOWN, 0);
1436             \textcolor{keywordflow}{return} 0;
1437 
1438         \}
1439     \textcolor{keywordflow}{break};
1440 
1441     \}
1442 
1443     \textcolor{keywordflow}{if}( \hyperlink{win_2win32_2mhmenu_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{editControlWndProc} ) 
1444         \textcolor{keywordflow}{return} CallWindowProc(\hyperlink{win_2win32_2mhmenu_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{editControlWndProc}, hWnd, message, wParam, lParam);
1445     \textcolor{keywordflow}{else} 
1446         \textcolor{keywordflow}{return} 0;
1447 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a09526f2ef32277c89886a7b74e5214eb}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!on\+Draw\+Item@{on\+Draw\+Item}}
\index{on\+Draw\+Item@{on\+Draw\+Item}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{on\+Draw\+Item}]{\setlength{\rightskip}{0pt plus 5cm}B\+O\+O\+L on\+Draw\+Item (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmenu_8c_a09526f2ef32277c89886a7b74e5214eb}


Definition at line 753 of file mhmenu.\+c.



References mswin\+\_\+menu\+\_\+item\+::accelerator, A\+T\+R\+\_\+\+B\+L\+I\+N\+K, mswin\+\_\+menu\+\_\+item\+::attr, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::bmp\+Checked, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::bmp\+Checked\+Count, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::bmp\+Not\+Checked, buf, B\+U\+F\+S\+Z, mswin\+\_\+menu\+\_\+item\+::count, D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+E\+N\+U, D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+E\+N\+U, F\+A\+L\+S\+E, Get\+N\+H\+App(), mswin\+\_\+menu\+\_\+item\+::glyph, glyph2tile, mswin\+\_\+menu\+\_\+item\+::has\+\_\+focus, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::how, max, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::menu, menu\+\_\+bg\+\_\+brush, menu\+\_\+bg\+\_\+color, menu\+\_\+fg\+\_\+brush, menu\+\_\+fg\+\_\+color, min, mswin\+\_\+get\+\_\+font(), N\+H\+\_\+\+A2\+W, nhapply\+\_\+image\+\_\+transparent(), N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+A\+B\+L\+E, N\+H\+W\+\_\+\+M\+E\+N\+U, N\+O\+\_\+\+G\+L\+Y\+P\+H, N\+U\+L\+L, P\+I\+C\+K\+\_\+\+N\+O\+N\+E, mswin\+\_\+menu\+\_\+item\+::str, S\+Y\+S\+C\+L\+R\+\_\+\+T\+O\+\_\+\+B\+R\+U\+S\+H, T\+A\+B\+\_\+\+S\+E\+P\+A\+R\+A\+T\+I\+O\+N, T\+I\+L\+E\+\_\+\+B\+K\+\_\+\+C\+O\+L\+O\+R, T\+I\+L\+E\+\_\+\+X, T\+I\+L\+E\+\_\+\+Y, T\+I\+L\+E\+S\+\_\+\+P\+E\+R\+\_\+\+L\+I\+N\+E, and T\+R\+U\+E.



Referenced by Menu\+Wnd\+Proc().


\begin{DoxyCode}
754 \{
755     LPDRAWITEMSTRUCT lpdis;
756     \hyperlink{structmswin__menu__item}{PNHMenuItem} item;
757     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
758     TEXTMETRIC \hyperlink{structtm}{tm};
759     HGDIOBJ saveFont;
760     HDC tileDC;
761     \textcolor{keywordtype}{short} ntile;
762     \textcolor{keywordtype}{int} t\_x, t\_y;
763     \textcolor{keywordtype}{int} x, y;
764     TCHAR wbuf[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
765     RECT drawRect;
766     COLORREF OldBg, OldFg, NewBg;
767     \textcolor{keywordtype}{char} *p, *p1;
768     \textcolor{keywordtype}{int} column;
769 
770     lpdis = (LPDRAWITEMSTRUCT) lParam; 
771 
772     \textcolor{comment}{/* If there are no list box items, skip this message. */}
773     \textcolor{keywordflow}{if} (lpdis->itemID == -1) \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
774 
775     data = (\hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
776 
777     item = &data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[lpdis->itemID];
778 
779     tileDC = CreateCompatibleDC(lpdis->hDC);
780     saveFont = SelectObject(lpdis->hDC, \hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(\hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU}, item->
      \hyperlink{structmswin__menu__item_aac16c04c8ecd7b7870d65034453cfd34}{attr}, lpdis->hDC, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}));
781     NewBg = \hyperlink{win_2win32_2mswproc_8c_a82f41013a422d657deaf09b86d42d9dc}{menu\_bg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_a6c5f5c1c14159485ea2ee8e462c288d3}{menu\_bg\_color} : (COLORREF)GetSysColor(
      \hyperlink{win_2win32_2mhmenu_8c_ac191df8eb452650490d0c60a03ab7f3a}{DEFAULT\_COLOR\_BG\_MENU});
782     OldBg = SetBkColor(lpdis->hDC, NewBg);
783     OldFg = SetTextColor(lpdis->hDC, 
784         \hyperlink{win_2win32_2mswproc_8c_a94470d3f3e89c1d7c044cde918769758}{menu\_fg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_aa44669b1e3ababfe264bea52ed3de6fe}{menu\_fg\_color} : (COLORREF)GetSysColor(
      \hyperlink{win_2win32_2mhmenu_8c_a08fcecfa6bc73cb3245146aa07fe4a02}{DEFAULT\_COLOR\_FG\_MENU})); 
785 
786     GetTextMetrics(lpdis->hDC, &tm);
787 
788     x = lpdis->rcItem.left + 1;
789 
790     \textcolor{comment}{/* print check mark and letter */}
791     \textcolor{keywordflow}{if}( \hyperlink{win_2win32_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{NHMENU\_IS\_SELECTABLE}(*item) ) \{
792  \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[2];
793  \textcolor{keywordflow}{if} (data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} != \hyperlink{wintype_8h_a9e3d317126c3eacb6311e15fedaf717c}{PICK\_NONE}) \{
794         HGDIOBJ saveBrush;
795         HBRUSH  hbrCheckMark;
796 
797         \textcolor{keywordflow}{switch}(item->\hyperlink{structmswin__menu__item_a28629e81df6ba5b0b67cf8309e20edaa}{count}) \{
798         \textcolor{keywordflow}{case} -1: hbrCheckMark = CreatePatternBrush(data->\hyperlink{structmswin__nethack__menu__window_a547aec082271327296a222cd550d0339}{bmpChecked}); \textcolor{keywordflow}{break};
799         \textcolor{keywordflow}{case} 0: hbrCheckMark = CreatePatternBrush(data->\hyperlink{structmswin__nethack__menu__window_a815f5ad41abbfa599ea0b35ddb7e2742}{bmpNotChecked}); \textcolor{keywordflow}{break};
800         \textcolor{keywordflow}{default}: hbrCheckMark = CreatePatternBrush(data->\hyperlink{structmswin__nethack__menu__window_a489e74d381e225e45bdcd709b76a9c4a}{bmpCheckedCount}); \textcolor{keywordflow}{break};
801         \}
802 
803         y = (lpdis->rcItem.bottom + lpdis->rcItem.top - \hyperlink{sys_2wince_2winMS_8h_a4a62524a49a9be02996b8e667b45abc9}{TILE\_Y}) / 2; 
804         SetBrushOrgEx(lpdis->hDC, x, y, \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
805         saveBrush = SelectObject(lpdis->hDC, hbrCheckMark);
806         PatBlt(lpdis->hDC, x, y, \hyperlink{sys_2wince_2winMS_8h_a9f3fae6a9058d02850af5deba9be4544}{TILE\_X}, \hyperlink{sys_2wince_2winMS_8h_a4a62524a49a9be02996b8e667b45abc9}{TILE\_Y}, PATCOPY);
807         SelectObject(lpdis->hDC, saveBrush);
808         DeleteObject(hbrCheckMark);
809 
810  \}
811         x += \hyperlink{sys_2wince_2winMS_8h_a9f3fae6a9058d02850af5deba9be4544}{TILE\_X} + 5;
812         \textcolor{keywordflow}{if}(item->\hyperlink{structmswin__menu__item_a68edbe01b9a5545b8d4c54fb70a51300}{accelerator}!=0) \{
813             buf[0] = item->\hyperlink{structmswin__menu__item_a68edbe01b9a5545b8d4c54fb70a51300}{accelerator};
814             buf[1] = \textcolor{stringliteral}{'\(\backslash\)x0'};
815 
816             SetRect( &drawRect, x, lpdis->rcItem.top, lpdis->rcItem.right, lpdis->rcItem.bottom );
817             DrawText(lpdis->hDC, \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(buf, wbuf, 2), 1, &drawRect, DT\_LEFT | DT\_VCENTER | 
      DT\_SINGLELINE | DT\_NOPREFIX);
818         \}
819         x += tm.tmAveCharWidth + tm.tmOverhang + 5;
820     \} \textcolor{keywordflow}{else} \{
821         x += \hyperlink{sys_2wince_2winMS_8h_a9f3fae6a9058d02850af5deba9be4544}{TILE\_X} + tm.tmAveCharWidth + tm.tmOverhang + 10;
822     \}
823 
824     \textcolor{comment}{/* print glyph if present */}
825     \textcolor{keywordflow}{if}( item->\hyperlink{structmswin__menu__item_a9184b47db8a12d06f5247a420a9ece34}{glyph} != \hyperlink{display_8h_ac36b9cc8436af3cf1f7f9919878d8354}{NO\_GLYPH} ) \{
826         HGDIOBJ saveBmp;
827 
828         saveBmp = SelectObject(tileDC, \hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->bmpTiles);               
829         ntile = \hyperlink{sys_2wince_2mhmenu_8c_a4d61aa736dae8287d97c3a68a3a917c5}{glyph2tile}[ item->\hyperlink{structmswin__menu__item_a9184b47db8a12d06f5247a420a9ece34}{glyph} ];
830         t\_x = (ntile % \hyperlink{sys_2wince_2winMS_8h_a1eaa02a47952ddaac086c1c00b92d0d6}{TILES\_PER\_LINE})*\hyperlink{sys_2wince_2winMS_8h_a9f3fae6a9058d02850af5deba9be4544}{TILE\_X};
831         t\_y = (ntile / \hyperlink{sys_2wince_2winMS_8h_a1eaa02a47952ddaac086c1c00b92d0d6}{TILES\_PER\_LINE})*\hyperlink{sys_2wince_2winMS_8h_a4a62524a49a9be02996b8e667b45abc9}{TILE\_Y};
832 
833         y = (lpdis->rcItem.bottom + lpdis->rcItem.top - \hyperlink{sys_2wince_2winMS_8h_a4a62524a49a9be02996b8e667b45abc9}{TILE\_Y}) / 2; 
834 
835         \hyperlink{sys_2wince_2mhmap_8c_afb458d94567c267343944df598e6f1e9}{nhapply\_image\_transparent}(
836             lpdis->hDC, x, y, \hyperlink{sys_2wince_2winMS_8h_a9f3fae6a9058d02850af5deba9be4544}{TILE\_X}, \hyperlink{sys_2wince_2winMS_8h_a4a62524a49a9be02996b8e667b45abc9}{TILE\_Y}, 
837             tileDC, t\_x, t\_y, \hyperlink{sys_2wince_2winMS_8h_a9f3fae6a9058d02850af5deba9be4544}{TILE\_X}, \hyperlink{sys_2wince_2winMS_8h_a4a62524a49a9be02996b8e667b45abc9}{TILE\_Y}, \hyperlink{sys_2wince_2winMS_8h_a43f48db3369313aac6df5acfab57a642}{TILE\_BK\_COLOR} );
838         SelectObject(tileDC, saveBmp);
839     \}
840 
841     x += \hyperlink{sys_2wince_2winMS_8h_a9f3fae6a9058d02850af5deba9be4544}{TILE\_X} + 5;
842 
843     \textcolor{comment}{/* draw item text */}
844 
845     p1 = item->\hyperlink{structmswin__menu__item_a6644e3aa5c3da84efdad362cc01adc66}{str};
846     p = strchr(item->\hyperlink{structmswin__menu__item_a6644e3aa5c3da84efdad362cc01adc66}{str}, \textcolor{charliteral}{'\(\backslash\)t'});
847     column = 0;
848     SetRect( &drawRect, x, lpdis->rcItem.top, \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(x + data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.tab\_stop\_size[0], lpdis->rcItem.
      right),
849         lpdis->rcItem.bottom );
850     \textcolor{keywordflow}{for} (;;) \{
851         TCHAR wbuf[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
852         \textcolor{keywordflow}{if} (p != \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}) *p = \textcolor{charliteral}{'\(\backslash\)0'}; \textcolor{comment}{/* for time being, view tab field as zstring */}
853         DrawText(lpdis->hDC,
854             \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(p1, wbuf, \hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}),
855             strlen(p1),
856             &drawRect,
857             DT\_LEFT | DT\_VCENTER | DT\_SINGLELINE
858         );
859         \textcolor{keywordflow}{if} (p != \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}) *p = \textcolor{charliteral}{'\(\backslash\)t'};
860         \textcolor{keywordflow}{else} \textcolor{comment}{/* last string so, */} \textcolor{keywordflow}{break};
861 
862         p1 = p + 1;
863         p = strchr(p1, \textcolor{charliteral}{'\(\backslash\)t'});
864         drawRect.left = drawRect.right + \hyperlink{win_2win32_2mhmenu_8c_a2d7b0f76873a47cdd301b0a7c222a681}{TAB\_SEPARATION};
865         ++column;
866         drawRect.right = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min} (drawRect.left + data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.tab\_stop\_size[column], lpdis->rcItem.right)
      ;
867     \}
868 
869     \textcolor{comment}{/* draw focused item */}
870     \textcolor{keywordflow}{if}( item->\hyperlink{structmswin__menu__item_ab880fce63154e7b3be65441f1f11f1c8}{has\_focus} 
871         || (\hyperlink{win_2win32_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{NHMENU\_IS\_SELECTABLE}(*item) && 
872             data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[lpdis->itemID].count!=-1)) \{
873         RECT client\_rt;
874 
875         GetClientRect(lpdis->hwndItem, &client\_rt);
876         \textcolor{keywordflow}{if}( \hyperlink{win_2win32_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{NHMENU\_IS\_SELECTABLE}(*item) && 
877             data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[lpdis->itemID].count!=0 &&
878             item->\hyperlink{structmswin__menu__item_a9184b47db8a12d06f5247a420a9ece34}{glyph} != \hyperlink{display_8h_ac36b9cc8436af3cf1f7f9919878d8354}{NO\_GLYPH} ) \{
879             \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[lpdis->itemID].count==-1 ) \{
880                 \_stprintf(wbuf, TEXT(\textcolor{stringliteral}{"Count: All"}) );
881             \} \textcolor{keywordflow}{else} \{
882                 \_stprintf(wbuf, TEXT(\textcolor{stringliteral}{"Count: %d"}), data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[lpdis->itemID].count );
883             \}
884 
885             SelectObject(lpdis->hDC, \hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(\hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU}, 
      \hyperlink{wintype_8h_a9d66a94b42076440893a6250fe72a8a8}{ATR\_BLINK}, lpdis->hDC, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}));
886 
887             \textcolor{comment}{/* calculate text rectangle */}
888             SetRect( &drawRect, client\_rt.left, lpdis->rcItem.top, client\_rt.right, lpdis->rcItem.bottom );
889             DrawText(lpdis->hDC, wbuf, \_tcslen(wbuf), &drawRect, 
890                      DT\_CALCRECT | DT\_RIGHT | DT\_VCENTER | DT\_SINGLELINE | DT\_NOPREFIX );
891             
892             \textcolor{comment}{/* erase text rectangle */}
893             drawRect.left = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(client\_rt.left+1, client\_rt.right - (drawRect.right - drawRect.left) - 1
      0);
894             drawRect.right = client\_rt.right-1;
895             drawRect.top = lpdis->rcItem.top;
896             drawRect.bottom = lpdis->rcItem.bottom;
897             FillRect(lpdis->hDC, &drawRect, 
898                      \hyperlink{win_2win32_2mswproc_8c_a82f41013a422d657deaf09b86d42d9dc}{menu\_bg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_a82f41013a422d657deaf09b86d42d9dc}{menu\_bg\_brush} : 
      \hyperlink{mhcolor_8h_ababa49ed211db00c071857fdd982ece1}{SYSCLR\_TO\_BRUSH}(\hyperlink{win_2win32_2mhmenu_8c_ac191df8eb452650490d0c60a03ab7f3a}{DEFAULT\_COLOR\_BG\_MENU}));
899 
900             \textcolor{comment}{/* draw text */}
901             DrawText(lpdis->hDC, wbuf, \_tcslen(wbuf), &drawRect, 
902                      DT\_RIGHT | DT\_VCENTER | DT\_SINGLELINE | DT\_NOPREFIX );
903         \}
904     \}
905     \textcolor{keywordflow}{if} (item->\hyperlink{structmswin__menu__item_ab880fce63154e7b3be65441f1f11f1c8}{has\_focus}) \{
906         \textcolor{comment}{/* draw focus rect */}
907         RECT client\_rt;
908 
909         GetClientRect(lpdis->hwndItem, &client\_rt);
910         SetRect( &drawRect, client\_rt.left, lpdis->rcItem.top, client\_rt.right, lpdis->rcItem.bottom );
911         DrawFocusRect(lpdis->hDC, &drawRect);
912     \}
913 
914     SetTextColor (lpdis->hDC, OldFg);
915     SetBkColor (lpdis->hDC, OldBg);
916     SelectObject(lpdis->hDC, saveFont);
917     DeleteDC(tileDC);
918     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
919 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a0fc93365413fa232f797e9bffa6780a9}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!on\+List\+Char@{on\+List\+Char}}
\index{on\+List\+Char@{on\+List\+Char}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{on\+List\+Char}]{\setlength{\rightskip}{0pt plus 5cm}B\+O\+O\+L on\+List\+Char (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{H\+W\+N\+D}]{hwnd\+List, }
\item[{W\+O\+R\+D}]{ch}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmenu_8c_a0fc93365413fa232f797e9bffa6780a9}


Definition at line 921 of file mhmenu.\+c.



References buf, B\+U\+F\+S\+Z, count, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::done, F\+A\+L\+S\+E, Get\+N\+H\+App(), mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::how, max, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::menu, M\+E\+N\+U\+\_\+\+F\+I\+R\+S\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+I\+N\+V\+E\+R\+T\+\_\+\+A\+L\+L, M\+E\+N\+U\+\_\+\+I\+N\+V\+E\+R\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+L\+A\+S\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+N\+E\+X\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+P\+R\+E\+V\+I\+O\+U\+S\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+S\+E\+A\+R\+C\+H, M\+E\+N\+U\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+A\+L\+L, M\+E\+N\+U\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+U\+N\+S\+E\+L\+E\+C\+T\+\_\+\+A\+L\+L, M\+E\+N\+U\+\_\+\+U\+N\+S\+E\+L\+E\+C\+T\+\_\+\+P\+A\+G\+E, min, mswin\+\_\+getlin\+\_\+window(), mswin\+\_\+nhbell(), N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+A\+B\+L\+E, N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+E\+D, P\+I\+C\+K\+\_\+\+A\+N\+Y, P\+I\+C\+K\+\_\+\+N\+O\+N\+E, P\+I\+C\+K\+\_\+\+O\+N\+E, reset\+\_\+menu\+\_\+count(), mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::result, Select\+Menu\+Item(), and T\+R\+U\+E.



Referenced by N\+H\+Menu\+List\+Wnd\+Proc().


\begin{DoxyCode}
922 \{
923     \textcolor{keywordtype}{int} i = 0;
924     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
925     \textcolor{keywordtype}{int} curIndex, topIndex, pageSize;
926     \textcolor{keywordtype}{boolean} is\_accelerator = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
927 
928     data = (\hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
929 
930     \textcolor{keywordflow}{switch}( ch ) \{
931     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a3eed1da5a8a308f757ae0bc07dc185b3}{MENU\_FIRST\_PAGE}:
932         i = 0;
933         ListView\_SetItemState(hwndList, i, LVIS\_FOCUSED, LVIS\_FOCUSED);
934         ListView\_EnsureVisible(hwndList, i, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
935     \textcolor{keywordflow}{return} -2;
936 
937     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a0d14d3fa404cc391d604a8c990af0954}{MENU\_LAST\_PAGE}:
938         i = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(0, data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size-1);
939         ListView\_SetItemState(hwndList, i, LVIS\_FOCUSED, LVIS\_FOCUSED);
940         ListView\_EnsureVisible(hwndList, i, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
941     \textcolor{keywordflow}{return} -2;
942 
943     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a38905328dea58bbf036f93b7b5a6a6ef}{MENU\_NEXT\_PAGE}:
944         topIndex = ListView\_GetTopIndex( hwndList );
945         pageSize = ListView\_GetCountPerPage( hwndList );
946         curIndex = ListView\_GetNextItem(hwndList, -1,   LVNI\_FOCUSED);
947         \textcolor{comment}{/* Focus down one page */}
948         i = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(curIndex+pageSize, data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size-1);
949         ListView\_SetItemState(hwndList, i, LVIS\_FOCUSED, LVIS\_FOCUSED);
950         \textcolor{comment}{/* Scrollpos down one page */}
951         i = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(topIndex+(2*pageSize - 1), data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size-1);
952         ListView\_EnsureVisible(hwndList, i, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
953     \textcolor{keywordflow}{return} -2;
954 
955     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a688fe5156d1b2c3cce5d71e50d62bfea}{MENU\_PREVIOUS\_PAGE}:
956         topIndex = ListView\_GetTopIndex( hwndList );
957         pageSize = ListView\_GetCountPerPage( hwndList );
958         curIndex = ListView\_GetNextItem(hwndList, -1,   LVNI\_FOCUSED);
959         \textcolor{comment}{/* Focus up one page */}
960         i = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(curIndex-pageSize, 0);
961         ListView\_SetItemState(hwndList, i, LVIS\_FOCUSED, LVIS\_FOCUSED);
962         \textcolor{comment}{/* Scrollpos up one page */}
963         i = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(topIndex-pageSize, 0);
964         ListView\_EnsureVisible(hwndList, i, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
965     \textcolor{keywordflow}{break};
966 
967     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a6c705d18a063df81d02997c09d14157f}{MENU\_SELECT\_ALL}:
968         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
969             \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(hwndList, data);
970             \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
971                 \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(hwndList, data, i, -1);
972             \}
973             \textcolor{keywordflow}{return} -2;
974         \}
975     \textcolor{keywordflow}{break};
976 
977     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a3a476dd165f2b9254ecc1ab3047238f8}{MENU\_UNSELECT\_ALL}:
978         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
979             \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(hwndList, data);
980             \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
981                 \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(hwndList, data, i, 0);
982             \}
983             \textcolor{keywordflow}{return} -2;
984         \}
985     \textcolor{keywordflow}{break};
986 
987     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a7be1bf4583bee8feddb61ab15e634fd9}{MENU\_INVERT\_ALL}:
988         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
989             \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(hwndList, data);
990             \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
991                 \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(
992                     hwndList, 
993                     data, 
994                     i, 
995                     \hyperlink{win_2win32_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{NHMENU\_IS\_SELECTED}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i])? 0 : -1
996                 );
997             \}
998             \textcolor{keywordflow}{return} -2;
999         \}
1000     \textcolor{keywordflow}{break};
1001 
1002     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a8ee870b720cd0aab7743ba83f8fb0a1b}{MENU\_SELECT\_PAGE}:
1003         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
1004             \textcolor{keywordtype}{int} from, to;
1005             \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(hwndList, data);
1006             topIndex = ListView\_GetTopIndex( hwndList );
1007             pageSize = ListView\_GetCountPerPage( hwndList );
1008             from = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(0, topIndex);
1009             to = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size, from+pageSize);
1010             \textcolor{keywordflow}{for}(i=from; i<to; i++ ) \{
1011                 \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(hwndList, data, i, -1);
1012             \}
1013             \textcolor{keywordflow}{return} -2;
1014         \}
1015     \textcolor{keywordflow}{break};
1016 
1017     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a18e91769b9181b3462efe03f534bd6e1}{MENU\_UNSELECT\_PAGE}:
1018         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
1019             \textcolor{keywordtype}{int} from, to;
1020             \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(hwndList, data);
1021             topIndex = ListView\_GetTopIndex( hwndList );
1022             pageSize = ListView\_GetCountPerPage( hwndList );
1023             from = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(0, topIndex);
1024             to = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size, from+pageSize);
1025             \textcolor{keywordflow}{for}(i=from; i<to; i++ ) \{
1026                 \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(hwndList, data, i, 0);
1027             \}
1028             \textcolor{keywordflow}{return} -2;
1029         \}
1030     \textcolor{keywordflow}{break};
1031 
1032     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_ad3dbb023bb0ffc9ffdf822e36734cedc}{MENU\_INVERT\_PAGE}:
1033         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
1034             \textcolor{keywordtype}{int} from, to;
1035             \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(hwndList, data);
1036             topIndex = ListView\_GetTopIndex( hwndList );
1037             pageSize = ListView\_GetCountPerPage( hwndList );
1038             from = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(0, topIndex);
1039             to = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size, from+pageSize);
1040             \textcolor{keywordflow}{for}(i=from; i<to; i++ ) \{
1041                 \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(
1042                     hwndList, 
1043                     data, 
1044                     i, 
1045                     \hyperlink{win_2win32_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{NHMENU\_IS\_SELECTED}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i])? 0 : -1
1046                 );
1047             \}
1048             \textcolor{keywordflow}{return} -2;
1049         \}
1050     \textcolor{keywordflow}{break};
1051 
1052     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a1c3201f2628d34d0880a40dbb566f316}{MENU\_SEARCH}:
1053         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} || data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} ) \{
1054             \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
1055             
1056             \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(hwndList, data);
1057             \textcolor{keywordflow}{if}( \hyperlink{sys_2wince_2mhdlg_8c_a39d42e14bc9786f5e2956df063ab92ff}{mswin\_getlin\_window}(\textcolor{stringliteral}{"Search for:"}, buf, \hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ})==IDCANCEL ) \{
1058                 strcpy(buf, \textcolor{stringliteral}{"\(\backslash\)033"});
1059             \}
1060             SetFocus(hwndList); \textcolor{comment}{// set focus back to the list control}
1061             \textcolor{keywordflow}{if} (!*buf || *buf == \textcolor{charliteral}{'\(\backslash\)033'}) \textcolor{keywordflow}{return} -2;
1062             \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
1063                 \textcolor{keywordflow}{if}( \hyperlink{win_2win32_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{NHMENU\_IS\_SELECTABLE}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i])
1064                     && strstr(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].str, buf) ) \{
1065                     \textcolor{keywordflow}{if} (data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY}) \{
1066                         \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(
1067                             hwndList, 
1068                             data, 
1069                             i, 
1070                             \hyperlink{win_2win32_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{NHMENU\_IS\_SELECTED}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i])? 0 : -1
1071                         );
1072                     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} ) \{
1073                         \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(
1074                             hwndList, 
1075                             data, 
1076                             i, 
1077                             -1
1078                         );
1079                         ListView\_SetItemState(hwndList, i, LVIS\_FOCUSED, LVIS\_FOCUSED);
1080                         ListView\_EnsureVisible(hwndList, i, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
1081                         \textcolor{keywordflow}{break};
1082                     \}
1083                 \}
1084             \} 
1085         \} \textcolor{keywordflow}{else} \{
1086             \hyperlink{sys_2wince_2mswproc_8c_acfd44b324a001d918123b85df7f81af1}{mswin\_nhbell}();
1087         \}
1088     \textcolor{keywordflow}{return} -2;
1089 
1090     \textcolor{keywordflow}{case} \textcolor{charliteral}{' '}:
1091     \{
1092         \textcolor{keywordflow}{if} (\hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->regNetHackMode) \{
1093             \textcolor{comment}{/* NetHack mode: Scroll down one page,}
1094 \textcolor{comment}{               ends menu when on last page. */}
1095             SCROLLINFO si;
1096 
1097             si.cbSize = \textcolor{keyword}{sizeof}(SCROLLINFO);
1098             si.fMask = SIF\_POS | SIF\_RANGE | SIF\_PAGE;
1099             GetScrollInfo(hwndList, SB\_VERT, &si);
1100             \textcolor{keywordflow}{if} ((si.nPos + (\textcolor{keywordtype}{int})si.nPage) > (si.nMax - si.nMin)) \{
1101                 \textcolor{comment}{/* We're at the bottom: dismiss. */}
1102                 data->\hyperlink{structmswin__nethack__menu__window_aaeb9b85cb77679ee1b41ac2b0377d90b}{done} = 1;
1103                 data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result} = 0;
1104                 \textcolor{keywordflow}{return} -2;
1105             \}
1106             \textcolor{comment}{/* We're not at the bottom: page down. */}
1107             topIndex = ListView\_GetTopIndex( hwndList );
1108             pageSize = ListView\_GetCountPerPage( hwndList );
1109             curIndex = ListView\_GetNextItem(hwndList, -1,   LVNI\_FOCUSED);
1110             \textcolor{comment}{/* Focus down one page */}
1111             i = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(curIndex+pageSize, data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size-1);
1112             ListView\_SetItemState(hwndList, i, LVIS\_FOCUSED, LVIS\_FOCUSED);
1113             \textcolor{comment}{/* Scrollpos down one page */}
1114             i = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(topIndex+(2*pageSize - 1), data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size-1);
1115             ListView\_EnsureVisible(hwndList, i, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
1116 
1117             \textcolor{keywordflow}{return} -2;
1118         \} \textcolor{keywordflow}{else} \{
1119             \textcolor{comment}{/* Windows mode: ends menu for PICK\_ONE/PICK\_NONE}
1120 \textcolor{comment}{               select item for PICK\_ANY */}
1121             \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} || data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a9e3d317126c3eacb6311e15fedaf717c}{PICK\_NONE} ) \{
1122                 data->\hyperlink{structmswin__nethack__menu__window_aaeb9b85cb77679ee1b41ac2b0377d90b}{done} = 1;
1123                 data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result} = 0;
1124                 \textcolor{keywordflow}{return} -2;
1125             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
1126                 i = ListView\_GetNextItem(hwndList, -1,  LVNI\_FOCUSED);
1127                 \textcolor{keywordflow}{if}( i>=0 ) \{
1128                     \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(
1129                         hwndList, 
1130                         data, 
1131                         i, 
1132                         \hyperlink{win_2win32_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{NHMENU\_IS\_SELECTED}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i])? 0 : -1
1133                     );
1134                 \}
1135             \}
1136         \}
1137     \}
1138     \textcolor{keywordflow}{break};
1139 
1140     \textcolor{keywordflow}{default}:
1141         \textcolor{keywordflow}{if}( strchr(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.gacc, ch) &&
1142             !(ch==\textcolor{charliteral}{'0'} && data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.counting) ) \{
1143             \textcolor{comment}{/* matched a group accelerator */}
1144             \textcolor{keywordflow}{if} (data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} || data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE}) \{
1145                 \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(hwndList, data);
1146                 \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
1147                     \textcolor{keywordflow}{if}( \hyperlink{win_2win32_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{NHMENU\_IS\_SELECTABLE}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i]) &&
1148                         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].group\_accel == ch ) \{
1149                         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
1150                             \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(
1151                                 hwndList, 
1152                                 data, 
1153                                 i, 
1154                                 \hyperlink{win_2win32_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{NHMENU\_IS\_SELECTED}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i])? 0 : -1
1155                             );
1156                         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} ) \{
1157                             \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(
1158                                 hwndList, 
1159                                 data, 
1160                                 i, 
1161                                 -1
1162                             );
1163                             data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result} = 0;
1164                             data->\hyperlink{structmswin__nethack__menu__window_aaeb9b85cb77679ee1b41ac2b0377d90b}{done} = 1;
1165                             \textcolor{keywordflow}{return} -2;
1166                         \}
1167                     \}
1168                 \}
1169                 \textcolor{keywordflow}{return} -2;
1170             \} \textcolor{keywordflow}{else} \{
1171                 \hyperlink{sys_2wince_2mswproc_8c_acfd44b324a001d918123b85df7f81af1}{mswin\_nhbell}();
1172                 \textcolor{keywordflow}{return} -2;
1173             \}
1174         \}
1175 
1176         \textcolor{keywordflow}{if} (isdigit(ch)) \{
1177             \textcolor{keywordtype}{int} \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count};
1178             i = ListView\_GetNextItem(hwndList, -1,  LVNI\_FOCUSED);
1179             \textcolor{keywordflow}{if}( i>=0 ) \{
1180                 count = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].count;
1181                 \textcolor{keywordflow}{if}( count==-1 ) count=0;
1182                 count *= 10L;
1183                 count += (int)(ch - \textcolor{charliteral}{'0'});
1184                 \textcolor{keywordflow}{if} (count != 0) \textcolor{comment}{/* ignore leading zeros */} \{
1185                     data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1186                     data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].count = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(100000, count);
1187                     ListView\_RedrawItems( hwndList, i, i ); \textcolor{comment}{/* update count mark */}
1188                 \}
1189             \}
1190             \textcolor{keywordflow}{return} -2;
1191         \}
1192 
1193         is\_accelerator = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1194         \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++) \{
1195             \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator == ch ) \{
1196                 is\_accelerator = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1197                 \textcolor{keywordflow}{break};
1198             \}
1199         \}
1200 
1201         \textcolor{keywordflow}{if}( (ch>=\textcolor{charliteral}{'a'} && ch<=\textcolor{charliteral}{'z'}) ||
1202             (ch>=\textcolor{charliteral}{'A'} && ch<=\textcolor{charliteral}{'Z'}) || is\_accelerator) \{
1203             \textcolor{keywordflow}{if} (data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} || data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE}) \{
1204                 \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
1205                     \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator == ch ) \{
1206                         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
1207                             \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(
1208                                 hwndList, 
1209                                 data, 
1210                                 i, 
1211                                 \hyperlink{win_2win32_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{NHMENU\_IS\_SELECTED}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i])? 0 : -1
1212                             );
1213                             ListView\_SetItemState(hwndList, i, LVIS\_FOCUSED, LVIS\_FOCUSED);
1214                             ListView\_EnsureVisible(hwndList, i, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
1215                             \textcolor{keywordflow}{return} -2;
1216                         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} ) \{
1217                             \hyperlink{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{SelectMenuItem}(
1218                                 hwndList, 
1219                                 data, 
1220                                 i, 
1221                                 -1
1222                             );
1223                             data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result} = 0;
1224                             data->\hyperlink{structmswin__nethack__menu__window_aaeb9b85cb77679ee1b41ac2b0377d90b}{done} = 1;
1225                             \textcolor{keywordflow}{return} -2;
1226                         \}
1227                     \}
1228                 \}
1229             \}
1230         \}
1231     \textcolor{keywordflow}{break};
1232     \}
1233 
1234     \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(hwndList, data);
1235     \textcolor{keywordflow}{return} -1;
1236 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a527e6fa96e8cf2ebbe785664951555b6}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!on\+Measure\+Item@{on\+Measure\+Item}}
\index{on\+Measure\+Item@{on\+Measure\+Item}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{on\+Measure\+Item}]{\setlength{\rightskip}{0pt plus 5cm}B\+O\+O\+L on\+Measure\+Item (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmenu_8c_a527e6fa96e8cf2ebbe785664951555b6}


Definition at line 727 of file mhmenu.\+c.



References A\+T\+R\+\_\+\+I\+N\+V\+E\+R\+S\+E, F\+A\+L\+S\+E, Get\+Menu\+Control(), max, mswin\+\_\+get\+\_\+font(), N\+H\+W\+\_\+\+M\+E\+N\+U, T\+I\+L\+E\+\_\+\+Y, and T\+R\+U\+E.



Referenced by Menu\+Wnd\+Proc().


\begin{DoxyCode}
728 \{
729     LPMEASUREITEMSTRUCT lpmis; 
730     TEXTMETRIC \hyperlink{structtm}{tm};
731     HGDIOBJ saveFont;
732     HDC hdc;
733     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
734     RECT list\_rect;
735 
736     lpmis = (LPMEASUREITEMSTRUCT) lParam; 
737     data = (\hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
738     GetClientRect(\hyperlink{win_2win32_2mhmenu_8c_a871d7d2f2639f7ebf2e8e9f6f681bd0a}{GetMenuControl}(hWnd), &list\_rect);
739 
740     hdc = GetDC(\hyperlink{win_2win32_2mhmenu_8c_a871d7d2f2639f7ebf2e8e9f6f681bd0a}{GetMenuControl}(hWnd));
741     saveFont = SelectObject(hdc, \hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(\hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU}, 
      \hyperlink{wintype_8h_a043c5fd85034778be335623e273d0777}{ATR\_INVERSE}, hdc, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}));
742     GetTextMetrics(hdc, &tm);
743 
744     \textcolor{comment}{/* Set the height of the list box items. */}
745     lpmis->itemHeight = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(tm.tmHeight, \hyperlink{sys_2wince_2winMS_8h_a4a62524a49a9be02996b8e667b45abc9}{TILE\_Y})+2;
746     lpmis->itemWidth = list\_rect.right - list\_rect.left;
747 
748     SelectObject(hdc, saveFont);
749     ReleaseDC(\hyperlink{win_2win32_2mhmenu_8c_a871d7d2f2639f7ebf2e8e9f6f681bd0a}{GetMenuControl}(hWnd), hdc);
750     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
751 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_ab1f0aceef05a1dec643246c7cbf5353c}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!on\+M\+S\+N\+H\+Command@{on\+M\+S\+N\+H\+Command}}
\index{on\+M\+S\+N\+H\+Command@{on\+M\+S\+N\+H\+Command}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{on\+M\+S\+N\+H\+Command}]{\setlength{\rightskip}{0pt plus 5cm}void on\+M\+S\+N\+H\+Command (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmenu_8c_ab1f0aceef05a1dec643246c7cbf5353c}


Definition at line 426 of file mhmenu.\+c.



References mswin\+\_\+nhmsg\+\_\+add\+\_\+menu\+::accelerator, mswin\+\_\+nhmsg\+\_\+add\+\_\+menu\+::attr, B\+U\+F\+S\+Z, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::done, F\+A\+L\+S\+E, free(), mswin\+\_\+nhmsg\+\_\+add\+\_\+menu\+::glyph, mswin\+\_\+nhmsg\+\_\+add\+\_\+menu\+::group\+\_\+accel, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::how, I\+D\+C\+\_\+\+M\+E\+N\+U\+\_\+\+T\+E\+X\+T, mswin\+\_\+nhmsg\+\_\+add\+\_\+menu\+::identifier, malloc(), max, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::menu, M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U, M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+X\+T, M\+I\+N\+\_\+\+T\+A\+B\+S\+T\+O\+P\+\_\+\+S\+I\+Z\+E, M\+S\+N\+H\+\_\+\+M\+S\+G\+\_\+\+A\+D\+D\+M\+E\+N\+U, M\+S\+N\+H\+\_\+\+M\+S\+G\+\_\+\+E\+N\+D\+M\+E\+N\+U, M\+S\+N\+H\+\_\+\+M\+S\+G\+\_\+\+P\+U\+T\+S\+T\+R, M\+S\+N\+H\+\_\+\+M\+S\+G\+\_\+\+S\+T\+A\+R\+T\+M\+E\+N\+U, mswin\+\_\+get\+\_\+font(), N\+H\+\_\+\+A2\+W, N\+H\+M\+E\+N\+U\+\_\+\+S\+T\+R\+\_\+\+S\+I\+Z\+E, N\+H\+W\+\_\+\+M\+E\+N\+U, N\+U\+L\+L, N\+U\+M\+T\+A\+B\+S, panic(), P\+I\+C\+K\+\_\+\+N\+O\+N\+E, mswin\+\_\+nhmsg\+\_\+add\+\_\+menu\+::presel, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::result, Set\+Menu\+Type(), mswin\+\_\+nhmsg\+\_\+add\+\_\+menu\+::str, mswin\+\_\+nhmsg\+\_\+putstr\+::text, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::text, mswin\+\_\+nhmsg\+\_\+end\+\_\+menu\+::text, and mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::type.



Referenced by Menu\+Wnd\+Proc().


\begin{DoxyCode}
427 \{
428     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
429 
430     data = (\hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
431     \textcolor{keywordflow}{switch}( wParam ) \{
432     \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2mhmsg_8h_a483b8d3a386f1c5d76da1dff6ed549a8}{MSNH\_MSG\_PUTSTR}: 
433     \{
434         \hyperlink{structmswin__nhmsg__putstr}{PMSNHMsgPutstr} msg\_data = (\hyperlink{sys_2wince_2mhmsg_8h_ad6db1f0e39180f07f00581a93dbdd846}{PMSNHMsgPutstr})lParam;
435         HWND   text\_view;
436         TCHAR   wbuf[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
437         \textcolor{keywordtype}{size\_t} text\_size;
438 
439         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type}!=\hyperlink{sys_2wince_2mhmenu_8h_ad863ba4d93ea3f9619d1f82c79c620e7}{MENU\_TYPE\_TEXT} )
440             \hyperlink{win_2win32_2mhmenu_8c_a9a4ac79f4c285b52ae25582c25beb82d}{SetMenuType}(hWnd, \hyperlink{sys_2wince_2mhmenu_8h_ad863ba4d93ea3f9619d1f82c79c620e7}{MENU\_TYPE\_TEXT});
441 
442         \textcolor{keywordflow}{if}( !data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text ) \{
443             text\_size = strlen(msg\_data->\hyperlink{structmswin__nhmsg__putstr_a27f09d7286c01fe17c1289761b63502e}{text}) + 4;
444             data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text = (TCHAR*)\hyperlink{winproto_8h_ab028c02ac00afc0c1d3c568ccad68869}{malloc}(text\_size*\textcolor{keyword}{sizeof}(data->
      \hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text[0]));
445             ZeroMemory(data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text, text\_size*\textcolor{keyword}{sizeof}(data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text[0]));
446         \} \textcolor{keywordflow}{else} \{
447             text\_size = \_tcslen(data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text) + strlen(msg\_data->\hyperlink{structmswin__nhmsg__putstr_a27f09d7286c01fe17c1289761b63502e}{text}) + 4;
448             data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text = (TCHAR*)realloc(data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text, text\_size*\textcolor{keyword}{sizeof}(data->
      \hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text[0]));
449         \}
450         \textcolor{keywordflow}{if}( !data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text ) \textcolor{keywordflow}{break};
451         
452         \_tcscat(data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text, \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(msg\_data->\hyperlink{structmswin__nhmsg__putstr_a27f09d7286c01fe17c1289761b63502e}{text}, wbuf, 
      \hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ})); 
453         \_tcscat(data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text, TEXT(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}));
454         
455         text\_view = GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_add6d9e4e19e8e119d474ba980520a4d2}{IDC\_MENU\_TEXT});
456         \textcolor{keywordflow}{if}( !text\_view ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"cannot get text view window"});
457         SetWindowText(text\_view, data->\hyperlink{structmswin__nethack__menu__window_ac6c6169f2aa8de6b303db695539d770a}{text}.text);
458     \} \textcolor{keywordflow}{break};
459 
460     \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2mhmsg_8h_a7086205b68db99e06544110233c90219}{MSNH\_MSG\_STARTMENU}:
461     \{
462         \textcolor{keywordtype}{int} i;
463         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type}!=\hyperlink{sys_2wince_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{MENU\_TYPE\_MENU} )
464             \hyperlink{win_2win32_2mhmenu_8c_a9a4ac79f4c285b52ae25582c25beb82d}{SetMenuType}(hWnd, \hyperlink{sys_2wince_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{MENU\_TYPE\_MENU});
465 
466         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items ) \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items);
467         data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} = \hyperlink{wintype_8h_a9e3d317126c3eacb6311e15fedaf717c}{PICK\_NONE};
468         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
469         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size = 0;
470         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.allocated = 0;
471         data->\hyperlink{structmswin__nethack__menu__window_aaeb9b85cb77679ee1b41ac2b0377d90b}{done} = 0;
472         data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result} = 0;
473         \textcolor{keywordflow}{for} (i = 0; i < \hyperlink{win_2win32_2mhmenu_8c_a2431d5b90e503a443a8e29c37a5ef549}{NUMTABS}; ++i)
474             data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.tab\_stop\_size[i] = \hyperlink{win_2win32_2mhmenu_8c_a511a6820684a87ea7109582ac3f158eb}{MIN\_TABSTOP\_SIZE};
475     \} \textcolor{keywordflow}{break};
476 
477     \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2mhmsg_8h_a95b5a261f9ef7b21daae9c1c076d105c}{MSNH\_MSG\_ADDMENU}:
478     \{
479         \hyperlink{structmswin__nhmsg__add__menu}{PMSNHMsgAddMenu} msg\_data = (\hyperlink{sys_2wince_2mhmsg_8h_a15379b5fcc8fd17481e686cbd0d0a3d2}{PMSNHMsgAddMenu})lParam;
480         \textcolor{keywordtype}{char} *p, *p1;
481         \textcolor{keywordtype}{int} new\_item;
482         HDC hDC;
483         \textcolor{keywordtype}{int} column;
484         HFONT saveFont;
485         
486         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type}!=\hyperlink{sys_2wince_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{MENU\_TYPE\_MENU} ) \textcolor{keywordflow}{break};
487         \textcolor{keywordflow}{if}( strlen(msg\_data->\hyperlink{structmswin__nhmsg__add__menu_affef89042e33c9d34265eadc957330d6}{str})==0 ) \textcolor{keywordflow}{break};
488 
489         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size==data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.allocated ) \{
490             data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.allocated += 10;
491             data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items = (\hyperlink{sys_2wince_2mhmenu_8c_aaac97a082e26a50927b1796fd38fc7e2}{PNHMenuItem})realloc(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items, data->
      \hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.allocated*\textcolor{keyword}{sizeof}(\hyperlink{structmswin__menu__item}{NHMenuItem}));
492         \}
493 
494         new\_item = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size;
495         ZeroMemory( &data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[new\_item], \textcolor{keyword}{sizeof}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[new\_item]));
496         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[new\_item].glyph = msg\_data->\hyperlink{structmswin__nhmsg__add__menu_a6be452cac105dee1671e9e61bafb58ae}{glyph};
497         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[new\_item].identifier = *msg\_data->\hyperlink{structmswin__nhmsg__add__menu_a5ce3f435709df4a7e6442cebba1593ee}{identifier};
498         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[new\_item].accelerator = msg\_data->\hyperlink{structmswin__nhmsg__add__menu_abad930c46c0bc05bff9e362d191e6255}{accelerator};
499         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[new\_item].group\_accel = msg\_data->\hyperlink{structmswin__nhmsg__add__menu_a5ad28b8447917e56539afb498fffc98a}{group\_accel};
500         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[new\_item].attr = msg\_data->\hyperlink{structmswin__nhmsg__add__menu_a01defd06f0fe00fc1b1986744ad288c9}{attr};
501         strncpy(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[new\_item].str, msg\_data->\hyperlink{structmswin__nhmsg__add__menu_affef89042e33c9d34265eadc957330d6}{str}, 
      \hyperlink{win_2win32_2mhmenu_8c_a952b01afec1711bc486a207765acb1a6}{NHMENU\_STR\_SIZE});
502         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[new\_item].presel = msg\_data->\hyperlink{structmswin__nhmsg__add__menu_aff828569cd76f607d077f89e23383938}{presel};
503 
504         \textcolor{comment}{/* calculate tabstop size */}
505         hDC = GetDC(hWnd);
506         saveFont = SelectObject(hDC, \hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(\hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU}, msg\_data->
      \hyperlink{structmswin__nhmsg__add__menu_a01defd06f0fe00fc1b1986744ad288c9}{attr}, hDC, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}));
507         p1 = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[new\_item].str;
508         p = strchr(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[new\_item].str, \textcolor{charliteral}{'\(\backslash\)t'});
509         column = 0;
510         \textcolor{keywordflow}{for} (;;) \{
511             TCHAR wbuf[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
512             RECT drawRect;
513             SetRect ( &drawRect, 0, 0, 1, 1 );
514             \textcolor{keywordflow}{if} (p != \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}) *p = \textcolor{charliteral}{'\(\backslash\)0'}; \textcolor{comment}{/* for time being, view tab field as zstring */}
515             DrawText(hDC,
516                 \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(p1, wbuf, \hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}),
517                 strlen(p1),
518                 &drawRect,
519                 DT\_CALCRECT | DT\_LEFT | DT\_VCENTER | DT\_EXPANDTABS | DT\_SINGLELINE
520             );
521             data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.tab\_stop\_size[column] =
522                 \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}( data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.tab\_stop\_size[column], drawRect.right - drawRect.left );
523             \textcolor{keywordflow}{if} (p != \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}) *p = \textcolor{charliteral}{'\(\backslash\)t'};
524             \textcolor{keywordflow}{else} \textcolor{comment}{/* last string so, */} \textcolor{keywordflow}{break};
525 
526             ++column;
527             p1 = p + 1;
528             p = strchr(p1, \textcolor{charliteral}{'\(\backslash\)t'});
529         \}
530         SelectObject(hDC, saveFont);
531         ReleaseDC(hWnd, hDC);
532 
533         \textcolor{comment}{/* increment size */}
534         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size++;
535     \} \textcolor{keywordflow}{break};
536 
537     \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2mhmsg_8h_a84f0789ba098698824ad1fdaeb83bb2b}{MSNH\_MSG\_ENDMENU}:
538     \{
539         \hyperlink{structmswin__nhmsg__end__menu}{PMSNHMsgEndMenu} msg\_data = (\hyperlink{sys_2wince_2mhmsg_8h_ad45300192aec5760b1295d3749eb4d19}{PMSNHMsgEndMenu})lParam;
540         \textcolor{keywordflow}{if}( msg\_data->\hyperlink{structmswin__nhmsg__end__menu_ad09bb3853bacd831228b72ab2bd9e4eb}{text} ) \{
541             strncpy( data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.prompt, msg\_data->\hyperlink{structmswin__nhmsg__end__menu_ad09bb3853bacd831228b72ab2bd9e4eb}{text}, \textcolor{keyword}{sizeof}(data->
      \hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.prompt)-1 );
542         \} \textcolor{keywordflow}{else} \{
543             ZeroMemory(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.prompt, \textcolor{keyword}{sizeof}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.prompt));
544         \}
545     \} \textcolor{keywordflow}{break};
546 
547     \}
548 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!reset\+\_\+menu\+\_\+count@{reset\+\_\+menu\+\_\+count}}
\index{reset\+\_\+menu\+\_\+count@{reset\+\_\+menu\+\_\+count}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{reset\+\_\+menu\+\_\+count}]{\setlength{\rightskip}{0pt plus 5cm}void reset\+\_\+menu\+\_\+count (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{hwnd\+List, }
\item[{{\bf P\+N\+H\+Menu\+Window}}]{data}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}


Definition at line 1338 of file mhmenu.\+c.



References F\+A\+L\+S\+E, and mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::menu.



Referenced by Menu\+Wnd\+Proc(), mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu(), on\+List\+Char(), and Select\+Menu\+Item().


\begin{DoxyCode}
1339 \{
1340     \textcolor{keywordtype}{int} i; 
1341     data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.counting = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1342     \textcolor{keywordflow}{if}( IsWindow(hwndList) ) \{
1343         i = ListView\_GetNextItem((hwndList), -1, LVNI\_FOCUSED);
1344         \textcolor{keywordflow}{if}( i>=0 ) ListView\_RedrawItems( hwndList, i, i ); 
1345     \}
1346 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!Select\+Menu\+Item@{Select\+Menu\+Item}}
\index{Select\+Menu\+Item@{Select\+Menu\+Item}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{Select\+Menu\+Item}]{\setlength{\rightskip}{0pt plus 5cm}void Select\+Menu\+Item (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{hwnd\+List, }
\item[{{\bf P\+N\+H\+Menu\+Window}}]{data, }
\item[{int}]{item, }
\item[{int}]{count}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmenu_8c_a15c608c8e8d9f2b0d6be8c3443db0470}


Definition at line 1319 of file mhmenu.\+c.



References count, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::how, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::menu, P\+I\+C\+K\+\_\+\+O\+N\+E, and reset\+\_\+menu\+\_\+count().



Referenced by Menu\+Wnd\+Proc(), and on\+List\+Char().


\begin{DoxyCode}
1320 \{
1321     \textcolor{keywordtype}{int} i;
1322 
1323     \textcolor{keywordflow}{if}( item<0 || item>=data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size ) \textcolor{keywordflow}{return};
1324 
1325     \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how}==\hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} && \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count}!=0 ) \{
1326         \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++) 
1327             \textcolor{keywordflow}{if}( item!=i && data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].count!=0 ) \{
1328                 data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].count = 0;
1329                 ListView\_RedrawItems( hwndList, i, i );
1330             \};
1331     \}
1332 
1333     data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[item].count = \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count};
1334     ListView\_RedrawItems( hwndList, item, item );
1335     \hyperlink{win_2win32_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(hwndList, data);
1336 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a9935a9b932fd4f54e94b72e7cd0dee54}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!Set\+Menu\+List\+Type@{Set\+Menu\+List\+Type}}
\index{Set\+Menu\+List\+Type@{Set\+Menu\+List\+Type}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{Set\+Menu\+List\+Type}]{\setlength{\rightskip}{0pt plus 5cm}void Set\+Menu\+List\+Type (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{hwnd, }
\item[{int}]{now}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmenu_8c_a9935a9b932fd4f54e94b72e7cd0dee54}


Definition at line 616 of file mhmenu.\+c.



References buf, B\+U\+F\+S\+Z, D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+E\+N\+U, D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+E\+N\+U, Get\+N\+H\+App(), mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::how, I\+D\+C\+\_\+\+M\+E\+N\+U\+\_\+\+L\+I\+S\+T, max, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::menu, menu\+\_\+bg\+\_\+brush, menu\+\_\+bg\+\_\+color, menu\+\_\+fg\+\_\+brush, menu\+\_\+fg\+\_\+color, M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U, N\+H\+\_\+\+A2\+W, N\+H\+Menu\+List\+Wnd\+Proc(), N\+U\+L\+L, panic(), P\+I\+C\+K\+\_\+\+A\+N\+Y, P\+I\+C\+K\+\_\+\+N\+O\+N\+E, P\+I\+C\+K\+\_\+\+O\+N\+E, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::type, and wnd\+Proc\+List\+View\+Orig.



Referenced by mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu().


\begin{DoxyCode}
617 \{
618     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
619     RECT rt;
620     DWORD dwStyles;
621     \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
622     TCHAR wbuf[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
623     \textcolor{keywordtype}{int} nItem;
624     \textcolor{keywordtype}{int} i;
625     HWND control;
626     LVCOLUMN lvcol;
627     LRESULT fnt;
628 
629     data = (\hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
630     \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type} != \hyperlink{sys_2wince_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{MENU\_TYPE\_MENU} ) \textcolor{keywordflow}{return};
631 
632     data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} = how;
633 
634     \textcolor{keywordflow}{switch}(how) \{
635     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a9e3d317126c3eacb6311e15fedaf717c}{PICK\_NONE}: 
636         dwStyles = WS\_VISIBLE | WS\_TABSTOP | WS\_BORDER | WS\_CHILD 
637             | WS\_VSCROLL | WS\_HSCROLL | LVS\_REPORT  
638             | LVS\_OWNERDRAWFIXED | LVS\_SINGLESEL; 
639         \textcolor{keywordflow}{break};
640     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE}: 
641         dwStyles = WS\_VISIBLE | WS\_TABSTOP | WS\_BORDER | WS\_CHILD 
642             | WS\_VSCROLL | WS\_HSCROLL | LVS\_REPORT  
643             | LVS\_OWNERDRAWFIXED | LVS\_SINGLESEL; 
644         \textcolor{keywordflow}{break};
645     \textcolor{keywordflow}{case} \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY}: 
646         dwStyles = WS\_VISIBLE | WS\_TABSTOP | WS\_BORDER | WS\_CHILD 
647             | WS\_VSCROLL | WS\_HSCROLL | LVS\_REPORT  
648             | LVS\_OWNERDRAWFIXED | LVS\_SINGLESEL; 
649         \textcolor{keywordflow}{break};
650     \textcolor{keywordflow}{default}: \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"how should be one of PICK\_NONE, PICK\_ONE or PICK\_ANY"});
651     \};
652 
653     \textcolor{keywordflow}{if}( strlen(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.prompt)==0 ) \{
654         dwStyles |= LVS\_NOCOLUMNHEADER ;
655     \}
656 
657     GetWindowRect(GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a1af3a3967bc3f6d66a75d340c1f56678}{IDC\_MENU\_LIST}), &rt);
658     DestroyWindow(GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a1af3a3967bc3f6d66a75d340c1f56678}{IDC\_MENU\_LIST}));
659     control = CreateWindow(WC\_LISTVIEW, \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 
660         dwStyles,
661         rt.left,
662         rt.top,
663         rt.right - rt.left,
664         rt.bottom - rt.top,
665         hWnd,
666         (HMENU)\hyperlink{sys_2wince_2resource_8h_a1af3a3967bc3f6d66a75d340c1f56678}{IDC\_MENU\_LIST},
667         \hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hApp,
668         \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} );
669     \textcolor{keywordflow}{if}( !control ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}( \textcolor{stringliteral}{"cannot create menu control"} );
670     
671     \textcolor{comment}{/* install the hook for the control window procedure */}
672     \hyperlink{win_2win32_2mhmenu_8c_a34b2053bf1601b3dc7b10796c1040cdc}{wndProcListViewOrig} = (WNDPROC)GetWindowLong(control, GWL\_WNDPROC);
673     SetWindowLong(control, GWL\_WNDPROC, (LONG)\hyperlink{sys_2wince_2mhmenu_8c_a98cae3dd2cc1e5ed8696141ea0af9736}{NHMenuListWndProc});
674 
675     \textcolor{comment}{/* set control colors */}
676     ListView\_SetBkColor(control, 
677         \hyperlink{win_2win32_2mswproc_8c_a82f41013a422d657deaf09b86d42d9dc}{menu\_bg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_a6c5f5c1c14159485ea2ee8e462c288d3}{menu\_bg\_color} : (COLORREF)GetSysColor(
      \hyperlink{win_2win32_2mhmenu_8c_ac191df8eb452650490d0c60a03ab7f3a}{DEFAULT\_COLOR\_BG\_MENU}));
678     ListView\_SetTextBkColor(control, 
679         \hyperlink{win_2win32_2mswproc_8c_a82f41013a422d657deaf09b86d42d9dc}{menu\_bg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_a6c5f5c1c14159485ea2ee8e462c288d3}{menu\_bg\_color} : (COLORREF)GetSysColor(
      \hyperlink{win_2win32_2mhmenu_8c_ac191df8eb452650490d0c60a03ab7f3a}{DEFAULT\_COLOR\_BG\_MENU}));
680     ListView\_SetTextColor(control, 
681         \hyperlink{win_2win32_2mswproc_8c_a94470d3f3e89c1d7c044cde918769758}{menu\_fg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_aa44669b1e3ababfe264bea52ed3de6fe}{menu\_fg\_color} : (COLORREF)GetSysColor(
      \hyperlink{win_2win32_2mhmenu_8c_a08fcecfa6bc73cb3245146aa07fe4a02}{DEFAULT\_COLOR\_FG\_MENU}));
682 
683     \textcolor{comment}{/* set control font */}
684     fnt = SendMessage(hWnd, WM\_GETFONT, (WPARAM)0, (LPARAM)0);
685     SendMessage(control, WM\_SETFONT, (WPARAM)fnt, (LPARAM)0);
686 
687     \textcolor{comment}{/* add column to the list view */}
688     ZeroMemory(&lvcol, \textcolor{keyword}{sizeof}(lvcol));
689     lvcol.mask = LVCF\_WIDTH | LVCF\_TEXT;
690     lvcol.cx = GetSystemMetrics(SM\_CXFULLSCREEN);
691     lvcol.pszText = \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.prompt, wbuf, \hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ});
692     ListView\_InsertColumn(control, 0, &lvcol);
693 
694     \textcolor{comment}{/* add items to the list view */}
695     \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
696         LVITEM lvitem;
697         ZeroMemory( &lvitem, \textcolor{keyword}{sizeof}(lvitem) );
698         sprintf(buf, \textcolor{stringliteral}{"%c - %s"}, \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator, \textcolor{charliteral}{' '}), data->
      \hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].str );
699 
700         lvitem.mask = LVIF\_PARAM | LVIF\_STATE | LVIF\_TEXT;
701         lvitem.iItem = i;
702         lvitem.iSubItem = 0;
703         lvitem.state = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].presel? LVIS\_SELECTED : 0;
704         lvitem.pszText = \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(buf, wbuf, \hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ});
705         lvitem.lParam = (LPARAM)&data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i];
706         nItem = SendMessage(control, LB\_ADDSTRING, (WPARAM)0, (LPARAM) buf); 
707         \textcolor{keywordflow}{if}( ListView\_InsertItem(control, &lvitem)==-1 ) \{
708             \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"cannot insert menu item"});
709         \}
710     \}
711     SetFocus(control);
712 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8c_a9a4ac79f4c285b52ae25582c25beb82d}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!Set\+Menu\+Type@{Set\+Menu\+Type}}
\index{Set\+Menu\+Type@{Set\+Menu\+Type}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{Set\+Menu\+Type}]{\setlength{\rightskip}{0pt plus 5cm}void Set\+Menu\+Type (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{hwnd, }
\item[{int}]{type}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmenu_8c_a9a4ac79f4c285b52ae25582c25beb82d}


Definition at line 589 of file mhmenu.\+c.



References F\+A\+L\+S\+E, I\+D\+C\+\_\+\+M\+E\+N\+U\+\_\+\+L\+I\+S\+T, I\+D\+C\+\_\+\+M\+E\+N\+U\+\_\+\+T\+E\+X\+T, Layout\+Menu(), M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+X\+T, T\+R\+U\+E, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::type, and type.



Referenced by mswin\+\_\+init\+\_\+menu\+\_\+window(), and on\+M\+S\+N\+H\+Command().


\begin{DoxyCode}
590 \{
591     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
592     HWND list, text;
593 
594     data = (\hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
595 
596     data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type} = \hyperlink{lev__main_8c_ac765329451135abec74c45e1897abf26}{type};
597     
598     text = GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_add6d9e4e19e8e119d474ba980520a4d2}{IDC\_MENU\_TEXT});
599     list = GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a1af3a3967bc3f6d66a75d340c1f56678}{IDC\_MENU\_LIST});
600     \textcolor{keywordflow}{if}(data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type}==\hyperlink{sys_2wince_2mhmenu_8h_ad863ba4d93ea3f9619d1f82c79c620e7}{MENU\_TYPE\_TEXT}) \{
601         ShowWindow(list, SW\_HIDE);
602         EnableWindow(list, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
603         EnableWindow(text, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
604         ShowWindow(text, SW\_SHOW);
605         SetFocus(text);
606     \} \textcolor{keywordflow}{else} \{
607         ShowWindow(text, SW\_HIDE);
608         EnableWindow(text, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
609         EnableWindow(list, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
610         ShowWindow(list, SW\_SHOW);
611         SetFocus(list);
612     \}
613     \hyperlink{win_2win32_2mhmenu_8c_a4aff550d92784a0c5e7fcb8b9f86a15e}{LayoutMenu}(hWnd);
614 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{win_2win32_2mhmenu_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!edit\+Control\+Wnd\+Proc@{edit\+Control\+Wnd\+Proc}}
\index{edit\+Control\+Wnd\+Proc@{edit\+Control\+Wnd\+Proc}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{edit\+Control\+Wnd\+Proc}]{\setlength{\rightskip}{0pt plus 5cm}W\+N\+D\+P\+R\+O\+C edit\+Control\+Wnd\+Proc = {\bf N\+U\+L\+L}\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmenu_8c_ad6488b0aa2546ac1e148bc6ca7b51087}


Definition at line 67 of file mhmenu.\+c.



Referenced by Menu\+Wnd\+Proc(), and N\+H\+Menu\+Text\+Wnd\+Proc().

\hypertarget{win_2win32_2mhmenu_8c_a4d61aa736dae8287d97c3a68a3a917c5}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!glyph2tile@{glyph2tile}}
\index{glyph2tile@{glyph2tile}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{glyph2tile}]{\setlength{\rightskip}{0pt plus 5cm}short glyph2tile\mbox{[}$\,$\mbox{]}}}\label{win_2win32_2mhmenu_8c_a4d61aa736dae8287d97c3a68a3a917c5}
\hypertarget{win_2win32_2mhmenu_8c_a34b2053bf1601b3dc7b10796c1040cdc}{\index{win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}!wnd\+Proc\+List\+View\+Orig@{wnd\+Proc\+List\+View\+Orig}}
\index{wnd\+Proc\+List\+View\+Orig@{wnd\+Proc\+List\+View\+Orig}!win/win32/mhmenu.\+c@{win/win32/mhmenu.\+c}}
\subsubsection[{wnd\+Proc\+List\+View\+Orig}]{\setlength{\rightskip}{0pt plus 5cm}W\+N\+D\+P\+R\+O\+C wnd\+Proc\+List\+View\+Orig = {\bf N\+U\+L\+L}\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmenu_8c_a34b2053bf1601b3dc7b10796c1040cdc}


Definition at line 66 of file mhmenu.\+c.



Referenced by N\+H\+Menu\+List\+Wnd\+Proc(), and Set\+Menu\+List\+Type().

