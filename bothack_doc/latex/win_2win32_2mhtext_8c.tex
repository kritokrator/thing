\hypertarget{win_2win32_2mhtext_8c}{\section{nethack/win/win32/mhtext.c File Reference}
\label{win_2win32_2mhtext_8c}\index{nethack/win/win32/mhtext.\+c@{nethack/win/win32/mhtext.\+c}}
}
{\ttfamily \#include \char`\"{}win\+M\+S.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}resource.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhtext.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhmsg.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhfont.\+h\char`\"{}}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structmswin__nethack__text__window}{mswin\+\_\+nethack\+\_\+text\+\_\+window}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{win_2win32_2mhtext_8c_a31e380304152e012afbd6151c8f4cc70}{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T}~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W
\item 
\#define \hyperlink{win_2win32_2mhtext_8c_a47fb1e2e86d10f668872ccce87a250f6}{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T}~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \\*
\hyperlink{structmswin__nethack__text__window}{mswin\+\_\+nethack\+\_\+text\+\_\+window} \hyperlink{win_2win32_2mhtext_8c_a93a68ae5d0ad265a1df776ec42c75b71}{N\+H\+Text\+Window}
\item 
typedef struct \\*
\hyperlink{structmswin__nethack__text__window}{mswin\+\_\+nethack\+\_\+text\+\_\+window} $\ast$ \hyperlink{win_2win32_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}{P\+N\+H\+Text\+Window}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{sys_2wince_2winMS_8h_a78ff8ed1e05072662719865d12608e75}{P\+N\+H\+Win\+App} \hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{Get\+N\+H\+App} (void)
\item 
B\+O\+O\+L C\+A\+L\+L\+B\+A\+C\+K \hyperlink{win_2win32_2mhtext_8c_ac7fcc73b73e8ded97c0eea607e8b7305}{N\+H\+Text\+Wnd\+Proc} (H\+W\+N\+D, \hyperlink{def__os2_8h_a36cb3b01d81ffd844bbbfb54003e06ec}{U\+I\+N\+T}, W\+P\+A\+R\+A\+M, L\+P\+A\+R\+A\+M)
\item 
L\+R\+E\+S\+U\+L\+T C\+A\+L\+L\+B\+A\+C\+K \hyperlink{win_2win32_2mhtext_8c_a99027d3049b43760d736201b8f88850a}{N\+H\+Edit\+Hook\+Wnd\+Proc} (H\+W\+N\+D, \hyperlink{def__os2_8h_a36cb3b01d81ffd844bbbfb54003e06ec}{U\+I\+N\+T}, W\+P\+A\+R\+A\+M, L\+P\+A\+R\+A\+M)
\item 
static void \hyperlink{win_2win32_2mhtext_8c_ab1f0aceef05a1dec643246c7cbf5353c}{on\+M\+S\+N\+H\+Command} (H\+W\+N\+D h\+Wnd, W\+P\+A\+R\+A\+M w\+Param, L\+P\+A\+R\+A\+M l\+Param)
\item 
static void \hyperlink{win_2win32_2mhtext_8c_aafad889148472301230253fc2b8f1191}{Layout\+Text} (H\+W\+N\+D hwnd)
\item 
H\+W\+N\+D \hyperlink{win_2win32_2mhtext_8c_ae237f4f0312cd51e1164e51204a49d09}{mswin\+\_\+init\+\_\+text\+\_\+window} ()
\item 
void \hyperlink{win_2win32_2mhtext_8c_a5eedafc31b1220d01c9bc9d8823e5ecb}{mswin\+\_\+display\+\_\+text\+\_\+window} (H\+W\+N\+D h\+Wnd)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static W\+N\+D\+P\+R\+O\+C \hyperlink{win_2win32_2mhtext_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{edit\+Control\+Wnd\+Proc} = 0
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{win_2win32_2mhtext_8c_a31e380304152e012afbd6151c8f4cc70}{\index{win/win32/mhtext.\+c@{win/win32/mhtext.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T}!win/win32/mhtext.\+c@{win/win32/mhtext.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W}}\label{win_2win32_2mhtext_8c_a31e380304152e012afbd6151c8f4cc70}


Definition at line 17 of file mhtext.\+c.



Referenced by N\+H\+Text\+Wnd\+Proc().

\hypertarget{win_2win32_2mhtext_8c_a47fb1e2e86d10f668872ccce87a250f6}{\index{win/win32/mhtext.\+c@{win/win32/mhtext.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T}!win/win32/mhtext.\+c@{win/win32/mhtext.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T}}\label{win_2win32_2mhtext_8c_a47fb1e2e86d10f668872ccce87a250f6}


Definition at line 18 of file mhtext.\+c.



Referenced by N\+H\+Text\+Wnd\+Proc().



\subsection{Typedef Documentation}
\hypertarget{win_2win32_2mhtext_8c_a93a68ae5d0ad265a1df776ec42c75b71}{\index{win/win32/mhtext.\+c@{win/win32/mhtext.\+c}!N\+H\+Text\+Window@{N\+H\+Text\+Window}}
\index{N\+H\+Text\+Window@{N\+H\+Text\+Window}!win/win32/mhtext.\+c@{win/win32/mhtext.\+c}}
\subsubsection[{N\+H\+Text\+Window}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf mswin\+\_\+nethack\+\_\+text\+\_\+window}  {\bf N\+H\+Text\+Window}}}\label{win_2win32_2mhtext_8c_a93a68ae5d0ad265a1df776ec42c75b71}
\hypertarget{win_2win32_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}{\index{win/win32/mhtext.\+c@{win/win32/mhtext.\+c}!P\+N\+H\+Text\+Window@{P\+N\+H\+Text\+Window}}
\index{P\+N\+H\+Text\+Window@{P\+N\+H\+Text\+Window}!win/win32/mhtext.\+c@{win/win32/mhtext.\+c}}
\subsubsection[{P\+N\+H\+Text\+Window}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf mswin\+\_\+nethack\+\_\+text\+\_\+window} $\ast$ {\bf P\+N\+H\+Text\+Window}}}\label{win_2win32_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}


\subsection{Function Documentation}
\hypertarget{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{\index{win/win32/mhtext.\+c@{win/win32/mhtext.\+c}!Get\+N\+H\+App@{Get\+N\+H\+App}}
\index{Get\+N\+H\+App@{Get\+N\+H\+App}!win/win32/mhtext.\+c@{win/win32/mhtext.\+c}}
\subsubsection[{Get\+N\+H\+App}]{\setlength{\rightskip}{0pt plus 5cm}{\bf P\+N\+H\+Win\+App} Get\+N\+H\+App (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}


Definition at line 154 of file winhack.\+c.



Referenced by mswin\+\_\+init\+\_\+text\+\_\+window(), N\+H\+Edit\+Hook\+Wnd\+Proc(), N\+H\+Text\+Wnd\+Proc(), and Text\+Wnd\+Proc().


\begin{DoxyCode}
155 \{
156     \textcolor{keywordflow}{return} &\hyperlink{sys_2wince_2winhack_8c_a5014ab92020eefd70dfd7b93937850f3}{\_nethack\_app};
157 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhtext_8c_aafad889148472301230253fc2b8f1191}{\index{win/win32/mhtext.\+c@{win/win32/mhtext.\+c}!Layout\+Text@{Layout\+Text}}
\index{Layout\+Text@{Layout\+Text}!win/win32/mhtext.\+c@{win/win32/mhtext.\+c}}
\subsubsection[{Layout\+Text}]{\setlength{\rightskip}{0pt plus 5cm}void Layout\+Text (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{hwnd}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhtext_8c_aafad889148472301230253fc2b8f1191}


Definition at line 178 of file mhtext.\+c.



References I\+D\+C\+\_\+\+T\+E\+X\+T\+\_\+\+C\+O\+N\+T\+R\+O\+L, S\+I\+Z\+E, and T\+R\+U\+E.



Referenced by N\+H\+Text\+Wnd\+Proc().


\begin{DoxyCode}
179 \{
180     HWND  btn\_ok;
181     HWND  text;
182     RECT  clrt, rt;
183     POINT pt\_elem, pt\_ok;
184     \hyperlink{global_8h_afd2537d19a3cb6556b0f727580ec6ee7}{SIZE}  sz\_elem, sz\_ok;
185 
186     text = GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a5a3e3e31caaecfedcda0408c52a93b1e}{IDC\_TEXT\_CONTROL});
187     btn\_ok = GetDlgItem(hWnd, IDOK);
188 
189     \textcolor{comment}{/* get window coordinates */}
190     GetClientRect(hWnd, &clrt );
191     
192     \textcolor{comment}{/* set window placements */}
193     GetWindowRect(btn\_ok, &rt);
194     sz\_ok.cx = clrt.right - clrt.left;
195     sz\_ok.cy = rt.bottom-rt.top;
196     pt\_ok.x = clrt.left;
197     pt\_ok.y = clrt.bottom - sz\_ok.cy;
198 
199     pt\_elem.x = clrt.left;
200     pt\_elem.y = clrt.top;
201     sz\_elem.cx = clrt.right - clrt.left;
202     sz\_elem.cy = pt\_ok.y;
203 
204     MoveWindow(text, pt\_elem.x, pt\_elem.y, sz\_elem.cx, sz\_elem.cy, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
205     MoveWindow(btn\_ok, pt\_ok.x, pt\_ok.y, sz\_ok.cx, sz\_ok.cy, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
206 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhtext_8c_a5eedafc31b1220d01c9bc9d8823e5ecb}{\index{win/win32/mhtext.\+c@{win/win32/mhtext.\+c}!mswin\+\_\+display\+\_\+text\+\_\+window@{mswin\+\_\+display\+\_\+text\+\_\+window}}
\index{mswin\+\_\+display\+\_\+text\+\_\+window@{mswin\+\_\+display\+\_\+text\+\_\+window}!win/win32/mhtext.\+c@{win/win32/mhtext.\+c}}
\subsubsection[{mswin\+\_\+display\+\_\+text\+\_\+window}]{\setlength{\rightskip}{0pt plus 5cm}void mswin\+\_\+display\+\_\+text\+\_\+window (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhtext_8c_a5eedafc31b1220d01c9bc9d8823e5ecb}


Definition at line 45 of file mhtext.\+c.



References mswin\+\_\+nethack\+\_\+text\+\_\+window\+::done, I\+D\+C\+\_\+\+T\+E\+X\+T\+\_\+\+C\+O\+N\+T\+R\+O\+L, mswin\+\_\+popup\+\_\+destroy(), mswin\+\_\+popup\+\_\+display(), mswin\+\_\+render\+\_\+text(), N\+U\+L\+L, and mswin\+\_\+nethack\+\_\+text\+\_\+window\+::window\+\_\+text.


\begin{DoxyCode}
46 \{
47     \hyperlink{structmswin__nethack__text__window}{PNHTextWindow} data;
48     
49     data = (\hyperlink{sys_2wince_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}{PNHTextWindow})GetWindowLong(hWnd, GWL\_USERDATA);
50     \textcolor{keywordflow}{if}( data && data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text} ) \{
51         HWND control;
52         control = GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a5a3e3e31caaecfedcda0408c52a93b1e}{IDC\_TEXT\_CONTROL});
53         SendMessage(control, EM\_FMTLINES, 1, 0 );
54         SetWindowText(GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a5a3e3e31caaecfedcda0408c52a93b1e}{IDC\_TEXT\_CONTROL}), data->
      \hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text});
55     \}
56 
57     \hyperlink{sys_2wince_2mswproc_8c_a2a23443a8cfc6b5b41024850877e0f5e}{mswin\_popup\_display}(hWnd, \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
58     \hyperlink{sys_2wince_2mswproc_8c_a49804134a4aaa8874010372eae4612f9}{mswin\_popup\_destroy}(hWnd);
59 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhtext_8c_ae237f4f0312cd51e1164e51204a49d09}{\index{win/win32/mhtext.\+c@{win/win32/mhtext.\+c}!mswin\+\_\+init\+\_\+text\+\_\+window@{mswin\+\_\+init\+\_\+text\+\_\+window}}
\index{mswin\+\_\+init\+\_\+text\+\_\+window@{mswin\+\_\+init\+\_\+text\+\_\+window}!win/win32/mhtext.\+c@{win/win32/mhtext.\+c}}
\subsubsection[{mswin\+\_\+init\+\_\+text\+\_\+window}]{\setlength{\rightskip}{0pt plus 5cm}H\+W\+N\+D mswin\+\_\+init\+\_\+text\+\_\+window (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhtext_8c_ae237f4f0312cd51e1164e51204a49d09}


Definition at line 25 of file mhtext.\+c.



References Create\+Dialog(), F\+A\+L\+S\+E, sinfo\+::gameover, Get\+N\+H\+App(), I\+D\+D\+\_\+\+N\+H\+T\+E\+X\+T, malloc(), mswin\+\_\+init\+\_\+text\+\_\+buffer(), N\+H\+Text\+Wnd\+Proc(), panic(), program\+\_\+state, Text\+Wnd\+Proc(), and mswin\+\_\+nethack\+\_\+text\+\_\+window\+::window\+\_\+text.


\begin{DoxyCode}
25                                \{
26     HWND ret;
27     \hyperlink{structmswin__nethack__text__window}{PNHTextWindow} data;
28 
29     ret = \hyperlink{dialogs_8c_aaf356545a4c5797e317091864c988de0}{CreateDialog}(
30             \hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{GetNHApp}()->hApp,
31             MAKEINTRESOURCE(\hyperlink{sys_2wince_2resource_8h_ae13d4f0d01ecf92dcee8e748f63a5bd4}{IDD\_NHTEXT}),
32             \hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{GetNHApp}()->hMainWnd,
33             \hyperlink{win_2win32_2mhtext_8c_ac7fcc73b73e8ded97c0eea607e8b7305}{NHTextWndProc}
34     );
35     \textcolor{keywordflow}{if}( !ret ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Cannot create text window"});
36 
37     data = (\hyperlink{sys_2wince_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}{PNHTextWindow})\hyperlink{winproto_8h_ab028c02ac00afc0c1d3c568ccad68869}{malloc}(\textcolor{keyword}{sizeof}(\hyperlink{structmswin__nethack__text__window}{NHTextWindow}));
38     \textcolor{keywordflow}{if}( !data ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"out of memory"});
39 
40     ZeroMemory(data, \textcolor{keyword}{sizeof}(\hyperlink{structmswin__nethack__text__window}{NHTextWindow}));
41     SetWindowLong(ret, GWL\_USERDATA, (LONG)data);
42     \textcolor{keywordflow}{return} ret;
43 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhtext_8c_a99027d3049b43760d736201b8f88850a}{\index{win/win32/mhtext.\+c@{win/win32/mhtext.\+c}!N\+H\+Edit\+Hook\+Wnd\+Proc@{N\+H\+Edit\+Hook\+Wnd\+Proc}}
\index{N\+H\+Edit\+Hook\+Wnd\+Proc@{N\+H\+Edit\+Hook\+Wnd\+Proc}!win/win32/mhtext.\+c@{win/win32/mhtext.\+c}}
\subsubsection[{N\+H\+Edit\+Hook\+Wnd\+Proc}]{\setlength{\rightskip}{0pt plus 5cm}L\+R\+E\+S\+U\+L\+T C\+A\+L\+L\+B\+A\+C\+K N\+H\+Edit\+Hook\+Wnd\+Proc (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{{\bf U\+I\+N\+T}}]{message, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhtext_8c_a99027d3049b43760d736201b8f88850a}


Definition at line 209 of file mhtext.\+c.



References edit\+Control\+Wnd\+Proc, and Get\+N\+H\+App().



Referenced by N\+H\+Text\+Wnd\+Proc().


\begin{DoxyCode}
210 \{
211     \textcolor{keywordflow}{switch}(message) \{
212 
213     \textcolor{keywordflow}{case} WM\_KEYDOWN:
214         \textcolor{keywordflow}{switch} (wParam)
215         \{
216         \textcolor{comment}{/* close on space in Windows mode}
217 \textcolor{comment}{           page down on space in NetHack mode */}
218         \textcolor{keywordflow}{case} VK\_SPACE:
219         \{   
220             SCROLLINFO si;
221 
222             si.cbSize = \textcolor{keyword}{sizeof}(SCROLLINFO);
223             si.fMask = SIF\_POS | SIF\_RANGE | SIF\_PAGE;
224             GetScrollInfo(hWnd, SB\_VERT, &si);
225             \textcolor{comment}{/* If nethackmode and not at the end of the list */}
226             \textcolor{keywordflow}{if} (\hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{GetNHApp}()->regNetHackMode &&
227                     (si.nPos + (\textcolor{keywordtype}{int})si.nPage) <= (si.nMax - si.nMin))
228                 SendMessage(hWnd, EM\_SCROLL, SB\_PAGEDOWN, 0);
229             \textcolor{keywordflow}{else}
230                 PostMessage(GetParent(hWnd), WM\_COMMAND, MAKELONG(IDOK, 0), 0);
231             \textcolor{keywordflow}{return} 0;
232         \}
233         \textcolor{keywordflow}{case} VK\_NEXT:
234             SendMessage(hWnd, EM\_SCROLL, SB\_PAGEDOWN, 0);
235             \textcolor{keywordflow}{return} 0;
236         \textcolor{keywordflow}{case} VK\_PRIOR:
237             SendMessage(hWnd, EM\_SCROLL, SB\_PAGEUP, 0);
238             \textcolor{keywordflow}{return} 0;
239         \textcolor{keywordflow}{case} VK\_UP:
240             SendMessage(hWnd, EM\_SCROLL, SB\_LINEUP, 0);
241             \textcolor{keywordflow}{return} 0;
242         \textcolor{keywordflow}{case} VK\_DOWN:
243             SendMessage(hWnd, EM\_SCROLL, SB\_LINEDOWN, 0);
244             \textcolor{keywordflow}{return} 0;
245 
246         \}
247     \textcolor{keywordflow}{break};
248     \}
249 
250     \textcolor{keywordflow}{if}( \hyperlink{win_2win32_2mhtext_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{editControlWndProc} ) 
251         \textcolor{keywordflow}{return} CallWindowProc(\hyperlink{win_2win32_2mhtext_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{editControlWndProc}, hWnd, message, wParam, lParam);
252     \textcolor{keywordflow}{else} 
253         \textcolor{keywordflow}{return} 0;
254 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhtext_8c_ac7fcc73b73e8ded97c0eea607e8b7305}{\index{win/win32/mhtext.\+c@{win/win32/mhtext.\+c}!N\+H\+Text\+Wnd\+Proc@{N\+H\+Text\+Wnd\+Proc}}
\index{N\+H\+Text\+Wnd\+Proc@{N\+H\+Text\+Wnd\+Proc}!win/win32/mhtext.\+c@{win/win32/mhtext.\+c}}
\subsubsection[{N\+H\+Text\+Wnd\+Proc}]{\setlength{\rightskip}{0pt plus 5cm}B\+O\+O\+L C\+A\+L\+L\+B\+A\+C\+K N\+H\+Text\+Wnd\+Proc (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{{\bf U\+I\+N\+T}}]{message, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhtext_8c_ac7fcc73b73e8ded97c0eea607e8b7305}


Definition at line 61 of file mhtext.\+c.



References A\+T\+R\+\_\+\+N\+O\+N\+E, D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+T\+E\+X\+T, D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+T\+E\+X\+T, edit\+Control\+Wnd\+Proc, F\+A\+L\+S\+E, free(), Get\+N\+H\+App(), mswin\+\_\+nhwindow\+\_\+app\+::h\+Main\+Wnd, I\+D\+C\+\_\+\+T\+E\+X\+T\+\_\+\+C\+O\+N\+T\+R\+O\+L, I\+D\+S\+\_\+\+A\+P\+P\+\_\+\+T\+I\+T\+L\+E, Layout\+Text(), M\+A\+X\+\_\+\+L\+O\+A\+D\+S\+T\+R\+I\+N\+G, mswin\+\_\+get\+\_\+font(), mswin\+\_\+window\+\_\+mark\+\_\+dead(), mswin\+\_\+winid\+\_\+from\+\_\+handle(), N\+H\+Edit\+Hook\+Wnd\+Proc(), N\+H\+W\+\_\+\+T\+E\+X\+T, N\+U\+L\+L, on\+M\+S\+N\+H\+Command(), panic(), S\+Y\+S\+C\+L\+R\+\_\+\+T\+O\+\_\+\+B\+R\+U\+S\+H, text\+\_\+bg\+\_\+brush, text\+\_\+bg\+\_\+color, text\+\_\+fg\+\_\+brush, text\+\_\+fg\+\_\+color, T\+R\+U\+E, mswin\+\_\+nethack\+\_\+text\+\_\+window\+::window\+\_\+text, and W\+M\+\_\+\+M\+S\+N\+H\+\_\+\+C\+O\+M\+M\+A\+N\+D.



Referenced by mswin\+\_\+init\+\_\+text\+\_\+window().


\begin{DoxyCode}
62 \{
63     HWND control;
64     HDC hdc;
65     \hyperlink{structmswin__nethack__text__window}{PNHTextWindow} data;
66     TCHAR title[\hyperlink{sys_2wince_2mhmain_8c_a2b68559d692760680c326428841254d1}{MAX\_LOADSTRING}];
67     
68     data = (\hyperlink{sys_2wince_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}{PNHTextWindow})GetWindowLong(hWnd, GWL\_USERDATA);
69     \textcolor{keywordflow}{switch} (message) 
70     \{
71     \textcolor{keywordflow}{case} WM\_INITDIALOG:
72         \textcolor{comment}{/* set text control font */}
73         control = GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a5a3e3e31caaecfedcda0408c52a93b1e}{IDC\_TEXT\_CONTROL});
74         \textcolor{keywordflow}{if}( !control ) \{
75             \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"cannot get text view window"});
76         \}
77 
78         hdc = GetDC(control);
79         SendMessage(control, WM\_SETFONT, (WPARAM)\hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(
      \hyperlink{wintype_8h_a7e2bcc8531c4c62e8d8f1c5279c5789b}{NHW\_TEXT}, \hyperlink{wintype_8h_a20a20b74e8cf84ecfbf3c8665c059636}{ATR\_NONE}, hdc, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}), 0);
80         ReleaseDC(control, hdc);
81 
82         \textcolor{comment}{/* subclass edit control */}
83         \hyperlink{win_2win32_2mhtext_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{editControlWndProc} = (WNDPROC)GetWindowLong(control, GWL\_WNDPROC);
84         SetWindowLong(control, GWL\_WNDPROC, (LONG)\hyperlink{win_2win32_2mhtext_8c_a99027d3049b43760d736201b8f88850a}{NHEditHookWndProc});
85 
86         SetFocus(control);
87 
88         \textcolor{comment}{/* Even though the dialog has no caption, you can still set the title }
89 \textcolor{comment}{           which shows on Alt-Tab */}
90         LoadString(\hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{GetNHApp}()->hApp, \hyperlink{sys_2wince_2resource_8h_a636c9aea2a8d16b73e43df39b3e0e7bd}{IDS\_APP\_TITLE}, title, 
      \hyperlink{sys_2wince_2mhmain_8c_a2b68559d692760680c326428841254d1}{MAX\_LOADSTRING});
91         SetWindowText(hWnd, title);
92     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
93 
94     \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2mhmsg_8h_a55eac656fabe0d462816201ac756eab6}{WM\_MSNH\_COMMAND}:
95         \hyperlink{win_2win32_2mhtext_8c_ab1f0aceef05a1dec643246c7cbf5353c}{onMSNHCommand}(hWnd, wParam, lParam);
96     \textcolor{keywordflow}{break};
97 
98     \textcolor{keywordflow}{case} WM\_SIZE:
99         \hyperlink{win_2win32_2mhtext_8c_aafad889148472301230253fc2b8f1191}{LayoutText}(hWnd);
100     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
101 
102     \textcolor{keywordflow}{case} WM\_COMMAND:
103         \textcolor{keywordflow}{switch} (LOWORD(wParam)) 
104         \{ 
105           \textcolor{keywordflow}{case} IDOK: 
106           \textcolor{keywordflow}{case} IDCANCEL:
107             \hyperlink{sys_2wince_2mswproc_8c_a2dd95f399fc771e39649d2962c6b04f6}{mswin\_window\_mark\_dead}(\hyperlink{sys_2wince_2mswproc_8c_ab8710fc5a763a885ff66eb7e01215fd0}{mswin\_winid\_from\_handle}(
      hWnd));
108             \textcolor{keywordflow}{if}( \hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{GetNHApp}()->hMainWnd==hWnd ) 
109                 \hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{GetNHApp}()->\hyperlink{structmswin__nhwindow__app_ada318d77e9dd51678af5d9a3ce6ef03a}{hMainWnd}=\hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
110             DestroyWindow(hWnd);
111             SetFocus(\hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{GetNHApp}()->hMainWnd);
112             \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
113           \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2resource_8h_a5a3e3e31caaecfedcda0408c52a93b1e}{IDC\_TEXT\_CONTROL}:
114             \textcolor{keywordflow}{switch} (HIWORD(wParam))
115             \{
116               \textcolor{keywordflow}{case} EN\_SETFOCUS:
117                 HideCaret((HWND)lParam);
118                 \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
119             \}
120         \}
121     \textcolor{keywordflow}{break};
122 
123     \textcolor{keywordflow}{case} WM\_CTLCOLORSTATIC: \{ \textcolor{comment}{/* sent by edit control before it is drawn */}
124         HDC hdcEdit = (HDC) wParam; 
125         HWND hwndEdit = (HWND) lParam;
126         \textcolor{keywordflow}{if}( hwndEdit == GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a5a3e3e31caaecfedcda0408c52a93b1e}{IDC\_TEXT\_CONTROL}) ) \{
127             SetBkColor(hdcEdit, 
128                 \hyperlink{win_2win32_2mswproc_8c_a25ec9999068f66e88062a207b0b122d8}{text\_bg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_a7101374a4b700d06a6ee6f951f029cd9}{text\_bg\_color} : (COLORREF)GetSysColor(
      \hyperlink{win_2win32_2mhtext_8c_a31e380304152e012afbd6151c8f4cc70}{DEFAULT\_COLOR\_BG\_TEXT})
129                 );
130             SetTextColor(hdcEdit, 
131                 \hyperlink{win_2win32_2mswproc_8c_ae8798e75c0140495b7d71273b1c5d084}{text\_fg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_a7d6dc4a40034d2d5b6e6cd388d11096b}{text\_fg\_color} : (COLORREF)GetSysColor(
      \hyperlink{win_2win32_2mhtext_8c_a47fb1e2e86d10f668872ccce87a250f6}{DEFAULT\_COLOR\_FG\_TEXT}) 
132                 ); 
133             \textcolor{keywordflow}{return} (BOOL)(\hyperlink{win_2win32_2mswproc_8c_a25ec9999068f66e88062a207b0b122d8}{text\_bg\_brush} 
134                     ? \hyperlink{win_2win32_2mswproc_8c_a25ec9999068f66e88062a207b0b122d8}{text\_bg\_brush} : \hyperlink{mhcolor_8h_ababa49ed211db00c071857fdd982ece1}{SYSCLR\_TO\_BRUSH}(
      \hyperlink{win_2win32_2mhtext_8c_a31e380304152e012afbd6151c8f4cc70}{DEFAULT\_COLOR\_BG\_TEXT}));
135         \}
136     \} \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
137 
138     \textcolor{keywordflow}{case} WM\_DESTROY:
139         \textcolor{keywordflow}{if}( data ) \{
140             \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text} ) \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text});
141             \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(data);
142             SetWindowLong(hWnd, GWL\_USERDATA, (LONG)0);
143         \}
144     \textcolor{keywordflow}{break};
145 
146     \}
147     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
148 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhtext_8c_ab1f0aceef05a1dec643246c7cbf5353c}{\index{win/win32/mhtext.\+c@{win/win32/mhtext.\+c}!on\+M\+S\+N\+H\+Command@{on\+M\+S\+N\+H\+Command}}
\index{on\+M\+S\+N\+H\+Command@{on\+M\+S\+N\+H\+Command}!win/win32/mhtext.\+c@{win/win32/mhtext.\+c}}
\subsubsection[{on\+M\+S\+N\+H\+Command}]{\setlength{\rightskip}{0pt plus 5cm}void on\+M\+S\+N\+H\+Command (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhtext_8c_ab1f0aceef05a1dec643246c7cbf5353c}


Definition at line 150 of file mhtext.\+c.



References B\+U\+F\+S\+Z, malloc(), M\+S\+N\+H\+\_\+\+M\+S\+G\+\_\+\+P\+U\+T\+S\+T\+R, N\+H\+\_\+\+A2\+W, mswin\+\_\+nhmsg\+\_\+putstr\+::text, and mswin\+\_\+nethack\+\_\+text\+\_\+window\+::window\+\_\+text.



Referenced by N\+H\+Text\+Wnd\+Proc().


\begin{DoxyCode}
151 \{
152     \hyperlink{structmswin__nethack__text__window}{PNHTextWindow} data;
153     
154     data = (\hyperlink{sys_2wince_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}{PNHTextWindow})GetWindowLong(hWnd, GWL\_USERDATA);
155     \textcolor{keywordflow}{switch}( wParam ) \{
156     \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2mhmsg_8h_a483b8d3a386f1c5d76da1dff6ed549a8}{MSNH\_MSG\_PUTSTR}: \{
157         \hyperlink{structmswin__nhmsg__putstr}{PMSNHMsgPutstr} msg\_data = (\hyperlink{sys_2wince_2mhmsg_8h_ad6db1f0e39180f07f00581a93dbdd846}{PMSNHMsgPutstr})lParam;
158         TCHAR   wbuf[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
159         \textcolor{keywordtype}{size\_t} text\_size;
160 
161         \textcolor{keywordflow}{if}( !data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text} ) \{
162             text\_size = strlen(msg\_data->\hyperlink{structmswin__nhmsg__putstr_a27f09d7286c01fe17c1289761b63502e}{text}) + 4;
163             data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text} = (TCHAR*)\hyperlink{winproto_8h_ab028c02ac00afc0c1d3c568ccad68869}{malloc}(text\_size*\textcolor{keyword}{sizeof}(data->
      \hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text}[0]));
164             ZeroMemory(data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text}, text\_size*\textcolor{keyword}{sizeof}(data->
      \hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text}[0]));
165         \} \textcolor{keywordflow}{else} \{
166             text\_size = \_tcslen(data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text}) + strlen(msg\_data->
      \hyperlink{structmswin__nhmsg__putstr_a27f09d7286c01fe17c1289761b63502e}{text}) + 4;
167             data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text} = (TCHAR*)realloc(data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text}, text\_size*\textcolor{keyword}{sizeof}(
      data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text}[0]));
168         \}
169         \textcolor{keywordflow}{if}( !data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text} ) \textcolor{keywordflow}{break};
170         
171         \_tcscat(data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text}, \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(msg\_data->\hyperlink{structmswin__nhmsg__putstr_a27f09d7286c01fe17c1289761b63502e}{text}, wbuf, 
      \hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ})); 
172         \_tcscat(data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text}, TEXT(\textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"}));
173         \textcolor{keywordflow}{break};
174     \}
175     \}
176 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{win_2win32_2mhtext_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{\index{win/win32/mhtext.\+c@{win/win32/mhtext.\+c}!edit\+Control\+Wnd\+Proc@{edit\+Control\+Wnd\+Proc}}
\index{edit\+Control\+Wnd\+Proc@{edit\+Control\+Wnd\+Proc}!win/win32/mhtext.\+c@{win/win32/mhtext.\+c}}
\subsubsection[{edit\+Control\+Wnd\+Proc}]{\setlength{\rightskip}{0pt plus 5cm}W\+N\+D\+P\+R\+O\+C edit\+Control\+Wnd\+Proc = 0\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhtext_8c_ad6488b0aa2546ac1e148bc6ca7b51087}


Definition at line 16 of file mhtext.\+c.



Referenced by N\+H\+Edit\+Hook\+Wnd\+Proc(), and N\+H\+Text\+Wnd\+Proc().

