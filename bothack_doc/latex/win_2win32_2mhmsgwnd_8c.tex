\hypertarget{win_2win32_2mhmsgwnd_8c}{\section{nethack/win/win32/mhmsgwnd.c File Reference}
\label{win_2win32_2mhmsgwnd_8c}\index{nethack/win/win32/mhmsgwnd.\+c@{nethack/win/win32/mhmsgwnd.\+c}}
}
{\ttfamily \#include \char`\"{}win\+M\+S.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhmsgwnd.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhmsg.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhfont.\+h\char`\"{}}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structwindow__line}{window\+\_\+line}
\item 
struct \hyperlink{structmswin__nethack__message__window}{mswin\+\_\+nethack\+\_\+message\+\_\+window}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{win_2win32_2mhmsgwnd_8c_aed04879f460c67483fee2c20648d35ff}{M\+S\+G\+\_\+\+W\+R\+A\+P\+\_\+\+T\+E\+X\+T}
\item 
\#define \hyperlink{win_2win32_2mhmsgwnd_8c_ab4f3451af76d732aceaf36e3d3043dfb}{M\+S\+G\+\_\+\+V\+I\+S\+I\+B\+L\+E\+\_\+\+L\+I\+N\+E\+S}~\hyperlink{dialogs_8c_affe776513b24d84b39af8ab0930fef7f}{max}(iflags.\+wc\+\_\+vary\+\_\+msgcount, 2)
\item 
\#define \hyperlink{win_2win32_2mhmsgwnd_8c_af62d3eba40911b9d82f6e377b48a50e2}{M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+L\+I\+N\+E\+S}~32
\item 
\#define \hyperlink{win_2win32_2mhmsgwnd_8c_aae28724cf681afbd0c0ce60297cfff1a}{M\+S\+G\+\_\+\+L\+I\+N\+E\+S}~(int)\hyperlink{tclib_8c_ac6afabdc09a49a433ee19d8a9486056d}{min}(iflags.\+msg\+\_\+history, \hyperlink{win_2win32_2mhmsgwnd_8c_af62d3eba40911b9d82f6e377b48a50e2}{M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+L\+I\+N\+E\+S})
\item 
\#define \hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{M\+A\+X\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T}~\hyperlink{wingem1_8c_aa18046886c403e831e620d0bfb76bdc7}{T\+B\+U\+F\+S\+Z}
\item 
\#define \hyperlink{win_2win32_2mhmsgwnd_8c_a265c206180eeac586995a50297197ec5}{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+S\+G}~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W
\item 
\#define \hyperlink{win_2win32_2mhmsgwnd_8c_afe538a4f29778b18c6fbb0b139932a19}{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+S\+G}~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T
\item 
\#define \hyperlink{win_2win32_2mhmsgwnd_8c_af1419a0ecedb20ed14a20e89ba0aae19}{M\+O\+R\+E}~\char`\"{}-\/-\/More-\/-\/\char`\"{}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \\*
\hyperlink{structmswin__nethack__message__window}{mswin\+\_\+nethack\+\_\+message\+\_\+window} \hyperlink{win_2win32_2mhmsgwnd_8c_a33b3f8800200036e0f9a266a8ccb7ca5}{N\+H\+Message\+Window}
\item 
typedef struct \\*
\hyperlink{structmswin__nethack__message__window}{mswin\+\_\+nethack\+\_\+message\+\_\+window} $\ast$ \hyperlink{win_2win32_2mhmsgwnd_8c_aeb30ef6a644f488174e92ff6962b1728}{P\+N\+H\+Message\+Window}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
L\+R\+E\+S\+U\+L\+T C\+A\+L\+L\+B\+A\+C\+K \hyperlink{win_2win32_2mhmsgwnd_8c_a12c253cbd080ff7e808f935f2bdf7680}{N\+H\+Message\+Wnd\+Proc} (H\+W\+N\+D, \hyperlink{def__os2_8h_a36cb3b01d81ffd844bbbfb54003e06ec}{U\+I\+N\+T}, W\+P\+A\+R\+A\+M, L\+P\+A\+R\+A\+M)
\item 
static void \hyperlink{win_2win32_2mhmsgwnd_8c_a65d05a8dfe8d143493a62903f06d051b}{register\+\_\+message\+\_\+window\+\_\+class} (void)
\item 
static void \hyperlink{win_2win32_2mhmsgwnd_8c_ab1f0aceef05a1dec643246c7cbf5353c}{on\+M\+S\+N\+H\+Command} (H\+W\+N\+D h\+Wnd, W\+P\+A\+R\+A\+M w\+Param, L\+P\+A\+R\+A\+M l\+Param)
\item 
static void \hyperlink{win_2win32_2mhmsgwnd_8c_a1f270ab41a83935a7f1a12c1ebf960c1}{on\+M\+S\+N\+H\+\_\+\+V\+Scroll} (H\+W\+N\+D h\+Wnd, W\+P\+A\+R\+A\+M w\+Param, L\+P\+A\+R\+A\+M l\+Param)
\item 
static C\+O\+L\+O\+R\+R\+E\+F \hyperlink{win_2win32_2mhmsgwnd_8c_a8aae2e718a66937d372bd6033438c542}{set\+Msg\+Text\+Color} (H\+D\+C hdc, int gray)
\item 
static void \hyperlink{win_2win32_2mhmsgwnd_8c_ad09a28d28eea324af31f4fdfa19a44b4}{on\+Paint} (H\+W\+N\+D h\+Wnd)
\item 
static void \hyperlink{win_2win32_2mhmsgwnd_8c_a8d537e532190de086a8d3636c37c57a9}{on\+Create} (H\+W\+N\+D h\+Wnd, W\+P\+A\+R\+A\+M w\+Param, L\+P\+A\+R\+A\+M l\+Param)
\item 
H\+W\+N\+D \hyperlink{win_2win32_2mhmsgwnd_8c_a1afe35c0c2ce82505b2146a9e4e3eb93}{mswin\+\_\+init\+\_\+message\+\_\+window} ()
\item 
void \hyperlink{win_2win32_2mhmsgwnd_8c_a83f12dae73f3dbddc7af82b4cc3f90bf}{mswin\+\_\+message\+\_\+window\+\_\+size} (H\+W\+N\+D h\+Wnd, L\+P\+S\+I\+Z\+E sz)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static T\+C\+H\+A\+R \hyperlink{win_2win32_2mhmsgwnd_8c_a787ab0593b5cdc6e80e8602488f03810}{sz\+Message\+Window\+Class} \mbox{[}$\,$\mbox{]} = T\+E\+X\+T(\char`\"{}M\+S\+N\+H\+Message\+Wnd\+Class\char`\"{})
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{win_2win32_2mhmsgwnd_8c_a265c206180eeac586995a50297197ec5}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+S\+G@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+S\+G}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+S\+G@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+S\+G}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+S\+G}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+S\+G~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W}}\label{win_2win32_2mhmsgwnd_8c_a265c206180eeac586995a50297197ec5}


Definition at line 16 of file mhmsgwnd.\+c.



Referenced by on\+Paint(), register\+\_\+message\+\_\+window\+\_\+class(), and set\+Msg\+Text\+Color().

\hypertarget{win_2win32_2mhmsgwnd_8c_afe538a4f29778b18c6fbb0b139932a19}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+S\+G@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+S\+G}}
\index{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+S\+G@{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+S\+G}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+S\+G}]{\setlength{\rightskip}{0pt plus 5cm}\#define D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+S\+G~C\+O\+L\+O\+R\+\_\+\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T}}\label{win_2win32_2mhmsgwnd_8c_afe538a4f29778b18c6fbb0b139932a19}


Definition at line 17 of file mhmsgwnd.\+c.



Referenced by set\+Msg\+Text\+Color().

\hypertarget{win_2win32_2mhmsgwnd_8c_af62d3eba40911b9d82f6e377b48a50e2}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+L\+I\+N\+E\+S@{M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+L\+I\+N\+E\+S}}
\index{M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+L\+I\+N\+E\+S@{M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+L\+I\+N\+E\+S}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+L\+I\+N\+E\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+L\+I\+N\+E\+S~32}}\label{win_2win32_2mhmsgwnd_8c_af62d3eba40911b9d82f6e377b48a50e2}


Definition at line 12 of file mhmsgwnd.\+c.

\hypertarget{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!M\+A\+X\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T@{M\+A\+X\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T}}
\index{M\+A\+X\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T@{M\+A\+X\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{M\+A\+X\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+A\+X\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T~{\bf T\+B\+U\+F\+S\+Z}}}\label{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}


Definition at line 14 of file mhmsgwnd.\+c.



Referenced by on\+Create(), on\+M\+S\+N\+H\+Command(), and on\+Paint().

\hypertarget{win_2win32_2mhmsgwnd_8c_af1419a0ecedb20ed14a20e89ba0aae19}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!M\+O\+R\+E@{M\+O\+R\+E}}
\index{M\+O\+R\+E@{M\+O\+R\+E}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{M\+O\+R\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+O\+R\+E~\char`\"{}-\/-\/More-\/-\/\char`\"{}}}\label{win_2win32_2mhmsgwnd_8c_af1419a0ecedb20ed14a20e89ba0aae19}


Definition at line 19 of file mhmsgwnd.\+c.



Referenced by on\+Paint().

\hypertarget{win_2win32_2mhmsgwnd_8c_aae28724cf681afbd0c0ce60297cfff1a}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!M\+S\+G\+\_\+\+L\+I\+N\+E\+S@{M\+S\+G\+\_\+\+L\+I\+N\+E\+S}}
\index{M\+S\+G\+\_\+\+L\+I\+N\+E\+S@{M\+S\+G\+\_\+\+L\+I\+N\+E\+S}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{M\+S\+G\+\_\+\+L\+I\+N\+E\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+S\+G\+\_\+\+L\+I\+N\+E\+S~(int){\bf min}(iflags.\+msg\+\_\+history, {\bf M\+A\+X\+\_\+\+M\+S\+G\+\_\+\+L\+I\+N\+E\+S})}}\label{win_2win32_2mhmsgwnd_8c_aae28724cf681afbd0c0ce60297cfff1a}


Definition at line 13 of file mhmsgwnd.\+c.



Referenced by N\+H\+Message\+Wnd\+Proc(), and on\+Paint().

\hypertarget{win_2win32_2mhmsgwnd_8c_ab4f3451af76d732aceaf36e3d3043dfb}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!M\+S\+G\+\_\+\+V\+I\+S\+I\+B\+L\+E\+\_\+\+L\+I\+N\+E\+S@{M\+S\+G\+\_\+\+V\+I\+S\+I\+B\+L\+E\+\_\+\+L\+I\+N\+E\+S}}
\index{M\+S\+G\+\_\+\+V\+I\+S\+I\+B\+L\+E\+\_\+\+L\+I\+N\+E\+S@{M\+S\+G\+\_\+\+V\+I\+S\+I\+B\+L\+E\+\_\+\+L\+I\+N\+E\+S}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{M\+S\+G\+\_\+\+V\+I\+S\+I\+B\+L\+E\+\_\+\+L\+I\+N\+E\+S}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+S\+G\+\_\+\+V\+I\+S\+I\+B\+L\+E\+\_\+\+L\+I\+N\+E\+S~{\bf max}(iflags.\+wc\+\_\+vary\+\_\+msgcount, 2)}}\label{win_2win32_2mhmsgwnd_8c_ab4f3451af76d732aceaf36e3d3043dfb}


Definition at line 11 of file mhmsgwnd.\+c.



Referenced by mswin\+\_\+message\+\_\+window\+\_\+size(), N\+H\+Message\+Wnd\+Proc(), on\+M\+S\+N\+H\+\_\+\+V\+Scroll(), and on\+Paint().

\hypertarget{win_2win32_2mhmsgwnd_8c_aed04879f460c67483fee2c20648d35ff}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!M\+S\+G\+\_\+\+W\+R\+A\+P\+\_\+\+T\+E\+X\+T@{M\+S\+G\+\_\+\+W\+R\+A\+P\+\_\+\+T\+E\+X\+T}}
\index{M\+S\+G\+\_\+\+W\+R\+A\+P\+\_\+\+T\+E\+X\+T@{M\+S\+G\+\_\+\+W\+R\+A\+P\+\_\+\+T\+E\+X\+T}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{M\+S\+G\+\_\+\+W\+R\+A\+P\+\_\+\+T\+E\+X\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+S\+G\+\_\+\+W\+R\+A\+P\+\_\+\+T\+E\+X\+T}}\label{win_2win32_2mhmsgwnd_8c_aed04879f460c67483fee2c20648d35ff}


Definition at line 9 of file mhmsgwnd.\+c.



\subsection{Typedef Documentation}
\hypertarget{win_2win32_2mhmsgwnd_8c_a33b3f8800200036e0f9a266a8ccb7ca5}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!N\+H\+Message\+Window@{N\+H\+Message\+Window}}
\index{N\+H\+Message\+Window@{N\+H\+Message\+Window}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{N\+H\+Message\+Window}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf mswin\+\_\+nethack\+\_\+message\+\_\+window}  {\bf N\+H\+Message\+Window}}}\label{win_2win32_2mhmsgwnd_8c_a33b3f8800200036e0f9a266a8ccb7ca5}
\hypertarget{win_2win32_2mhmsgwnd_8c_aeb30ef6a644f488174e92ff6962b1728}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!P\+N\+H\+Message\+Window@{P\+N\+H\+Message\+Window}}
\index{P\+N\+H\+Message\+Window@{P\+N\+H\+Message\+Window}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{P\+N\+H\+Message\+Window}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf mswin\+\_\+nethack\+\_\+message\+\_\+window} $\ast$ {\bf P\+N\+H\+Message\+Window}}}\label{win_2win32_2mhmsgwnd_8c_aeb30ef6a644f488174e92ff6962b1728}


\subsection{Function Documentation}
\hypertarget{win_2win32_2mhmsgwnd_8c_a1afe35c0c2ce82505b2146a9e4e3eb93}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!mswin\+\_\+init\+\_\+message\+\_\+window@{mswin\+\_\+init\+\_\+message\+\_\+window}}
\index{mswin\+\_\+init\+\_\+message\+\_\+window@{mswin\+\_\+init\+\_\+message\+\_\+window}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{mswin\+\_\+init\+\_\+message\+\_\+window}]{\setlength{\rightskip}{0pt plus 5cm}H\+W\+N\+D mswin\+\_\+init\+\_\+message\+\_\+window (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhmsgwnd_8c_a1afe35c0c2ce82505b2146a9e4e3eb93}


Definition at line 66 of file mhmsgwnd.\+c.



References Get\+N\+H\+App(), N\+U\+L\+L, panic(), register\+\_\+message\+\_\+window\+\_\+class(), and sz\+Message\+Window\+Class.


\begin{DoxyCode}
66                                   \{
67     \textcolor{keyword}{static} \textcolor{keywordtype}{int} run\_once = 0;
68     HWND ret;
69     DWORD style;
70 
71     \textcolor{keywordflow}{if}( !run\_once ) \{
72         \hyperlink{win_2win32_2mhmsgwnd_8c_a65d05a8dfe8d143493a62903f06d051b}{register\_message\_window\_class}( );
73         run\_once = 1;
74     \}
75 
76 \textcolor{preprocessor}{#ifdef MSG\_WRAP\_TEXT            }
77     style = WS\_CHILD | WS\_CLIPSIBLINGS | WS\_VSCROLL;
78 \textcolor{preprocessor}{#else}
79     style = WS\_CHILD | WS\_CLIPSIBLINGS | WS\_VSCROLL | WS\_HSCROLL;
80 \textcolor{preprocessor}{#endif}
81 
82     ret = CreateWindowEx(
83             WS\_EX\_CLIENTEDGE,
84             \hyperlink{win_2win32_2mhmsgwnd_8c_a787ab0593b5cdc6e80e8602488f03810}{szMessageWindowClass},   \textcolor{comment}{/* registered class name */}
85             \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL},                   \textcolor{comment}{/* window name */}           
86             style, \textcolor{comment}{/* window style */}
87             0,   \textcolor{comment}{/* horizontal position of window */}
88             0,   \textcolor{comment}{/* vertical position of window */}
89             0,   \textcolor{comment}{/* window width */}
90             0,   \textcolor{comment}{/* window height - set it later */}
91             \hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hMainWnd,   \textcolor{comment}{/* handle to parent or owner window */}
92             \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL},                   \textcolor{comment}{/* menu handle or child identifier */}
93             \hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hApp,       \textcolor{comment}{/* handle to application instance */}
94             \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} );                 \textcolor{comment}{/* window-creation data */}
95 
96     \textcolor{keywordflow}{if}( !ret ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Cannot create message window"});
97 
98     \textcolor{keywordflow}{return} ret;
99 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmsgwnd_8c_a83f12dae73f3dbddc7af82b4cc3f90bf}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!mswin\+\_\+message\+\_\+window\+\_\+size@{mswin\+\_\+message\+\_\+window\+\_\+size}}
\index{mswin\+\_\+message\+\_\+window\+\_\+size@{mswin\+\_\+message\+\_\+window\+\_\+size}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{mswin\+\_\+message\+\_\+window\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}void mswin\+\_\+message\+\_\+window\+\_\+size (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{L\+P\+S\+I\+Z\+E}]{sz}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhmsgwnd_8c_a83f12dae73f3dbddc7af82b4cc3f90bf}


Definition at line 705 of file mhmsgwnd.\+c.



References A\+T\+R\+\_\+\+N\+O\+N\+E, F\+A\+L\+S\+E, M\+S\+G\+\_\+\+V\+I\+S\+I\+B\+L\+E\+\_\+\+L\+I\+N\+E\+S, mswin\+\_\+get\+\_\+font(), N\+H\+W\+\_\+\+M\+E\+S\+S\+A\+G\+E, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::x\+Char, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::x\+Page, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::x\+Upper, and mswin\+\_\+nethack\+\_\+message\+\_\+window\+::y\+Char.


\begin{DoxyCode}
706 \{
707     HDC hdc;
708     HGDIOBJ saveFont;
709     TEXTMETRIC \hyperlink{structtm}{tm}; 
710     \hyperlink{structmswin__nethack__message__window}{PNHMessageWindow} data;
711     RECT rt, client\_rt;
712 
713     data = (\hyperlink{sys_2wince_2mhmsgwnd_8c_aeb30ef6a644f488174e92ff6962b1728}{PNHMessageWindow})GetWindowLong(hWnd, GWL\_USERDATA);
714     \textcolor{keywordflow}{if}( !data ) \textcolor{keywordflow}{return};
715 
716     \textcolor{comment}{/* -- Calculate the font size -- */}
717     \textcolor{comment}{/* Get the handle to the client area's device context. */}
718     hdc = GetDC(hWnd); 
719     saveFont = SelectObject(hdc, \hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(\hyperlink{wintype_8h_ab3d471e84a363992b5a483392d0b2389}{NHW\_MESSAGE}, 
      \hyperlink{wintype_8h_a20a20b74e8cf84ecfbf3c8665c059636}{ATR\_NONE}, hdc, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}));
720 
721     \textcolor{comment}{/* Extract font dimensions from the text metrics. */}
722     GetTextMetrics (hdc, &tm); 
723     data->\hyperlink{structmswin__nethack__message__window_a3a2ddfa2880d9e42fe99c727c9f52a6f}{xChar} = tm.tmAveCharWidth; 
724     data->\hyperlink{structmswin__nethack__message__window_a78d9744ac68cb597f4917b871ba9f134}{xUpper} = (tm.tmPitchAndFamily & 1 ? 3 : 2) * data->\hyperlink{structmswin__nethack__message__window_a3a2ddfa2880d9e42fe99c727c9f52a6f}{xChar}/2; 
725     data->\hyperlink{structmswin__nethack__message__window_abcddabdea03ae3f33b1459fb81075dae}{yChar} = tm.tmHeight + tm.tmExternalLeading; 
726     data->\hyperlink{structmswin__nethack__message__window_ad9bd73638158de8be8fae776b862e639}{xPage} = 1;
727 
728     \textcolor{comment}{/* Free the device context.  */}
729     SelectObject(hdc, saveFont);
730     ReleaseDC (hWnd, hdc); 
731     
732     \textcolor{comment}{/* -- calculate window size -- */}
733     GetWindowRect(hWnd, &rt);
734     sz->cx = rt.right - rt.left;
735     sz->cy = rt.bottom - rt.top;
736 
737     \textcolor{comment}{/* set size to accomodate MSG\_VISIBLE\_LINES and}
738 \textcolor{comment}{       horizontal scroll bar (difference between window rect and client rect */}
739     GetClientRect(hWnd, &client\_rt);
740     sz->cy = sz->cy - (client\_rt.bottom - client\_rt.top) +
741              data->\hyperlink{structmswin__nethack__message__window_abcddabdea03ae3f33b1459fb81075dae}{yChar} * \hyperlink{win_2win32_2mhmsgwnd_8c_ab4f3451af76d732aceaf36e3d3043dfb}{MSG\_VISIBLE\_LINES};
742 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmsgwnd_8c_a12c253cbd080ff7e808f935f2bdf7680}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!N\+H\+Message\+Wnd\+Proc@{N\+H\+Message\+Wnd\+Proc}}
\index{N\+H\+Message\+Wnd\+Proc@{N\+H\+Message\+Wnd\+Proc}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{N\+H\+Message\+Wnd\+Proc}]{\setlength{\rightskip}{0pt plus 5cm}L\+R\+E\+S\+U\+L\+T C\+A\+L\+L\+B\+A\+C\+K N\+H\+Message\+Wnd\+Proc (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{{\bf U\+I\+N\+T}}]{message, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhmsgwnd_8c_a12c253cbd080ff7e808f935f2bdf7680}


Definition at line 120 of file mhmsgwnd.\+c.



References free(), Get\+N\+H\+App(), max, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::max\+\_\+text, min, M\+S\+G\+\_\+\+L\+I\+N\+E\+S, M\+S\+G\+\_\+\+V\+I\+S\+I\+B\+L\+E\+\_\+\+L\+I\+N\+E\+S, on\+Create(), on\+M\+S\+N\+H\+\_\+\+H\+Scroll(), on\+M\+S\+N\+H\+\_\+\+V\+Scroll(), on\+M\+S\+N\+H\+Command(), on\+Paint(), T\+R\+U\+E, W\+M\+\_\+\+M\+S\+N\+H\+\_\+\+C\+O\+M\+M\+A\+N\+D, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::x\+Char, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::x\+Max, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::x\+Page, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::x\+Pos, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::y\+Max, and mswin\+\_\+nethack\+\_\+message\+\_\+window\+::y\+Pos.


\begin{DoxyCode}
121 \{
122     \textcolor{keywordflow}{switch} (message) 
123     \{
124     \textcolor{keywordflow}{case} WM\_CREATE:
125         \hyperlink{win_2win32_2mhmsgwnd_8c_a8d537e532190de086a8d3636c37c57a9}{onCreate}( hWnd, wParam, lParam );
126         \textcolor{keywordflow}{break};
127 
128     \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2mhmsg_8h_a55eac656fabe0d462816201ac756eab6}{WM\_MSNH\_COMMAND}: 
129         \hyperlink{win_2win32_2mhmsgwnd_8c_ab1f0aceef05a1dec643246c7cbf5353c}{onMSNHCommand}(hWnd, wParam, lParam);
130         \textcolor{keywordflow}{break};
131 
132     \textcolor{keywordflow}{case} WM\_PAINT: 
133         \hyperlink{win_2win32_2mhmsgwnd_8c_ad09a28d28eea324af31f4fdfa19a44b4}{onPaint}(hWnd);
134         \textcolor{keywordflow}{break};
135 
136     \textcolor{keywordflow}{case} WM\_SETFOCUS:
137         SetFocus(\hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hMainWnd);
138         \textcolor{keywordflow}{break};
139 
140 \textcolor{preprocessor}{#ifndef MSG\_WRAP\_TEXT}
141     \textcolor{keywordflow}{case} WM\_HSCROLL:
142         \hyperlink{sys_2wince_2mhmap_8c_ad9a3e28d520ba0d767dd1b281c074ea6}{onMSNH\_HScroll}(hWnd, wParam, lParam);
143         \textcolor{keywordflow}{break};
144 \textcolor{preprocessor}{#endif}
145 
146     \textcolor{keywordflow}{case} WM\_VSCROLL:
147         \hyperlink{win_2win32_2mhmsgwnd_8c_a1f270ab41a83935a7f1a12c1ebf960c1}{onMSNH\_VScroll}(hWnd, wParam, lParam);
148         \textcolor{keywordflow}{break};
149 
150     \textcolor{keywordflow}{case} WM\_DESTROY: 
151     \{
152         \hyperlink{structmswin__nethack__message__window}{PNHMessageWindow} data;
153         data = (\hyperlink{sys_2wince_2mhmsgwnd_8c_aeb30ef6a644f488174e92ff6962b1728}{PNHMessageWindow})GetWindowLong(hWnd, GWL\_USERDATA);
154         \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(data);
155         SetWindowLong(hWnd, GWL\_USERDATA, (LONG)0);
156     \}   \textcolor{keywordflow}{break};
157 
158     \textcolor{keywordflow}{case} WM\_SIZE: 
159     \{ 
160         SCROLLINFO si;
161         \textcolor{keywordtype}{int} xNewSize; 
162         \textcolor{keywordtype}{int} yNewSize; 
163         \hyperlink{structmswin__nethack__message__window}{PNHMessageWindow} data;
164     
165         data = (\hyperlink{sys_2wince_2mhmsgwnd_8c_aeb30ef6a644f488174e92ff6962b1728}{PNHMessageWindow})GetWindowLong(hWnd, GWL\_USERDATA);
166  
167         xNewSize = LOWORD(lParam); 
168         yNewSize = HIWORD(lParam); 
169 
170         \textcolor{keywordflow}{if}( xNewSize>0 || yNewSize>0 ) \{
171 
172 \textcolor{preprocessor}{#ifndef MSG\_WRAP\_TEXT}
173             data->\hyperlink{structmswin__nethack__message__window_ad9bd73638158de8be8fae776b862e639}{xPage} = xNewSize/data->\hyperlink{structmswin__nethack__message__window_a3a2ddfa2880d9e42fe99c727c9f52a6f}{xChar};
174             data->\hyperlink{structmswin__nethack__message__window_a4a4612686946a3904c34c050753583cb}{xMax} = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(0, (\textcolor{keywordtype}{int})(1 + data->\hyperlink{structmswin__nethack__message__window_aa5bff51a92ce67744b3df06ad74fbc92}{max\_text} - data->
      \hyperlink{structmswin__nethack__message__window_ad9bd73638158de8be8fae776b862e639}{xPage}));
175             data->\hyperlink{structmswin__nethack__message__window_a2d63ab3f820de7f35b50f99c982dbf55}{xPos} = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(data->\hyperlink{structmswin__nethack__message__window_a2d63ab3f820de7f35b50f99c982dbf55}{xPos}, data->\hyperlink{structmswin__nethack__message__window_a4a4612686946a3904c34c050753583cb}{xMax});
176 
177             ZeroMemory(&si, \textcolor{keyword}{sizeof}(si));
178             si.cbSize = \textcolor{keyword}{sizeof}(si); 
179             si.fMask  = SIF\_RANGE | SIF\_PAGE | SIF\_POS; 
180             si.nMin   = 0; 
181             si.nMax   = data->\hyperlink{structmswin__nethack__message__window_aa5bff51a92ce67744b3df06ad74fbc92}{max\_text}; 
182             si.nPage  = data->\hyperlink{structmswin__nethack__message__window_ad9bd73638158de8be8fae776b862e639}{xPage}; 
183             si.nPos   = data->\hyperlink{structmswin__nethack__message__window_a2d63ab3f820de7f35b50f99c982dbf55}{xPos};
184             SetScrollInfo(hWnd, SB\_HORZ, &si, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}); 
185 \textcolor{preprocessor}{#endif}
186         
187             data->\hyperlink{structmswin__nethack__message__window_a89b10107b69dc753430b418076cb300f}{yMax} = \hyperlink{win_2win32_2mhmsgwnd_8c_aae28724cf681afbd0c0ce60297cfff1a}{MSG\_LINES}-1;
188             data->\hyperlink{structmswin__nethack__message__window_aa0b66211653f6020214bb6e9ba806e39}{yPos} = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(data->\hyperlink{structmswin__nethack__message__window_aa0b66211653f6020214bb6e9ba806e39}{yPos}, data->\hyperlink{structmswin__nethack__message__window_a89b10107b69dc753430b418076cb300f}{yMax});
189 
190             ZeroMemory(&si, \textcolor{keyword}{sizeof}(si));
191             si.cbSize = \textcolor{keyword}{sizeof}(si); 
192             si.fMask  = SIF\_RANGE | SIF\_PAGE | SIF\_POS; 
193             si.nMin   = \hyperlink{win_2win32_2mhmsgwnd_8c_ab4f3451af76d732aceaf36e3d3043dfb}{MSG\_VISIBLE\_LINES}; 
194             si.nMax   = data->\hyperlink{structmswin__nethack__message__window_a89b10107b69dc753430b418076cb300f}{yMax} + \hyperlink{win_2win32_2mhmsgwnd_8c_ab4f3451af76d732aceaf36e3d3043dfb}{MSG\_VISIBLE\_LINES} - 1; 
195             si.nPage  = \hyperlink{win_2win32_2mhmsgwnd_8c_ab4f3451af76d732aceaf36e3d3043dfb}{MSG\_VISIBLE\_LINES};
196             si.nPos   = data->\hyperlink{structmswin__nethack__message__window_aa0b66211653f6020214bb6e9ba806e39}{yPos};
197             SetScrollInfo(hWnd, SB\_VERT, &si, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}); 
198         \}
199     \} 
200     \textcolor{keywordflow}{break}; 
201 
202     \textcolor{keywordflow}{default}:
203         \textcolor{keywordflow}{return} DefWindowProc(hWnd, message, wParam, lParam);
204    \}
205    \textcolor{keywordflow}{return} 0;
206 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmsgwnd_8c_a8d537e532190de086a8d3636c37c57a9}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!on\+Create@{on\+Create}}
\index{on\+Create@{on\+Create}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{on\+Create}]{\setlength{\rightskip}{0pt plus 5cm}void on\+Create (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmsgwnd_8c_a8d537e532190de086a8d3636c37c57a9}


Definition at line 689 of file mhmsgwnd.\+c.



References malloc(), mswin\+\_\+nethack\+\_\+message\+\_\+window\+::max\+\_\+text, M\+A\+X\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T, mswin\+\_\+message\+\_\+window\+\_\+size(), panic(), and S\+I\+Z\+E.



Referenced by N\+H\+Message\+Wnd\+Proc().


\begin{DoxyCode}
690 \{
691     \hyperlink{structmswin__nethack__message__window}{PNHMessageWindow} data;
692     \hyperlink{global_8h_afd2537d19a3cb6556b0f727580ec6ee7}{SIZE}    dummy;
693 
694     \textcolor{comment}{/* set window data */}
695     data = (\hyperlink{sys_2wince_2mhmsgwnd_8c_aeb30ef6a644f488174e92ff6962b1728}{PNHMessageWindow})\hyperlink{winproto_8h_ab028c02ac00afc0c1d3c568ccad68869}{malloc}(\textcolor{keyword}{sizeof}(\hyperlink{structmswin__nethack__message__window}{NHMessageWindow}));
696     \textcolor{keywordflow}{if}( !data ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"out of memory"});
697     ZeroMemory(data, \textcolor{keyword}{sizeof}(\hyperlink{structmswin__nethack__message__window}{NHMessageWindow}));
698     data->\hyperlink{structmswin__nethack__message__window_aa5bff51a92ce67744b3df06ad74fbc92}{max\_text} = \hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{MAXWINDOWTEXT};
699     SetWindowLong(hWnd, GWL\_USERDATA, (LONG)data);
700 
701     \textcolor{comment}{/* re-calculate window size (+ font size) */}
702     \hyperlink{sys_2wince_2mhmsgwnd_8c_a83f12dae73f3dbddc7af82b4cc3f90bf}{mswin\_message\_window\_size}(hWnd, &dummy);
703 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmsgwnd_8c_a1f270ab41a83935a7f1a12c1ebf960c1}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!on\+M\+S\+N\+H\+\_\+\+V\+Scroll@{on\+M\+S\+N\+H\+\_\+\+V\+Scroll}}
\index{on\+M\+S\+N\+H\+\_\+\+V\+Scroll@{on\+M\+S\+N\+H\+\_\+\+V\+Scroll}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{on\+M\+S\+N\+H\+\_\+\+V\+Scroll}]{\setlength{\rightskip}{0pt plus 5cm}void on\+M\+S\+N\+H\+\_\+\+V\+Scroll (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmsgwnd_8c_a1f270ab41a83935a7f1a12c1ebf960c1}


Definition at line 279 of file mhmsgwnd.\+c.



References max, min, M\+S\+G\+\_\+\+V\+I\+S\+I\+B\+L\+E\+\_\+\+L\+I\+N\+E\+S, N\+U\+L\+L, T\+R\+U\+E, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::y\+Max, and mswin\+\_\+nethack\+\_\+message\+\_\+window\+::y\+Pos.



Referenced by N\+H\+Message\+Wnd\+Proc().


\begin{DoxyCode}
280 \{
281     \hyperlink{structmswin__nethack__message__window}{PNHMessageWindow} data;
282     SCROLLINFO si; 
283     \textcolor{keywordtype}{int} yInc;
284  
285     \textcolor{comment}{/* get window data */}
286     data = (\hyperlink{sys_2wince_2mhmsgwnd_8c_aeb30ef6a644f488174e92ff6962b1728}{PNHMessageWindow})GetWindowLong(hWnd, GWL\_USERDATA);
287     
288     ZeroMemory(&si, \textcolor{keyword}{sizeof}(si));
289     si.cbSize = \textcolor{keyword}{sizeof}(si);
290     si.fMask = SIF\_PAGE | SIF\_POS;
291     GetScrollInfo(hWnd, SB\_VERT, &si);
292 
293     \textcolor{keywordflow}{switch}(LOWORD (wParam)) 
294     \{ 
295     \textcolor{comment}{// User clicked the shaft above the scroll box. }
296 
297     \textcolor{keywordflow}{case} SB\_PAGEUP: 
298          yInc = -(int)si.nPage; 
299          \textcolor{keywordflow}{break}; 
300 
301     \textcolor{comment}{// User clicked the shaft below the scroll box. }
302 
303     \textcolor{keywordflow}{case} SB\_PAGEDOWN: 
304          yInc = si.nPage; 
305          \textcolor{keywordflow}{break}; 
306 
307     \textcolor{comment}{// User clicked the top arrow. }
308 
309     \textcolor{keywordflow}{case} SB\_LINEUP: 
310          yInc = -1; 
311          \textcolor{keywordflow}{break}; 
312 
313     \textcolor{comment}{// User clicked the bottom arrow. }
314 
315     \textcolor{keywordflow}{case} SB\_LINEDOWN: 
316          yInc = 1; 
317          \textcolor{keywordflow}{break}; 
318 
319     \textcolor{comment}{// User dragged the scroll box. }
320 
321     \textcolor{keywordflow}{case} SB\_THUMBTRACK: 
322          yInc = HIWORD(wParam) - data->\hyperlink{structmswin__nethack__message__window_aa0b66211653f6020214bb6e9ba806e39}{yPos}; 
323          \textcolor{keywordflow}{break}; 
324 
325     \textcolor{keywordflow}{default}: 
326          yInc = 0; 
327     \}
328 
329     \textcolor{comment}{// If applying the vertical scrolling increment does not }
330     \textcolor{comment}{// take the scrolling position out of the scrolling range, }
331     \textcolor{comment}{// increment the scrolling position, adjust the position }
332     \textcolor{comment}{// of the scroll box, and update the window. UpdateWindow }
333     \textcolor{comment}{// sends the WM\_PAINT message. }
334 
335     \textcolor{keywordflow}{if} (yInc = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}( \hyperlink{win_2win32_2mhmsgwnd_8c_ab4f3451af76d732aceaf36e3d3043dfb}{MSG\_VISIBLE\_LINES} - data->\hyperlink{structmswin__nethack__message__window_aa0b66211653f6020214bb6e9ba806e39}{yPos}, 
336                     \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(yInc, data->\hyperlink{structmswin__nethack__message__window_a89b10107b69dc753430b418076cb300f}{yMax} - data->\hyperlink{structmswin__nethack__message__window_aa0b66211653f6020214bb6e9ba806e39}{yPos}))) 
337     \{ 
338         data->\hyperlink{structmswin__nethack__message__window_aa0b66211653f6020214bb6e9ba806e39}{yPos} += yInc; 
339         \textcolor{comment}{/* ScrollWindowEx(hWnd, 0, -data->yChar * yInc, }
340 \textcolor{comment}{            (CONST RECT *) NULL, (CONST RECT *) NULL, }
341 \textcolor{comment}{            (HRGN) NULL, (LPRECT) NULL, SW\_INVALIDATE | SW\_ERASE); }
342 \textcolor{comment}{        */}
343         InvalidateRect(hWnd, \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
344 
345         ZeroMemory(&si, \textcolor{keyword}{sizeof}(si));
346         si.cbSize = \textcolor{keyword}{sizeof}(si); 
347         si.fMask  = SIF\_POS; 
348         si.nPos   = data->\hyperlink{structmswin__nethack__message__window_aa0b66211653f6020214bb6e9ba806e39}{yPos}; 
349         SetScrollInfo(hWnd, SB\_VERT, &si, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}); 
350 
351         UpdateWindow (hWnd); 
352     \} 
353 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmsgwnd_8c_ab1f0aceef05a1dec643246c7cbf5353c}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!on\+M\+S\+N\+H\+Command@{on\+M\+S\+N\+H\+Command}}
\index{on\+M\+S\+N\+H\+Command@{on\+M\+S\+N\+H\+Command}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{on\+M\+S\+N\+H\+Command}]{\setlength{\rightskip}{0pt plus 5cm}void on\+M\+S\+N\+H\+Command (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmsgwnd_8c_ab1f0aceef05a1dec643246c7cbf5353c}


Definition at line 208 of file mhmsgwnd.\+c.



References mswin\+\_\+nhmsg\+\_\+putstr\+::append, window\+\_\+line\+::attr, mswin\+\_\+nhmsg\+\_\+putstr\+::attr, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::cleared, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::last\+\_\+line, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::lines\+\_\+not\+\_\+seen, max, M\+A\+X\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T, M\+S\+N\+H\+\_\+\+M\+S\+G\+\_\+\+C\+A\+R\+E\+T, M\+S\+N\+H\+\_\+\+M\+S\+G\+\_\+\+C\+L\+E\+A\+R\+\_\+\+W\+I\+N\+D\+O\+W, M\+S\+N\+H\+\_\+\+M\+S\+G\+\_\+\+P\+U\+T\+S\+T\+R, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::nevermore, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::new\+\_\+line, N\+U\+L\+L, window\+\_\+line\+::text, mswin\+\_\+nhmsg\+\_\+putstr\+::text, T\+R\+U\+E, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::window\+\_\+text, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::y\+Char, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::y\+Max, and mswin\+\_\+nethack\+\_\+message\+\_\+window\+::y\+Pos.



Referenced by N\+H\+Message\+Wnd\+Proc().


\begin{DoxyCode}
209 \{
210     \hyperlink{structmswin__nethack__message__window}{PNHMessageWindow} data;
211     
212     data = (\hyperlink{sys_2wince_2mhmsgwnd_8c_aeb30ef6a644f488174e92ff6962b1728}{PNHMessageWindow})GetWindowLong(hWnd, GWL\_USERDATA);
213     \textcolor{keywordflow}{switch}( wParam ) \{
214     \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2mhmsg_8h_a483b8d3a386f1c5d76da1dff6ed549a8}{MSNH\_MSG\_PUTSTR}: 
215     \{
216         \hyperlink{structmswin__nhmsg__putstr}{PMSNHMsgPutstr} msg\_data = (\hyperlink{sys_2wince_2mhmsg_8h_ad6db1f0e39180f07f00581a93dbdd846}{PMSNHMsgPutstr})lParam;
217         SCROLLINFO si;
218 
219         \textcolor{keywordflow}{if}( msg\_data->\hyperlink{structmswin__nhmsg__putstr_af1e2c11564b34538c13ee0ec5c9dda56}{append} == 1) \{
220             \textcolor{comment}{/* Forcibly append to line, even if we pass the edge */}
221             strncat(data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[data->\hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line}].\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}, msg\_data->
      \hyperlink{structmswin__nhmsg__putstr_a27f09d7286c01fe17c1289761b63502e}{text}, 
222                 \hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{MAXWINDOWTEXT} - strlen(data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[data->
      \hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line}].\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}));
223         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( msg\_data->\hyperlink{structmswin__nhmsg__putstr_af1e2c11564b34538c13ee0ec5c9dda56}{append} < 0) \{
224             \textcolor{comment}{/* remove that many chars */}
225             \textcolor{keywordtype}{int} len = strlen(data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[data->\hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line}].
      \hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text});
226             \textcolor{keywordtype}{int} newend = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(len + msg\_data->\hyperlink{structmswin__nhmsg__putstr_af1e2c11564b34538c13ee0ec5c9dda56}{append}, 0);
227             data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[data->\hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line}].\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}[newend] = \textcolor{charliteral}{'\(\backslash\)0'};
228         \} \textcolor{keywordflow}{else} \{
229             \textcolor{comment}{/* Try to append but move the whole message to the next line if }
230 \textcolor{comment}{               it doesn't fit */}
231             \textcolor{comment}{/* just schedule for displaying */}
232             data->\hyperlink{structmswin__nethack__message__window_ac25c648cce60829c413d9ffa9da703bb}{new\_line}.\hyperlink{structwindow__line_a58077cb852250ed547bc6cfd0310db23}{attr} = msg\_data->\hyperlink{structmswin__nhmsg__putstr_aefa22819f8c3ca3574cfbcfd583ded58}{attr};
233             strncpy(data->\hyperlink{structmswin__nethack__message__window_ac25c648cce60829c413d9ffa9da703bb}{new\_line}.\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}, msg\_data->\hyperlink{structmswin__nhmsg__putstr_a27f09d7286c01fe17c1289761b63502e}{text}, 
      \hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{MAXWINDOWTEXT});
234         \}
235         
236         \textcolor{comment}{/* reset V-scroll position to display new text */}
237         data->\hyperlink{structmswin__nethack__message__window_aa0b66211653f6020214bb6e9ba806e39}{yPos} = data->\hyperlink{structmswin__nethack__message__window_a89b10107b69dc753430b418076cb300f}{yMax};
238 
239         ZeroMemory(&si, \textcolor{keyword}{sizeof}(si));
240         si.cbSize = \textcolor{keyword}{sizeof}(si);
241         si.fMask  = SIF\_POS; 
242         si.nPos   = data->\hyperlink{structmswin__nethack__message__window_aa0b66211653f6020214bb6e9ba806e39}{yPos}; 
243         SetScrollInfo(hWnd, SB\_VERT, &si, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
244 
245         \textcolor{comment}{/* update window content */}
246         InvalidateRect(hWnd, \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
247 
248 \textcolor{preprocessor}{#ifdef USER\_SOUNDS}
249         play\_sound\_for\_message(msg\_data->\hyperlink{structmswin__nhmsg__putstr_a27f09d7286c01fe17c1289761b63502e}{text});
250 \textcolor{preprocessor}{#endif}
251     \}
252     \textcolor{keywordflow}{break};
253 
254     \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2mhmsg_8h_a569048188a906452ebb6b755cd9ac662}{MSNH\_MSG\_CLEAR\_WINDOW}:
255     \{
256         data->\hyperlink{structmswin__nethack__message__window_ac7120601d4735608d1b4374d24cd348f}{cleared} = 1;
257         data->\hyperlink{structmswin__nethack__message__window_a03376eec1493f3cbe10aa7608b06da71}{lines\_not\_seen} = 0;
258         \textcolor{comment}{/* do --More-- again if needed */}
259         data->\hyperlink{structmswin__nethack__message__window_a4da794907bafacc07e6227112897d153}{nevermore} = 0;
260         \textcolor{keywordflow}{break};
261     \}
262     \textcolor{keywordflow}{case} \hyperlink{win_2win32_2mhmsg_8h_a3e64623328880849c3b6c3d8d050f662}{MSNH\_MSG\_CARET}:
263         \textcolor{comment}{/* Create or destroy a caret */}
264         \textcolor{keywordflow}{if} (*(\textcolor{keywordtype}{int} *)lParam)
265             CreateCaret(hWnd, \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, data->\hyperlink{structmswin__nethack__message__window_abcddabdea03ae3f33b1459fb81075dae}{yChar});
266         \textcolor{keywordflow}{else} \{
267             DestroyCaret();
268         \textcolor{comment}{/* this means we just did something interactive in this window, so we}
269 \textcolor{comment}{           don't need a --More-- for the lines above.}
270 \textcolor{comment}{           */}
271         data->\hyperlink{structmswin__nethack__message__window_a03376eec1493f3cbe10aa7608b06da71}{lines\_not\_seen} = 0;
272         \}
273         \textcolor{keywordflow}{break};
274 
275 
276     \}
277 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmsgwnd_8c_ad09a28d28eea324af31f4fdfa19a44b4}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!on\+Paint@{on\+Paint}}
\index{on\+Paint@{on\+Paint}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{on\+Paint}]{\setlength{\rightskip}{0pt plus 5cm}void on\+Paint (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmsgwnd_8c_ad09a28d28eea324af31f4fdfa19a44b4}


Definition at line 455 of file mhmsgwnd.\+c.



References window\+\_\+line\+::attr, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::cleared, D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+S\+G, F\+A\+L\+S\+E, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::in\+\_\+more, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::last\+\_\+line, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::lines\+\_\+last\+\_\+turn, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::lines\+\_\+not\+\_\+seen, max, M\+A\+X\+W\+I\+N\+D\+O\+W\+T\+E\+X\+T, message\+\_\+bg\+\_\+brush, message\+\_\+bg\+\_\+color, min, M\+O\+R\+E, M\+S\+G\+\_\+\+L\+I\+N\+E\+S, M\+S\+G\+\_\+\+V\+I\+S\+I\+B\+L\+E\+\_\+\+L\+I\+N\+E\+S, mswin\+\_\+get\+\_\+font(), mswin\+\_\+nhgetch(), mswin\+\_\+nethack\+\_\+message\+\_\+window\+::nevermore, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::new\+\_\+line, N\+H\+\_\+\+A2\+W, N\+H\+W\+\_\+\+M\+E\+S\+S\+A\+G\+E, N\+U\+L\+L, set\+Msg\+Text\+Color(), S\+I\+Z\+E, window\+\_\+line\+::text, T\+R\+U\+E, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::window\+\_\+text, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::window\+\_\+text\+\_\+lines, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::x\+Char, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::x\+Pos, mswin\+\_\+nethack\+\_\+message\+\_\+window\+::y\+Char, and mswin\+\_\+nethack\+\_\+message\+\_\+window\+::y\+Pos.



Referenced by N\+H\+Message\+Wnd\+Proc().


\begin{DoxyCode}
456 \{
457     PAINTSTRUCT ps;
458     HDC hdc;
459     \hyperlink{structmswin__nethack__message__window}{PNHMessageWindow} data;
460     RECT client\_rt, draw\_rt;
461     \textcolor{keywordtype}{int} FirstLine, LastLine;
462     \textcolor{keywordtype}{int} i, x, y;
463     HGDIOBJ oldFont;
464     TCHAR wbuf[\hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{MAXWINDOWTEXT}+2];
465     \textcolor{keywordtype}{size\_t} wlen;
466     COLORREF OldBg, OldFg;
467     \textcolor{keywordtype}{int} do\_more = 0;
468 
469     hdc = BeginPaint(hWnd, &ps);
470 
471     OldBg = SetBkColor(hdc, \hyperlink{win_2win32_2mswproc_8c_a9405a1abd371b5ea2a4c15ad6892884d}{message\_bg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_a867bd2404eb08a076bf6d18489fbc6dd}{message\_bg\_color} : (COLORREF
      )GetSysColor(\hyperlink{win_2win32_2mhmsgwnd_8c_a265c206180eeac586995a50297197ec5}{DEFAULT\_COLOR\_BG\_MSG}));
472     OldFg = \hyperlink{win_2win32_2mhmsgwnd_8c_a8aae2e718a66937d372bd6033438c542}{setMsgTextColor}(hdc, 0);
473 
474     data = (\hyperlink{sys_2wince_2mhmsgwnd_8c_aeb30ef6a644f488174e92ff6962b1728}{PNHMessageWindow})GetWindowLong(hWnd, GWL\_USERDATA);
475 
476     GetClientRect(hWnd, &client\_rt);
477 
478     \textcolor{keywordflow}{if}( !IsRectEmpty(&ps.rcPaint) ) \{
479         FirstLine = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max} (0, data->\hyperlink{structmswin__nethack__message__window_aa0b66211653f6020214bb6e9ba806e39}{yPos} - (client\_rt.bottom - ps.rcPaint.top)/data->
      \hyperlink{structmswin__nethack__message__window_abcddabdea03ae3f33b1459fb81075dae}{yChar} + 1); 
480         LastLine = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min} (\hyperlink{win_2win32_2mhmsgwnd_8c_aae28724cf681afbd0c0ce60297cfff1a}{MSG\_LINES}-1, data->\hyperlink{structmswin__nethack__message__window_aa0b66211653f6020214bb6e9ba806e39}{yPos} - (client\_rt.bottom - ps.rcPaint.bottom)/
      data->\hyperlink{structmswin__nethack__message__window_abcddabdea03ae3f33b1459fb81075dae}{yChar}); 
481         y = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}( ps.rcPaint.bottom, client\_rt.bottom ); 
482         \textcolor{keywordflow}{for} (i=LastLine; i>=FirstLine; i--) \{ 
483                 \textcolor{keywordtype}{int} lineidx = (data->\hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line} + 1 + i) % \hyperlink{win_2win32_2mhmsgwnd_8c_aae28724cf681afbd0c0ce60297cfff1a}{MSG\_LINES};
484                 x = data->\hyperlink{structmswin__nethack__message__window_a3a2ddfa2880d9e42fe99c727c9f52a6f}{xChar} * (2 - data->\hyperlink{structmswin__nethack__message__window_a2d63ab3f820de7f35b50f99c982dbf55}{xPos}); 
485 
486                 draw\_rt.left = x;
487                 draw\_rt.right = client\_rt.right;
488                 draw\_rt.top = y - data->\hyperlink{structmswin__nethack__message__window_abcddabdea03ae3f33b1459fb81075dae}{yChar};
489                 draw\_rt.bottom = y;
490 
491         oldFont = SelectObject(hdc, \hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(\hyperlink{wintype_8h_ab3d471e84a363992b5a483392d0b2389}{NHW\_MESSAGE}, data->
      \hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[lineidx].\hyperlink{structwindow__line_a58077cb852250ed547bc6cfd0310db23}{attr}, hdc, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}));
492 
493         \textcolor{comment}{/* find out if we can concatenate the scheduled message without wrapping,}
494 \textcolor{comment}{        but only if no clear\_nhwindow was done just before putstr'ing this one,}
495 \textcolor{comment}{        and only if not in a more prompt already (to prevent concatenating to}
496 \textcolor{comment}{        a line containing --More-- when resizing while --More-- is displayed.) }
497 \textcolor{comment}{           */}
498         \textcolor{keywordflow}{if} (i == \hyperlink{win_2win32_2mhmsgwnd_8c_aae28724cf681afbd0c0ce60297cfff1a}{MSG\_LINES}-1 
499   && strlen(data->\hyperlink{structmswin__nethack__message__window_ac25c648cce60829c413d9ffa9da703bb}{new\_line}.\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}) > 0
500   && !data->\hyperlink{structmswin__nethack__message__window_a9b3ed726a4e021a2b7532e4f4af2dfe5}{in\_more}) \{
501         \textcolor{comment}{/* concatenate to the previous line if that is not empty, and}
502 \textcolor{comment}{           if it has the same attribute, and no clear was done.}
503 \textcolor{comment}{           */}
504         \textcolor{keywordflow}{if} (strlen(data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[lineidx].\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}) > 0
505             && (data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[lineidx].\hyperlink{structwindow__line_a58077cb852250ed547bc6cfd0310db23}{attr} 
506                 == data->\hyperlink{structmswin__nethack__message__window_ac25c648cce60829c413d9ffa9da703bb}{new\_line}.\hyperlink{structwindow__line_a58077cb852250ed547bc6cfd0310db23}{attr})
507             && !data->\hyperlink{structmswin__nethack__message__window_ac7120601d4735608d1b4374d24cd348f}{cleared}) \{
508             RECT tmpdraw\_rt = draw\_rt;
509             \textcolor{comment}{/* assume this will never work when textsize is near MAXWINDOWTEXT */}
510             \textcolor{keywordtype}{char} tmptext[\hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{MAXWINDOWTEXT}];
511             TCHAR tmpwbuf[\hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{MAXWINDOWTEXT}+2];
512 
513             strcpy(tmptext, data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[lineidx].\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text});
514             strncat(tmptext, \textcolor{stringliteral}{"  "}, 
515                 \hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{MAXWINDOWTEXT} - strlen(tmptext));
516             strncat(tmptext, data->\hyperlink{structmswin__nethack__message__window_ac25c648cce60829c413d9ffa9da703bb}{new\_line}.\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}, 
517                 \hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{MAXWINDOWTEXT} - strlen(tmptext));
518             \textcolor{comment}{/* Always keep room for a --More-- */}
519             strncat(tmptext, \hyperlink{win_2win32_2mhmsgwnd_8c_af1419a0ecedb20ed14a20e89ba0aae19}{MORE}, 
520                 \hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{MAXWINDOWTEXT} - strlen(tmptext));
521             \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(tmptext, tmpwbuf, \textcolor{keyword}{sizeof}(tmpwbuf));
522             \textcolor{comment}{/* Find out how large the bounding rectangle of the text is */}                
523             DrawText(hdc, tmpwbuf, \_tcslen(tmpwbuf), &tmpdraw\_rt, DT\_NOPREFIX | DT\_WORDBREAK | DT\_CALCRECT)
      ;
524             \textcolor{keywordflow}{if} ((tmpdraw\_rt.bottom - tmpdraw\_rt.top) == (draw\_rt.bottom - draw\_rt.top)  \textcolor{comment}{/* fits pixelwise 
      */}
525                 && (strlen(data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[lineidx].\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}) 
526                 + strlen(data->\hyperlink{structmswin__nethack__message__window_ac25c648cce60829c413d9ffa9da703bb}{new\_line}.\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}) < \hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{MAXWINDOWTEXT})) \textcolor{comment}{/* fits charwise 
      */}
527             \{
528             \textcolor{comment}{/* strip off --More-- of this combined line and make it so */}
529             tmptext[strlen(tmptext) - strlen(\hyperlink{win_2win32_2mhmsgwnd_8c_af1419a0ecedb20ed14a20e89ba0aae19}{MORE})] = \textcolor{charliteral}{'\(\backslash\)0'};
530             strcpy(data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[lineidx].\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}, tmptext);
531             data->\hyperlink{structmswin__nethack__message__window_ac25c648cce60829c413d9ffa9da703bb}{new\_line}.\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}[0] = \textcolor{charliteral}{'\(\backslash\)0'};
532             i++; \textcolor{comment}{/* Start from the last line again */}
533             \textcolor{keywordflow}{continue};
534             \}
535         \}
536         \textcolor{keywordflow}{if} (strlen(data->\hyperlink{structmswin__nethack__message__window_ac25c648cce60829c413d9ffa9da703bb}{new\_line}.\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}) > 0) \{
537             \textcolor{comment}{/* if we get here, the new line was not concatenated. Add it on a new line,}
538 \textcolor{comment}{               but first check whether we should --More--. */}
539             RECT tmpdraw\_rt = draw\_rt;
540             TCHAR tmpwbuf[\hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{MAXWINDOWTEXT}+2];
541             HGDIOBJ oldFont;
542             \textcolor{keywordtype}{int} new\_screen\_lines;
543             \textcolor{keywordtype}{int} screen\_lines\_not\_seen = 0;
544             \textcolor{comment}{/* Count how many screen lines we haven't seen yet. */}
545 \textcolor{preprocessor}{#ifdef MSG\_WRAP\_TEXT                }
546             \{
547             \textcolor{keywordtype}{int} n;
548             \textcolor{keywordflow}{for} (n = data->\hyperlink{structmswin__nethack__message__window_a03376eec1493f3cbe10aa7608b06da71}{lines\_not\_seen} - 1; n >= 0; n--) \{
549                 screen\_lines\_not\_seen += 
550                 data->\hyperlink{structmswin__nethack__message__window_afa2db7ba637e5708d489acbddc9e989d}{window\_text\_lines}[(data->\hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line} - n + 
      \hyperlink{win_2win32_2mhmsgwnd_8c_aae28724cf681afbd0c0ce60297cfff1a}{MSG\_LINES}) % \hyperlink{win_2win32_2mhmsgwnd_8c_aae28724cf681afbd0c0ce60297cfff1a}{MSG\_LINES}];
551             \}
552             \}
553 \textcolor{preprocessor}{#else}
554             screen\_lines\_not\_seen = data->\hyperlink{structmswin__nethack__message__window_a03376eec1493f3cbe10aa7608b06da71}{lines\_not\_seen};
555 \textcolor{preprocessor}{#endif}
556             \textcolor{comment}{/* Now find out how many screen lines we would like to add */}
557             \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(data->\hyperlink{structmswin__nethack__message__window_ac25c648cce60829c413d9ffa9da703bb}{new\_line}.\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}, tmpwbuf, \textcolor{keyword}{sizeof}(tmpwbuf));
558             \textcolor{comment}{/* Find out how large the bounding rectangle of the text is */}                
559             oldFont = SelectObject(hdc, \hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(\hyperlink{wintype_8h_ab3d471e84a363992b5a483392d0b2389}{NHW\_MESSAGE}, data->
      \hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[lineidx].\hyperlink{structwindow__line_a58077cb852250ed547bc6cfd0310db23}{attr}, hdc, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}));
560             DrawText(hdc, tmpwbuf, \_tcslen(tmpwbuf), &tmpdraw\_rt, DT\_NOPREFIX | DT\_WORDBREAK | DT\_CALCRECT)
      ;
561             SelectObject(hdc, oldFont);
562             new\_screen\_lines = (tmpdraw\_rt.bottom - tmpdraw\_rt.top) / data->
      \hyperlink{structmswin__nethack__message__window_abcddabdea03ae3f33b1459fb81075dae}{yChar};
563             \textcolor{comment}{/* If this together is more than fits on the window, we must }
564 \textcolor{comment}{               --More--, unless:}
565 \textcolor{comment}{               - We are in --More-- already (the user is scrolling the window)}
566 \textcolor{comment}{               - The user pressed ESC}
567 \textcolor{comment}{               */}
568             if (screen\_lines\_not\_seen + new\_screen\_lines > \hyperlink{win_2win32_2mhmsgwnd_8c_ab4f3451af76d732aceaf36e3d3043dfb}{MSG\_VISIBLE\_LINES}
569                 && !data->\hyperlink{structmswin__nethack__message__window_a9b3ed726a4e021a2b7532e4f4af2dfe5}{in\_more} && !data->\hyperlink{structmswin__nethack__message__window_a4da794907bafacc07e6227112897d153}{nevermore}) \{
570             data->\hyperlink{structmswin__nethack__message__window_a9b3ed726a4e021a2b7532e4f4af2dfe5}{in\_more} = 1;
571             \textcolor{comment}{/* Show --More-- on last line */}
572             strcat(data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[data->\hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line}].\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}, 
      \hyperlink{win_2win32_2mhmsgwnd_8c_af1419a0ecedb20ed14a20e89ba0aae19}{MORE});
573             \textcolor{comment}{/* Go on drawing, but remember we must do a more afterwards */}
574             do\_more = 1;
575             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!data->\hyperlink{structmswin__nethack__message__window_a9b3ed726a4e021a2b7532e4f4af2dfe5}{in\_more}) \{
576             data->\hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line}++;
577             data->\hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line} %= \hyperlink{win_2win32_2mhmsgwnd_8c_aae28724cf681afbd0c0ce60297cfff1a}{MSG\_LINES}; 
578             data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[data->\hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line}].\hyperlink{structwindow__line_a58077cb852250ed547bc6cfd0310db23}{attr} = data->
      \hyperlink{structmswin__nethack__message__window_ac25c648cce60829c413d9ffa9da703bb}{new\_line}.\hyperlink{structwindow__line_a58077cb852250ed547bc6cfd0310db23}{attr};
579             strncpy(data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[data->\hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line}].\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}, data->
      \hyperlink{structmswin__nethack__message__window_ac25c648cce60829c413d9ffa9da703bb}{new\_line}.\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}, \hyperlink{win_2win32_2mhmsgwnd_8c_a7823f335c74115317a5e71c645dae320}{MAXWINDOWTEXT});
580             data->\hyperlink{structmswin__nethack__message__window_ac25c648cce60829c413d9ffa9da703bb}{new\_line}.\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}[0] = \textcolor{charliteral}{'\(\backslash\)0'};
581             \textcolor{keywordflow}{if} (data->\hyperlink{structmswin__nethack__message__window_ac7120601d4735608d1b4374d24cd348f}{cleared}) \{
582                 \textcolor{comment}{/* now we are drawing a new line, the old lines can be redrawn in grey.*/}
583                 data->\hyperlink{structmswin__nethack__message__window_a15ac3ae0e42d4bf54132068138905b66}{lines\_last\_turn} = 0;
584                 data->\hyperlink{structmswin__nethack__message__window_ac7120601d4735608d1b4374d24cd348f}{cleared} = 0;
585             \}
586             data->\hyperlink{structmswin__nethack__message__window_a15ac3ae0e42d4bf54132068138905b66}{lines\_last\_turn}++;
587             data->\hyperlink{structmswin__nethack__message__window_a03376eec1493f3cbe10aa7608b06da71}{lines\_not\_seen}++;
588             \textcolor{comment}{/* and start over */}
589             i++; \textcolor{comment}{/* Start from the last line again */}
590             \textcolor{keywordflow}{continue};
591             \}
592         \}
593         \}
594         \textcolor{comment}{/* convert to UNICODE */}
595         \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[lineidx].\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}, wbuf, \textcolor{keyword}{sizeof}(wbuf));
596         wlen = \_tcslen(wbuf);
597         \hyperlink{win_2win32_2mhmsgwnd_8c_a8aae2e718a66937d372bd6033438c542}{setMsgTextColor}(hdc, i < (\hyperlink{win_2win32_2mhmsgwnd_8c_aae28724cf681afbd0c0ce60297cfff1a}{MSG\_LINES} - data->
      \hyperlink{structmswin__nethack__message__window_a15ac3ae0e42d4bf54132068138905b66}{lines\_last\_turn}));
598 \textcolor{preprocessor}{#ifdef MSG\_WRAP\_TEXT                }
599         \textcolor{comment}{/* Find out how large the bounding rectangle of the text is */}                
600                 DrawText(hdc, wbuf, wlen, &draw\_rt, DT\_NOPREFIX | DT\_WORDBREAK | DT\_CALCRECT);
601         \textcolor{comment}{/* move that rectangle up, so that the bottom remains at the same height */}
602                 draw\_rt.top = y - (draw\_rt.bottom - draw\_rt.top);
603                 draw\_rt.bottom = y;
604         \textcolor{comment}{/* Remember the height of this line for subsequent --More--'s */}
605         data->\hyperlink{structmswin__nethack__message__window_afa2db7ba637e5708d489acbddc9e989d}{window\_text\_lines}[lineidx] = (draw\_rt.bottom - draw\_rt.top) / data->
      \hyperlink{structmswin__nethack__message__window_abcddabdea03ae3f33b1459fb81075dae}{yChar};
606         \textcolor{comment}{/* Now really draw it */}
607                 DrawText(hdc, wbuf, wlen, &draw\_rt, DT\_NOPREFIX | DT\_WORDBREAK);
608                 
609                 \textcolor{comment}{/* Find out the cursor (caret) position */}
610         \textcolor{keywordflow}{if} (i == \hyperlink{win_2win32_2mhmsgwnd_8c_aae28724cf681afbd0c0ce60297cfff1a}{MSG\_LINES}-1) \{
611                     \textcolor{keywordtype}{int} nnum, numfit;
612                     \hyperlink{global_8h_afd2537d19a3cb6556b0f727580ec6ee7}{SIZE} \hyperlink{structsize}{size};
613                     TCHAR *nbuf;
614                     \textcolor{keywordtype}{int} nlen;
615 
616                     nbuf = wbuf;
617                     nlen = wlen;
618                     \textcolor{keywordflow}{while} (nlen) \{
619                         \textcolor{comment}{/* Get the number of characters that fit on the line */}
620                         GetTextExtentExPoint(hdc, nbuf, nlen, draw\_rt.right - draw\_rt.left, &numfit, 
      \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, &size);
621                         \textcolor{comment}{/* Search back to a space */}
622                         nnum = numfit;
623                         \textcolor{keywordflow}{if} (numfit < nlen) \{
624                             \textcolor{keywordflow}{while} (nnum > 0 && nbuf[nnum] != \textcolor{charliteral}{' '})
625                                 nnum--;
626                             \textcolor{comment}{/* If no space found, break wherever */}
627                             \textcolor{keywordflow}{if} (nnum == 0)
628                                 nnum = numfit;
629                         \}
630                         nbuf += nnum;
631                         nlen -= nnum;
632                         \textcolor{keywordflow}{if} (*nbuf == \textcolor{charliteral}{' '}) \{
633                             nbuf++;
634                             nlen--;
635                         \}
636                     \}
637                     \textcolor{comment}{/* The last size is the size of the last line. Set the caret there.}
638 \textcolor{comment}{                       This will fail automatically if we don't own the caret (i.e.,}
639 \textcolor{comment}{                       when not in a question.)}
640 \textcolor{comment}{                     */}
641                     SetCaretPos(draw\_rt.left + size.cx, draw\_rt.bottom - data->
      \hyperlink{structmswin__nethack__message__window_abcddabdea03ae3f33b1459fb81075dae}{yChar});
642                 \}
643 \textcolor{preprocessor}{#else}
644                 DrawText(hdc, wbuf, wlen, &draw\_rt, DT\_NOPREFIX );
645                 SetCaretPos(draw\_rt.left + size.cx, draw\_rt.bottom - data->\hyperlink{structmswin__nethack__message__window_abcddabdea03ae3f33b1459fb81075dae}{yChar});
646 \textcolor{preprocessor}{#endif}
647                 SelectObject(hdc, oldFont);
648                 y -= draw\_rt.bottom - draw\_rt.top;
649             \}
650     \textcolor{keywordflow}{if} (do\_more) \{
651         \textcolor{keywordtype}{int} okkey = 0;
652         \textcolor{keywordtype}{int} chop;
653         \textcolor{comment}{// @@@ Ok respnses}
654 
655         \textcolor{keywordflow}{while} (!okkey) \{
656         \textcolor{keywordtype}{char} c = \hyperlink{sys_2wince_2mswproc_8c_aed024ee2c1cc72c00ef0c1c47cc3cef4}{mswin\_nhgetch}();
657 
658         \textcolor{keywordflow}{switch} (c)
659         \{
660             \textcolor{comment}{/* space or enter */}
661             \textcolor{keywordflow}{case} \textcolor{charliteral}{' '}:
662             \textcolor{keywordflow}{case} \textcolor{charliteral}{'\(\backslash\)015'}:
663             okkey = 1;
664             \textcolor{keywordflow}{break};
665             \textcolor{comment}{/* ESC */}
666             \textcolor{keywordflow}{case} \textcolor{charliteral}{'\(\backslash\)033'}:
667             data->\hyperlink{structmswin__nethack__message__window_a4da794907bafacc07e6227112897d153}{nevermore} = 1;
668             okkey = 1;
669             \textcolor{keywordflow}{break};
670             \textcolor{keywordflow}{default}:
671             \textcolor{keywordflow}{break};
672             \}
673         \}
674         chop = strlen(data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[data->\hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line}].
      \hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}) 
675         - strlen(\hyperlink{win_2win32_2mhmsgwnd_8c_af1419a0ecedb20ed14a20e89ba0aae19}{MORE});
676         data->\hyperlink{structmswin__nethack__message__window_a0e392ae401c1cc51fd7aa0cc8ecbae95}{window\_text}[data->\hyperlink{structmswin__nethack__message__window_ae7ecc61ab8572e72f04323746402282f}{last\_line}].\hyperlink{structwindow__line_a080d799babb8e16480b257e64df3d660}{text}[chop] = \textcolor{charliteral}{'\(\backslash\)0'};
677         data->\hyperlink{structmswin__nethack__message__window_a9b3ed726a4e021a2b7532e4f4af2dfe5}{in\_more} = 0;
678         data->\hyperlink{structmswin__nethack__message__window_a03376eec1493f3cbe10aa7608b06da71}{lines\_not\_seen} = 0;
679         \textcolor{comment}{/* We did the --More--, reset the lines\_not\_seen; now draw that}
680 \textcolor{comment}{           new line. This is the easiest method */}
681         InvalidateRect(hWnd, \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
682     \}
683     \}
684     SetTextColor (hdc, OldFg);
685     SetBkColor (hdc, OldBg);
686     EndPaint(hWnd, &ps);
687 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmsgwnd_8c_a65d05a8dfe8d143493a62903f06d051b}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!register\+\_\+message\+\_\+window\+\_\+class@{register\+\_\+message\+\_\+window\+\_\+class}}
\index{register\+\_\+message\+\_\+window\+\_\+class@{register\+\_\+message\+\_\+window\+\_\+class}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{register\+\_\+message\+\_\+window\+\_\+class}]{\setlength{\rightskip}{0pt plus 5cm}void register\+\_\+message\+\_\+window\+\_\+class (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmsgwnd_8c_a65d05a8dfe8d143493a62903f06d051b}


Definition at line 101 of file mhmsgwnd.\+c.



References D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+S\+G, Get\+N\+H\+App(), mswin\+\_\+nhwindow\+\_\+app\+::h\+App, message\+\_\+bg\+\_\+brush, N\+H\+Message\+Wnd\+Proc(), N\+U\+L\+L, S\+Y\+S\+C\+L\+R\+\_\+\+T\+O\+\_\+\+B\+R\+U\+S\+H, and sz\+Message\+Window\+Class.



Referenced by mswin\+\_\+init\+\_\+message\+\_\+window().


\begin{DoxyCode}
102 \{
103     WNDCLASS wcex;
104     ZeroMemory( &wcex, \textcolor{keyword}{sizeof}(wcex));
105 
106     wcex.style          = CS\_NOCLOSE;
107     wcex.lpfnWndProc    = (WNDPROC)\hyperlink{sys_2wince_2mhmsgwnd_8c_a12c253cbd080ff7e808f935f2bdf7680}{NHMessageWndProc};
108     wcex.cbClsExtra     = 0;
109     wcex.cbWndExtra     = 0;
110     wcex.hInstance      = \hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->\hyperlink{structmswin__nhwindow__app_ae3a365ad66195c8e1d915242897c3f24}{hApp};
111     wcex.hIcon          = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
112     wcex.hCursor        = LoadCursor(\hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, IDC\_ARROW);
113     wcex.hbrBackground  = \hyperlink{win_2win32_2mswproc_8c_a9405a1abd371b5ea2a4c15ad6892884d}{message\_bg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_a9405a1abd371b5ea2a4c15ad6892884d}{message\_bg\_brush} : 
      \hyperlink{mhcolor_8h_ababa49ed211db00c071857fdd982ece1}{SYSCLR\_TO\_BRUSH}(\hyperlink{win_2win32_2mhmsgwnd_8c_a265c206180eeac586995a50297197ec5}{DEFAULT\_COLOR\_BG\_MSG});
114     wcex.lpszMenuName   = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
115     wcex.lpszClassName  = \hyperlink{win_2win32_2mhmsgwnd_8c_a787ab0593b5cdc6e80e8602488f03810}{szMessageWindowClass};
116 
117     RegisterClass(&wcex);
118 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmsgwnd_8c_a8aae2e718a66937d372bd6033438c542}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!set\+Msg\+Text\+Color@{set\+Msg\+Text\+Color}}
\index{set\+Msg\+Text\+Color@{set\+Msg\+Text\+Color}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{set\+Msg\+Text\+Color}]{\setlength{\rightskip}{0pt plus 5cm}C\+O\+L\+O\+R\+R\+E\+F set\+Msg\+Text\+Color (
\begin{DoxyParamCaption}
\item[{H\+D\+C}]{hdc, }
\item[{int}]{gray}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmsgwnd_8c_a8aae2e718a66937d372bd6033438c542}


Definition at line 430 of file mhmsgwnd.\+c.



References D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G\+\_\+\+M\+S\+G, D\+E\+F\+A\+U\+L\+T\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G\+\_\+\+M\+S\+G, message\+\_\+bg\+\_\+brush, message\+\_\+bg\+\_\+color, message\+\_\+fg\+\_\+brush, message\+\_\+fg\+\_\+color, and R\+G\+B.



Referenced by on\+Paint().


\begin{DoxyCode}
431 \{
432     COLORREF fg, color1, color2;
433     \textcolor{keywordflow}{if} (gray) \{
434     \textcolor{keywordflow}{if} (\hyperlink{win_2win32_2mswproc_8c_a9405a1abd371b5ea2a4c15ad6892884d}{message\_bg\_brush}) \{
435         color1 = \hyperlink{win_2win32_2mswproc_8c_a867bd2404eb08a076bf6d18489fbc6dd}{message\_bg\_color};
436         color2 = \hyperlink{win_2win32_2mswproc_8c_ab43ca99a814c50b5ee7469d392a93f33}{message\_fg\_color};
437     \} \textcolor{keywordflow}{else} \{
438         color1 = (COLORREF)GetSysColor(\hyperlink{win_2win32_2mhmsgwnd_8c_a265c206180eeac586995a50297197ec5}{DEFAULT\_COLOR\_BG\_MSG});
439         color2 = (COLORREF)GetSysColor(\hyperlink{win_2win32_2mhmsgwnd_8c_afe538a4f29778b18c6fbb0b139932a19}{DEFAULT\_COLOR\_FG\_MSG});
440     \}
441     \textcolor{comment}{/* Make a "gray" color by taking the average of the individual R,G,B }
442 \textcolor{comment}{       components of two colors. Thanks to Jonathan del Strother */}
443     fg = \hyperlink{bitmfile_8c_af08f42f04fcb2073807ade62eef86121a30447e9f6efa4afdd251f9afc1d5fb44}{RGB}((GetRValue(color1)+GetRValue(color2))/2,
444         (GetGValue(color1)+GetGValue(color2))/2,
445         (GetBValue(color1)+GetBValue(color2))/2);
446     \} \textcolor{keywordflow}{else} \{
447     fg = \hyperlink{win_2win32_2mswproc_8c_a268717fad95ab89a9dd4764044ae7d07}{message\_fg\_brush} ? \hyperlink{win_2win32_2mswproc_8c_ab43ca99a814c50b5ee7469d392a93f33}{message\_fg\_color} : (COLORREF)GetSysColor(
      \hyperlink{win_2win32_2mhmsgwnd_8c_afe538a4f29778b18c6fbb0b139932a19}{DEFAULT\_COLOR\_FG\_MSG});
448     \}
449 
450 
451     \textcolor{keywordflow}{return} SetTextColor(hdc, fg);
452 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{win_2win32_2mhmsgwnd_8c_a787ab0593b5cdc6e80e8602488f03810}{\index{win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}!sz\+Message\+Window\+Class@{sz\+Message\+Window\+Class}}
\index{sz\+Message\+Window\+Class@{sz\+Message\+Window\+Class}!win/win32/mhmsgwnd.\+c@{win/win32/mhmsgwnd.\+c}}
\subsubsection[{sz\+Message\+Window\+Class}]{\setlength{\rightskip}{0pt plus 5cm}T\+C\+H\+A\+R sz\+Message\+Window\+Class\mbox{[}$\,$\mbox{]} = T\+E\+X\+T(\char`\"{}M\+S\+N\+H\+Message\+Wnd\+Class\char`\"{})\hspace{0.3cm}{\ttfamily [static]}}}\label{win_2win32_2mhmsgwnd_8c_a787ab0593b5cdc6e80e8602488f03810}


Definition at line 50 of file mhmsgwnd.\+c.



Referenced by mswin\+\_\+init\+\_\+message\+\_\+window(), and register\+\_\+message\+\_\+window\+\_\+class().

