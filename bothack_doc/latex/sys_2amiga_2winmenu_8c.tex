\hypertarget{sys_2amiga_2winmenu_8c}{\section{nethack/sys/amiga/winmenu.c File Reference}
\label{sys_2amiga_2winmenu_8c}\index{nethack/sys/amiga/winmenu.\+c@{nethack/sys/amiga/winmenu.\+c}}
}
{\ttfamily \#include \char`\"{}N\+H\+:sys/amiga/windefs.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}N\+H\+:sys/amiga/winext.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}N\+H\+:sys/amiga/winproto.\+h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{sys_2amiga_2winmenu_8c_a89cf922e63d8a85ad1ff67acd04f8228}{P\+R\+O\+M\+P\+T\+F\+I\+R\+S\+T}~/$\ast$ Define this to have prompt first $\ast$/
\item 
\#define \hyperlink{sys_2amiga_2winmenu_8c_ace6fa4719be9aafa2968680c5ef75ac5}{C\+T\+R\+L}(x)~((x)-\/'@')
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{sys_2amiga_2winmenu_8c_a230942d950e207d2a95a0eaf3bcdf345}{amii\+\_\+start\+\_\+menu} (\hyperlink{wintype_8h_adc2de956a3f084b1691cf080e1d1412b}{winid} window)
\item 
void \hyperlink{sys_2amiga_2winmenu_8c_af51e6a3371b277061496ecc1fd4096da}{amii\+\_\+add\+\_\+menu} (\hyperlink{wintype_8h_adc2de956a3f084b1691cf080e1d1412b}{winid} window, int glyph, \hyperlink{tradstdc_8h_a2c212835823e3c54a8ab6d95c652660e}{const} \hyperlink{wintype_8h_a49720928e6af182ee38aa332d0483b2a}{anything} $\ast$id, char ch, char gch, int attr, \hyperlink{tradstdc_8h_a2c212835823e3c54a8ab6d95c652660e}{const} char $\ast$str, \hyperlink{wingem1_8c_aa2723cc3af18a5199ab4ce7cca84d82b}{B\+O\+O\+L\+E\+A\+N\+\_\+\+P} preselected)
\item 
void \hyperlink{sys_2amiga_2winmenu_8c_a619402e82816d6c7ecb4ce2f1ed7ee8c}{amii\+\_\+end\+\_\+menu} (\hyperlink{wintype_8h_adc2de956a3f084b1691cf080e1d1412b}{winid} window, \hyperlink{tradstdc_8h_a2c212835823e3c54a8ab6d95c652660e}{const} char $\ast$morestr)
\item 
int \hyperlink{sys_2amiga_2winmenu_8c_ac6e5a44c3929632a8d47a2061bc8bad8}{amii\+\_\+select\+\_\+menu} (\hyperlink{wintype_8h_adc2de956a3f084b1691cf080e1d1412b}{winid} window, int how, \hyperlink{wintype_8h_aaef709f77068fd7ba62812589327f08f}{menu\+\_\+item} $\ast$$\ast$mip)
\item 
\hyperlink{winami_8h_aece08fc25183baf9557e21ef1adc4c2c}{amii\+\_\+menu\+\_\+item} $\ast$ \hyperlink{sys_2amiga_2winmenu_8c_aa4cfb2336bbe67a2a34667bacfd6fd8b}{find\+\_\+menu\+\_\+item} (\hyperlink{mkmaze_8c_a24ac627a7839caecddfc66f1d46033f0}{register} struct \hyperlink{structamii__WinDesc}{amii\+\_\+\+Win\+Desc} $\ast$cw, int idx)
\item 
int \hyperlink{sys_2amiga_2winmenu_8c_a9193caef076cb9de1fc1d4a77c34b869}{make\+\_\+menu\+\_\+items} (\hyperlink{mkmaze_8c_a24ac627a7839caecddfc66f1d46033f0}{register} struct \hyperlink{structamii__WinDesc}{amii\+\_\+\+Win\+Desc} $\ast$cw, \hyperlink{mkmaze_8c_a24ac627a7839caecddfc66f1d46033f0}{register} \hyperlink{wintype_8h_aaef709f77068fd7ba62812589327f08f}{menu\+\_\+item} $\ast$$\ast$rmip)
\item 
int \hyperlink{sys_2amiga_2winmenu_8c_a2ab7ed911fa9e298491912256dad69be}{Do\+Menu\+Scroll} (int win, int blocking, int how, \hyperlink{wintype_8h_aaef709f77068fd7ba62812589327f08f}{menu\+\_\+item} $\ast$$\ast$retmip)
\item 
void \hyperlink{sys_2amiga_2winmenu_8c_a0d631bd0422a752b9471cd23834a863d}{Re\+Display\+Data} (\hyperlink{wintype_8h_adc2de956a3f084b1691cf080e1d1412b}{winid} win)
\item 
long \hyperlink{sys_2amiga_2winmenu_8c_a5c10fb452bdd53064eb14c3f1a270b62}{Find\+Line} (\hyperlink{wintype_8h_adc2de956a3f084b1691cf080e1d1412b}{winid} win, int line)
\item 
long \hyperlink{sys_2amiga_2winmenu_8c_aab1d3a28e3b2dd6770eae7e837fa27dd}{Count\+Lines} (\hyperlink{wintype_8h_adc2de956a3f084b1691cf080e1d1412b}{winid} win)
\item 
void \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{Display\+Data} (\hyperlink{wintype_8h_adc2de956a3f084b1691cf080e1d1412b}{winid} win, int start)
\item 
void \hyperlink{sys_2amiga_2winmenu_8c_a28121fc0d5fc72d2292fa04d5bbf7d60}{Set\+Prop\+Info} (struct Window $\ast$win, struct Gadget $\ast$gad, long vis, long total, long top)
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{sys_2amiga_2winmenu_8c_ace6fa4719be9aafa2968680c5ef75ac5}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!C\+T\+R\+L@{C\+T\+R\+L}}
\index{C\+T\+R\+L@{C\+T\+R\+L}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{C\+T\+R\+L}]{\setlength{\rightskip}{0pt plus 5cm}\#define C\+T\+R\+L(
\begin{DoxyParamCaption}
\item[{}]{x}
\end{DoxyParamCaption}
)~((x)-\/'@')}}\label{sys_2amiga_2winmenu_8c_ace6fa4719be9aafa2968680c5ef75ac5}


Referenced by Do\+Menu\+Scroll().

\hypertarget{sys_2amiga_2winmenu_8c_a89cf922e63d8a85ad1ff67acd04f8228}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!P\+R\+O\+M\+P\+T\+F\+I\+R\+S\+T@{P\+R\+O\+M\+P\+T\+F\+I\+R\+S\+T}}
\index{P\+R\+O\+M\+P\+T\+F\+I\+R\+S\+T@{P\+R\+O\+M\+P\+T\+F\+I\+R\+S\+T}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{P\+R\+O\+M\+P\+T\+F\+I\+R\+S\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define P\+R\+O\+M\+P\+T\+F\+I\+R\+S\+T~/$\ast$ Define this to have prompt first $\ast$/}}\label{sys_2amiga_2winmenu_8c_a89cf922e63d8a85ad1ff67acd04f8228}


\subsection{Function Documentation}
\hypertarget{sys_2amiga_2winmenu_8c_af51e6a3371b277061496ecc1fd4096da}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!amii\+\_\+add\+\_\+menu@{amii\+\_\+add\+\_\+menu}}
\index{amii\+\_\+add\+\_\+menu@{amii\+\_\+add\+\_\+menu}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{amii\+\_\+add\+\_\+menu}]{\setlength{\rightskip}{0pt plus 5cm}void amii\+\_\+add\+\_\+menu (
\begin{DoxyParamCaption}
\item[{{\bf winid}}]{window, }
\item[{int}]{glyph, }
\item[{{\bf const} {\bf anything} $\ast$}]{id, }
\item[{char}]{ch, }
\item[{char}]{gch, }
\item[{int}]{attr, }
\item[{{\bf const} char $\ast$}]{str, }
\item[{{\bf B\+O\+O\+L\+E\+A\+N\+\_\+\+P}}]{preselected}
\end{DoxyParamCaption}
)}}\label{sys_2amiga_2winmenu_8c_af51e6a3371b277061496ecc1fd4096da}


Definition at line 59 of file winmenu.\+c.



References alloc(), amii\+\_\+putstr(), amii\+\_\+wins, amii\+\_\+mi\+::attr, buf, B\+U\+F\+S\+Z, amii\+\_\+mi\+::canselect, amii\+\_\+menu\+::chr, amii\+\_\+mi\+::count, amii\+\_\+menu\+::count, amii\+\_\+\+Win\+Desc\+::cury, amii\+\_\+\+Win\+Desc\+::data, amii\+\_\+mi\+::glyph, amii\+\_\+mi\+::gselector, amii\+\_\+mi\+::identifier, Is\+\_\+rogue\+\_\+level, amii\+\_\+menu\+::items, amii\+\_\+menu\+::last, amii\+\_\+\+Win\+Desc\+::menu, amii\+\_\+mi\+::next, N\+H\+W\+\_\+\+M\+E\+N\+U, N\+O\+\_\+\+G\+L\+Y\+P\+H, N\+U\+L\+L, panic(), amii\+\_\+mi\+::selected, amii\+\_\+mi\+::selector, Sprintf, amii\+\_\+mi\+::str, amii\+\_\+\+Win\+Desc\+::type, u, you\+::uz, W\+I\+N\+\_\+\+E\+R\+R, and winpanicstr.



Referenced by amii\+\_\+end\+\_\+menu().


\begin{DoxyCode}
68 \{
69     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structamii__WinDesc}{amii\_WinDesc} *cw;
70     \hyperlink{structamii__mi}{amii\_menu\_item} *mip;
71     \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[ 4+\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ} ];
72 
73     \textcolor{keywordflow}{if}(str == \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})\textcolor{keywordflow}{return};
74 
75     \textcolor{keywordflow}{if}(window == \hyperlink{wintype_8h_a56d1f4f2e517a4e81be0b7593e35e681}{WIN\_ERR} || (cw = \hyperlink{winami_8h_a84358fe75628f255a0687acb6e8499de}{amii\_wins}[window]) == \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || cw->
      \hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} != \hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU})
76     \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\hyperlink{winext_8h_a4264157ee8930111caf21b62c212e08c}{winpanicstr},window, \textcolor{stringliteral}{"add\_menu"});
77 
78     mip = (\hyperlink{structamii__mi}{amii\_menu\_item} *)\hyperlink{txt2iff_8c_ae273cbdce4cd64a076220ad06c41a5a1}{alloc}( \textcolor{keyword}{sizeof}( *mip ) );
79     mip->\hyperlink{structamii__mi_ad856ed93a149eeb875438a1870a556fe}{identifier} = *id;
80     mip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected} = preselected;
81     mip->\hyperlink{structamii__mi_ac5dfee277f46f053ecd99b0b7f863bb6}{attr} = attr;
82     mip->\hyperlink{structamii__mi_a3e4c3c4ab75e4d6027c978bb75fffbce}{glyph} = \hyperlink{dungeon_8h_a2732117523c8540638daf4315dda16b9}{Is\_rogue\_level}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}) ? \hyperlink{display_8h_ac36b9cc8436af3cf1f7f9919878d8354}{NO\_GLYPH} : glyph;
83     mip->\hyperlink{structamii__mi_a77084785d6d5815d0e006ad4ff6dd0b9}{selector} = 0;
84     mip->\hyperlink{structamii__mi_aa5480683a78e9e88d8569be6438c7ae5}{gselector} = gch;
85     mip->\hyperlink{structamii__mi_a15c24390709412f24da5e5207808712b}{count} = -1;
86 
87     \textcolor{keywordflow}{if} (id->\hyperlink{unionany_a570c320f6790aab4b51733abc54827d7}{a\_void} && !ch && cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a8a21d4745ccbca398561a27079e4e5f8}{chr} != 0)
88     \{
89     ch = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a8a21d4745ccbca398561a27079e4e5f8}{chr}++;
90     \textcolor{keywordflow}{if}( ch == \textcolor{charliteral}{'z'} )
91         cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a8a21d4745ccbca398561a27079e4e5f8}{chr} = \textcolor{charliteral}{'A'};
92     \textcolor{keywordflow}{if}( ch == \textcolor{charliteral}{'Z'} )
93         cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a8a21d4745ccbca398561a27079e4e5f8}{chr} = 0;
94     \}
95 
96     mip->\hyperlink{structamii__mi_a68250523fd29eae87c3a438284fab1c0}{canselect} = ( \textcolor{keywordtype}{id}->a\_void != 0 );
97 
98     \textcolor{keywordflow}{if}( id->\hyperlink{unionany_a570c320f6790aab4b51733abc54827d7}{a\_void} && ch != \textcolor{charliteral}{'\(\backslash\)0'})
99     \{
100     \hyperlink{global_8h_aa55ba8f4e3c82fe00035e6b51d6c7dee}{Sprintf}( buf, \textcolor{stringliteral}{"%c - %s"}, ch, str );
101     str = \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf};
102     mip->\hyperlink{structamii__mi_a68250523fd29eae87c3a438284fab1c0}{canselect} = 1;
103     \}
104 
105     mip->\hyperlink{structamii__mi_a77084785d6d5815d0e006ad4ff6dd0b9}{selector} = ch;
106 
107     \hyperlink{winproto_8h_a9fdbf76005ec3ae5b77b3002366c04d3}{amii\_putstr}( window, attr, str );
108 
109     mip->\hyperlink{structamii__mi_a31791a6dba8c361ec8c8d5776bb82593}{str} = cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[ cw->\hyperlink{structamii__WinDesc_aee07cf405ea0e78eb6b82c339360a0f8}{cury} - 1 ];
110     cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a6498bbd7c8a254b78e3cf333f3ce3318}{count}++;
111 
112     mip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next} = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
113 
114     \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items} == 0 )
115         cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a9bcaeffce2bc3c2bfbac65309e3f80ce}{last} = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items} = mip;
116     \textcolor{keywordflow}{else}
117     \{
118     cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a9bcaeffce2bc3c2bfbac65309e3f80ce}{last}->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next} = mip;
119     cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a9bcaeffce2bc3c2bfbac65309e3f80ce}{last} = mip;
120     \}
121 \}
\end{DoxyCode}
\hypertarget{sys_2amiga_2winmenu_8c_a619402e82816d6c7ecb4ce2f1ed7ee8c}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!amii\+\_\+end\+\_\+menu@{amii\+\_\+end\+\_\+menu}}
\index{amii\+\_\+end\+\_\+menu@{amii\+\_\+end\+\_\+menu}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{amii\+\_\+end\+\_\+menu}]{\setlength{\rightskip}{0pt plus 5cm}void amii\+\_\+end\+\_\+menu (
\begin{DoxyParamCaption}
\item[{{\bf winid}}]{window, }
\item[{{\bf const} char $\ast$}]{morestr}
\end{DoxyParamCaption}
)}}\label{sys_2amiga_2winmenu_8c_a619402e82816d6c7ecb4ce2f1ed7ee8c}


Definition at line 126 of file winmenu.\+c.



References any\+::a\+\_\+void, amii\+\_\+add\+\_\+menu(), amii\+\_\+wins, A\+T\+R\+\_\+\+N\+O\+N\+E, amii\+\_\+\+Win\+Desc\+::cury, amii\+\_\+\+Win\+Desc\+::data, amii\+\_\+menu\+::items, amii\+\_\+menu\+::last, amii\+\_\+\+Win\+Desc\+::menu, M\+E\+N\+U\+\_\+\+U\+N\+S\+E\+L\+E\+C\+T\+E\+D, amii\+\_\+\+Win\+Desc\+::morestr, amii\+\_\+mi\+::next, N\+H\+W\+\_\+\+M\+E\+N\+U, N\+O\+\_\+\+G\+L\+Y\+P\+H, N\+U\+L\+L, panic(), strdup, amii\+\_\+\+Win\+Desc\+::type, W\+I\+N\+\_\+\+E\+R\+R, and winpanicstr.


\begin{DoxyCode}
129 \{
130     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structamii__WinDesc}{amii\_WinDesc} *cw;
131 
132     \textcolor{keywordflow}{if}(window == \hyperlink{wintype_8h_a56d1f4f2e517a4e81be0b7593e35e681}{WIN\_ERR} || (cw=\hyperlink{winami_8h_a84358fe75628f255a0687acb6e8499de}{amii\_wins}[window]) == \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}
133        || cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} != \hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU} )
134     \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\hyperlink{winext_8h_a4264157ee8930111caf21b62c212e08c}{winpanicstr},window, \textcolor{stringliteral}{"end\_menu"});
135 
136     \textcolor{keywordflow}{if}( \hyperlink{structamii__WinDesc_a18f1ba88dadd6f00144ad9f0b16a2b20}{morestr} && *\hyperlink{structamii__WinDesc_a18f1ba88dadd6f00144ad9f0b16a2b20}{morestr} )
137     \{
138     \hyperlink{unionany}{anything} \hyperlink{unionany}{any};
139 \textcolor{preprocessor}{#define PROMPTFIRST }\textcolor{comment}{/* Define this to have prompt first */}\textcolor{preprocessor}{}
140 \textcolor{preprocessor}{#ifdef PROMPTFIRST}
141     \hyperlink{structamii__mi}{amii\_menu\_item} *mip;
142     \textcolor{keywordtype}{int} i;
143     \textcolor{keywordtype}{char} *t;
144     mip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a9bcaeffce2bc3c2bfbac65309e3f80ce}{last};
145 \textcolor{preprocessor}{#endif}
146     any.\hyperlink{unionany_a570c320f6790aab4b51733abc54827d7}{a\_void} = 0;
147     \hyperlink{sys_2amiga_2winmenu_8c_af51e6a3371b277061496ecc1fd4096da}{amii\_add\_menu}( window, \hyperlink{display_8h_ac36b9cc8436af3cf1f7f9919878d8354}{NO\_GLYPH}, &any, 0, 0, \hyperlink{wintype_8h_a20a20b74e8cf84ecfbf3c8665c059636}{ATR\_NONE}, 
      \hyperlink{structamii__WinDesc_a18f1ba88dadd6f00144ad9f0b16a2b20}{morestr},
148        \hyperlink{hack_8h_a1b4cfefbc89386fb8977794f02b0a13c}{MENU\_UNSELECTED});
149 \textcolor{preprocessor}{#ifdef PROMPTFIRST }\textcolor{comment}{/* Do some shuffling. Last first, push others one forward */}\textcolor{preprocessor}{}
150     mip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next} = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
151     cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a9bcaeffce2bc3c2bfbac65309e3f80ce}{last}->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next} = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items};
152     cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items} = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a9bcaeffce2bc3c2bfbac65309e3f80ce}{last};
153     cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a9bcaeffce2bc3c2bfbac65309e3f80ce}{last} = mip;
154     t = cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[cw->\hyperlink{structamii__WinDesc_aee07cf405ea0e78eb6b82c339360a0f8}{cury}-1];
155     \textcolor{keywordflow}{for} (i=cw->\hyperlink{structamii__WinDesc_aee07cf405ea0e78eb6b82c339360a0f8}{cury}-1; i>0; i--) \{
156         cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[i] = cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[i-1];
157     \}
158     cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[0] = t;
159 \textcolor{preprocessor}{#endif}
160     \}
161 
162     \textcolor{comment}{/* If prompt first, don't put same string in title where in most cases}
163 \textcolor{comment}{       it's not entirely visible anyway */}
164 \textcolor{preprocessor}{#ifndef PROMPTFIRST}
165     \textcolor{keywordflow}{if}( \hyperlink{structamii__WinDesc_a18f1ba88dadd6f00144ad9f0b16a2b20}{morestr} )
166     cw->\hyperlink{structamii__WinDesc_a18f1ba88dadd6f00144ad9f0b16a2b20}{morestr} = \hyperlink{wceconf_8h_a9254b089d435892385cf14d0ab4a7a2d}{strdup}( \hyperlink{structamii__WinDesc_a18f1ba88dadd6f00144ad9f0b16a2b20}{morestr} );
167 \textcolor{preprocessor}{#endif}
168 \}
\end{DoxyCode}
\hypertarget{sys_2amiga_2winmenu_8c_ac6e5a44c3929632a8d47a2061bc8bad8}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!amii\+\_\+select\+\_\+menu@{amii\+\_\+select\+\_\+menu}}
\index{amii\+\_\+select\+\_\+menu@{amii\+\_\+select\+\_\+menu}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{amii\+\_\+select\+\_\+menu}]{\setlength{\rightskip}{0pt plus 5cm}int amii\+\_\+select\+\_\+menu (
\begin{DoxyParamCaption}
\item[{{\bf winid}}]{window, }
\item[{int}]{how, }
\item[{{\bf menu\+\_\+item} $\ast$$\ast$}]{mip}
\end{DoxyParamCaption}
)}}\label{sys_2amiga_2winmenu_8c_ac6e5a44c3929632a8d47a2061bc8bad8}


Definition at line 173 of file winmenu.\+c.



References alwaysinvent, amii\+\_\+wins, dismiss\+\_\+nhwindow(), Do\+Menu\+Scroll(), N\+H\+W\+\_\+\+M\+E\+N\+U, N\+U\+L\+L, panic(), amii\+\_\+\+Win\+Desc\+::type, W\+I\+N\+\_\+\+E\+R\+R, W\+I\+N\+\_\+\+I\+N\+V\+E\+N, and winpanicstr.


\begin{DoxyCode}
177 \{
178     \textcolor{keywordtype}{int} cnt;
179     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structamii__WinDesc}{amii\_WinDesc} *cw;
180 
181     \textcolor{keywordflow}{if}( window == \hyperlink{wintype_8h_a56d1f4f2e517a4e81be0b7593e35e681}{WIN\_ERR} || ( cw=\hyperlink{winami_8h_a84358fe75628f255a0687acb6e8499de}{amii\_wins}[window] ) == \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} ||
182       cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} != \hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU} )
183     \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\hyperlink{winext_8h_a4264157ee8930111caf21b62c212e08c}{winpanicstr},window, \textcolor{stringliteral}{"select\_menu"});
184 
185     cnt = \hyperlink{sys_2amiga_2winmenu_8c_a2ab7ed911fa9e298491912256dad69be}{DoMenuScroll}( window, 1, how, mip );
186 
187     \textcolor{comment}{/* This would allow the inventory window to stay open. */}
188     \textcolor{keywordflow}{if}( !\hyperlink{winext_8h_a5f7057e3372d8abeddf1df4f99752979}{alwaysinvent} || window != \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
189     \hyperlink{winfuncs_8c_ac946cc5b4c43a936e168ddc80b74c4bd}{dismiss\_nhwindow}(window);       \textcolor{comment}{/* Now tear it down */}
190     \textcolor{keywordflow}{return} cnt;
191 \}
\end{DoxyCode}
\hypertarget{sys_2amiga_2winmenu_8c_a230942d950e207d2a95a0eaf3bcdf345}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!amii\+\_\+start\+\_\+menu@{amii\+\_\+start\+\_\+menu}}
\index{amii\+\_\+start\+\_\+menu@{amii\+\_\+start\+\_\+menu}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{amii\+\_\+start\+\_\+menu}]{\setlength{\rightskip}{0pt plus 5cm}void amii\+\_\+start\+\_\+menu (
\begin{DoxyParamCaption}
\item[{{\bf winid}}]{window}
\end{DoxyParamCaption}
)}}\label{sys_2amiga_2winmenu_8c_a230942d950e207d2a95a0eaf3bcdf345}


Definition at line 11 of file winmenu.\+c.



References alwaysinvent, amii\+\_\+clear\+\_\+nhwindow(), amii\+\_\+wins, amii\+\_\+menu\+::chr, amii\+\_\+menu\+::count, menu\+::count, amii\+\_\+\+Win\+Desc\+::cury, amii\+\_\+\+Win\+Desc\+::data, free(), amii\+\_\+menu\+::items, amii\+\_\+\+Win\+Desc\+::maxcol, amii\+\_\+\+Win\+Desc\+::maxrow, amii\+\_\+\+Win\+Desc\+::menu, amii\+\_\+\+Win\+Desc\+::morestr, amii\+\_\+mi\+::next, N\+H\+W\+\_\+\+M\+E\+N\+U, N\+H\+W\+\_\+\+M\+E\+S\+S\+A\+G\+E, N\+H\+W\+\_\+\+T\+E\+X\+T, N\+U\+L\+L, panic(), amii\+\_\+\+Win\+Desc\+::rows, amii\+\_\+\+Win\+Desc\+::type, amii\+\_\+\+Win\+Desc\+::wasup, amii\+\_\+\+Win\+Desc\+::win, W\+I\+N\+\_\+\+E\+R\+R, W\+I\+N\+\_\+\+I\+N\+V\+E\+N, and winpanicstr.


\begin{DoxyCode}
13 \{
14     \textcolor{keyword}{register} \textcolor{keywordtype}{int} i;
15     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structamii__WinDesc}{amii\_WinDesc} *cw;
16     \textcolor{keyword}{register} \hyperlink{structamii__mi}{amii\_menu\_item} *mip;
17 
18     \textcolor{keywordflow}{if}(window == \hyperlink{wintype_8h_a56d1f4f2e517a4e81be0b7593e35e681}{WIN\_ERR} || (cw = \hyperlink{winami_8h_a84358fe75628f255a0687acb6e8499de}{amii\_wins}[window]) == \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} || cw->
      \hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} != \hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU})
19     \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\hyperlink{winext_8h_a4264157ee8930111caf21b62c212e08c}{winpanicstr},window, \textcolor{stringliteral}{"start\_menu"});
20 
21     \hyperlink{winfuncs_8c_ac2b43ff5e6b6394438fd8fde2008d264}{amii\_clear\_nhwindow}(window);
22 
23     \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data} && ( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_ab3d471e84a363992b5a483392d0b2389}{NHW\_MESSAGE} ||
24         cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU} || cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_a7e2bcc8531c4c62e8d8f1c5279c5789b}{NHW\_TEXT} ) )
25     \{
26     \textcolor{keywordflow}{for}( i = 0; i < cw->\hyperlink{structamii__WinDesc_a1ca7af4b595bf7bb077ed78546548670}{maxrow}; ++i )
27     \{
28         \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[ i ] )
29         \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}( cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[ i ] );
30     \}
31     \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}( cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data} );
32     cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data} = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
33     \}
34 
35     \textcolor{keywordflow}{for}( mip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items}, i = 0; (mip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items}) && i < cw->
      \hyperlink{structmenu}{menu}.\hyperlink{structmenu_a3d6c8d06c1b134f60244b4449a094d16}{count}; ++i )
36     \{
37     cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items} = mip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next};
38         \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}( mip );
39     \}
40 
41     cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items} = 0;
42     cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a6498bbd7c8a254b78e3cf333f3ce3318}{count} = 0;
43     cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a8a21d4745ccbca398561a27079e4e5f8}{chr} = \textcolor{charliteral}{'a'};
44 
45     \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_a18f1ba88dadd6f00144ad9f0b16a2b20}{morestr} ) \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}( cw->\hyperlink{structamii__WinDesc_a18f1ba88dadd6f00144ad9f0b16a2b20}{morestr} );
46     cw->\hyperlink{structamii__WinDesc_a18f1ba88dadd6f00144ad9f0b16a2b20}{morestr} = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
47 
48     \textcolor{keywordflow}{if}( window == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} && cw->\hyperlink{structamii__WinDesc_a9835faa4d66643cd889203e26edee8ae}{win} != \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} )
49     \{
50     \textcolor{keywordflow}{if}( \hyperlink{winext_8h_a5f7057e3372d8abeddf1df4f99752979}{alwaysinvent} )
51         cw->\hyperlink{structamii__WinDesc_ab4e4bdac6ab87e8f1cf420814f09e876}{wasup} = 1;
52     \}
53     cw->\hyperlink{structamii__WinDesc_aee07cf405ea0e78eb6b82c339360a0f8}{cury} = cw->\hyperlink{structamii__WinDesc_a465b4a9c04b3c325f2af2722aac9c5f3}{rows} = cw->\hyperlink{structamii__WinDesc_a1ca7af4b595bf7bb077ed78546548670}{maxrow} = cw->\hyperlink{structamii__WinDesc_a7abaf7568c45c6f6efabdfdc13164a4c}{maxcol} = 0;
54     \textcolor{keywordflow}{return};
55 \}
\end{DoxyCode}
\hypertarget{sys_2amiga_2winmenu_8c_aab1d3a28e3b2dd6770eae7e837fa27dd}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!Count\+Lines@{Count\+Lines}}
\index{Count\+Lines@{Count\+Lines}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{Count\+Lines}]{\setlength{\rightskip}{0pt plus 5cm}long Count\+Lines (
\begin{DoxyParamCaption}
\item[{{\bf winid}}]{win}
\end{DoxyParamCaption}
)}}\label{sys_2amiga_2winmenu_8c_aab1d3a28e3b2dd6770eae7e837fa27dd}


Definition at line 1277 of file winmenu.\+c.



References amii\+\_\+wins, amii\+\_\+\+Win\+Desc\+::cols, amii\+\_\+\+Win\+Desc\+::data, amii\+\_\+menu\+::items, amii\+\_\+\+Win\+Desc\+::maxrow, amii\+\_\+\+Win\+Desc\+::menu, N\+H\+W\+\_\+\+M\+E\+S\+S\+A\+G\+E, panic(), pictdata, S\+E\+L\+\_\+\+I\+T\+E\+M, S\+O\+F\+F, amii\+\_\+\+Win\+Desc\+::type, amii\+\_\+\+Win\+Desc\+::win, W\+I\+N\+\_\+\+E\+R\+R, W\+I\+N\+\_\+\+I\+N\+V\+E\+N, winpanicstr, W\+I\+N\+V\+E\+R\+S\+\_\+\+A\+M\+I\+V, and P\+D\+A\+T\+::xsize.



Referenced by amii\+\_\+putstr(), Do\+Menu\+Scroll(), and Re\+Display\+Data().


\begin{DoxyCode}
1279 \{
1280     \textcolor{keywordtype}{int} txwd;
1281     \hyperlink{structamii__mi}{amii\_menu\_item} *mip;
1282     \textcolor{keyword}{register} \textcolor{keywordtype}{char} *t;
1283     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structamii__WinDesc}{amii\_WinDesc} *cw;
1284     \textcolor{keyword}{register} \textcolor{keyword}{struct }Window *w;
1285     \textcolor{keyword}{register} \textcolor{keywordtype}{int} i, disprow, len;
1286     \textcolor{keywordtype}{int} col = -1;
1287 
1288     \textcolor{keywordflow}{if}( win == \hyperlink{wintype_8h_a56d1f4f2e517a4e81be0b7593e35e681}{WIN\_ERR} || !(cw = \hyperlink{winami_8h_a84358fe75628f255a0687acb6e8499de}{amii\_wins}[win]) || !( w = cw->
      \hyperlink{structamii__WinDesc_a9835faa4d66643cd889203e26edee8ae}{win} ) )
1289     \{
1290     \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}( \hyperlink{winext_8h_a4264157ee8930111caf21b62c212e08c}{winpanicstr}, win, \textcolor{stringliteral}{"No Window in CountLines"} );
1291     \}
1292 
1293     txwd = w->RPort->TxWidth;
1294     \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
1295     \{
1296     \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
1297     \{
1298         cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft -
1299             w->BorderRight - 4 - \hyperlink{winchar_8c_a00763f280fa207a0cf085c6d52246c8c}{pictdata}.\hyperlink{structPDAT_a957fade03cbfb4ce4de9df4e09be7fc7}{xsize} - 3) / txwd;
1300     \}
1301     \textcolor{keywordflow}{else}
1302         cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft - w->BorderRight - 4 ) / txwd;
1303     \}
1304     \textcolor{keywordflow}{else}
1305     \{
1306     cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft - w->BorderRight - 4 ) / txwd;
1307     \}
1308 
1309     disprow = cw->\hyperlink{structamii__WinDesc_a1ca7af4b595bf7bb077ed78546548670}{maxrow};
1310     mip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items};
1311     \textcolor{keywordflow}{for}( col = i = 0; i < cw->\hyperlink{structamii__WinDesc_a1ca7af4b595bf7bb077ed78546548670}{maxrow}; ++i )
1312     \{
1313     t = cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[ i ] + \hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF};
1314     \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_ab3d471e84a363992b5a483392d0b2389}{NHW\_MESSAGE} && cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[ i ][ \hyperlink{windefs_8h_a5840a65df04b15a5a319b3cae209fe18}{SEL\_ITEM} ] < 0 )
1315         --disprow;
1316     \textcolor{keywordflow}{else}
1317         col = 0;
1318     \textcolor{keywordflow}{while}( *t )
1319     \{
1320         len = strlen( t );
1321         \textcolor{keywordflow}{if}( col + len > cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} )
1322         len = cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} - col;
1323         \textcolor{keywordflow}{while}( len > 0 )
1324         \{
1325             \textcolor{keywordflow}{if}( !t[len] || t[len] == \textcolor{charliteral}{' '} )
1326             \textcolor{keywordflow}{break};
1327             --len;
1328         \}
1329         \textcolor{keywordflow}{if}( len == 0 ) \{
1330         \textcolor{keywordflow}{while} ( *t && *t != \textcolor{charliteral}{' '}) \{
1331             t++; col++;
1332         \}
1333         \} \textcolor{keywordflow}{else} \{
1334         t += len;
1335         col += len;
1336         \}
1337         \textcolor{keywordflow}{if}( *t )
1338         \{
1339         \textcolor{keywordflow}{while}( *t == \textcolor{charliteral}{' '} )
1340             ++t;
1341         col = 0;
1342         ++disprow;
1343         \}
1344     \}
1345     \}
1346     \textcolor{keywordflow}{return}( disprow );
1347 \}
\end{DoxyCode}
\hypertarget{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!Display\+Data@{Display\+Data}}
\index{Display\+Data@{Display\+Data}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{Display\+Data}]{\setlength{\rightskip}{0pt plus 5cm}void Display\+Data (
\begin{DoxyParamCaption}
\item[{{\bf winid}}]{win, }
\item[{int}]{start}
\end{DoxyParamCaption}
)}}\label{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}


Definition at line 1350 of file winmenu.\+c.



References amiga\+\_\+print\+\_\+glyph(), amii\+\_\+cl\+\_\+end(), amii\+\_\+curs(), amii\+\_\+menu\+A\+Pen, amii\+\_\+menu\+B\+Pen, amii\+\_\+msg\+A\+Pen, amii\+\_\+msg\+B\+Pen, amii\+\_\+text\+A\+Pen, amii\+\_\+text\+B\+Pen, amii\+\_\+wins, C\+\_\+\+B\+L\+U\+E, C\+\_\+\+R\+E\+D, amii\+\_\+\+Win\+Desc\+::cols, amii\+\_\+\+Win\+Desc\+::data, Find\+Line(), amii\+\_\+mi\+::glyph, amii\+\_\+menu\+::items, max, amii\+\_\+\+Win\+Desc\+::maxrow, amii\+\_\+\+Win\+Desc\+::menu, amii\+\_\+mi\+::next, N\+H\+W\+\_\+\+M\+E\+N\+U, N\+H\+W\+\_\+\+M\+E\+S\+S\+A\+G\+E, N\+H\+W\+\_\+\+T\+E\+X\+T, N\+O\+\_\+\+G\+L\+Y\+P\+H, panic(), pictdata, amii\+\_\+\+Win\+Desc\+::rows, rp, S\+E\+L\+\_\+\+I\+T\+E\+M, amii\+\_\+mi\+::selected, S\+O\+F\+F, amii\+\_\+\+Win\+Desc\+::type, amii\+\_\+\+Win\+Desc\+::win, W\+I\+N\+\_\+\+E\+R\+R, W\+I\+N\+\_\+\+I\+N\+V\+E\+N, winpanicstr, W\+I\+N\+V\+E\+R\+S\+\_\+\+A\+M\+I\+V, P\+D\+A\+T\+::xsize, and P\+D\+A\+T\+::ysize.



Referenced by amii\+\_\+doprev\+\_\+message(), Do\+Menu\+Scroll(), and Re\+Display\+Data().


\begin{DoxyCode}
1353 \{
1354     \textcolor{keywordtype}{int} txwd;
1355     \hyperlink{structamii__mi}{amii\_menu\_item} *mip;
1356     \textcolor{keyword}{register} \textcolor{keywordtype}{char} *t;
1357     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structamii__WinDesc}{amii\_WinDesc} *cw;
1358     \textcolor{keyword}{register} \textcolor{keyword}{struct }Window *w;
1359     \textcolor{keyword}{register} \textcolor{keyword}{struct }RastPort *\hyperlink{amirip_8c_aa0639b6491ec144930d14703053f32a4}{rp};
1360     \textcolor{keyword}{register} \textcolor{keywordtype}{int} i, disprow, len, wheight;
1361     \textcolor{keywordtype}{int} whichcolor = -1;
1362     \textcolor{keywordtype}{int} col;
1363 
1364     \textcolor{keywordflow}{if}( win == \hyperlink{wintype_8h_a56d1f4f2e517a4e81be0b7593e35e681}{WIN\_ERR} || !(cw = \hyperlink{winami_8h_a84358fe75628f255a0687acb6e8499de}{amii\_wins}[win]) || !( w = cw->
      \hyperlink{structamii__WinDesc_a9835faa4d66643cd889203e26edee8ae}{win} ) )
1365     \{
1366     \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}( \hyperlink{winext_8h_a4264157ee8930111caf21b62c212e08c}{winpanicstr}, win, \textcolor{stringliteral}{"No Window in DisplayData"} );
1367     \}
1368 
1369     rp = w->RPort;
1370     SetDrMd( rp, JAM2 );
1371     \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} && win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
1372     \{
1373     wheight = ( w->Height - w->BorderTop - w->BorderBottom - 2 ) /
1374             \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}( rp->TxHeight, \hyperlink{winchar_8c_a00763f280fa207a0cf085c6d52246c8c}{pictdata}.\hyperlink{structPDAT_ad7ef994c367e747b85e09149fdccff1b}{ysize} + 3 );
1375     \}
1376     \textcolor{keywordflow}{else}
1377     \{
1378     wheight = ( w->Height - w->BorderTop - w->BorderBottom - 2 ) /
1379             rp->TxHeight;
1380     \}
1381 
1382     cw->\hyperlink{structamii__WinDesc_a465b4a9c04b3c325f2af2722aac9c5f3}{rows} = wheight;
1383     txwd = rp->TxWidth;
1384     \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
1385     \{
1386     \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
1387     \{
1388         cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft -
1389             w->BorderRight - 4 - \hyperlink{winchar_8c_a00763f280fa207a0cf085c6d52246c8c}{pictdata}.\hyperlink{structPDAT_a957fade03cbfb4ce4de9df4e09be7fc7}{xsize} - 3) / txwd;
1390     \}
1391     \textcolor{keywordflow}{else}
1392         cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft - w->BorderRight - 4 ) / txwd;
1393     \}
1394     \textcolor{keywordflow}{else}
1395     \{
1396     cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft - w->BorderRight - 4 ) / txwd;
1397     \}
1398 
1399     \textcolor{comment}{/* Get the real line to display at */}
1400     start = \hyperlink{sys_2amiga_2winmenu_8c_a5c10fb452bdd53064eb14c3f1a270b62}{FindLine}( win, start );
1401 
1402     mip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items};
1403     \textcolor{keywordflow}{for}( i = 0; mip && i < start; ++i )
1404     \{
1405     mip = mip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next};
1406     \}
1407 
1408     \textcolor{comment}{/* Skip any initial response to a previous line */}
1409     \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_ab3d471e84a363992b5a483392d0b2389}{NHW\_MESSAGE} && mip && mip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected} < 0 )
1410     ++start;
1411     \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} && cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_ab3d471e84a363992b5a483392d0b2389}{NHW\_MESSAGE} )
1412     SetAPen( rp, \hyperlink{winext_8h_acc9bd89041e1021df5e8d898dda9968c}{amii\_msgAPen} );
1413     
1414     \textcolor{keywordflow}{for}( disprow = i = start; disprow < wheight + start; i++ )
1415     \{
1416     \textcolor{comment}{/* Just erase unused lines in the window */}
1417         \textcolor{keywordflow}{if}( i >= cw->\hyperlink{structamii__WinDesc_a1ca7af4b595bf7bb077ed78546548670}{maxrow} )
1418         \{
1419         \textcolor{keywordflow}{if} (\hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} && win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN}) \{
1420         \hyperlink{winfuncs_8c_ad16d76372b2790f7b6926dc6174e4111}{amii\_curs}( win, 0, disprow - start );
1421         \hyperlink{winproto_8h_a203b786b96fe4c8be21c63f474486d52}{amiga\_print\_glyph}( win, 0, \hyperlink{display_8h_ac36b9cc8436af3cf1f7f9919878d8354}{NO\_GLYPH});
1422         \}
1423         \hyperlink{winfuncs_8c_ad16d76372b2790f7b6926dc6174e4111}{amii\_curs}( win, 1, disprow - start );
1424         \hyperlink{winfuncs_8c_ace7ed7ac165d8e68bbc3df59a8ac5ec6}{amii\_cl\_end}( cw, 0 );
1425         ++disprow;
1426         \textcolor{keywordflow}{continue};
1427         \}
1428 
1429     \textcolor{comment}{/* Any string with a highlighted attribute goes}
1430 \textcolor{comment}{     * onto the end of the current line in the message window.}
1431 \textcolor{comment}{     */}
1432     \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_ab3d471e84a363992b5a483392d0b2389}{NHW\_MESSAGE} )
1433         SetAPen( rp, cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[ i ][ \hyperlink{windefs_8h_a5840a65df04b15a5a319b3cae209fe18}{SEL\_ITEM} ] < 0 ? \hyperlink{windefs_8h_a7adb9aaa1eed15caecd92e3837581b53}{C\_RED} : 
      \hyperlink{winext_8h_acc9bd89041e1021df5e8d898dda9968c}{amii\_msgAPen} );
1434 
1435     \textcolor{comment}{/* Selected text in the message window goes onto the end of the current line */}
1436     \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} != \hyperlink{wintype_8h_ab3d471e84a363992b5a483392d0b2389}{NHW\_MESSAGE} || cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[ i ][ \hyperlink{windefs_8h_a5840a65df04b15a5a319b3cae209fe18}{SEL\_ITEM} ] >= 0 )
1437     \{
1438         \hyperlink{winfuncs_8c_ad16d76372b2790f7b6926dc6174e4111}{amii\_curs}( win, 1, disprow - start );
1439         \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} && win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
1440         \{
1441         \textcolor{keywordflow}{if}( mip )
1442             \hyperlink{winproto_8h_a203b786b96fe4c8be21c63f474486d52}{amiga\_print\_glyph}( win, 0, mip->\hyperlink{structamii__mi_a3e4c3c4ab75e4d6027c978bb75fffbce}{glyph} );
1443         \hyperlink{winfuncs_8c_ad16d76372b2790f7b6926dc6174e4111}{amii\_curs}( win, 1, disprow - start );
1444         \}
1445         col = 0;
1446     \}
1447 
1448     \textcolor{comment}{/* If this entry is to be highlighted, do so */}
1449     \textcolor{keywordflow}{if}( mip && mip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected} != 0 )
1450     \{
1451         \textcolor{keywordflow}{if}( whichcolor != 1 )
1452         \{
1453         SetDrMd( rp, JAM2 );
1454         \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
1455         \{
1456             SetAPen( rp, \hyperlink{winext_8h_a26ac45dc44f3d41edc95bc99e0b788d8}{amii\_menuBPen} );
1457             SetBPen( rp, \hyperlink{windefs_8h_a2e4dd0b4af70107f36c2aa60b1195f01}{C\_BLUE} );
1458         \}
1459         \textcolor{keywordflow}{else}
1460         \{
1461             SetAPen( rp, \hyperlink{windefs_8h_a2e4dd0b4af70107f36c2aa60b1195f01}{C\_BLUE} );
1462             SetBPen( rp, \hyperlink{winext_8h_a14ab17c151206a4245022490c76255ec}{amii\_menuAPen} );
1463         \}
1464         whichcolor = 1;
1465         \}
1466     \}
1467     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( whichcolor != 2 )
1468     \{
1469         SetDrMd( rp, JAM2 );
1470         \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_ab3d471e84a363992b5a483392d0b2389}{NHW\_MESSAGE} )
1471         \{
1472         SetAPen( rp, \hyperlink{winext_8h_acc9bd89041e1021df5e8d898dda9968c}{amii\_msgAPen} );
1473         SetBPen( rp, \hyperlink{winext_8h_ab8d29ceb31e5059cc2430e47bfba87c8}{amii\_msgBPen} );
1474         \}
1475         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU} )
1476         \{
1477         SetAPen( rp, \hyperlink{winext_8h_a14ab17c151206a4245022490c76255ec}{amii\_menuAPen} );
1478         SetBPen( rp, \hyperlink{winext_8h_a26ac45dc44f3d41edc95bc99e0b788d8}{amii\_menuBPen} );
1479         \}
1480         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_a7e2bcc8531c4c62e8d8f1c5279c5789b}{NHW\_TEXT} )
1481         \{
1482         SetAPen( rp, \hyperlink{winext_8h_a87c9b725a8d1a308419408002c9eed2d}{amii\_textAPen} );
1483         SetBPen( rp, \hyperlink{winext_8h_a9ba6c6ce5bc8ca526739e615566abde0}{amii\_textBPen} );
1484         \}
1485         whichcolor = 2;
1486     \}
1487 
1488     \textcolor{comment}{/* Next line out, wrap if too long */}
1489 
1490     t = cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[ i ] + \hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF};
1491     ++disprow;
1492     col = 0;
1493     \textcolor{keywordflow}{while}( *t )
1494     \{
1495         len = strlen( t );
1496         \textcolor{keywordflow}{if}( len > (cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} - col) )
1497         len = cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} - col;
1498         \textcolor{keywordflow}{while}( len > 0 )
1499         \{
1500             \textcolor{keywordflow}{if}( !t[len] || t[len] == \textcolor{charliteral}{' '} )
1501             \textcolor{keywordflow}{break};
1502             --len;
1503         \}
1504         \textcolor{keywordflow}{if}( len == 0 ) \{
1505         Text( rp, t, cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} - col );
1506         \textcolor{keywordflow}{while} ( *t && *t != \textcolor{charliteral}{' '}) \{
1507             t++; col++;
1508         \}
1509         \} \textcolor{keywordflow}{else} \{
1510         Text( rp, t, len );
1511         t += len;
1512         col += len;
1513         \}
1514         \hyperlink{winfuncs_8c_ace7ed7ac165d8e68bbc3df59a8ac5ec6}{amii\_cl\_end}( cw, col );
1515         \textcolor{keywordflow}{if}( *t )
1516         \{
1517         ++disprow;
1518         \textcolor{comment}{/* Stop at the bottom of the window */}
1519         \textcolor{keywordflow}{if}( disprow > wheight + start )
1520             \textcolor{keywordflow}{break};
1521         \textcolor{keywordflow}{while}( *t == \textcolor{charliteral}{' '} )
1522             ++t;
1523         \hyperlink{winfuncs_8c_ad16d76372b2790f7b6926dc6174e4111}{amii\_curs}( win, 1, disprow - start - 1 );
1524         \textcolor{keywordflow}{if}( mip && win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} && \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
1525         \{
1526             \textcolor{comment}{/* Erase any previous glyph drawn here. */}
1527             \hyperlink{winproto_8h_a203b786b96fe4c8be21c63f474486d52}{amiga\_print\_glyph}( win, 0, \hyperlink{display_8h_ac36b9cc8436af3cf1f7f9919878d8354}{NO\_GLYPH} );
1528             \hyperlink{winfuncs_8c_ad16d76372b2790f7b6926dc6174e4111}{amii\_curs}( win, 1, disprow - start - 1 );
1529         \}
1530         Text( rp, \textcolor{stringliteral}{"+"}, 1 );
1531         col = 1;
1532         \}
1533     \}
1534 
1535     \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_ab3d471e84a363992b5a483392d0b2389}{NHW\_MESSAGE} )
1536     \{
1537         SetAPen( rp, \hyperlink{winext_8h_ab8d29ceb31e5059cc2430e47bfba87c8}{amii\_msgBPen} );
1538         SetBPen( rp, \hyperlink{winext_8h_ab8d29ceb31e5059cc2430e47bfba87c8}{amii\_msgBPen} );
1539     \}
1540     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU} )
1541     \{
1542         SetAPen( rp, \hyperlink{winext_8h_a26ac45dc44f3d41edc95bc99e0b788d8}{amii\_menuBPen} );
1543         SetBPen( rp, \hyperlink{winext_8h_a26ac45dc44f3d41edc95bc99e0b788d8}{amii\_menuBPen} );
1544     \}
1545     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_a7e2bcc8531c4c62e8d8f1c5279c5789b}{NHW\_TEXT} )
1546     \{
1547         SetAPen( rp, \hyperlink{winext_8h_a9ba6c6ce5bc8ca526739e615566abde0}{amii\_textBPen} );
1548         SetBPen( rp, \hyperlink{winext_8h_a9ba6c6ce5bc8ca526739e615566abde0}{amii\_textBPen} );
1549     \}
1550     \hyperlink{winfuncs_8c_ace7ed7ac165d8e68bbc3df59a8ac5ec6}{amii\_cl\_end}( cw, col );
1551     whichcolor = -1;
1552     \textcolor{keywordflow}{if}( mip ) mip = mip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next};
1553     \}
1554     RefreshWindowFrame(w);
1555     \textcolor{keywordflow}{return};
1556 \}
\end{DoxyCode}
\hypertarget{sys_2amiga_2winmenu_8c_a2ab7ed911fa9e298491912256dad69be}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!Do\+Menu\+Scroll@{Do\+Menu\+Scroll}}
\index{Do\+Menu\+Scroll@{Do\+Menu\+Scroll}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{Do\+Menu\+Scroll}]{\setlength{\rightskip}{0pt plus 5cm}int Do\+Menu\+Scroll (
\begin{DoxyParamCaption}
\item[{int}]{win, }
\item[{int}]{blocking, }
\item[{int}]{how, }
\item[{{\bf menu\+\_\+item} $\ast$$\ast$}]{retmip}
\end{DoxyParamCaption}
)}}\label{sys_2amiga_2winmenu_8c_a2ab7ed911fa9e298491912256dad69be}


Definition at line 235 of file winmenu.\+c.



References alwaysinvent, amii\+\_\+getlin(), amii\+\_\+setfillpens(), amii\+\_\+wins, ami\+I\+Display, buf, B\+U\+F\+S\+Z, amii\+\_\+mi\+::canselect, amii\+\_\+\+Win\+Desc\+::cols, Convert\+Key(), amii\+\_\+mi\+::count, count, Count\+Lines(), C\+T\+R\+L, amii\+\_\+\+Win\+Desc\+::curx, Display\+Data(), Dup\+New\+Window(), F\+A\+L\+S\+E, find\+\_\+menu\+\_\+item(), amii\+\_\+mi\+::gselector, Hack\+Font, Hack\+Screen, amii\+\_\+menu\+::items, L\+A\+R\+G\+E\+S\+T\+\_\+\+I\+N\+T, lastmsg, make\+\_\+menu\+\_\+items(), map\+\_\+menu\+\_\+cmd(), max, amii\+\_\+\+Win\+Desc\+::maxcol, amii\+\_\+\+Win\+Desc\+::maxrow, amii\+\_\+\+Win\+Desc\+::menu, M\+E\+N\+U\+\_\+\+F\+I\+R\+S\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+I\+N\+V\+E\+R\+T\+\_\+\+A\+L\+L, M\+E\+N\+U\+\_\+\+I\+N\+V\+E\+R\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+L\+A\+S\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+N\+E\+X\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+P\+R\+E\+V\+I\+O\+U\+S\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+S\+E\+A\+R\+C\+H, M\+E\+N\+U\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+A\+L\+L, M\+E\+N\+U\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+U\+N\+S\+E\+L\+E\+C\+T\+\_\+\+A\+L\+L, M\+E\+N\+U\+\_\+\+U\+N\+S\+E\+L\+E\+C\+T\+\_\+\+P\+A\+G\+E, Menu\+Scroll, min, morc, amii\+\_\+\+Win\+Desc\+::morestr, new\+\_\+wins, amii\+\_\+\+Win\+Desc\+::newwin, win\+\_\+setup\+::newwin, amii\+\_\+mi\+::next, N\+H\+W\+\_\+\+M\+E\+N\+U, N\+H\+W\+\_\+\+T\+E\+X\+T, N\+U\+L\+L, Open\+Sh\+Window(), panic(), P\+I\+C\+K\+\_\+\+A\+N\+Y, P\+I\+C\+K\+\_\+\+N\+O\+N\+E, P\+I\+C\+K\+\_\+\+O\+N\+E, pictdata, pl\+\_\+character, plname, Prop\+Scroll, amii\+\_\+mi\+::selected, amii\+\_\+mi\+::selector, Set\+Prop\+Info(), S\+O\+F\+F, amii\+\_\+mi\+::str, Texts\+Font, T\+R\+U\+E, txheight, txwidth, amii\+\_\+\+Win\+Desc\+::type, amii\+\_\+\+Win\+Desc\+::wasup, amii\+\_\+\+Win\+Desc\+::win, W\+I\+N\+\_\+\+E\+R\+R, W\+I\+N\+\_\+\+I\+N\+V\+E\+N, W\+I\+N\+\_\+\+M\+A\+P, W\+I\+N\+\_\+\+M\+E\+S\+S\+A\+G\+E, W\+I\+N\+\_\+\+S\+T\+A\+T\+U\+S, winpanicstr, amii\+\_\+\+Win\+Desc\+::wintags, W\+I\+N\+V\+E\+R\+S\+\_\+\+A\+M\+I\+I, W\+I\+N\+V\+E\+R\+S\+\_\+\+A\+M\+I\+V, amii\+\_\+\+Display\+Desc\+::xpix, xsize, P\+D\+A\+T\+::xsize, amii\+\_\+\+Display\+Desc\+::ypix, ysize, and P\+D\+A\+T\+::ysize.



Referenced by amii\+\_\+display\+\_\+nhwindow(), and amii\+\_\+select\+\_\+menu().


\begin{DoxyCode}
238 \{
239     \hyperlink{structamii__mi}{amii\_menu\_item} *amip;
240     \textcolor{keyword}{register} \textcolor{keyword}{struct }Window *w;
241     \textcolor{keyword}{register} \textcolor{keyword}{struct }NewWindow *nw;
242     \textcolor{keyword}{struct }PropInfo *pip;
243     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structamii__WinDesc}{amii\_WinDesc} *cw;
244     \textcolor{keyword}{struct }IntuiMessage *imsg;
245     \textcolor{keyword}{struct }Gadget *gd;
246     \textcolor{keyword}{register} \textcolor{keywordtype}{int} wheight, \hyperlink{sp__lev_8c_a22122ed2c15d87f3ff9e3dad23423244}{xsize}, \hyperlink{sp__lev_8c_a17f6fa5b5051ab79afe70d9598576009}{ysize}, aredone = 0;
247     \textcolor{keyword}{register} \textcolor{keywordtype}{int} txwd, txh;
248     \textcolor{keywordtype}{long} mics, secs, \textcolor{keyword}{class}, code;
249     \textcolor{keywordtype}{long} oldmics = 0, oldsecs = 0;
250     \textcolor{keywordtype}{int} aidx, oidx, topidx, hidden;
251     \textcolor{keywordtype}{int} totalvis;
252     SHORT mx, my;
253     \textcolor{keyword}{static} \textcolor{keywordtype}{char} title[ 100 ];
254     \textcolor{keywordtype}{int} dosize = 1;
255     \textcolor{keyword}{struct }Screen *scrn = \hyperlink{winext_8h_ad92207d95deab9f96588451c7ed34419}{HackScreen};
256     \textcolor{keywordtype}{int} x1,x2,y1,y2;
257     \textcolor{keywordtype}{long} counting = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count} = 0, reset\_counting = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
258     \textcolor{keywordtype}{char} countString[32];
259 
260     \textcolor{keywordflow}{if}( win == \hyperlink{wintype_8h_a56d1f4f2e517a4e81be0b7593e35e681}{WIN\_ERR} || ( cw = \hyperlink{winami_8h_a84358fe75628f255a0687acb6e8499de}{amii\_wins}[ win ] ) == \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} )
261     \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\hyperlink{winext_8h_a4264157ee8930111caf21b62c212e08c}{winpanicstr},win,\textcolor{stringliteral}{"DoMenuScroll"});
262 
263     \textcolor{comment}{/*  Initial guess at window sizing values */}
264     txwd = \hyperlink{winext_8h_a017c6ef07f078c21f903ea8942bb43b3}{txwidth};
265     \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
266     \{
267     \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
268         txh = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}( \hyperlink{winext_8h_afdf567214d70875e5c17efe40a02b53a}{txheight}, \hyperlink{winchar_8c_a00763f280fa207a0cf085c6d52246c8c}{pictdata}.\hyperlink{structPDAT_ad7ef994c367e747b85e09149fdccff1b}{ysize} + 3 ); \textcolor{comment}{/* interline space */}
269     \textcolor{keywordflow}{else}
270         txh = \hyperlink{winext_8h_afdf567214d70875e5c17efe40a02b53a}{txheight}; \textcolor{comment}{/* interline space */}
271     \}
272     \textcolor{keywordflow}{else}
273     txh = \hyperlink{winext_8h_afdf567214d70875e5c17efe40a02b53a}{txheight}; \textcolor{comment}{/* interline space */}
274 
275     \textcolor{comment}{/* Check to see if we should open the window, should need to for}
276 \textcolor{comment}{     * TEXT and MENU but not MESSAGE.}
277 \textcolor{comment}{     */}
278 
279     w = cw->\hyperlink{structamii__WinDesc_a9835faa4d66643cd889203e26edee8ae}{win};
280     topidx = 0;
281 
282     \textcolor{keywordflow}{if}( w == \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} )
283     \{
284 
285 \textcolor{preprocessor}{#ifdef  INTUI\_NEW\_LOOK}
286     \textcolor{keywordflow}{if}( IntuitionBase->LibNode.lib\_Version >= 37 )
287     \{
288         \hyperlink{winext_8h_ac03b382c1a8a8d6748fc7bfe920e0ec2}{PropScroll}.Flags |= PROPNEWLOOK;
289     \}
290 \textcolor{preprocessor}{#endif}
291     nw = (\textcolor{keywordtype}{void} *)\hyperlink{winproto_8h_ac3377d82ce911663e05ba9a63d464d90}{DupNewWindow}( (\textcolor{keywordtype}{void} *)(&\hyperlink{winext_8h_a2b4f8d028c6b8c047e86aa0c49348f36}{new\_wins}[ cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} ].
      \hyperlink{structwin__setup_a274eccbc444f827a7db33a83c4f4ec70}{newwin}) );
292     \textcolor{keywordflow}{if}( !\hyperlink{winext_8h_a5f7057e3372d8abeddf1df4f99752979}{alwaysinvent} || win != \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
293     \{
294         xsize = scrn->WBorLeft + scrn->WBorRight + \hyperlink{winext_8h_a0be771971036f589c1013474c1fcd264}{MenuScroll}.Width + 1 +
295                 (txwd * cw->\hyperlink{structamii__WinDesc_a7abaf7568c45c6f6efabdfdc13164a4c}{maxcol});
296         \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
297         \{
298         \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
299             xsize += \hyperlink{winchar_8c_a00763f280fa207a0cf085c6d52246c8c}{pictdata}.\hyperlink{structPDAT_a957fade03cbfb4ce4de9df4e09be7fc7}{xsize} + 4;
300         \}
301         \textcolor{keywordflow}{if}( xsize > \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_af95f6ae98ff1f0ccc96b06fdd296530e}{xpix} )
302         xsize = \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_af95f6ae98ff1f0ccc96b06fdd296530e}{xpix};
303 
304         \textcolor{comment}{/* If next row not off window, use it, else use the bottom */}
305 
306         ysize = ( txh * cw->\hyperlink{structamii__WinDesc_a1ca7af4b595bf7bb077ed78546548670}{maxrow} ) +              \textcolor{comment}{/* The text space */}
307             \hyperlink{winext_8h_ad92207d95deab9f96588451c7ed34419}{HackScreen}->WBorTop + \hyperlink{winext_8h_afdf567214d70875e5c17efe40a02b53a}{txheight} + 1 +  \textcolor{comment}{/* Top border */}
308             \hyperlink{winext_8h_ad92207d95deab9f96588451c7ed34419}{HackScreen}->WBorBottom + 3;         \textcolor{comment}{/* The bottom border */}
309         \textcolor{keywordflow}{if}( ysize > \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_a24ab4ee31424d8d41235227d2d919b4e}{ypix} )
310         ysize = \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_a24ab4ee31424d8d41235227d2d919b4e}{ypix};
311 
312         \textcolor{comment}{/* Adjust the size of the menu scroll gadget */}
313 
314         nw->TopEdge = 0;
315         \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_a7e2bcc8531c4c62e8d8f1c5279c5789b}{NHW\_TEXT} && ysize < amiIDisplay->ypix )
316         nw->TopEdge += ( \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_a24ab4ee31424d8d41235227d2d919b4e}{ypix} - \hyperlink{sp__lev_8c_a17f6fa5b5051ab79afe70d9598576009}{ysize} ) / 2;
317         nw->LeftEdge = \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_af95f6ae98ff1f0ccc96b06fdd296530e}{xpix} - \hyperlink{sp__lev_8c_a22122ed2c15d87f3ff9e3dad23423244}{xsize};
318         \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU} )
319         \{
320         \textcolor{keywordflow}{if}( nw->LeftEdge > 10 )
321             nw->LeftEdge -= 10;
322         \textcolor{keywordflow}{else}
323             nw->LeftEdge = 0;
324         \textcolor{keywordflow}{if}( \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_a24ab4ee31424d8d41235227d2d919b4e}{ypix} - nw->Height > 10 )
325             nw->TopEdge += 10;
326         \textcolor{keywordflow}{else}
327             nw->TopEdge = \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_a24ab4ee31424d8d41235227d2d919b4e}{ypix} - nw->Height - 1;
328         \}
329         \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_a7e2bcc8531c4c62e8d8f1c5279c5789b}{NHW\_TEXT} && xsize < amiIDisplay->xpix )
330         nw->LeftEdge -= ( \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_af95f6ae98ff1f0ccc96b06fdd296530e}{xpix} - \hyperlink{sp__lev_8c_a22122ed2c15d87f3ff9e3dad23423244}{xsize} ) / 2;
331     \}
332     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
333     \{
334         \textcolor{keyword}{struct }Window *mw = \hyperlink{winami_8h_a84358fe75628f255a0687acb6e8499de}{amii\_wins}[ \hyperlink{decl_8h_afa1f7dd312c4c1b72afe3d2c8c2af691}{WIN\_MAP} ]->\hyperlink{structamii__WinDesc_a9835faa4d66643cd889203e26edee8ae}{win};
335         \textcolor{keyword}{struct }Window *sw = \hyperlink{winami_8h_a84358fe75628f255a0687acb6e8499de}{amii\_wins}[ \hyperlink{decl_8h_ae0690a38fd295760409995ce03b88329}{WIN\_STATUS} ]->\hyperlink{structamii__WinDesc_a9835faa4d66643cd889203e26edee8ae}{win};
336 
337         xsize = scrn->WBorLeft + scrn->WBorRight + \hyperlink{winext_8h_a0be771971036f589c1013474c1fcd264}{MenuScroll}.Width + 1 +
338                 (txwd * cw->\hyperlink{structamii__WinDesc_a7abaf7568c45c6f6efabdfdc13164a4c}{maxcol});
339 
340         \textcolor{comment}{/* Make space for the glyph to appear at the left of the description */}
341         \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
342         xsize += \hyperlink{winchar_8c_a00763f280fa207a0cf085c6d52246c8c}{pictdata}.\hyperlink{structPDAT_a957fade03cbfb4ce4de9df4e09be7fc7}{xsize} + 4;
343 
344         \textcolor{keywordflow}{if}( xsize > \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_af95f6ae98ff1f0ccc96b06fdd296530e}{xpix} )
345         xsize = \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_af95f6ae98ff1f0ccc96b06fdd296530e}{xpix};
346 
347         \textcolor{comment}{/* If next row not off window, use it, else use the bottom */}
348 
349         ysize = sw->TopEdge - (mw->TopEdge + mw->Height) - 1;
350         \textcolor{keywordflow}{if}( ysize > \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_a24ab4ee31424d8d41235227d2d919b4e}{ypix} )
351         ysize = \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_a24ab4ee31424d8d41235227d2d919b4e}{ypix};
352 
353         \textcolor{comment}{/* Adjust the size of the menu scroll gadget */}
354 
355         nw->TopEdge = mw->TopEdge + mw->Height;
356         nw->LeftEdge = 0;
357     \}
358     cw->\hyperlink{structamii__WinDesc_a96e2d1e26527cec8fe44903009a365a8}{newwin} = (\textcolor{keywordtype}{void} *)nw;
359     \textcolor{keywordflow}{if}( nw == \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} )
360         \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"No NewWindow Allocated"} );
361 
362     nw->Screen = \hyperlink{winext_8h_ad92207d95deab9f96588451c7ed34419}{HackScreen};
363 
364     \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
365     \{
366         sprintf( title, \textcolor{stringliteral}{"%s the %s's Inventory"}, \hyperlink{decl_8h_a362b24d8378ea9e5a611cc50d66e354b}{plname}, \hyperlink{decl_8h_a053ad248bf641e54a6f7bfb6a8fb9e05}{pl\_character} );
367         nw->Title = title;
368         \textcolor{keywordflow}{if}( lastinvent.MaxX != 0 )
369         \{
370         nw->LeftEdge = lastinvent.MinX;
371         nw->TopEdge = lastinvent.MinY;
372         nw->Width = lastinvent.MaxX;
373         nw->Height = lastinvent.MaxY;
374         \}
375     \}
376     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_a18f1ba88dadd6f00144ad9f0b16a2b20}{morestr} )
377         nw->Title = cw->\hyperlink{structamii__WinDesc_a18f1ba88dadd6f00144ad9f0b16a2b20}{morestr};
378 
379     \textcolor{comment}{/* Adjust the window coordinates and size now that we know}
380 \textcolor{comment}{     * how many items are to be displayed.}
381 \textcolor{comment}{     */}
382 
383     \textcolor{keywordflow}{if}( ( xsize > \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_af95f6ae98ff1f0ccc96b06fdd296530e}{xpix} - nw->LeftEdge ) &&
384         ( xsize < amiIDisplay->xpix ) )
385     \{
386         nw->LeftEdge = \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_af95f6ae98ff1f0ccc96b06fdd296530e}{xpix} - \hyperlink{sp__lev_8c_a22122ed2c15d87f3ff9e3dad23423244}{xsize};
387         nw->Width = \hyperlink{sp__lev_8c_a22122ed2c15d87f3ff9e3dad23423244}{xsize};
388     \}
389     \textcolor{keywordflow}{else}
390     \{
391         nw->Width = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}( xsize, \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_af95f6ae98ff1f0ccc96b06fdd296530e}{xpix} - nw->LeftEdge );
392     \}
393     nw->Height = \hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}( ysize, \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_a24ab4ee31424d8d41235227d2d919b4e}{ypix} - nw->TopEdge );
394 
395     \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} || \hyperlink{windefs_8h_adf1601afd1e2d6555110cd79bbbf4705}{WINVERS\_AMII} )
396     \{
397         \textcolor{comment}{/* Make sure we are using the correct hook structure */}
398         nw->Extension = cw->\hyperlink{structamii__WinDesc_a982df47148570e92162c13c1d158ef1b}{wintags};
399     \}
400 
401     \textcolor{comment}{/* Now, open the window */}
402     w = cw->\hyperlink{structamii__WinDesc_a9835faa4d66643cd889203e26edee8ae}{win} = \hyperlink{winproto_8h_a4fbda1b274fbd7f990be789cfbb8fd52}{OpenShWindow}( (\textcolor{keywordtype}{void} *)nw );
403 
404     \textcolor{keywordflow}{if}( w == \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} )
405     \{
406         \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[ 130 ];
407 
408         sprintf( buf, \textcolor{stringliteral}{"No Window Opened For Menu (%d,%d,%d-%d,%d-%d)"},
409         nw->LeftEdge, nw->TopEdge, nw->Width, \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_af95f6ae98ff1f0ccc96b06fdd296530e}{xpix},
410         nw->Height, \hyperlink{winami_8h_a0ecec29922f9b6272c2b5344ce40b283}{amiIDisplay}->\hyperlink{structamii__DisplayDesc_a24ab4ee31424d8d41235227d2d919b4e}{ypix} );
411         \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}( buf );
412     \}
413 
414 \textcolor{preprocessor}{#ifdef HACKFONT}
415     \textcolor{keywordflow}{if}( \hyperlink{winext_8h_a5ba89c525a49d1190a1a5ecdf5f65aa6}{TextsFont} )
416         SetFont(w->RPort, \hyperlink{winext_8h_a5ba89c525a49d1190a1a5ecdf5f65aa6}{TextsFont} );
417     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{winext_8h_addd84e576afd1379e2aa7fa9921de0a5}{HackFont} )
418         SetFont(w->RPort, \hyperlink{winext_8h_addd84e576afd1379e2aa7fa9921de0a5}{HackFont} );
419 \textcolor{preprocessor}{#endif}
420     txwd = w->RPort->TxWidth;
421     \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
422     \{
423         \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
424         txh = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}( w->RPort->TxHeight, \hyperlink{winchar_8c_a00763f280fa207a0cf085c6d52246c8c}{pictdata}.\hyperlink{structPDAT_ad7ef994c367e747b85e09149fdccff1b}{ysize} + 3 ); \textcolor{comment}{/* interline space */}
425         \textcolor{keywordflow}{else}
426         txh = w->RPort->TxHeight; \textcolor{comment}{/* interline space */}
427     \}
428     \textcolor{keywordflow}{else}
429         txh = w->RPort->TxHeight; \textcolor{comment}{/* interline space */}
430 
431     \textcolor{comment}{/* subtract 2 to account for spacing away from border (1 on each side) */}
432     wheight = ( w->Height - w->BorderTop - w->BorderBottom - 2 ) / txh;
433     \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
434     \{
435         \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
436         \{
437         cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft -
438                 w->BorderRight - 4 - \hyperlink{winchar_8c_a00763f280fa207a0cf085c6d52246c8c}{pictdata}.\hyperlink{structPDAT_a957fade03cbfb4ce4de9df4e09be7fc7}{xsize} - 3 ) / txwd;
439         \}
440         \textcolor{keywordflow}{else}
441         \{
442         cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft - w->BorderRight - 4 ) / txwd;
443         \}
444     \}
445     \textcolor{keywordflow}{else}
446     \{
447         cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft - w->BorderRight - 4 ) / txwd;
448     \}
449     totalvis = \hyperlink{sys_2amiga_2winmenu_8c_aab1d3a28e3b2dd6770eae7e837fa27dd}{CountLines}( win );
450     \}
451     \textcolor{keywordflow}{else}
452     \{
453     txwd = w->RPort->TxWidth;
454     \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
455     \{
456         \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
457         txh = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}( w->RPort->TxHeight, \hyperlink{winchar_8c_a00763f280fa207a0cf085c6d52246c8c}{pictdata}.\hyperlink{structPDAT_ad7ef994c367e747b85e09149fdccff1b}{ysize} + 3 ); \textcolor{comment}{/* interline space */}
458         \textcolor{keywordflow}{else}
459         txh = w->RPort->TxHeight; \textcolor{comment}{/* interline space */}
460     \}
461     \textcolor{keywordflow}{else}
462     \{
463         txh = w->RPort->TxHeight; \textcolor{comment}{/* interline space */}
464     \}
465 
466     \textcolor{comment}{/* subtract 2 to account for spacing away from border (1 on each side) */}
467     wheight = ( w->Height - w->BorderTop - w->BorderBottom - 2 ) / txh;
468     \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
469     \{
470         \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
471         \{
472         cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft -
473                 w->BorderRight - 4 - \hyperlink{winchar_8c_a00763f280fa207a0cf085c6d52246c8c}{pictdata}.\hyperlink{structPDAT_a957fade03cbfb4ce4de9df4e09be7fc7}{xsize} - 3) / txwd;
474         \}
475         \textcolor{keywordflow}{else}
476         cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft - w->BorderRight - 4 ) / txwd;
477     \}
478     \textcolor{keywordflow}{else}
479     \{
480         cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft - w->BorderRight - 4 ) / txwd;
481     \}
482 
483     totalvis = \hyperlink{sys_2amiga_2winmenu_8c_aab1d3a28e3b2dd6770eae7e837fa27dd}{CountLines}( win );
484 
485     \textcolor{keywordflow}{for}( gd = w->FirstGadget; gd && gd->GadgetID != 1; )
486         gd = gd->NextGadget;
487 
488     \textcolor{keywordflow}{if}( gd )
489     \{
490         pip = (\textcolor{keyword}{struct }PropInfo *)gd->SpecialInfo;
491         hidden = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}( totalvis - wheight, 0 );
492         topidx = (((\hyperlink{def__os2_8h_af632da489ebc3708ec3ab6791ee53fa4}{ULONG})hidden * pip->VertPot) + (MAXPOT/2)) >> 16;
493     \}
494     \}
495 
496     \textcolor{keywordflow}{for}( gd = w->FirstGadget; gd && gd->GadgetID != 1; )
497     gd = gd->NextGadget;
498 
499     \textcolor{keywordflow}{if}( !gd ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Can't find scroll gadget"} );
500 
501     \hyperlink{winami_8h_aba452ddfcafb21205b4a07d22dabc398}{morc} = 0;
502     oidx = -1;
503 
504 \textcolor{preprocessor}{#if 0}
505     \textcolor{comment}{/* Make sure there are no selections left over from last time. */}
506 \textcolor{comment}{/* XXX potential problem for preselection if this is really needed */}
507   \textcolor{keywordflow}{for}( amip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items}; amip; amip = amip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next} )
508     amip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected} = 0;
509 \textcolor{preprocessor}{#endif}
510 
511     \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}( win, topidx );
512 
513     \textcolor{comment}{/* Make the prop gadget the right size and place */}
514 
515     \hyperlink{sys_2amiga_2winmenu_8c_a28121fc0d5fc72d2292fa04d5bbf7d60}{SetPropInfo}( w, gd, wheight, totalvis, topidx );
516     oldsecs = oldmics = 0;
517 
518     \textcolor{comment}{/* If window already up, don't stop to process events */}
519     \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_ab4e4bdac6ab87e8f1cf420814f09e876}{wasup} )
520     \{
521         aredone = 1;
522         cw->\hyperlink{structamii__WinDesc_ab4e4bdac6ab87e8f1cf420814f09e876}{wasup} = 0;
523     \}
524 
525     \textcolor{keywordflow}{while}( !aredone )
526     \{
527     \textcolor{comment}{/* Process window messages */}
528 
529     WaitPort( w->UserPort );
530     \textcolor{keywordflow}{while}( imsg = (\textcolor{keyword}{struct} IntuiMessage * ) GetMsg( w->UserPort ) )
531     \{
532         \textcolor{keyword}{class }= imsg->Class;
533         code = imsg->Code;
534         mics = imsg->Micros;
535         secs = imsg->Seconds;
536         gd = (\textcolor{keyword}{struct }Gadget *) imsg->IAddress;
537         mx = imsg->MouseX;
538         my = imsg->MouseY;
539 
540         \textcolor{comment}{/* Only do our window or VANILLAKEY from other windows */}
541 
542         \textcolor{keywordflow}{if}( imsg->IDCMPWindow != w && \textcolor{keyword}{class} != VANILLAKEY &&
543                             \textcolor{keyword}{class} != RAWKEY )
544         \{
545         ReplyMsg( (\textcolor{keyword}{struct} Message *) imsg );
546         \textcolor{keywordflow}{continue};
547         \}
548 
549         \textcolor{comment}{/* Do DeadKeyConvert() stuff if RAWKEY... */}
550         \textcolor{keywordflow}{if}( \textcolor{keyword}{class} == RAWKEY )
551         \{
552         \textcolor{keyword}{class }= VANILLAKEY;
553         code = \hyperlink{winproto_8h_a63bceb4935b25e00e97a8b1cf17719bb}{ConvertKey}( imsg );
554         \}
555         ReplyMsg( (\textcolor{keyword}{struct} Message *) imsg );
556 
557         \textcolor{keywordflow}{switch}( \textcolor{keyword}{class} )
558         \{
559         \textcolor{keywordflow}{case} NEWSIZE:
560 
561             \textcolor{comment}{/*}
562 \textcolor{comment}{             * Ignore every other newsize, no action needed,}
563 \textcolor{comment}{             * except RefreshWindowFrame() in case borders got overwritten}
564 \textcolor{comment}{             * for some reason. It should not happen, but ...}
565 \textcolor{comment}{             */}
566 
567             \textcolor{keywordflow}{if}( !dosize )
568             \{
569             RefreshWindowFrame(w);
570             dosize = 1;
571             \textcolor{keywordflow}{break};
572             \}
573 
574             \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
575             \{
576             lastinvent.MinX = w->LeftEdge;
577             lastinvent.MinY = w->TopEdge;
578             lastinvent.MaxX = w->Width;
579             lastinvent.MaxY = w->Height;
580             \}
581             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_a4a1cc9e693dbdfad3ea32b10ce19f337}{WIN\_MESSAGE} )
582             \{
583             \hyperlink{winext_8h_a15fb087f5b07d7dbc0f859370ebe6151}{lastmsg}.MinX = w->LeftEdge;
584             \hyperlink{winext_8h_a15fb087f5b07d7dbc0f859370ebe6151}{lastmsg}.MinY = w->TopEdge;
585             \hyperlink{winext_8h_a15fb087f5b07d7dbc0f859370ebe6151}{lastmsg}.MaxX = w->Width;
586             \hyperlink{winext_8h_a15fb087f5b07d7dbc0f859370ebe6151}{lastmsg}.MaxY = w->Height;
587             \}
588 
589             \textcolor{comment}{/* Find the gadget */}
590 
591             \textcolor{keywordflow}{for}( gd = w->FirstGadget; gd && gd->GadgetID != 1; )
592             gd = gd->NextGadget;
593 
594             \textcolor{keywordflow}{if}( !gd )
595             \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Can't find scroll gadget"} );
596 
597             totalvis = \hyperlink{sys_2amiga_2winmenu_8c_aab1d3a28e3b2dd6770eae7e837fa27dd}{CountLines}( win );
598             wheight = ( w->Height - w->BorderTop -
599                         w->BorderBottom - 2) / txh;
600             \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
601             \{
602             \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
603             \{
604                 cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft -
605                     w->BorderRight - 4 - \hyperlink{winchar_8c_a00763f280fa207a0cf085c6d52246c8c}{pictdata}.\hyperlink{structPDAT_a957fade03cbfb4ce4de9df4e09be7fc7}{xsize} - 3) / txwd;
606             \}
607             \textcolor{keywordflow}{else}
608                 cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft - w->BorderRight - 4 ) / txwd;
609             \}
610             \textcolor{keywordflow}{else}
611             \{
612             cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft - w->BorderRight - 4 ) / txwd;
613             \}
614 
615             \textcolor{keywordflow}{if}( wheight < 2 )
616             wheight = 2;
617 
618             \textcolor{comment}{/*}
619 \textcolor{comment}{             * Clear the right side & bottom. Parts of letters are not erased by}
620 \textcolor{comment}{             * amii\_cl\_end if window shrinks and columns decrease.}
621 \textcolor{comment}{             */}
622 
623             \textcolor{keywordflow}{if} ( \hyperlink{windefs_8h_adf1601afd1e2d6555110cd79bbbf4705}{WINVERS\_AMII} || \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} ) \{
624             \hyperlink{winfuncs_8c_a4df453dcf15e61612e6e06b40279d5d8}{amii\_setfillpens}(w, cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type});
625             SetDrMd(w->RPort, JAM2);
626             x2 = w->Width - w->BorderRight;
627             y2 = w->Height - w->BorderBottom;
628             x1 = x2 - w->IFont->tf\_XSize - w->IFont->tf\_XSize;
629             y1 = w->BorderTop;
630             \textcolor{keywordflow}{if} (x1 < w->BorderLeft)
631                 x1 = w->BorderLeft;
632             RectFill(w->RPort, x1, y1, x2, y2);
633             x1 = w->BorderLeft;
634             y1 = y1 - w->IFont->tf\_YSize;
635             RectFill(w->RPort, x1, y1, x2, y2);
636             RefreshWindowFrame(w);
637             \}
638 
639             \textcolor{comment}{/* Make the prop gadget the right size and place */}
640 
641             \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}( win, topidx );
642             \hyperlink{sys_2amiga_2winmenu_8c_a28121fc0d5fc72d2292fa04d5bbf7d60}{SetPropInfo}( w, gd, wheight, totalvis, topidx );
643 
644             \textcolor{comment}{/* Force the window to a text line boundary <= to}
645 \textcolor{comment}{             * what the user dragged it to.  This eliminates}
646 \textcolor{comment}{             * having to clean things up on the bottom edge.}
647 \textcolor{comment}{             */}
648 
649             SizeWindow( w, 0, ( wheight * txh) +
650                 w->BorderTop + w->BorderBottom + 2 - w->Height );
651 
652             \textcolor{comment}{/* Don't do next NEWSIZE, we caused it */}
653             dosize = 0;
654             oldsecs = oldmics = 0;
655             \textcolor{keywordflow}{break};
656 
657         \textcolor{keywordflow}{case} VANILLAKEY:
658 \textcolor{preprocessor}{#define CTRL(x)     ((x)-'@')}
659             \hyperlink{winami_8h_aba452ddfcafb21205b4a07d22dabc398}{morc} = code = \hyperlink{options_8c_a12b336a1f1a4cec27361fc446f21ac01}{map\_menu\_cmd}(code);
660             \textcolor{keywordflow}{if} (code == \hyperlink{wintype_8h_a6c705d18a063df81d02997c09d14157f}{MENU\_SELECT\_ALL}) \{
661             \textcolor{keywordflow}{if} (how == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY}) \{
662                 amip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items};
663                 \textcolor{keywordflow}{while} (amip) \{
664                 \textcolor{keywordflow}{if} (amip->\hyperlink{structamii__mi_a68250523fd29eae87c3a438284fab1c0}{canselect} && amip->\hyperlink{structamii__mi_a77084785d6d5815d0e006ad4ff6dd0b9}{selector}) \{
665                 \textcolor{comment}{/*}
666 \textcolor{comment}{                 * Select those yet unselected}
667 \textcolor{comment}{                 * and apply count if necessary}
668 \textcolor{comment}{                 */}
669                     \textcolor{keywordflow}{if} (!amip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected}) \{
670                     amip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
671                     \textcolor{keywordflow}{if} (counting) \{
672                         amip->\hyperlink{structamii__mi_a15c24390709412f24da5e5207808712b}{count} = \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count};
673                         reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
674                     \textcolor{comment}{/*}
675 \textcolor{comment}{                     * This makes the assumption that }
676 \textcolor{comment}{                     * the string is in format "X - foo"}
677 \textcolor{comment}{                     * with additional selecting and formatting}
678 \textcolor{comment}{                     * data in front (size SOFF)}
679 \textcolor{comment}{                     */}
680                         amip->\hyperlink{structamii__mi_a31791a6dba8c361ec8c8d5776bb82593}{str}[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'#'};
681                     \} \textcolor{keywordflow}{else} \{
682                         amip->\hyperlink{structamii__mi_a15c24390709412f24da5e5207808712b}{count} = -1;
683                         amip->\hyperlink{structamii__mi_a31791a6dba8c361ec8c8d5776bb82593}{str}[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
684                     \}
685                     \}
686                 \}
687                 amip=amip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next};
688                 \}
689                 \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}(win, topidx);
690             \}
691             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code == \hyperlink{wintype_8h_a3a476dd165f2b9254ecc1ab3047238f8}{MENU\_UNSELECT\_ALL}) \{
692             \textcolor{keywordflow}{if} (how == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY}) \{
693                 amip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items};
694                 \textcolor{keywordflow}{while} (amip) \{
695                 \textcolor{keywordflow}{if} (amip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected}) \{
696                     amip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected} = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
697                     amip->\hyperlink{structamii__mi_a15c24390709412f24da5e5207808712b}{count} = -1;
698                     amip->\hyperlink{structamii__mi_a31791a6dba8c361ec8c8d5776bb82593}{str}[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
699                 \}
700                 amip=amip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next};
701                 \}
702                 \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}(win, topidx);
703             \}
704             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code == \hyperlink{wintype_8h_a7be1bf4583bee8feddb61ab15e634fd9}{MENU\_INVERT\_ALL}) \{
705             \textcolor{keywordflow}{if} (how == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY}) \{
706                 amip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items};
707                 \textcolor{keywordflow}{while} (amip) \{
708                 \textcolor{keywordflow}{if} (amip->\hyperlink{structamii__mi_a68250523fd29eae87c3a438284fab1c0}{canselect} && amip->\hyperlink{structamii__mi_a77084785d6d5815d0e006ad4ff6dd0b9}{selector}) \{
709                     amip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected} = !amip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected};
710                     \textcolor{keywordflow}{if} (counting && amip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected}) \{
711                     amip->\hyperlink{structamii__mi_a15c24390709412f24da5e5207808712b}{count} = \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count};
712                     amip->\hyperlink{structamii__mi_a31791a6dba8c361ec8c8d5776bb82593}{str}[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'#'};
713                     reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
714                     \} \textcolor{keywordflow}{else} \{
715                     amip->\hyperlink{structamii__mi_a15c24390709412f24da5e5207808712b}{count} = -1;
716                     amip->\hyperlink{structamii__mi_a31791a6dba8c361ec8c8d5776bb82593}{str}[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
717                     \}
718                 \}
719                 amip=amip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next};
720                 \}
721                 \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}(win, topidx);
722             \}
723             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code == \hyperlink{wintype_8h_a8ee870b720cd0aab7743ba83f8fb0a1b}{MENU\_SELECT\_PAGE}) \{
724             \textcolor{keywordflow}{if} (how == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY}) \{
725                 \textcolor{keywordtype}{int} i = 0;
726                 amip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items};
727                 \textcolor{keywordflow}{while} (amip && i++ < topidx)
728                 amip = amip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next};
729                 \textcolor{keywordflow}{for} (i=0;i < wheight && amip; i++, amip=amip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next}) \{
730                 \textcolor{keywordflow}{if} (amip->canselect && amip->selector) \{
731                     \textcolor{keywordflow}{if} (!amip->selected) \{
732                     \textcolor{keywordflow}{if} (counting) \{
733                         amip->\hyperlink{structamii__mi_a15c24390709412f24da5e5207808712b}{count} = \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count};
734                         reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
735                         amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'#'};
736                     \} \textcolor{keywordflow}{else} \{
737                         amip->count = -1;
738                         amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
739                     \}
740                     \}
741                     amip->selected = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
742                 \}
743                 \}
744                 \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}(win, topidx);
745             \}
746             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code == \hyperlink{wintype_8h_a18e91769b9181b3462efe03f534bd6e1}{MENU\_UNSELECT\_PAGE}) \{
747             \textcolor{keywordflow}{if} (how == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY}) \{
748                 \textcolor{keywordtype}{int} i = 0;
749                 amip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items};
750                 \textcolor{keywordflow}{while} (amip && i++ < topidx)
751                 amip = amip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next};
752                 \textcolor{keywordflow}{for} (i=0;i < wheight && amip; i++, amip=amip->next) \{
753                 \textcolor{keywordflow}{if} (amip->selected) \{
754                     amip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected} = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
755                     amip->count = -1;
756                     amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
757                 \}
758                 \}
759                 \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}(win, topidx);
760             \}
761             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code == \hyperlink{wintype_8h_ad3dbb023bb0ffc9ffdf822e36734cedc}{MENU\_INVERT\_PAGE}) \{
762             \textcolor{keywordflow}{if} (how == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY}) \{
763                 \textcolor{keywordtype}{int} i = 0;
764                 amip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items};
765                 \textcolor{keywordflow}{while} (amip && i++ < topidx)
766                 amip = amip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next};
767                 \textcolor{keywordflow}{for} (i=0;i < wheight && amip; i++, amip=amip->next) \{
768                 \textcolor{keywordflow}{if} (amip->canselect && amip->selector) \{
769                     amip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected} = !amip->selected;
770                     \textcolor{keywordflow}{if} (counting && amip->selected) \{
771                     amip->count = \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count};
772                     amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'#'};
773                     reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
774                     \} \textcolor{keywordflow}{else} \{
775                     amip->count = -1;
776                     amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
777                     \}
778                 \}
779                 \}
780                 \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}(win, topidx);
781             \}
782             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code == \hyperlink{wintype_8h_a1c3201f2628d34d0880a40dbb566f316}{MENU\_SEARCH} && cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == 
      \hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU}) \{
783             \textcolor{keywordflow}{if} (how == \hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} || how == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY}) \{
784                 \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
785                 amip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items};
786                 \hyperlink{winproto_8h_af10d73c7abbeacb1dbf7c63fd6f50fab}{amii\_getlin}(\textcolor{stringliteral}{"Search for:"}, buf);
787                 \textcolor{keywordflow}{if} (!*buf || *buf == \textcolor{charliteral}{'\(\backslash\)033'})
788                 \textcolor{keywordflow}{break};
789                 \textcolor{keywordflow}{while} (amip) \{
790                 \textcolor{keywordflow}{if} (amip->canselect && amip->selector && amip->str &&
791                     strstri(&amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}], buf)) \{
792                     \textcolor{keywordflow}{if} (how == \hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE}) \{
793                     amip->selected = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
794                     aredone = 1;
795                     \textcolor{keywordflow}{break};
796                     \}
797                     amip->selected = !amip->selected;
798                     \textcolor{keywordflow}{if} (counting && amip->selected) \{
799                     amip->count = \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count};
800                     reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
801                     amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'#'};
802                     \} \textcolor{keywordflow}{else} \{
803                     amip->count = -1;
804                     reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
805                     amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
806                     \}
807                 \}
808                 amip = amip->next;
809                 \}
810             \}
811             \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}(win, topidx);
812             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (how == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} && isdigit(code) &&
813                    (counting || (!counting && code !=\textcolor{charliteral}{'0'}))) \{
814             \textcolor{keywordflow}{if} (count < \hyperlink{global_8h_a7e80c139c01102183d2a57d61b5d2d8a}{LARGEST\_INT}) \{
815                 count = count*10 + (long)(code-\textcolor{charliteral}{'0'});
816                 \textcolor{keywordflow}{if} (count > \hyperlink{global_8h_a7e80c139c01102183d2a57d61b5d2d8a}{LARGEST\_INT})
817                 count = \hyperlink{global_8h_a7e80c139c01102183d2a57d61b5d2d8a}{LARGEST\_INT};
818                 \textcolor{keywordflow}{if} (count > 0) \{
819                 counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
820                 reset\_counting = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
821                 \} \textcolor{keywordflow}{else} \{
822                 reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
823                 \}
824                 sprintf(countString, \textcolor{stringliteral}{"Count: %d"}, count);
825                 pline(countString);
826             \}
827             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( code == \hyperlink{sys_2amiga_2winmenu_8c_ace6fa4719be9aafa2968680c5ef75ac5}{CTRL}(\textcolor{charliteral}{'D'}) || code == \hyperlink{sys_2amiga_2winmenu_8c_ace6fa4719be9aafa2968680c5ef75ac5}{CTRL}(\textcolor{charliteral}{'U'}) ||
828                    code == \hyperlink{wintype_8h_a38905328dea58bbf036f93b7b5a6a6ef}{MENU\_NEXT\_PAGE} || code == 
      \hyperlink{wintype_8h_a688fe5156d1b2c3cce5d71e50d62bfea}{MENU\_PREVIOUS\_PAGE} ||
829                    code == \hyperlink{wintype_8h_a3eed1da5a8a308f757ae0bc07dc185b3}{MENU\_FIRST\_PAGE} || code == 
      \hyperlink{wintype_8h_a0d14d3fa404cc391d604a8c990af0954}{MENU\_LAST\_PAGE} )
830             \{
831             \textcolor{keywordtype}{int} endcnt, i;
832 
833             \textcolor{keywordflow}{for}( gd = w->FirstGadget; gd && gd->GadgetID != 1; )
834                 gd = gd->NextGadget;
835 
836             \textcolor{keywordflow}{if}( !gd )
837                 \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Can't find scroll gadget"} );
838 
839             endcnt = wheight; \textcolor{comment}{/* /2; */}
840             \textcolor{keywordflow}{if}( endcnt == 0 )
841                 endcnt = 1;
842 
843             \textcolor{keywordflow}{if} (code == \hyperlink{wintype_8h_a3eed1da5a8a308f757ae0bc07dc185b3}{MENU\_FIRST\_PAGE}) \{
844                 topidx = 0;
845             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code == \hyperlink{wintype_8h_a0d14d3fa404cc391d604a8c990af0954}{MENU\_LAST\_PAGE}) \{
846                 topidx = cw->\hyperlink{structamii__WinDesc_a1ca7af4b595bf7bb077ed78546548670}{maxrow} - wheight;
847             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{for}( i = 0; i < endcnt; ++i )
848             \{
849                 \textcolor{keywordflow}{if} (code == \hyperlink{sys_2amiga_2winmenu_8c_ace6fa4719be9aafa2968680c5ef75ac5}{CTRL}(\textcolor{charliteral}{'D'}) || code == \hyperlink{wintype_8h_a38905328dea58bbf036f93b7b5a6a6ef}{MENU\_NEXT\_PAGE})
850                 \{
851                 \textcolor{keywordflow}{if}( topidx + wheight < cw->maxrow )
852                     ++topidx;
853                 \textcolor{keywordflow}{else}
854                     \textcolor{keywordflow}{break};
855                 \}
856                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (code = \hyperlink{sys_2amiga_2winmenu_8c_ace6fa4719be9aafa2968680c5ef75ac5}{CTRL}(\textcolor{charliteral}{'U'}) || code == \hyperlink{wintype_8h_a688fe5156d1b2c3cce5d71e50d62bfea}{MENU\_PREVIOUS\_PAGE})
857                 \{
858                 \textcolor{keywordflow}{if}( topidx > 0 )
859                     --topidx;
860                 \textcolor{keywordflow}{else}
861                     \textcolor{keywordflow}{break};
862                 \}
863             \}
864             \textcolor{comment}{/* Make prop gadget the right size and place */}
865 
866             \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}( win, topidx );
867             \hyperlink{sys_2amiga_2winmenu_8c_a28121fc0d5fc72d2292fa04d5bbf7d60}{SetPropInfo}( w,gd, wheight, totalvis, topidx );
868             oldsecs = oldmics = 0;
869             \}
870             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( code == \textcolor{charliteral}{'\(\backslash\)b'} )
871             \{
872             \textcolor{keywordflow}{for}( gd = w->FirstGadget; gd && gd->GadgetID != 1; )
873                 gd = gd->NextGadget;
874 
875             \textcolor{keywordflow}{if}( !gd )
876                 \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Can't find scroll gadget"} );
877 
878             \textcolor{keywordflow}{if}( topidx - wheight - 2 < 0 )
879             \{
880                 topidx = 0;
881             \}
882             \textcolor{keywordflow}{else}
883             \{
884                 topidx -= wheight - 2;
885             \}
886             \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}( win, topidx );
887             \hyperlink{sys_2amiga_2winmenu_8c_a28121fc0d5fc72d2292fa04d5bbf7d60}{SetPropInfo}( w, gd, wheight, totalvis, topidx );
888             oldsecs = oldmics = 0;
889             \}
890             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( code == \textcolor{charliteral}{' '} )
891             \{
892             \textcolor{keywordflow}{for}( gd = w->FirstGadget; gd && gd->GadgetID != 1; )
893                 gd = gd->NextGadget;
894 
895             \textcolor{keywordflow}{if}( !gd )
896                 \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Can't find scroll gadget"} );
897 
898             \textcolor{keywordflow}{if}( topidx + wheight >= cw->\hyperlink{structamii__WinDesc_a1ca7af4b595bf7bb077ed78546548670}{maxrow} )
899             \{
900                 \hyperlink{winami_8h_aba452ddfcafb21205b4a07d22dabc398}{morc} = 0;
901                 aredone = 1;
902             \}
903             \textcolor{keywordflow}{else}
904             \{
905                 \textcolor{comment}{/*  If there are still lines to be seen */}
906 
907                 \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_a1ca7af4b595bf7bb077ed78546548670}{maxrow} > topidx + wheight )
908                 \{
909                 \textcolor{keywordflow}{if}( wheight > 2 )
910                     topidx += wheight - 2;
911                 \textcolor{keywordflow}{else}
912                     ++topidx;
913                 \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}( win, topidx );
914                 \hyperlink{sys_2amiga_2winmenu_8c_a28121fc0d5fc72d2292fa04d5bbf7d60}{SetPropInfo}( w, gd, wheight,
915                             totalvis, topidx );
916                 \}
917                 oldsecs = oldmics = 0;
918             \}
919             \}
920             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( code == \textcolor{charliteral}{'\(\backslash\)n'} || code == \textcolor{charliteral}{'\(\backslash\)r'} )
921             \{
922             \textcolor{keywordflow}{for}( gd = w->FirstGadget; gd && gd->GadgetID != 1; )
923                 gd = gd->NextGadget;
924 
925             \textcolor{keywordflow}{if}( !gd )
926                 \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Can't find scroll gadget"} );
927 
928             \textcolor{comment}{/* If all line displayed, we are done */}
929 
930             \textcolor{keywordflow}{if}( topidx + wheight >= cw->\hyperlink{structamii__WinDesc_a1ca7af4b595bf7bb077ed78546548670}{maxrow} )
931             \{
932                 \hyperlink{winami_8h_aba452ddfcafb21205b4a07d22dabc398}{morc} = 0;
933                 aredone = 1;
934             \}
935             \textcolor{keywordflow}{else}
936             \{
937                 \textcolor{comment}{/*  If there are still lines to be seen */}
938 
939                 \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_a1ca7af4b595bf7bb077ed78546548670}{maxrow} > topidx + 1 )
940                 \{
941                 ++topidx;
942                 \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}( win, topidx );
943                 \hyperlink{sys_2amiga_2winmenu_8c_a28121fc0d5fc72d2292fa04d5bbf7d60}{SetPropInfo}( w, gd, wheight,
944                             totalvis, topidx );
945                 \}
946                 oldsecs = oldmics = 0;
947             \}
948             \}
949             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( code == \textcolor{stringliteral}{'\(\backslash\)33'} )
950             \{
951             \textcolor{keywordflow}{if} (counting) \{
952                 reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
953             \} \textcolor{keywordflow}{else} \{
954                 aredone = 1;
955             \}
956             \}
957             \textcolor{keywordflow}{else}
958             \{
959             \textcolor{keywordtype}{int} selected = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
960             \textcolor{keywordflow}{for}( amip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items}; amip; amip = amip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next} )
961             \{
962                 \textcolor{keywordflow}{if}( amip->selector == code )
963                 \{
964                 \textcolor{keywordflow}{if}( how == \hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} )
965                     aredone = 1;
966                 amip->selected = !amip->selected;
967                 \textcolor{keywordflow}{if} (counting && amip->selected) \{
968                     amip->count = \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count};
969                     reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
970                     amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'#'};
971                 \} \textcolor{keywordflow}{else} \{
972                     amip->count = -1;
973                     reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
974                     amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
975                 \}
976                 selected = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
977                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (amip->gselector == code )
978                 \{
979                 amip->selected = !amip->selected;
980                 \textcolor{keywordflow}{if} (counting) \{
981                     amip->count = \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count};
982                     reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
983                     amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'#'};
984                 \} \textcolor{keywordflow}{else} \{
985                     amip->count = -1;
986                     reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
987                     amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
988                 \}
989                 selected = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
990                 \}
991             \}
992             \textcolor{keywordflow}{if} (selected)
993                 \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}( win, topidx );
994             \}
995             \textcolor{keywordflow}{break};
996 
997         \textcolor{keywordflow}{case} CLOSEWINDOW:
998             \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
999             \{
1000             lastinvent.MinX = w->LeftEdge;
1001             lastinvent.MinY = w->TopEdge;
1002             lastinvent.MaxX = w->Width;
1003             lastinvent.MaxY = w->Height;
1004             \}
1005             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_a4a1cc9e693dbdfad3ea32b10ce19f337}{WIN\_MESSAGE} )
1006             \{
1007             \hyperlink{winext_8h_a15fb087f5b07d7dbc0f859370ebe6151}{lastmsg}.MinX = w->LeftEdge;
1008             \hyperlink{winext_8h_a15fb087f5b07d7dbc0f859370ebe6151}{lastmsg}.MinY = w->TopEdge;
1009             \hyperlink{winext_8h_a15fb087f5b07d7dbc0f859370ebe6151}{lastmsg}.MaxX = w->Width;
1010             \hyperlink{winext_8h_a15fb087f5b07d7dbc0f859370ebe6151}{lastmsg}.MaxY = w->Height;
1011             \}
1012             aredone = 1;
1013             \hyperlink{winami_8h_aba452ddfcafb21205b4a07d22dabc398}{morc} = \textcolor{stringliteral}{'\(\backslash\)33'};
1014             \textcolor{keywordflow}{break};
1015 
1016         \textcolor{keywordflow}{case} GADGETUP:
1017             \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_a4a1cc9e693dbdfad3ea32b10ce19f337}{WIN\_MESSAGE} )
1018             aredone = 1;
1019             \textcolor{keywordflow}{for}( gd = w->FirstGadget; gd && gd->GadgetID != 1; )
1020             gd = gd->NextGadget;
1021 
1022             pip = (\textcolor{keyword}{struct }PropInfo *)gd->SpecialInfo;
1023             totalvis = \hyperlink{sys_2amiga_2winmenu_8c_aab1d3a28e3b2dd6770eae7e837fa27dd}{CountLines}( win );
1024             hidden = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}( totalvis - wheight, 0 );
1025             aidx = (((\hyperlink{def__os2_8h_af632da489ebc3708ec3ab6791ee53fa4}{ULONG})hidden * pip->VertPot) + (MAXPOT/2)) >> 16;
1026             \textcolor{keywordflow}{if}( aidx != topidx )
1027             \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}( win, topidx = aidx );
1028             \textcolor{keywordflow}{break};
1029 
1030         \textcolor{keywordflow}{case} MOUSEMOVE:
1031             \textcolor{keywordflow}{for}( gd = w->FirstGadget; gd && gd->GadgetID != 1; )
1032             gd = gd->NextGadget;
1033 
1034             pip = (\textcolor{keyword}{struct }PropInfo *)gd->SpecialInfo;
1035             totalvis = \hyperlink{sys_2amiga_2winmenu_8c_aab1d3a28e3b2dd6770eae7e837fa27dd}{CountLines}( win );
1036             hidden = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}( totalvis - wheight, 0 );
1037             aidx = (((\hyperlink{def__os2_8h_af632da489ebc3708ec3ab6791ee53fa4}{ULONG})hidden * pip->VertPot) + (MAXPOT/2)) >> 16;
1038             \textcolor{keywordflow}{if}( aidx != topidx )
1039             \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}( win, topidx = aidx );
1040             \textcolor{keywordflow}{break};
1041 
1042         \textcolor{keywordflow}{case} INACTIVEWINDOW:
1043             \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_a4a1cc9e693dbdfad3ea32b10ce19f337}{WIN\_MESSAGE} || ( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} && 
      \hyperlink{winext_8h_a5f7057e3372d8abeddf1df4f99752979}{alwaysinvent} ) )
1044             aredone = 1;
1045             \textcolor{keywordflow}{break};
1046 
1047         \textcolor{keywordflow}{case} MOUSEBUTTONS:
1048             \textcolor{keywordflow}{if}( ( code == SELECTUP || code == SELECTDOWN ) &&
1049                     cw->\hyperlink{structamii__WinDesc_ab90130f7f09b474842877b2f71d708e0}{type} == \hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU} && how != \hyperlink{wintype_8h_a9e3d317126c3eacb6311e15fedaf717c}{PICK\_NONE} )
1050             \{
1051             \textcolor{comment}{/* Which one is the mouse pointing at? */}
1052 
1053             aidx = ( ( my - w->BorderTop - 1 ) / txh ) + topidx;
1054 
1055             \textcolor{comment}{/* If different lines, don't select double click */}
1056 
1057             \textcolor{keywordflow}{if}( aidx != oidx )
1058             \{
1059                 oldsecs = 0;
1060                 oldmics = 0;
1061             \}
1062 
1063             \textcolor{comment}{/* If releasing, check for double click */}
1064 
1065             \textcolor{keywordflow}{if}( code == SELECTUP )
1066             \{
1067                 amip = \hyperlink{sys_2amiga_2winmenu_8c_aa4cfb2336bbe67a2a34667bacfd6fd8b}{find\_menu\_item}( cw, aidx );
1068                 \textcolor{keywordflow}{if}( aidx == oidx )
1069                 \{
1070                 \textcolor{keywordflow}{if}( DoubleClick( oldsecs,
1071                             oldmics, secs, mics ) )
1072                 \{
1073                     aredone = 1;
1074                 \}
1075                 oldsecs = secs;
1076                 oldmics = mics;
1077                 \}
1078                 \textcolor{keywordflow}{else}
1079                 \{
1080                 amip = \hyperlink{sys_2amiga_2winmenu_8c_aa4cfb2336bbe67a2a34667bacfd6fd8b}{find\_menu\_item}( cw, oidx );
1081                 amip->selected = 0;
1082                 amip->count = -1;
1083                 reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1084                 \textcolor{keywordflow}{if} (amip->canselect && amip->selector)
1085                     amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
1086                 \}
1087                 \textcolor{keywordflow}{if} (counting && amip->selected && amip->canselect && amip->selector) \{
1088                 amip->count = \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count};
1089                 reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1090                 amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'#'};
1091                 \}
1092                 \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}( win, topidx );
1093             \}
1094             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( aidx - topidx < wheight &&
1095                 aidx < cw->maxrow && code == SELECTDOWN )
1096             \{
1097                 \textcolor{comment}{/* Remove old highlighting if visible */}
1098 
1099                 amip = \hyperlink{sys_2amiga_2winmenu_8c_aa4cfb2336bbe67a2a34667bacfd6fd8b}{find\_menu\_item}( cw, oidx );
1100                 \textcolor{keywordflow}{if}( amip && oidx != aidx &&
1101                     ( oidx > topidx && oidx - topidx < wheight ) )
1102                 \{
1103                 \textcolor{keywordflow}{if}( how != \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
1104                     amip->selected = 0;
1105                     amip->count = -1;
1106                     reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1107                     \textcolor{keywordflow}{if} (amip->canselect && amip->selector)
1108                     amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
1109                 \}
1110                 oidx = -1;
1111                 \}
1112                 amip = \hyperlink{sys_2amiga_2winmenu_8c_aa4cfb2336bbe67a2a34667bacfd6fd8b}{find\_menu\_item}( cw, aidx );
1113 
1114                 \textcolor{keywordflow}{if}( amip && amip->canselect && amip->selector && how != 
      \hyperlink{wintype_8h_a9e3d317126c3eacb6311e15fedaf717c}{PICK\_NONE} )
1115                 \{
1116                 oidx = aidx;
1117                 \textcolor{keywordflow}{if}( !DoubleClick( oldsecs,
1118                             oldmics, secs, mics ) )
1119                 \{
1120                     amip->selected = !amip->selected;
1121                     \textcolor{keywordflow}{if} (counting && amip->selected) \{
1122                     amip->count = \hyperlink{wingem1_8c_a66e3fedede6aa372e5196e55e5e8d5c1}{count};
1123                     reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1124                     amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'#'};
1125                     \} \textcolor{keywordflow}{else} \{
1126                     amip->count = -1;
1127                     reset\_counting = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1128                     \textcolor{keywordflow}{if} (amip->canselect && amip->selector)
1129                         amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
1130                     \}
1131                 \}
1132                 \}
1133                 \textcolor{keywordflow}{else}
1134                 \{
1135                 DisplayBeep( \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} );
1136                 oldsecs = 0;
1137                 oldmics = 0;
1138                 \}
1139                 \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}( win, topidx );
1140             \}
1141             \}
1142             \textcolor{keywordflow}{else}
1143             \{
1144             DisplayBeep( \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} );
1145             \}
1146             \textcolor{keywordflow}{break};
1147         \}
1148         \textcolor{keywordflow}{if} (!counting && \hyperlink{winami_8h_aba452ddfcafb21205b4a07d22dabc398}{morc} == \textcolor{stringliteral}{'\(\backslash\)33'}) \{
1149         amip = cw->\hyperlink{structamii__WinDesc_aeffe06ac39ddf1ea949990646a1bbf0d}{menu}.\hyperlink{structamii__menu_a01d8d53511bbcb518c8c721c42a1168d}{items};
1150         \textcolor{keywordflow}{while} (amip) \{
1151             \textcolor{keywordflow}{if} (amip->canselect && amip->selector) \{
1152             amip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected} = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1153             amip->count = -1;
1154             amip->str[\hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF}+2] = \textcolor{charliteral}{'-'};
1155             \}
1156             amip=amip->next;
1157         \}
1158         \}
1159         \textcolor{keywordflow}{if} (reset\_counting) \{
1160         count = 0;
1161         \textcolor{keywordflow}{if} (counting)
1162             pline(\textcolor{stringliteral}{"Count: 0"});
1163         counting = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1164         \}
1165     \}
1166     \}
1167     \textcolor{comment}{/* Force a cursor reposition before next message output */}
1168     \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_a4a1cc9e693dbdfad3ea32b10ce19f337}{WIN\_MESSAGE} )
1169     cw->\hyperlink{structamii__WinDesc_a4ae862475cf0a2f6aed98394d3ac12bd}{curx} = -1;
1170     \textcolor{keywordflow}{return}( \hyperlink{sys_2amiga_2winmenu_8c_a9193caef076cb9de1fc1d4a77c34b869}{make\_menu\_items}( cw, retmip ) );
1171 \}
\end{DoxyCode}
\hypertarget{sys_2amiga_2winmenu_8c_aa4cfb2336bbe67a2a34667bacfd6fd8b}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!find\+\_\+menu\+\_\+item@{find\+\_\+menu\+\_\+item}}
\index{find\+\_\+menu\+\_\+item@{find\+\_\+menu\+\_\+item}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{find\+\_\+menu\+\_\+item}]{\setlength{\rightskip}{0pt plus 5cm}{\bf amii\+\_\+menu\+\_\+item}$\ast$ find\+\_\+menu\+\_\+item (
\begin{DoxyParamCaption}
\item[{{\bf register} struct {\bf amii\+\_\+\+Win\+Desc} $\ast$}]{cw, }
\item[{int}]{idx}
\end{DoxyParamCaption}
)}}\label{sys_2amiga_2winmenu_8c_aa4cfb2336bbe67a2a34667bacfd6fd8b}


Definition at line 194 of file winmenu.\+c.



References amii\+\_\+menu\+::items, amii\+\_\+\+Win\+Desc\+::menu, and amii\+\_\+mi\+::next.



Referenced by Do\+Menu\+Scroll().


\begin{DoxyCode}
195 \{
196     \hyperlink{structamii__mi}{amii\_menu\_item} *mip;
197     \textcolor{keywordflow}{for}( mip = cw->menu.items; idx > 0 && mip; mip = mip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next} )
198     --idx;
199 
200     \textcolor{keywordflow}{return}( mip );
201 \}
\end{DoxyCode}
\hypertarget{sys_2amiga_2winmenu_8c_a5c10fb452bdd53064eb14c3f1a270b62}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!Find\+Line@{Find\+Line}}
\index{Find\+Line@{Find\+Line}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{Find\+Line}]{\setlength{\rightskip}{0pt plus 5cm}long Find\+Line (
\begin{DoxyParamCaption}
\item[{{\bf winid}}]{win, }
\item[{int}]{line}
\end{DoxyParamCaption}
)}}\label{sys_2amiga_2winmenu_8c_a5c10fb452bdd53064eb14c3f1a270b62}


Definition at line 1204 of file winmenu.\+c.



References amii\+\_\+wins, amii\+\_\+\+Win\+Desc\+::cols, amii\+\_\+\+Win\+Desc\+::data, amii\+\_\+\+Win\+Desc\+::maxrow, panic(), pictdata, S\+O\+F\+F, amii\+\_\+\+Win\+Desc\+::win, W\+I\+N\+\_\+\+E\+R\+R, W\+I\+N\+\_\+\+I\+N\+V\+E\+N, winpanicstr, W\+I\+N\+V\+E\+R\+S\+\_\+\+A\+M\+I\+V, and P\+D\+A\+T\+::xsize.



Referenced by Display\+Data().


\begin{DoxyCode}
1207 \{
1208     \textcolor{keywordtype}{int} txwd;
1209     \textcolor{keyword}{register} \textcolor{keywordtype}{char} *t;
1210     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structamii__WinDesc}{amii\_WinDesc} *cw;
1211     \textcolor{keyword}{register} \textcolor{keyword}{struct }Window *w;
1212     \textcolor{keyword}{register} \textcolor{keywordtype}{int} i, disprow, len;
1213     \textcolor{keywordtype}{int} col = -1;
1214 
1215     \textcolor{keywordflow}{if}( win == \hyperlink{wintype_8h_a56d1f4f2e517a4e81be0b7593e35e681}{WIN\_ERR} || !(cw = \hyperlink{winami_8h_a84358fe75628f255a0687acb6e8499de}{amii\_wins}[win]) || !( w = cw->
      \hyperlink{structamii__WinDesc_a9835faa4d66643cd889203e26edee8ae}{win} ) )
1216     \{
1217     \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}( \hyperlink{winext_8h_a4264157ee8930111caf21b62c212e08c}{winpanicstr}, win, \textcolor{stringliteral}{"No Window in FindLine"} );
1218     \}
1219     txwd = w->RPort->TxWidth;
1220     \textcolor{keywordflow}{if}( \hyperlink{windefs_8h_aa0b90aaeb74b2488a95f0902cef09cbf}{WINVERS\_AMIV} )
1221     \{
1222     \textcolor{keywordflow}{if}( win == \hyperlink{decl_8h_aabd3637304d093f7077c788661a0a5fd}{WIN\_INVEN} )
1223     \{
1224         cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft -
1225             w->BorderRight - 4 - \hyperlink{winchar_8c_a00763f280fa207a0cf085c6d52246c8c}{pictdata}.\hyperlink{structPDAT_a957fade03cbfb4ce4de9df4e09be7fc7}{xsize} - 3) / txwd;
1226     \}
1227     \textcolor{keywordflow}{else}
1228         cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft - w->BorderRight - 4 ) / txwd;
1229     \}
1230     \textcolor{keywordflow}{else}
1231     \{
1232     cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} = ( w->Width - w->BorderLeft - w->BorderRight - 4 ) / txwd;
1233     \}
1234 
1235     disprow = 0;
1236     \textcolor{keywordflow}{for}( col = i = 0; line > disprow && i < cw->\hyperlink{structamii__WinDesc_a1ca7af4b595bf7bb077ed78546548670}{maxrow}; ++i )
1237     \{
1238     t = cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[ i ] + \hyperlink{windefs_8h_a18a002ccef5ceab145570860644dfc74}{SOFF};
1239     \textcolor{keywordflow}{if}( cw->\hyperlink{structamii__WinDesc_a1be96ba5842aef93cb36e73173277ad6}{data}[i][1] >= 0 )
1240     \{
1241         ++disprow;
1242         col = 0;
1243     \}
1244 
1245     \textcolor{keywordflow}{while}( *t )
1246     \{
1247         len = strlen( t );
1248         \textcolor{keywordflow}{if}( col + len > cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} )
1249         len = cw->\hyperlink{structamii__WinDesc_a8ef9da0197015f48920307f3692f2a54}{cols} - col;
1250         \textcolor{keywordflow}{while}( len > 0 )
1251         \{
1252             \textcolor{keywordflow}{if}( !t[len] || t[len] == \textcolor{charliteral}{' '} )
1253             \textcolor{keywordflow}{break};
1254             --len;
1255         \}
1256         \textcolor{keywordflow}{if}( len == 0 ) \{
1257         \textcolor{keywordflow}{while} ( *t && *t != \textcolor{charliteral}{' '}) \{
1258             t++; col++;
1259         \}
1260         \} \textcolor{keywordflow}{else} \{
1261         t += len;
1262         col += len;
1263         \}
1264         \textcolor{keywordflow}{if}( *t )
1265         \{
1266         \textcolor{keywordflow}{while}( *t == \textcolor{charliteral}{' '} )
1267             ++t;
1268         col = 0;
1269         ++disprow;
1270         \}
1271     \}
1272     \}
1273     \textcolor{keywordflow}{return}( i );
1274 \}
\end{DoxyCode}
\hypertarget{sys_2amiga_2winmenu_8c_a9193caef076cb9de1fc1d4a77c34b869}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!make\+\_\+menu\+\_\+items@{make\+\_\+menu\+\_\+items}}
\index{make\+\_\+menu\+\_\+items@{make\+\_\+menu\+\_\+items}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{make\+\_\+menu\+\_\+items}]{\setlength{\rightskip}{0pt plus 5cm}int make\+\_\+menu\+\_\+items (
\begin{DoxyParamCaption}
\item[{{\bf register} struct {\bf amii\+\_\+\+Win\+Desc} $\ast$}]{cw, }
\item[{{\bf register} {\bf menu\+\_\+item} $\ast$$\ast$}]{rmip}
\end{DoxyParamCaption}
)}}\label{sys_2amiga_2winmenu_8c_a9193caef076cb9de1fc1d4a77c34b869}


Definition at line 204 of file winmenu.\+c.



References alloc(), amii\+\_\+mi\+::count, mi\+::count, amii\+\_\+mi\+::identifier, mi\+::item, amii\+\_\+menu\+::items, amii\+\_\+\+Win\+Desc\+::menu, amii\+\_\+\+Win\+Desc\+::mi, amii\+\_\+mi\+::next, and amii\+\_\+mi\+::selected.



Referenced by Do\+Menu\+Scroll().


\begin{DoxyCode}
205 \{
206     \textcolor{keyword}{register} \textcolor{keywordtype}{int} idx = 0;
207     \textcolor{keyword}{register} \hyperlink{structamii__mi}{amii\_menu\_item} *mip;
208     \textcolor{keyword}{register} \hyperlink{structmi}{menu\_item} *mmip;
209 
210     \textcolor{keywordflow}{for}( mip = cw->menu.items; mip; mip = mip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next} )
211     \{
212     \textcolor{keywordflow}{if}( mip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected} )
213         ++idx;
214     \}
215 
216     \textcolor{keywordflow}{if}( idx )
217     \{
218     mmip = *rmip = (\hyperlink{structmi}{menu\_item} *)\hyperlink{txt2iff_8c_ae273cbdce4cd64a076220ad06c41a5a1}{alloc}( idx * \textcolor{keyword}{sizeof}( *mip ) );
219     \textcolor{keywordflow}{for}( mip = cw->menu.items; mip; mip = mip->\hyperlink{structamii__mi_a2046365b8a73513492596c98a5d30452}{next} )
220     \{
221         \textcolor{keywordflow}{if}( mip->\hyperlink{structamii__mi_a47a93b904054888bb7a94309a192f01a}{selected} )
222         \{
223         mmip->\hyperlink{structmi_a24f26cd1b01d3cf3ed16b1fd020d3a08}{item} = mip->\hyperlink{structamii__mi_ad856ed93a149eeb875438a1870a556fe}{identifier};
224         mmip->\hyperlink{structmi_a008e5c33aa571223ec592e0725c5fb73}{count} = mip->\hyperlink{structamii__mi_a15c24390709412f24da5e5207808712b}{count};
225         mmip++;
226         \}
227     \}
228 
229     cw->mi = *rmip;
230     \}
231     \textcolor{keywordflow}{return}( idx );
232 \}
\end{DoxyCode}
\hypertarget{sys_2amiga_2winmenu_8c_a0d631bd0422a752b9471cd23834a863d}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!Re\+Display\+Data@{Re\+Display\+Data}}
\index{Re\+Display\+Data@{Re\+Display\+Data}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{Re\+Display\+Data}]{\setlength{\rightskip}{0pt plus 5cm}void Re\+Display\+Data (
\begin{DoxyParamCaption}
\item[{{\bf winid}}]{win}
\end{DoxyParamCaption}
)}}\label{sys_2amiga_2winmenu_8c_a0d631bd0422a752b9471cd23834a863d}


Definition at line 1174 of file winmenu.\+c.



References amii\+\_\+wins, clear\+\_\+nhwindow, Count\+Lines(), Display\+Data(), max, amii\+\_\+\+Win\+Desc\+::win, and W\+I\+N\+\_\+\+E\+R\+R.


\begin{DoxyCode}
1176 \{
1177     \textcolor{keywordtype}{int} totalvis;
1178     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structamii__WinDesc}{amii\_WinDesc} *cw;
1179     \textcolor{keyword}{register} \textcolor{keyword}{struct }Window *w;
1180     \textcolor{keyword}{register} \textcolor{keyword}{struct }Gadget *gd;
1181     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{long} hidden, aidx, wheight;
1182     \textcolor{keyword}{struct }PropInfo *pip;
1183     
1184     \textcolor{keywordflow}{if}( win == \hyperlink{wintype_8h_a56d1f4f2e517a4e81be0b7593e35e681}{WIN\_ERR} || !(cw = \hyperlink{winami_8h_a84358fe75628f255a0687acb6e8499de}{amii\_wins}[win]) || !( w = cw->
      \hyperlink{structamii__WinDesc_a9835faa4d66643cd889203e26edee8ae}{win} ) )
1185     \textcolor{keywordflow}{return};
1186 
1187     \textcolor{keywordflow}{for}( gd = w->FirstGadget; gd && gd->GadgetID != 1; )
1188     gd = gd->NextGadget;
1189 
1190     \textcolor{keywordflow}{if}( !gd )
1191     \textcolor{keywordflow}{return};
1192 
1193     wheight = (w->Height - w->BorderTop - w->BorderBottom-2)/w->RPort->TxHeight;
1194 
1195     pip = (\textcolor{keyword}{struct} PropInfo *)gd->SpecialInfo;
1196     totalvis = \hyperlink{sys_2amiga_2winmenu_8c_aab1d3a28e3b2dd6770eae7e837fa27dd}{CountLines}( win );
1197     hidden = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}( totalvis - wheight, 0 );
1198     aidx = (((\hyperlink{def__os2_8h_af632da489ebc3708ec3ab6791ee53fa4}{ULONG})hidden * pip->VertPot) + (MAXPOT/2)) >> 16;
1199     \hyperlink{winprocs_8h_a177c23e23d7dafb484ad58f01ae1d063}{clear\_nhwindow}( win );
1200     \hyperlink{sys_2amiga_2winmenu_8c_a3b9f0aa6b0cb58acb709d87e44a3eb99}{DisplayData}( win, aidx );
1201 \}
\end{DoxyCode}
\hypertarget{sys_2amiga_2winmenu_8c_a28121fc0d5fc72d2292fa04d5bbf7d60}{\index{sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}!Set\+Prop\+Info@{Set\+Prop\+Info}}
\index{Set\+Prop\+Info@{Set\+Prop\+Info}!sys/amiga/winmenu.\+c@{sys/amiga/winmenu.\+c}}
\subsubsection[{Set\+Prop\+Info}]{\setlength{\rightskip}{0pt plus 5cm}void Set\+Prop\+Info (
\begin{DoxyParamCaption}
\item[{struct Window $\ast$}]{win, }
\item[{struct Gadget $\ast$}]{gad, }
\item[{long}]{vis, }
\item[{long}]{total, }
\item[{long}]{top}
\end{DoxyParamCaption}
)}}\label{sys_2amiga_2winmenu_8c_a28121fc0d5fc72d2292fa04d5bbf7d60}


Definition at line 1558 of file winmenu.\+c.



References max, and N\+U\+L\+L.



Referenced by amii\+\_\+doprev\+\_\+message(), amii\+\_\+putstr(), and Do\+Menu\+Scroll().


\begin{DoxyCode}
1562 \{
1563     \textcolor{keywordtype}{long} mflags;
1564     \textcolor{keyword}{register} \textcolor{keywordtype}{long} hidden;
1565     \textcolor{keyword}{register} \textcolor{keywordtype}{int} body, pot;
1566 
1567     hidden = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}( total-vis, 0 );
1568 
1569     \textcolor{comment}{/* Force the last section to be just to the bottom */}
1570 
1571     \textcolor{keywordflow}{if}( top > hidden )
1572     top = hidden;
1573 
1574     \textcolor{comment}{/* Scale the body position. */}
1575     \textcolor{comment}{/* 2 lines overlap */}
1576 
1577     \textcolor{keywordflow}{if}( hidden > 0 && total > 2)
1578     body = (\hyperlink{def__os2_8h_af632da489ebc3708ec3ab6791ee53fa4}{ULONG}) ((vis - 2) * MAXBODY) / (total - 2);
1579     \textcolor{keywordflow}{else}
1580     body = MAXBODY;
1581 
1582     \textcolor{keywordflow}{if}( hidden > 0 )
1583     pot = (\hyperlink{def__os2_8h_af632da489ebc3708ec3ab6791ee53fa4}{ULONG}) (top * MAXPOT) / hidden;
1584     \textcolor{keywordflow}{else}
1585     pot = 0;
1586 
1587     mflags = AUTOKNOB|FREEVERT;
1588 \textcolor{preprocessor}{#ifdef  INTUI\_NEW\_LOOK}
1589     \textcolor{keywordflow}{if}( IntuitionBase->LibNode.lib\_Version >= 37 )
1590     \{
1591     mflags |= PROPNEWLOOK;
1592     \}
1593 \textcolor{preprocessor}{#endif}
1594 
1595     NewModifyProp( gad, win, \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL},
1596                 mflags, 0, pot, MAXBODY, body, 1 );
1597 \}
\end{DoxyCode}
