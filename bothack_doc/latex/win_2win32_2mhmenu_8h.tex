\hypertarget{win_2win32_2mhmenu_8h}{\section{nethack/win/win32/mhmenu.h File Reference}
\label{win_2win32_2mhmenu_8h}\index{nethack/win/win32/mhmenu.\+h@{nethack/win/win32/mhmenu.\+h}}
}
{\ttfamily \#include \char`\"{}win\+M\+S.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}config.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}global.\+h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{win_2win32_2mhmenu_8h_ad863ba4d93ea3f9619d1f82c79c620e7}{M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+X\+T}~1
\item 
\#define \hyperlink{win_2win32_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U}~2
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
H\+W\+N\+D \hyperlink{win_2win32_2mhmenu_8h_a8c5ddcafb43564d6bbc9a6a422974797}{mswin\+\_\+init\+\_\+menu\+\_\+window} (int \hyperlink{lev__main_8c_ac765329451135abec74c45e1897abf26}{type})
\item 
int \hyperlink{win_2win32_2mhmenu_8h_af89f7711e723f70ac3af6b7fc82f63b1}{mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu} (H\+W\+N\+D hwnd, int how, \hyperlink{wintype_8h_a56b56557611b7f64f4e6585a1b78c8f9}{M\+E\+N\+U\+\_\+\+I\+T\+E\+M\+\_\+\+P} $\ast$$\ast$)
\item 
void \hyperlink{win_2win32_2mhmenu_8h_a93f677ba7b9a82155898c18af49cfc35}{mswin\+\_\+menu\+\_\+window\+\_\+size} (H\+W\+N\+D hwnd, L\+P\+S\+I\+Z\+E sz)
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{win_2win32_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{\index{win/win32/mhmenu.\+h@{win/win32/mhmenu.\+h}!M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U@{M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U}}
\index{M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U@{M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U}!win/win32/mhmenu.\+h@{win/win32/mhmenu.\+h}}
\subsubsection[{M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U~2}}\label{win_2win32_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}


Definition at line 12 of file mhmenu.\+h.

\hypertarget{win_2win32_2mhmenu_8h_ad863ba4d93ea3f9619d1f82c79c620e7}{\index{win/win32/mhmenu.\+h@{win/win32/mhmenu.\+h}!M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+X\+T@{M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+X\+T}}
\index{M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+X\+T@{M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+X\+T}!win/win32/mhmenu.\+h@{win/win32/mhmenu.\+h}}
\subsubsection[{M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+X\+T}]{\setlength{\rightskip}{0pt plus 5cm}\#define M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+T\+E\+X\+T~1}}\label{win_2win32_2mhmenu_8h_ad863ba4d93ea3f9619d1f82c79c620e7}


Definition at line 11 of file mhmenu.\+h.



\subsection{Function Documentation}
\hypertarget{win_2win32_2mhmenu_8h_a8c5ddcafb43564d6bbc9a6a422974797}{\index{win/win32/mhmenu.\+h@{win/win32/mhmenu.\+h}!mswin\+\_\+init\+\_\+menu\+\_\+window@{mswin\+\_\+init\+\_\+menu\+\_\+window}}
\index{mswin\+\_\+init\+\_\+menu\+\_\+window@{mswin\+\_\+init\+\_\+menu\+\_\+window}!win/win32/mhmenu.\+h@{win/win32/mhmenu.\+h}}
\subsubsection[{mswin\+\_\+init\+\_\+menu\+\_\+window}]{\setlength{\rightskip}{0pt plus 5cm}H\+W\+N\+D mswin\+\_\+init\+\_\+menu\+\_\+window (
\begin{DoxyParamCaption}
\item[{int}]{type}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhmenu_8h_a8c5ddcafb43564d6bbc9a6a422974797}


Definition at line 84 of file mhmenu.\+c.



References Create\+Dialog(), Get\+N\+H\+App(), I\+D\+D\+\_\+\+M\+E\+N\+U, Menu\+Wnd\+Proc(), panic(), and Set\+Menu\+Type().



Referenced by mswin\+\_\+putstr\+\_\+ex(), and mswin\+\_\+start\+\_\+menu().


\begin{DoxyCode}
84                                        \{
85     HWND ret;
86 
87     ret = \hyperlink{dialogs_8c_aaf356545a4c5797e317091864c988de0}{CreateDialog}(
88             \hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hApp,
89             MAKEINTRESOURCE(\hyperlink{sys_2wince_2resource_8h_a7a706fe51baa9204554045ed82ca2c9f}{IDD\_MENU}),
90             \hyperlink{sys_2wince_2winhack_8c_ad72c8d80c9fc01eaf07a3c2463ab88bd}{GetNHApp}()->hMainWnd,
91             \hyperlink{sys_2wince_2mhmenu_8c_a085082d0591741058c85b4ff41570488}{MenuWndProc}
92     );
93     \textcolor{keywordflow}{if}( !ret ) \{
94         \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Cannot create menu window"});
95     \}
96     
97     \hyperlink{sys_2wince_2mhmenu_8c_a9a4ac79f4c285b52ae25582c25beb82d}{SetMenuType}(ret, \hyperlink{lev__main_8c_ac765329451135abec74c45e1897abf26}{type});
98     \textcolor{keywordflow}{return} ret;
99 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8h_af89f7711e723f70ac3af6b7fc82f63b1}{\index{win/win32/mhmenu.\+h@{win/win32/mhmenu.\+h}!mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu@{mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu}}
\index{mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu@{mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu}!win/win32/mhmenu.\+h@{win/win32/mhmenu.\+h}}
\subsubsection[{mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu}]{\setlength{\rightskip}{0pt plus 5cm}int mswin\+\_\+menu\+\_\+window\+\_\+select\+\_\+menu (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{hwnd, }
\item[{int}]{how, }
\item[{{\bf M\+E\+N\+U\+\_\+\+I\+T\+E\+M\+\_\+\+P} $\ast$$\ast$}]{}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhmenu_8h_af89f7711e723f70ac3af6b7fc82f63b1}


Definition at line 102 of file mhmenu.\+c.



References assert, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::done, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::how, malloc(), mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::menu, M\+E\+N\+U\+\_\+\+F\+I\+R\+S\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+I\+N\+V\+E\+R\+T\+\_\+\+A\+L\+L, M\+E\+N\+U\+\_\+\+I\+N\+V\+E\+R\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+I\+T\+E\+M\+\_\+\+P, M\+E\+N\+U\+\_\+\+L\+A\+S\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+N\+E\+X\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+P\+R\+E\+V\+I\+O\+U\+S\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+S\+E\+A\+R\+C\+H, M\+E\+N\+U\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+A\+L\+L, M\+E\+N\+U\+\_\+\+S\+E\+L\+E\+C\+T\+\_\+\+P\+A\+G\+E, M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U, M\+E\+N\+U\+\_\+\+U\+N\+S\+E\+L\+E\+C\+T\+\_\+\+A\+L\+L, M\+E\+N\+U\+\_\+\+U\+N\+S\+E\+L\+E\+C\+T\+\_\+\+P\+A\+G\+E, mswin\+\_\+popup\+\_\+destroy(), mswin\+\_\+popup\+\_\+display(), N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+A\+B\+L\+E, N\+H\+M\+E\+N\+U\+\_\+\+I\+S\+\_\+\+S\+E\+L\+E\+C\+T\+E\+D, N\+U\+L\+L, panic(), P\+I\+C\+K\+\_\+\+A\+N\+Y, P\+I\+C\+K\+\_\+\+N\+O\+N\+E, P\+I\+C\+K\+\_\+\+O\+N\+E, reset\+\_\+menu\+\_\+count(), mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::result, Set\+Menu\+List\+Type(), and mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::type.



Referenced by mswin\+\_\+display\+\_\+nhwindow(), and mswin\+\_\+select\+\_\+menu().


\begin{DoxyCode}
103 \{
104     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
105     \textcolor{keywordtype}{int} ret\_val;
106     \hyperlink{wintype_8h_a56b56557611b7f64f4e6585a1b78c8f9}{MENU\_ITEM\_P} *selected = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
107     \textcolor{keywordtype}{int} i;
108     \textcolor{keywordtype}{char}* ap;
109     \textcolor{keywordtype}{char} accell\_str[256];
110 
111     \hyperlink{assert_8h_a6f56363b38edbe2c8f3f447f891ee2c0}{assert}( \_selected!=\hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL} );
112     *\_selected = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
113     ret\_val = -1;
114 
115     data = (\hyperlink{sys_2wince_2mhmenu_8c_a8dfb3f69fcbf57a3843c996afc7410df}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
116 
117     \textcolor{comment}{/* set menu type */}
118     \hyperlink{sys_2wince_2mhmenu_8c_a9935a9b932fd4f54e94b72e7cd0dee54}{SetMenuListType}(hWnd, how);
119 
120     \textcolor{comment}{/* Ok, now give items a unique accelerators */}
121     ZeroMemory(accell\_str, \textcolor{keyword}{sizeof}(accell\_str));
122     ap = accell\_str;
123 
124 \textcolor{preprocessor}{#if defined(WIN\_CE\_SMARTPHONE)}
125     \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size>10 ) \{
126         *ap++ = \hyperlink{wintype_8h_a3eed1da5a8a308f757ae0bc07dc185b3}{MENU\_FIRST\_PAGE};
127         *ap++ = \hyperlink{wintype_8h_a0d14d3fa404cc391d604a8c990af0954}{MENU\_LAST\_PAGE};
128         *ap++ = \hyperlink{wintype_8h_a38905328dea58bbf036f93b7b5a6a6ef}{MENU\_NEXT\_PAGE};
129         *ap++ = \hyperlink{wintype_8h_a688fe5156d1b2c3cce5d71e50d62bfea}{MENU\_PREVIOUS\_PAGE};
130         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} == \hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY} ) \{
131             *ap++ = \hyperlink{wintype_8h_a6c705d18a063df81d02997c09d14157f}{MENU\_SELECT\_ALL};
132             *ap++ = \hyperlink{wintype_8h_a3a476dd165f2b9254ecc1ab3047238f8}{MENU\_UNSELECT\_ALL};
133             *ap++ = \hyperlink{wintype_8h_a7be1bf4583bee8feddb61ab15e634fd9}{MENU\_INVERT\_ALL};
134             *ap++ = \hyperlink{wintype_8h_a8ee870b720cd0aab7743ba83f8fb0a1b}{MENU\_SELECT\_PAGE};
135             *ap++ = \hyperlink{wintype_8h_a18e91769b9181b3462efe03f534bd6e1}{MENU\_UNSELECT\_PAGE};
136             *ap++ = \hyperlink{wintype_8h_ad3dbb023bb0ffc9ffdf822e36734cedc}{MENU\_INVERT\_PAGE};
137         \}
138         *ap++ = \hyperlink{wintype_8h_a1c3201f2628d34d0880a40dbb566f316}{MENU\_SEARCH};
139     \}
140 \textcolor{preprocessor}{#endif}
141 
142     \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type} == \hyperlink{sys_2wince_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{MENU\_TYPE\_MENU} ) \{
143         \textcolor{keywordtype}{char} next\_char = \textcolor{charliteral}{'a'};
144 
145         \textcolor{keywordflow}{for}( i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size;  i++) \{
146             \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator!=0 ) \{
147                 *ap++ = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator;
148                 next\_char = (char)(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator+1);
149             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}( \hyperlink{sys_2wince_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{NHMENU\_IS\_SELECTABLE}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i]) ) \{
150                 \textcolor{keywordflow}{if} ( (next\_char>=\textcolor{charliteral}{'a'} && next\_char<=\textcolor{charliteral}{'z'}) ||
151                      (next\_char>=\textcolor{charliteral}{'A'} && next\_char<=\textcolor{charliteral}{'Z'}) )  \{
152                      data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator = next\_char;
153                      *ap++ = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator;
154                 \} \textcolor{keywordflow}{else} \{
155                     \textcolor{keywordflow}{if}( next\_char > \textcolor{charliteral}{'z'} ) next\_char = \textcolor{charliteral}{'A'};
156                     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ( next\_char > \textcolor{charliteral}{'Z'} ) \textcolor{keywordflow}{break};
157 
158                     data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator = next\_char;
159                     *ap++ = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].accelerator;
160                 \}
161 
162                 next\_char ++;
163             \}
164         \}
165 
166         \textcolor{comment}{/* collect group accelerators */}
167         data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.gacc[0] = \textcolor{charliteral}{'\(\backslash\)0'};
168         ap = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.gacc;
169         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_aa165ee77989c4e4cec77f8ce58ca27b9}{how} != \hyperlink{wintype_8h_a9e3d317126c3eacb6311e15fedaf717c}{PICK\_NONE} ) \{
170             \textcolor{keywordflow}{for}( i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size;  i++) \{
171                 \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].group\_accel && 
172                     !strchr(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.gacc, data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].group\_accel) ) \{
173                     *ap++ = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].group\_accel;
174                     *ap = \textcolor{stringliteral}{'\(\backslash\)x0'};
175                 \}
176             \}
177         \}
178 
179         \hyperlink{sys_2wince_2mhmenu_8c_a5ecda635f7697da558dc112094c8be0e}{reset\_menu\_count}(\hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, data);
180     \}
181 
182 \textcolor{preprocessor}{#if defined(WIN\_CE\_SMARTPHONE)}
183     \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type}==\hyperlink{sys_2wince_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{MENU\_TYPE\_MENU} ) NHSPhoneSetKeypadFromString( accell\_str );
184 \textcolor{preprocessor}{#endif}
185 
186     \hyperlink{sys_2wince_2mswproc_8c_a2a23443a8cfc6b5b41024850877e0f5e}{mswin\_popup\_display}(hWnd, &data->\hyperlink{structmswin__nethack__menu__window_aaeb9b85cb77679ee1b41ac2b0377d90b}{done});
187 
188     \textcolor{comment}{/* get the result */}
189     \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result} != -1 ) \{
190         \textcolor{keywordflow}{if}(how==\hyperlink{wintype_8h_a9e3d317126c3eacb6311e15fedaf717c}{PICK\_NONE}) \{
191             \textcolor{keywordflow}{if}(data->\hyperlink{structmswin__nethack__menu__window_a8ec6092e0354a2a0d233634b120e4d78}{result}>=0) ret\_val=0;
192             \textcolor{keywordflow}{else}                ret\_val=-1;
193         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(how==\hyperlink{wintype_8h_a53377e7b2fddfaf7cc2351dab3b2b139}{PICK\_ONE} || how==\hyperlink{wintype_8h_a2bd6d317ee7338c416301da3d054dd9f}{PICK\_ANY}) \{
194             \textcolor{comment}{/* count selected items */}
195             ret\_val = 0;
196             \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
197                 \textcolor{keywordflow}{if}( \hyperlink{sys_2wince_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{NHMENU\_IS\_SELECTABLE}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i]) &&
198                     \hyperlink{sys_2wince_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{NHMENU\_IS\_SELECTED}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i]) ) \{
199                     ret\_val++;
200                 \}
201             \}
202             \textcolor{keywordflow}{if}( ret\_val > 0 ) \{
203                 \textcolor{keywordtype}{int} sel\_ind;
204 
205                 selected = (\hyperlink{wintype_8h_a56b56557611b7f64f4e6585a1b78c8f9}{MENU\_ITEM\_P}*)\hyperlink{winproto_8h_ab028c02ac00afc0c1d3c568ccad68869}{malloc}(ret\_val*\textcolor{keyword}{sizeof}(
      \hyperlink{wintype_8h_a56b56557611b7f64f4e6585a1b78c8f9}{MENU\_ITEM\_P}));
206                 \textcolor{keywordflow}{if}( !selected ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"out of memory"});
207 
208                 sel\_ind = 0;
209                 \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
210                     \textcolor{keywordflow}{if}( \hyperlink{sys_2wince_2mhmenu_8c_aa8bce4ca1a293da05862b6183251c5a0}{NHMENU\_IS\_SELECTABLE}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i]) &&
211                         \hyperlink{sys_2wince_2mhmenu_8c_aca5111f9b75578b43ee24bca0e3f2985}{NHMENU\_IS\_SELECTED}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i]) ) \{
212                         selected[sel\_ind].item = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].identifier;
213                         selected[sel\_ind].count = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].count;
214                         sel\_ind++;
215                     \}
216                 \}
217                 ret\_val = sel\_ind;
218                 *\_selected = selected;
219             \}
220         \}
221     \}
222 
223     \hyperlink{sys_2wince_2mswproc_8c_a49804134a4aaa8874010372eae4612f9}{mswin\_popup\_destroy}(hWnd);
224 
225 \textcolor{preprocessor}{#if defined(WIN\_CE\_SMARTPHONE)}
226     \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type}==\hyperlink{sys_2wince_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{MENU\_TYPE\_MENU} ) NHSPhoneSetKeypadDefault();
227 \textcolor{preprocessor}{#endif}
228 
229     \textcolor{keywordflow}{return} ret\_val;
230 \}
\end{DoxyCode}
\hypertarget{win_2win32_2mhmenu_8h_a93f677ba7b9a82155898c18af49cfc35}{\index{win/win32/mhmenu.\+h@{win/win32/mhmenu.\+h}!mswin\+\_\+menu\+\_\+window\+\_\+size@{mswin\+\_\+menu\+\_\+window\+\_\+size}}
\index{mswin\+\_\+menu\+\_\+window\+\_\+size@{mswin\+\_\+menu\+\_\+window\+\_\+size}!win/win32/mhmenu.\+h@{win/win32/mhmenu.\+h}}
\subsubsection[{mswin\+\_\+menu\+\_\+window\+\_\+size}]{\setlength{\rightskip}{0pt plus 5cm}void mswin\+\_\+menu\+\_\+window\+\_\+size (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{hwnd, }
\item[{L\+P\+S\+I\+Z\+E}]{sz}
\end{DoxyParamCaption}
)}}\label{win_2win32_2mhmenu_8h_a93f677ba7b9a82155898c18af49cfc35}


Definition at line 1317 of file mhmenu.\+c.



References A\+T\+R\+\_\+\+N\+O\+N\+E, B\+U\+F\+S\+Z, F\+A\+L\+S\+E, Get\+Menu\+Control(), max, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::menu, M\+E\+N\+U\+\_\+\+T\+Y\+P\+E\+\_\+\+M\+E\+N\+U, mswin\+\_\+get\+\_\+font(), N\+H\+\_\+\+A2\+W, N\+H\+W\+\_\+\+M\+E\+N\+U, N\+U\+L\+L, T\+A\+B\+\_\+\+S\+E\+P\+A\+R\+A\+T\+I\+O\+N, mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::text, T\+I\+L\+E\+\_\+\+X, and mswin\+\_\+nethack\+\_\+menu\+\_\+window\+::type.



Referenced by mswin\+\_\+layout\+\_\+main\+\_\+window(), and Set\+Menu\+List\+Type().


\begin{DoxyCode}
1318 \{
1319     TEXTMETRIC \hyperlink{structtm}{tm};
1320     HWND control;
1321     HGDIOBJ saveFont;
1322     HDC hdc;
1323     \hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow} data;
1324     \textcolor{keywordtype}{int} i;
1325     RECT rt, wrt;
1326     \textcolor{keywordtype}{int} extra\_cx;
1327 
1328     GetClientRect(hWnd, &rt);
1329     sz->cx = rt.right - rt.left;
1330     sz->cy = rt.bottom - rt.top;
1331 
1332     GetWindowRect(hWnd, &wrt);
1333     extra\_cx = (wrt.right-wrt.left) - sz->cx;
1334 
1335     data = (\hyperlink{structmswin__nethack__menu__window}{PNHMenuWindow})GetWindowLong(hWnd, GWL\_USERDATA);
1336     \textcolor{keywordflow}{if}(data) \{
1337         control = \hyperlink{sys_2wince_2mhmenu_8c_a871d7d2f2639f7ebf2e8e9f6f681bd0a}{GetMenuControl}(hWnd);
1338         hdc = GetDC(control);
1339 
1340         \textcolor{keywordflow}{if}( data->\hyperlink{structmswin__nethack__menu__window_ab0fda81d90930a6d45dd16aeb8ce4f8a}{type}==\hyperlink{sys_2wince_2mhmenu_8h_a721a1d91420a4ebad6c2d4c37c344557}{MENU\_TYPE\_MENU} ) \{
1341             \textcolor{comment}{/* Calculate the width of the list box. */}
1342             saveFont = SelectObject(hdc, \hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(\hyperlink{wintype_8h_a60a03e50aaeef35cd7cd3bf6f790791c}{NHW\_MENU}, 
      \hyperlink{wintype_8h_a20a20b74e8cf84ecfbf3c8665c059636}{ATR\_NONE}, hdc, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}));
1343             GetTextMetrics(hdc, &tm);
1344             \textcolor{keywordflow}{for}(i=0; i<data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.size; i++ ) \{
1345                 LONG menuitemwidth = 0;
1346                 \textcolor{keywordtype}{int} column;
1347                 \textcolor{keywordtype}{char} *p, *p1;
1348 
1349                 p1 = data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].str;
1350                 p = strchr(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.items[i].str, \textcolor{charliteral}{'\(\backslash\)t'});
1351                 column = 0;
1352                 \textcolor{keywordflow}{for} (;;) \{
1353                     TCHAR wbuf[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
1354                     RECT tabRect;
1355                     SetRect ( &tabRect, 0, 0, 1, 1 );
1356                     \textcolor{keywordflow}{if} (p != \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}) *p = \textcolor{charliteral}{'\(\backslash\)0'}; \textcolor{comment}{/* for time being, view tab field as zstring */}
1357                     DrawText(hdc,
1358                         \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(p1, wbuf, \hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}),
1359                         strlen(p1),
1360                         &tabRect,
1361                         DT\_CALCRECT | DT\_LEFT | DT\_VCENTER | DT\_SINGLELINE
1362                     );
1363                     \textcolor{comment}{/* it probably isn't necessary to recompute the tab width now, but do so}
1364 \textcolor{comment}{                     * just in case, honoring the previously computed value}
1365 \textcolor{comment}{                     */}
1366                     menuitemwidth += \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(data->\hyperlink{structmswin__nethack__menu__window_a8da0ac3642664655477707181c2b4284}{menu}.tab\_stop\_size[column],
1367                         tabRect.right - tabRect.left);
1368                     \textcolor{keywordflow}{if} (p != \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}) *p = \textcolor{charliteral}{'\(\backslash\)t'};
1369                     \textcolor{keywordflow}{else} \textcolor{comment}{/* last string so, */} \textcolor{keywordflow}{break};
1370                     \textcolor{comment}{/* add the separation only when not the last item */}
1371                     \textcolor{comment}{/* in the last item, we break out of the loop, in the statement just above */}
1372                     menuitemwidth += \hyperlink{sys_2wince_2mhmenu_8c_a2d7b0f76873a47cdd301b0a7c222a681}{TAB\_SEPARATION};
1373                     ++column;
1374                     p1 = p + 1;
1375                     p = strchr(p1, \textcolor{charliteral}{'\(\backslash\)t'});
1376                 \}
1377 
1378                 sz->cx = \hyperlink{hack_8h_affe776513b24d84b39af8ab0930fef7f}{max}(sz->cx, 
1379                     (LONG)(2*\hyperlink{sys_2wince_2winMS_8h_a9f3fae6a9058d02850af5deba9be4544}{TILE\_X} + menuitemwidth + tm.tmAveCharWidth*12 + tm.tmOverhang));
1380             \}
1381             SelectObject(hdc, saveFont);
1382         \} \textcolor{keywordflow}{else} \{
1383             \textcolor{comment}{/* do not change size for text output - the text will be formatted to}
1384 \textcolor{comment}{               fit any window */}
1385         \}
1386         sz->cx += extra\_cx;
1387 
1388         ReleaseDC(control, hdc);
1389     \}
1390 \}
\end{DoxyCode}
