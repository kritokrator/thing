\hypertarget{mhtxtbuf_8h}{\section{nethack/sys/wince/mhtxtbuf.h File Reference}
\label{mhtxtbuf_8h}\index{nethack/sys/wince/mhtxtbuf.\+h@{nethack/sys/wince/mhtxtbuf.\+h}}
}
{\ttfamily \#include \char`\"{}win\+M\+S.\+h\char`\"{}}\\*
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \\*
\hyperlink{structmswin__nethack__text__buffer}{mswin\+\_\+nethack\+\_\+text\+\_\+buffer} $\ast$ \hyperlink{mhtxtbuf_8h_a6b41a846f60195b7172fadbda0590eca}{P\+N\+H\+Text\+Buffer}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{mhtxtbuf_8c_a1dd05af79bf8ee000da64ac915b745b1}{P\+N\+H\+Text\+Buffer} \hyperlink{mhtxtbuf_8h_a4fd9327233e68071e2a79c64b2e40d2b}{mswin\+\_\+init\+\_\+text\+\_\+buffer} (B\+O\+O\+L wrap\+\_\+text)
\item 
void \hyperlink{mhtxtbuf_8h_a63fe01aa79509551331fc693eb26b49d}{mswin\+\_\+free\+\_\+text\+\_\+buffer} (\hyperlink{mhtxtbuf_8c_a1dd05af79bf8ee000da64ac915b745b1}{P\+N\+H\+Text\+Buffer} pb)
\item 
void \hyperlink{mhtxtbuf_8h_a35f7fea200655732ca987c85a767df1f}{mswin\+\_\+add\+\_\+text} (\hyperlink{mhtxtbuf_8c_a1dd05af79bf8ee000da64ac915b745b1}{P\+N\+H\+Text\+Buffer} pb, int attr, \hyperlink{tradstdc_8h_a2c212835823e3c54a8ab6d95c652660e}{const} char $\ast$text)
\item 
void \hyperlink{mhtxtbuf_8h_ad3aa1058c339493ae60ba46351d4b2d4}{mswin\+\_\+render\+\_\+text} (\hyperlink{mhtxtbuf_8c_a1dd05af79bf8ee000da64ac915b745b1}{P\+N\+H\+Text\+Buffer} pb, H\+W\+N\+D edit\+\_\+control)
\end{DoxyCompactItemize}


\subsection{Typedef Documentation}
\hypertarget{mhtxtbuf_8h_a6b41a846f60195b7172fadbda0590eca}{\index{mhtxtbuf.\+h@{mhtxtbuf.\+h}!P\+N\+H\+Text\+Buffer@{P\+N\+H\+Text\+Buffer}}
\index{P\+N\+H\+Text\+Buffer@{P\+N\+H\+Text\+Buffer}!mhtxtbuf.\+h@{mhtxtbuf.\+h}}
\subsubsection[{P\+N\+H\+Text\+Buffer}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf mswin\+\_\+nethack\+\_\+text\+\_\+buffer}$\ast$ {\bf P\+N\+H\+Text\+Buffer}}}\label{mhtxtbuf_8h_a6b41a846f60195b7172fadbda0590eca}


Definition at line 9 of file mhtxtbuf.\+h.



\subsection{Function Documentation}
\hypertarget{mhtxtbuf_8h_a35f7fea200655732ca987c85a767df1f}{\index{mhtxtbuf.\+h@{mhtxtbuf.\+h}!mswin\+\_\+add\+\_\+text@{mswin\+\_\+add\+\_\+text}}
\index{mswin\+\_\+add\+\_\+text@{mswin\+\_\+add\+\_\+text}!mhtxtbuf.\+h@{mhtxtbuf.\+h}}
\subsubsection[{mswin\+\_\+add\+\_\+text}]{\setlength{\rightskip}{0pt plus 5cm}void mswin\+\_\+add\+\_\+text (
\begin{DoxyParamCaption}
\item[{{\bf P\+N\+H\+Text\+Buffer}}]{pb, }
\item[{int}]{attr, }
\item[{{\bf const} char $\ast$}]{text}
\end{DoxyParamCaption}
)}}\label{mhtxtbuf_8h_a35f7fea200655732ca987c85a767df1f}


Definition at line 62 of file mhtxtbuf.\+c.



References text\+\_\+buffer\+\_\+line\+::attr, text\+\_\+buffer\+\_\+line\+::beg\+\_\+padding, text\+\_\+buffer\+\_\+line\+::end\+\_\+padding, F\+A\+L\+S\+E, text\+\_\+buffer\+\_\+line\+::formatted, mswin\+\_\+nethack\+\_\+text\+\_\+buffer\+::n\+\_\+size, mswin\+\_\+nethack\+\_\+text\+\_\+buffer\+::n\+\_\+used, N\+H\+T\+E\+X\+T\+\_\+\+B\+U\+F\+F\+E\+R\+\_\+\+I\+N\+C\+R\+E\+M\+E\+N\+T, N\+H\+Text\+Line, N\+U\+L\+L, panic(), strdup, text\+\_\+buffer\+\_\+line\+::text, and mswin\+\_\+nethack\+\_\+text\+\_\+buffer\+::text\+\_\+buffer\+\_\+line.



Referenced by on\+M\+S\+N\+H\+Command().


\begin{DoxyCode}
63 \{
64     \textcolor{keywordtype}{char}* p;
65     \textcolor{keyword}{struct }\hyperlink{structtext__buffer__line}{text\_buffer\_line}* new\_line;
66 
67     \textcolor{comment}{/* grow buffer */}
68     \textcolor{keywordflow}{if}( pb->\hyperlink{structmswin__nethack__text__buffer_a415404171adf88a11b4e5cba4dc55710}{n\_used} >= pb->\hyperlink{structmswin__nethack__text__buffer_a68d3b91e928c9eda9cad2cbae937de64}{n\_size} ) \{
69         pb->\hyperlink{structmswin__nethack__text__buffer_a68d3b91e928c9eda9cad2cbae937de64}{n\_size} += \hyperlink{mhtxtbuf_8c_abef1e4e5868cbbb940e29a79ba572fb8}{NHTEXT\_BUFFER\_INCREMENT};
70         pb->\hyperlink{structmswin__nethack__text__buffer_a50aafb5cf8dde4a5a2e86bd1247d7736}{text\_buffer\_line} =
71             (\textcolor{keyword}{struct }\hyperlink{structtext__buffer__line}{text\_buffer\_line}*)realloc( pb->
      \hyperlink{structmswin__nethack__text__buffer_a50aafb5cf8dde4a5a2e86bd1247d7736}{text\_buffer\_line}, pb->\hyperlink{structmswin__nethack__text__buffer_a68d3b91e928c9eda9cad2cbae937de64}{n\_size}*\textcolor{keyword}{sizeof}(\textcolor{keyword}{struct} 
      \hyperlink{structtext__buffer__line}{text\_buffer\_line}) );
72         \textcolor{keywordflow}{if}( !pb->\hyperlink{structmswin__nethack__text__buffer_a50aafb5cf8dde4a5a2e86bd1247d7736}{text\_buffer\_line} ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Memory allocation error"});
73     \}
74 
75     \textcolor{comment}{/* analyze the new line of text */}
76     new\_line = &\hyperlink{mhtxtbuf_8c_a431929df40cc8bff99a6b64e6166855e}{NHTextLine}(pb, pb->\hyperlink{structmswin__nethack__text__buffer_a415404171adf88a11b4e5cba4dc55710}{n\_used});
77     new\_line->\hyperlink{structtext__buffer__line_a2f755726b09338da45acd955ab8775e2}{attr} = \hyperlink{structtext__buffer__line_a2f755726b09338da45acd955ab8775e2}{attr};
78     new\_line->\hyperlink{structtext__buffer__line_a14587c527cf165fc1f83fee0f32fbc3b}{beg\_padding} = 0;
79     new\_line->\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text} = \hyperlink{wceconf_8h_a9254b089d435892385cf14d0ab4a7a2d}{strdup}(\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text});
80     \textcolor{keywordflow}{for}( p = new\_line->\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text}; *p && isspace(*p); p++ ) \{
81         new\_line->\hyperlink{structtext__buffer__line_a14587c527cf165fc1f83fee0f32fbc3b}{beg\_padding}++;
82     \}
83     \textcolor{keywordflow}{if}( *p ) \{
84         memmove(new\_line->\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text},
85                 new\_line->\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text} + new\_line->\hyperlink{structtext__buffer__line_a14587c527cf165fc1f83fee0f32fbc3b}{beg\_padding},
86                 strlen(new\_line->\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text}) - new\_line->\hyperlink{structtext__buffer__line_a14587c527cf165fc1f83fee0f32fbc3b}{beg\_padding} + 1
87                 );
88         \textcolor{keywordflow}{for}( p = new\_line->\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text}+strlen(new\_line->\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text}); 
89              p>=new\_line->\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text} && isspace(*p); 
90              p-- ) \{
91             new\_line->\hyperlink{structtext__buffer__line_aacec6fcbbd5dbcbd1b4bee8d9947b6ee}{end\_padding}++;
92             *p = 0;
93         \}
94 
95         \textcolor{comment}{/* if there are 3 (or more) consecutive spaces inside the string }
96 \textcolor{comment}{           consider it formatted */}
97         new\_line->\hyperlink{structtext__buffer__line_a954908a09498bbd0349c82db8836b36e}{formatted} = (strstr(new\_line->\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text}, \textcolor{stringliteral}{"   "})!=\hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
98     \} \textcolor{keywordflow}{else} \{
99         new\_line->\hyperlink{structtext__buffer__line_aacec6fcbbd5dbcbd1b4bee8d9947b6ee}{end\_padding} = 0;
100         new\_line->\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text}[0] = 0;
101         new\_line->\hyperlink{structtext__buffer__line_a954908a09498bbd0349c82db8836b36e}{formatted} = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
102     \}
103     pb->\hyperlink{structmswin__nethack__text__buffer_a415404171adf88a11b4e5cba4dc55710}{n\_used}++;
104 \}
\end{DoxyCode}
\hypertarget{mhtxtbuf_8h_a63fe01aa79509551331fc693eb26b49d}{\index{mhtxtbuf.\+h@{mhtxtbuf.\+h}!mswin\+\_\+free\+\_\+text\+\_\+buffer@{mswin\+\_\+free\+\_\+text\+\_\+buffer}}
\index{mswin\+\_\+free\+\_\+text\+\_\+buffer@{mswin\+\_\+free\+\_\+text\+\_\+buffer}!mhtxtbuf.\+h@{mhtxtbuf.\+h}}
\subsubsection[{mswin\+\_\+free\+\_\+text\+\_\+buffer}]{\setlength{\rightskip}{0pt plus 5cm}void mswin\+\_\+free\+\_\+text\+\_\+buffer (
\begin{DoxyParamCaption}
\item[{{\bf P\+N\+H\+Text\+Buffer}}]{pb}
\end{DoxyParamCaption}
)}}\label{mhtxtbuf_8h_a63fe01aa79509551331fc693eb26b49d}


Definition at line 49 of file mhtxtbuf.\+c.



References free(), mswin\+\_\+nethack\+\_\+text\+\_\+buffer\+::n\+\_\+used, text\+\_\+buffer\+\_\+line\+::text, and mswin\+\_\+nethack\+\_\+text\+\_\+buffer\+::text\+\_\+buffer\+\_\+line.



Referenced by Menu\+Wnd\+Proc(), and Text\+Wnd\+Proc().


\begin{DoxyCode}
50 \{
51     \textcolor{keywordtype}{int} i;
52     
53     \textcolor{keywordflow}{if}( !pb ) \textcolor{keywordflow}{return};
54 
55     \textcolor{keywordflow}{for}(i=0; i<pb->\hyperlink{structmswin__nethack__text__buffer_a415404171adf88a11b4e5cba4dc55710}{n\_used}; i++ ) \{
56         \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(pb->\hyperlink{structmswin__nethack__text__buffer_a50aafb5cf8dde4a5a2e86bd1247d7736}{text\_buffer\_line}[i].\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text});
57     \}
58     \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}( pb->\hyperlink{structmswin__nethack__text__buffer_a50aafb5cf8dde4a5a2e86bd1247d7736}{text\_buffer\_line} );
59     \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}( pb );
60 \}
\end{DoxyCode}
\hypertarget{mhtxtbuf_8h_a4fd9327233e68071e2a79c64b2e40d2b}{\index{mhtxtbuf.\+h@{mhtxtbuf.\+h}!mswin\+\_\+init\+\_\+text\+\_\+buffer@{mswin\+\_\+init\+\_\+text\+\_\+buffer}}
\index{mswin\+\_\+init\+\_\+text\+\_\+buffer@{mswin\+\_\+init\+\_\+text\+\_\+buffer}!mhtxtbuf.\+h@{mhtxtbuf.\+h}}
\subsubsection[{mswin\+\_\+init\+\_\+text\+\_\+buffer}]{\setlength{\rightskip}{0pt plus 5cm}{\bf P\+N\+H\+Text\+Buffer} mswin\+\_\+init\+\_\+text\+\_\+buffer (
\begin{DoxyParamCaption}
\item[{B\+O\+O\+L}]{wrap\+\_\+text}
\end{DoxyParamCaption}
)}}\label{mhtxtbuf_8h_a4fd9327233e68071e2a79c64b2e40d2b}


Definition at line 36 of file mhtxtbuf.\+c.



References mswin\+\_\+nethack\+\_\+text\+\_\+buffer\+::b\+\_\+wrap\+\_\+text, malloc(), mswin\+\_\+nethack\+\_\+text\+\_\+buffer\+::n\+\_\+size, mswin\+\_\+nethack\+\_\+text\+\_\+buffer\+::n\+\_\+used, N\+U\+L\+L, panic(), and mswin\+\_\+nethack\+\_\+text\+\_\+buffer\+::text\+\_\+buffer\+\_\+line.



Referenced by mswin\+\_\+init\+\_\+text\+\_\+window(), and on\+M\+S\+N\+H\+Command().


\begin{DoxyCode}
37 \{
38     \hyperlink{structmswin__nethack__text__buffer}{PNHTextBuffer} pb = (\hyperlink{mhtxtbuf_8c_a1dd05af79bf8ee000da64ac915b745b1}{PNHTextBuffer})\hyperlink{winproto_8h_ab028c02ac00afc0c1d3c568ccad68869}{malloc}(\textcolor{keyword}{sizeof}(
      \hyperlink{structmswin__nethack__text__buffer}{NHTextBuffer}));
39     \textcolor{keywordflow}{if}( !pb ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Out of memory"});
40     
41     ZeroMemory(pb, \textcolor{keyword}{sizeof}(\hyperlink{structmswin__nethack__text__buffer}{NHTextBuffer}));
42     pb->\hyperlink{structmswin__nethack__text__buffer_a78db27a26e3871f7309475ad133da130}{b\_wrap\_text} = wrap\_text;
43     pb->\hyperlink{structmswin__nethack__text__buffer_a68d3b91e928c9eda9cad2cbae937de64}{n\_size} = 0;
44     pb->\hyperlink{structmswin__nethack__text__buffer_a415404171adf88a11b4e5cba4dc55710}{n\_used} = 0;
45     pb->\hyperlink{structmswin__nethack__text__buffer_a50aafb5cf8dde4a5a2e86bd1247d7736}{text\_buffer\_line} = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
46     \textcolor{keywordflow}{return} pb;
47 \}
\end{DoxyCode}
\hypertarget{mhtxtbuf_8h_ad3aa1058c339493ae60ba46351d4b2d4}{\index{mhtxtbuf.\+h@{mhtxtbuf.\+h}!mswin\+\_\+render\+\_\+text@{mswin\+\_\+render\+\_\+text}}
\index{mswin\+\_\+render\+\_\+text@{mswin\+\_\+render\+\_\+text}!mhtxtbuf.\+h@{mhtxtbuf.\+h}}
\subsubsection[{mswin\+\_\+render\+\_\+text}]{\setlength{\rightskip}{0pt plus 5cm}void mswin\+\_\+render\+\_\+text (
\begin{DoxyParamCaption}
\item[{{\bf P\+N\+H\+Text\+Buffer}}]{pb, }
\item[{H\+W\+N\+D}]{edit\+\_\+control}
\end{DoxyParamCaption}
)}}\label{mhtxtbuf_8h_ad3aa1058c339493ae60ba46351d4b2d4}


Definition at line 130 of file mhtxtbuf.\+c.



References mswin\+\_\+nethack\+\_\+text\+\_\+buffer\+::b\+\_\+wrap\+\_\+text, buf, B\+U\+F\+S\+Z, text\+\_\+buffer\+\_\+line\+::formatted, free(), mswin\+\_\+nethack\+\_\+text\+\_\+buffer\+::n\+\_\+used, N\+H\+\_\+\+A2\+W, nh\+\_\+append(), N\+H\+Text\+Line, N\+U\+L\+L, S\+I\+Z\+E, and text\+\_\+buffer\+\_\+line\+::text.



Referenced by Layout\+Menu(), mswin\+\_\+display\+\_\+text\+\_\+window(), and on\+M\+S\+N\+H\+Command().


\begin{DoxyCode}
131 \{
132     RECT rt\_client;      \textcolor{comment}{/* boundaries of the client area of the edit control */}
133     \hyperlink{global_8h_afd2537d19a3cb6556b0f727580ec6ee7}{SIZE} size\_text;      \textcolor{comment}{/* size of the edit control */}
134     RECT rt\_text;        \textcolor{comment}{/* calculated text rectangle for the visible line */}
135     \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];     \textcolor{comment}{/* buffer for the visible line */}
136     TCHAR tbuf[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];   \textcolor{comment}{/* temp buffer for DrawText */}
137     TCHAR* pText = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}; \textcolor{comment}{/* resulting text (formatted) */}
138     \textcolor{keywordtype}{int} pTextSize = 0;   \textcolor{comment}{/* resulting text size */}
139     \textcolor{keywordtype}{char}* p\_cur = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};  \textcolor{comment}{/* current position in the NHTextBuffer->text\_buffer\_line->text */}
140     \textcolor{keywordtype}{char}* p\_buf\_cur = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}; \textcolor{comment}{/* current position in the visible line buffer */}
141     \textcolor{keywordtype}{int} i;
142     HDC hdcEdit;         \textcolor{comment}{/* device context for the edit control */}
143     HFONT hFont, hOldFont; \textcolor{comment}{/* edit control font */}
144 
145     GetClientRect(edit\_control, &rt\_client );
146     size\_text.cx = rt\_client.right - rt\_client.left;
147     size\_text.cy = rt\_client.bottom - rt\_client.top;
148     size\_text.cx -= GetSystemMetrics(SM\_CXVSCROLL); \textcolor{comment}{/* add a slight right margin - the text looks better
       that way */}
149     hdcEdit = GetDC(edit\_control);
150     hFont = (HFONT)SendMessage(edit\_control, WM\_GETFONT, 0, 0);
151     \textcolor{keywordflow}{if}( hFont ) hOldFont = SelectObject(hdcEdit, hFont);
152 
153     \textcolor{comment}{/* loop through each line (outer loop) and wrap it around (inner loop) */}
154     ZeroMemory(buf, \textcolor{keyword}{sizeof}(buf));
155     p\_buf\_cur = \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf};
156     \textcolor{keywordflow}{for}( i=0; i<pb->\hyperlink{structmswin__nethack__text__buffer_a415404171adf88a11b4e5cba4dc55710}{n\_used}; i++ ) \{
157         \textcolor{keywordflow}{if}( pb->\hyperlink{structmswin__nethack__text__buffer_a78db27a26e3871f7309475ad133da130}{b\_wrap\_text} ) \{
158             p\_cur = \hyperlink{mhtxtbuf_8c_a431929df40cc8bff99a6b64e6166855e}{NHTextLine}(pb,i).text;
159 
160             \textcolor{comment}{/* insert an line break for the empty string */}
161             \textcolor{keywordflow}{if}( !\hyperlink{mhtxtbuf_8c_a431929df40cc8bff99a6b64e6166855e}{NHTextLine}(pb,i).\hyperlink{structtext__buffer__line_ab3af8e4e600d655d06c514cd743eca92}{text}[0] ) \{
162                 pText = \hyperlink{mhtxtbuf_8c_a61e58a57c5b4f18a6c77f77255c53db3}{nh\_append}(pText, &pTextSize, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
163                 \textcolor{keywordflow}{continue};
164             \}
165 
166             \textcolor{comment}{/* add margin to the "formatted" line of text */}
167             \textcolor{keywordflow}{if}( \hyperlink{mhtxtbuf_8c_a431929df40cc8bff99a6b64e6166855e}{NHTextLine}(pb,i).\hyperlink{structtext__buffer__line_a954908a09498bbd0349c82db8836b36e}{formatted} ) \{
168                 strcpy(buf, \textcolor{stringliteral}{"   "});
169                 p\_buf\_cur += 3;
170             \}
171 
172             \textcolor{comment}{/* scroll thourgh the current line of text and wrap it}
173 \textcolor{comment}{               so it fits to width of the edit control */}
174             \textcolor{keywordflow}{while}( *p\_cur ) \{
175                 \textcolor{keywordtype}{char} *p\_word\_pos = p\_buf\_cur;
176 
177                 \textcolor{comment}{/* copy one word into the buffer */}
178                 \textcolor{keywordflow}{while}( *p\_cur && isspace(*p\_cur) ) 
179                     \textcolor{keywordflow}{if}( p\_buf\_cur!=buf ) *p\_buf\_cur++ = *p\_cur++;
180                     \textcolor{keywordflow}{else} p\_cur++;
181 
182                 \textcolor{keywordflow}{while}( *p\_cur && !isspace(*p\_cur) ) 
183                     *p\_buf\_cur++ = *p\_cur++;
184 
185                 \textcolor{comment}{/* check if it fits */}
186                 SetRect( &rt\_text, 0, 0, size\_text.cx, size\_text.cy );
187                 DrawText(hdcEdit, \hyperlink{wceconf_8h_a2ed36c9ee770dfe5f2d0e3088a62adad}{NH\_A2W}(buf, tbuf, p\_buf\_cur-buf), p\_buf\_cur-buf, &rt\_text, 
      DT\_CALCRECT | DT\_LEFT | DT\_SINGLELINE | DT\_NOCLIP);
188                 \textcolor{keywordflow}{if}( (rt\_text.right - rt\_text.left)>=size\_text.cx ) \{
189                     \textcolor{comment}{/* Backtrack. }
190 \textcolor{comment}{                       Only backtrack if the last word caused the overflow -}
191 \textcolor{comment}{                       do not backtrack if the entire current line does not fit the visible area.}
192 \textcolor{comment}{                       Otherwise it is a infinite loop.}
193 \textcolor{comment}{                    */}
194                     \textcolor{keywordflow}{if}( p\_word\_pos>buf ) \{
195                         p\_cur -= (p\_buf\_cur-p\_word\_pos);
196                         p\_buf\_cur = p\_word\_pos;
197                     \}
198                     *p\_buf\_cur = 0;  \textcolor{comment}{/* break the line */}
199 
200                     \textcolor{comment}{/* append the calculated line to the text buffer */}
201                     pText = \hyperlink{mhtxtbuf_8c_a61e58a57c5b4f18a6c77f77255c53db3}{nh\_append}(pText, &pTextSize, buf);
202                     pText = \hyperlink{mhtxtbuf_8c_a61e58a57c5b4f18a6c77f77255c53db3}{nh\_append}(pText, &pTextSize, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
203                     ZeroMemory(buf, \textcolor{keyword}{sizeof}(buf));
204                     p\_buf\_cur = \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf};
205                 \}
206             \}
207 
208             \textcolor{comment}{/* always break the line at the end of the buffer text */}
209             \textcolor{keywordflow}{if}( p\_buf\_cur != buf ) \{
210                 \textcolor{comment}{/* flush the current buffrer */}
211                 *p\_buf\_cur = 0;  \textcolor{comment}{/* break the line */}
212                 pText = \hyperlink{mhtxtbuf_8c_a61e58a57c5b4f18a6c77f77255c53db3}{nh\_append}(pText, &pTextSize, buf);
213                 pText = \hyperlink{mhtxtbuf_8c_a61e58a57c5b4f18a6c77f77255c53db3}{nh\_append}(pText, &pTextSize, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
214                 ZeroMemory(buf, \textcolor{keyword}{sizeof}(buf));
215                 p\_buf\_cur = \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf};
216             \}
217         \} \textcolor{keywordflow}{else} \{ \textcolor{comment}{/* do not wrap text */}
218             \textcolor{keywordtype}{int} j;
219             \textcolor{keywordflow}{for}( j=0; j<\hyperlink{mhtxtbuf_8c_a431929df40cc8bff99a6b64e6166855e}{NHTextLine}(pb,i).beg\_padding; j++ ) 
220                 pText = \hyperlink{mhtxtbuf_8c_a61e58a57c5b4f18a6c77f77255c53db3}{nh\_append}(pText, &pTextSize, \textcolor{stringliteral}{" "});
221             pText = \hyperlink{mhtxtbuf_8c_a61e58a57c5b4f18a6c77f77255c53db3}{nh\_append}(pText, &pTextSize, \hyperlink{mhtxtbuf_8c_a431929df40cc8bff99a6b64e6166855e}{NHTextLine}(pb,i).text);
222             pText = \hyperlink{mhtxtbuf_8c_a61e58a57c5b4f18a6c77f77255c53db3}{nh\_append}(pText, &pTextSize, \textcolor{stringliteral}{"\(\backslash\)r\(\backslash\)n"});
223         \}
224     \}
225     
226     \textcolor{comment}{/* cleanup */}
227     \textcolor{keywordflow}{if}( hFont ) SelectObject(hdcEdit, hOldFont);
228     ReleaseDC(edit\_control, hdcEdit);
229 
230     \textcolor{comment}{/* update edit control text */}
231     \textcolor{keywordflow}{if}( pText ) \{
232         SendMessage(edit\_control, EM\_FMTLINES, 1, 0 );
233         SetWindowText(edit\_control, pText);
234         \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(pText);
235     \}
236 \}
\end{DoxyCode}
