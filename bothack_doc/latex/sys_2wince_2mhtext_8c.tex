\hypertarget{sys_2wince_2mhtext_8c}{\section{nethack/sys/wince/mhtext.c File Reference}
\label{sys_2wince_2mhtext_8c}\index{nethack/sys/wince/mhtext.\+c@{nethack/sys/wince/mhtext.\+c}}
}
{\ttfamily \#include \char`\"{}win\+M\+S.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhtext.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhmsg.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhfont.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhcolor.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mhtxtbuf.\+h\char`\"{}}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structmswin__nethack__text__window}{mswin\+\_\+nethack\+\_\+text\+\_\+window}
\end{DoxyCompactItemize}
\subsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef struct \\*
\hyperlink{structmswin__nethack__text__window}{mswin\+\_\+nethack\+\_\+text\+\_\+window} \hyperlink{sys_2wince_2mhtext_8c_a93a68ae5d0ad265a1df776ec42c75b71}{N\+H\+Text\+Window}
\item 
typedef struct \\*
\hyperlink{structmswin__nethack__text__window}{mswin\+\_\+nethack\+\_\+text\+\_\+window} $\ast$ \hyperlink{sys_2wince_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}{P\+N\+H\+Text\+Window}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
L\+R\+E\+S\+U\+L\+T C\+A\+L\+L\+B\+A\+C\+K \hyperlink{sys_2wince_2mhtext_8c_a682f897cc2508d22b5670b3cd32748c5}{Text\+Wnd\+Proc} (H\+W\+N\+D, \hyperlink{def__os2_8h_a36cb3b01d81ffd844bbbfb54003e06ec}{U\+I\+N\+T}, W\+P\+A\+R\+A\+M, L\+P\+A\+R\+A\+M)
\item 
L\+R\+E\+S\+U\+L\+T C\+A\+L\+L\+B\+A\+C\+K \hyperlink{sys_2wince_2mhtext_8c_aa789d211183f6c28b404242c21e8d3b1}{N\+H\+Text\+Control\+Wnd\+Proc} (H\+W\+N\+D, \hyperlink{def__os2_8h_a36cb3b01d81ffd844bbbfb54003e06ec}{U\+I\+N\+T}, W\+P\+A\+R\+A\+M, L\+P\+A\+R\+A\+M)
\item 
static void \hyperlink{sys_2wince_2mhtext_8c_ab1f0aceef05a1dec643246c7cbf5353c}{on\+M\+S\+N\+H\+Command} (H\+W\+N\+D h\+Wnd, W\+P\+A\+R\+A\+M w\+Param, L\+P\+A\+R\+A\+M l\+Param)
\item 
static void \hyperlink{sys_2wince_2mhtext_8c_aafad889148472301230253fc2b8f1191}{Layout\+Text} (H\+W\+N\+D hwnd)
\item 
H\+W\+N\+D \hyperlink{sys_2wince_2mhtext_8c_ae237f4f0312cd51e1164e51204a49d09}{mswin\+\_\+init\+\_\+text\+\_\+window} ()
\item 
void \hyperlink{sys_2wince_2mhtext_8c_a5eedafc31b1220d01c9bc9d8823e5ecb}{mswin\+\_\+display\+\_\+text\+\_\+window} (H\+W\+N\+D h\+Wnd)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
static W\+N\+D\+P\+R\+O\+C \hyperlink{sys_2wince_2mhtext_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{edit\+Control\+Wnd\+Proc} = \hyperlink{uudecode_8c_a070d2ce7b6bb7e5c05602aa8c308d0c4}{N\+U\+L\+L}
\end{DoxyCompactItemize}


\subsection{Typedef Documentation}
\hypertarget{sys_2wince_2mhtext_8c_a93a68ae5d0ad265a1df776ec42c75b71}{\index{sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}!N\+H\+Text\+Window@{N\+H\+Text\+Window}}
\index{N\+H\+Text\+Window@{N\+H\+Text\+Window}!sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}}
\subsubsection[{N\+H\+Text\+Window}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf mswin\+\_\+nethack\+\_\+text\+\_\+window}  {\bf N\+H\+Text\+Window}}}\label{sys_2wince_2mhtext_8c_a93a68ae5d0ad265a1df776ec42c75b71}
\hypertarget{sys_2wince_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}{\index{sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}!P\+N\+H\+Text\+Window@{P\+N\+H\+Text\+Window}}
\index{P\+N\+H\+Text\+Window@{P\+N\+H\+Text\+Window}!sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}}
\subsubsection[{P\+N\+H\+Text\+Window}]{\setlength{\rightskip}{0pt plus 5cm}typedef struct {\bf mswin\+\_\+nethack\+\_\+text\+\_\+window} $\ast$ {\bf P\+N\+H\+Text\+Window}}}\label{sys_2wince_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}


\subsection{Function Documentation}
\hypertarget{sys_2wince_2mhtext_8c_aafad889148472301230253fc2b8f1191}{\index{sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}!Layout\+Text@{Layout\+Text}}
\index{Layout\+Text@{Layout\+Text}!sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}}
\subsubsection[{Layout\+Text}]{\setlength{\rightskip}{0pt plus 5cm}void Layout\+Text (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{hwnd}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{sys_2wince_2mhtext_8c_aafad889148472301230253fc2b8f1191}


Definition at line 160 of file mhtext.\+c.



References I\+D\+C\+\_\+\+T\+E\+X\+T\+\_\+\+C\+O\+N\+T\+R\+O\+L, S\+I\+Z\+E, and T\+R\+U\+E.



Referenced by Text\+Wnd\+Proc().


\begin{DoxyCode}
161 \{
162     HWND  btn\_ok;
163     HWND  text;
164     RECT  clrt, rt;
165     POINT pt\_elem, pt\_ok;
166     \hyperlink{global_8h_afd2537d19a3cb6556b0f727580ec6ee7}{SIZE}  sz\_elem, sz\_ok;
167 
168     text = GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a5a3e3e31caaecfedcda0408c52a93b1e}{IDC\_TEXT\_CONTROL});
169     btn\_ok = GetDlgItem(hWnd, IDOK);
170 
171     \textcolor{comment}{/* get window coordinates */}
172     GetClientRect(hWnd, &clrt );
173     
174     \textcolor{comment}{/* set window placements */}
175     \textcolor{keywordflow}{if}( IsWindow(btn\_ok) ) \{
176         GetWindowRect(btn\_ok, &rt);
177         sz\_ok.cx = clrt.right - clrt.left;
178         sz\_ok.cy = rt.bottom-rt.top;
179         pt\_ok.x = clrt.left;
180         pt\_ok.y = clrt.bottom - sz\_ok.cy;
181         MoveWindow(btn\_ok, pt\_ok.x, pt\_ok.y, sz\_ok.cx, sz\_ok.cy, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
182 
183         pt\_elem.x = clrt.left;
184         pt\_elem.y = clrt.top;
185         sz\_elem.cx = clrt.right - clrt.left;
186         sz\_elem.cy = pt\_ok.y;
187         MoveWindow(text, pt\_elem.x, pt\_elem.y, sz\_elem.cx, sz\_elem.cy, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
188     \} \textcolor{keywordflow}{else} \{
189         pt\_elem.x = clrt.left;
190         pt\_elem.y = clrt.top;
191         sz\_elem.cx = clrt.right - clrt.left;
192         sz\_elem.cy = clrt.bottom - clrt.top;
193         MoveWindow(text, pt\_elem.x, pt\_elem.y, sz\_elem.cx, sz\_elem.cy, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE} );
194     \}
195 \}
\end{DoxyCode}
\hypertarget{sys_2wince_2mhtext_8c_a5eedafc31b1220d01c9bc9d8823e5ecb}{\index{sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}!mswin\+\_\+display\+\_\+text\+\_\+window@{mswin\+\_\+display\+\_\+text\+\_\+window}}
\index{mswin\+\_\+display\+\_\+text\+\_\+window@{mswin\+\_\+display\+\_\+text\+\_\+window}!sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}}
\subsubsection[{mswin\+\_\+display\+\_\+text\+\_\+window}]{\setlength{\rightskip}{0pt plus 5cm}void mswin\+\_\+display\+\_\+text\+\_\+window (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd}
\end{DoxyParamCaption}
)}}\label{sys_2wince_2mhtext_8c_a5eedafc31b1220d01c9bc9d8823e5ecb}


Definition at line 46 of file mhtext.\+c.



Referenced by mswin\+\_\+display\+\_\+nhwindow(), and mswin\+\_\+display\+\_\+\+R\+I\+P\+\_\+window().


\begin{DoxyCode}
47 \{
48     \hyperlink{structmswin__nethack__text__window}{PNHTextWindow} data;
49     
50     data = (\hyperlink{sys_2wince_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}{PNHTextWindow})GetWindowLong(hWnd, GWL\_USERDATA);
51     \textcolor{keywordflow}{if}( data ) \{
52         HWND control;
53         control = GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a5a3e3e31caaecfedcda0408c52a93b1e}{IDC\_TEXT\_CONTROL});
54         SendMessage(control, EM\_FMTLINES, 1, 0 );
55         \hyperlink{mhtxtbuf_8c_ad3aa1058c339493ae60ba46351d4b2d4}{mswin\_render\_text}(data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text}, GetDlgItem(hWnd, 
      \hyperlink{sys_2wince_2resource_8h_a5a3e3e31caaecfedcda0408c52a93b1e}{IDC\_TEXT\_CONTROL}));
56 
57         data->\hyperlink{structmswin__nethack__text__window_a7e683da7c6146eb8003bac175347383d}{done} = 0;
58         \hyperlink{sys_2wince_2mswproc_8c_a2a23443a8cfc6b5b41024850877e0f5e}{mswin\_popup\_display}(hWnd, &data->\hyperlink{structmswin__nethack__text__window_a7e683da7c6146eb8003bac175347383d}{done});
59         \hyperlink{sys_2wince_2mswproc_8c_a49804134a4aaa8874010372eae4612f9}{mswin\_popup\_destroy}(hWnd);
60     \}
61 \}
\end{DoxyCode}
\hypertarget{sys_2wince_2mhtext_8c_ae237f4f0312cd51e1164e51204a49d09}{\index{sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}!mswin\+\_\+init\+\_\+text\+\_\+window@{mswin\+\_\+init\+\_\+text\+\_\+window}}
\index{mswin\+\_\+init\+\_\+text\+\_\+window@{mswin\+\_\+init\+\_\+text\+\_\+window}!sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}}
\subsubsection[{mswin\+\_\+init\+\_\+text\+\_\+window}]{\setlength{\rightskip}{0pt plus 5cm}H\+W\+N\+D mswin\+\_\+init\+\_\+text\+\_\+window (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{sys_2wince_2mhtext_8c_ae237f4f0312cd51e1164e51204a49d09}


Definition at line 23 of file mhtext.\+c.



Referenced by mswin\+\_\+create\+\_\+nhwindow(), and mswin\+\_\+init\+\_\+\+R\+I\+P\+\_\+window().


\begin{DoxyCode}
23                                \{
24     HWND ret;
25     \hyperlink{structmswin__nethack__text__window}{PNHTextWindow} data;
26 
27     ret = \hyperlink{dialogs_8c_aaf356545a4c5797e317091864c988de0}{CreateDialog}(
28             \hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{GetNHApp}()->hApp,
29             MAKEINTRESOURCE(\hyperlink{sys_2wince_2resource_8h_ae13d4f0d01ecf92dcee8e748f63a5bd4}{IDD\_NHTEXT}),
30             \hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{GetNHApp}()->hMainWnd,
31             \hyperlink{sys_2wince_2mhtext_8c_a682f897cc2508d22b5670b3cd32748c5}{TextWndProc}
32     );
33     \textcolor{keywordflow}{if}( !ret ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"Cannot create text window"});
34 
35     data = (\hyperlink{sys_2wince_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}{PNHTextWindow})\hyperlink{winproto_8h_ab028c02ac00afc0c1d3c568ccad68869}{malloc}(\textcolor{keyword}{sizeof}(\hyperlink{structmswin__nethack__text__window}{NHTextWindow}));
36     \textcolor{keywordflow}{if}( !data ) \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"out of memory"});
37 
38     ZeroMemory(data, \textcolor{keyword}{sizeof}(\hyperlink{structmswin__nethack__text__window}{NHTextWindow}));
39     data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text} = \hyperlink{mhtxtbuf_8c_a4fd9327233e68071e2a79c64b2e40d2b}{mswin\_init\_text\_buffer}(
40             \hyperlink{decl_8h_a91c51d44f2b6e70f8a5d42a5b5218dcd}{program\_state}.\hyperlink{structsinfo_ac1f9d8fcec6871fb805fe566ac8a8823}{gameover}? \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE} : \hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{GetNHApp}()->bWrapText
41         );
42     SetWindowLong(ret, GWL\_USERDATA, (LONG)data);
43     \textcolor{keywordflow}{return} ret;
44 \}
\end{DoxyCode}
\hypertarget{sys_2wince_2mhtext_8c_aa789d211183f6c28b404242c21e8d3b1}{\index{sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}!N\+H\+Text\+Control\+Wnd\+Proc@{N\+H\+Text\+Control\+Wnd\+Proc}}
\index{N\+H\+Text\+Control\+Wnd\+Proc@{N\+H\+Text\+Control\+Wnd\+Proc}!sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}}
\subsubsection[{N\+H\+Text\+Control\+Wnd\+Proc}]{\setlength{\rightskip}{0pt plus 5cm}L\+R\+E\+S\+U\+L\+T C\+A\+L\+L\+B\+A\+C\+K N\+H\+Text\+Control\+Wnd\+Proc (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{{\bf U\+I\+N\+T}}]{message, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)}}\label{sys_2wince_2mhtext_8c_aa789d211183f6c28b404242c21e8d3b1}


Definition at line 198 of file mhtext.\+c.



References edit\+Control\+Wnd\+Proc, and N\+U\+L\+L.



Referenced by Text\+Wnd\+Proc().


\begin{DoxyCode}
199 \{
200     \textcolor{keywordflow}{switch}(message) \{
201     \textcolor{keywordflow}{case} WM\_KEYUP:
202         \textcolor{keywordflow}{switch}( wParam ) \{
203         \textcolor{keywordflow}{case} VK\_SPACE:
204         \textcolor{keywordflow}{case} VK\_RETURN:
205             \textcolor{comment}{/* close on space */}
206             PostMessage(GetParent(hWnd), WM\_COMMAND, MAKELONG(IDOK, 0), 0);
207             \textcolor{keywordflow}{return} 0;
208         
209         \textcolor{keywordflow}{case} VK\_UP:
210             \textcolor{comment}{/* scoll up */}
211             PostMessage(hWnd, WM\_VSCROLL, MAKEWPARAM(SB\_LINEUP, 0), (LPARAM)\hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
212             \textcolor{keywordflow}{return} 0;
213 
214         \textcolor{keywordflow}{case} VK\_DOWN:
215             \textcolor{comment}{/* scoll down */}
216             PostMessage(hWnd, WM\_VSCROLL, MAKEWPARAM(SB\_LINEDOWN, 0), (LPARAM)
      \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
217             \textcolor{keywordflow}{return} 0;
218 
219         \textcolor{keywordflow}{case} VK\_LEFT:
220             \textcolor{comment}{/* scoll left */}
221             PostMessage(hWnd, WM\_HSCROLL, MAKEWPARAM(SB\_LINELEFT, 0), (LPARAM)
      \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
222             \textcolor{keywordflow}{return} 0;
223 
224         \textcolor{keywordflow}{case} VK\_RIGHT:
225             \textcolor{comment}{/* scoll right */}
226             PostMessage(hWnd, WM\_HSCROLL, MAKEWPARAM(SB\_LINERIGHT, 0), (LPARAM)
      \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL});
227             \textcolor{keywordflow}{return} 0;
228         \}
229         \textcolor{keywordflow}{break}; \textcolor{comment}{/* case WM\_KEYUP: */}
230     \}
231 
232     \textcolor{keywordflow}{if}( \hyperlink{sys_2wince_2mhtext_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{editControlWndProc} ) 
233         \textcolor{keywordflow}{return} CallWindowProc(\hyperlink{sys_2wince_2mhtext_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{editControlWndProc}, hWnd, message, wParam, lParam);
234     \textcolor{keywordflow}{else} 
235         \textcolor{keywordflow}{return} 0;
236 \}
\end{DoxyCode}
\hypertarget{sys_2wince_2mhtext_8c_ab1f0aceef05a1dec643246c7cbf5353c}{\index{sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}!on\+M\+S\+N\+H\+Command@{on\+M\+S\+N\+H\+Command}}
\index{on\+M\+S\+N\+H\+Command@{on\+M\+S\+N\+H\+Command}!sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}}
\subsubsection[{on\+M\+S\+N\+H\+Command}]{\setlength{\rightskip}{0pt plus 5cm}void on\+M\+S\+N\+H\+Command (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{sys_2wince_2mhtext_8c_ab1f0aceef05a1dec643246c7cbf5353c}


Definition at line 146 of file mhtext.\+c.



References mswin\+\_\+nhmsg\+\_\+putstr\+::attr, M\+S\+N\+H\+\_\+\+M\+S\+G\+\_\+\+P\+U\+T\+S\+T\+R, mswin\+\_\+add\+\_\+text(), mswin\+\_\+nhmsg\+\_\+putstr\+::text, and mswin\+\_\+nethack\+\_\+text\+\_\+window\+::window\+\_\+text.



Referenced by Text\+Wnd\+Proc().


\begin{DoxyCode}
147 \{
148     \hyperlink{structmswin__nethack__text__window}{PNHTextWindow} data;
149     
150     data = (\hyperlink{sys_2wince_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}{PNHTextWindow})GetWindowLong(hWnd, GWL\_USERDATA);
151     \textcolor{keywordflow}{switch}( wParam ) \{
152     \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2mhmsg_8h_a483b8d3a386f1c5d76da1dff6ed549a8}{MSNH\_MSG\_PUTSTR}: \{
153         \hyperlink{structmswin__nhmsg__putstr}{PMSNHMsgPutstr} msg\_data = (\hyperlink{sys_2wince_2mhmsg_8h_ad6db1f0e39180f07f00581a93dbdd846}{PMSNHMsgPutstr})lParam;
154         \hyperlink{mhtxtbuf_8c_a35f7fea200655732ca987c85a767df1f}{mswin\_add\_text}(data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text}, msg\_data->
      \hyperlink{structmswin__nhmsg__putstr_aefa22819f8c3ca3574cfbcfd583ded58}{attr}, msg\_data->\hyperlink{structmswin__nhmsg__putstr_a27f09d7286c01fe17c1289761b63502e}{text});
155         \textcolor{keywordflow}{break};
156     \}
157     \}
158 \}
\end{DoxyCode}
\hypertarget{sys_2wince_2mhtext_8c_a682f897cc2508d22b5670b3cd32748c5}{\index{sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}!Text\+Wnd\+Proc@{Text\+Wnd\+Proc}}
\index{Text\+Wnd\+Proc@{Text\+Wnd\+Proc}!sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}}
\subsubsection[{Text\+Wnd\+Proc}]{\setlength{\rightskip}{0pt plus 5cm}L\+R\+E\+S\+U\+L\+T C\+A\+L\+L\+B\+A\+C\+K Text\+Wnd\+Proc (
\begin{DoxyParamCaption}
\item[{H\+W\+N\+D}]{h\+Wnd, }
\item[{{\bf U\+I\+N\+T}}]{message, }
\item[{W\+P\+A\+R\+A\+M}]{w\+Param, }
\item[{L\+P\+A\+R\+A\+M}]{l\+Param}
\end{DoxyParamCaption}
)}}\label{sys_2wince_2mhtext_8c_a682f897cc2508d22b5670b3cd32748c5}


Definition at line 63 of file mhtext.\+c.



References A\+T\+R\+\_\+\+N\+O\+N\+E, mswin\+\_\+nethack\+\_\+text\+\_\+window\+::done, edit\+Control\+Wnd\+Proc, F\+A\+L\+S\+E, free(), sinfo\+::gameover, Get\+N\+H\+App(), I\+D\+C\+\_\+\+T\+E\+X\+T\+\_\+\+C\+O\+N\+T\+R\+O\+L, Layout\+Text(), M\+S\+W\+I\+N\+\_\+\+C\+O\+L\+O\+R\+\_\+\+B\+G, M\+S\+W\+I\+N\+\_\+\+C\+O\+L\+O\+R\+\_\+\+F\+G, mswin\+\_\+free\+\_\+text\+\_\+buffer(), mswin\+\_\+get\+\_\+brush(), mswin\+\_\+get\+\_\+color(), mswin\+\_\+get\+\_\+font(), N\+H\+Text\+Control\+Wnd\+Proc(), N\+H\+W\+\_\+\+T\+E\+X\+T, N\+U\+L\+L, on\+M\+S\+N\+H\+Command(), panic(), program\+\_\+state, T\+R\+U\+E, mswin\+\_\+nethack\+\_\+text\+\_\+window\+::window\+\_\+text, and W\+M\+\_\+\+M\+S\+N\+H\+\_\+\+C\+O\+M\+M\+A\+N\+D.



Referenced by mswin\+\_\+init\+\_\+text\+\_\+window().


\begin{DoxyCode}
64 \{
65     HWND control;
66     HDC hdc;
67     \hyperlink{structmswin__nethack__text__window}{PNHTextWindow} data;
68     
69     data = (\hyperlink{sys_2wince_2mhtext_8c_aaa8032e4e5366f3ed6f735e961d4994e}{PNHTextWindow})GetWindowLong(hWnd, GWL\_USERDATA);
70     \textcolor{keywordflow}{switch} (message) 
71     \{
72     \textcolor{keywordflow}{case} WM\_INITDIALOG:
73         \textcolor{comment}{/* set text control font */}
74         control = GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a5a3e3e31caaecfedcda0408c52a93b1e}{IDC\_TEXT\_CONTROL});
75         \textcolor{keywordflow}{if}( !control ) \{
76             \hyperlink{txt2iff_8c_ab0824b6f5eb51db9371d2e9a222249d3}{panic}(\textcolor{stringliteral}{"cannot get text view window"});
77         \}
78 
79         hdc = GetDC(control);
80         SendMessage(control, WM\_SETFONT, (WPARAM)\hyperlink{sys_2wince_2mhfont_8c_a480013e685b85460be07910c65a1ef51}{mswin\_get\_font}(
      \hyperlink{wintype_8h_a7e2bcc8531c4c62e8d8f1c5279c5789b}{NHW\_TEXT}, \hyperlink{wintype_8h_a20a20b74e8cf84ecfbf3c8665c059636}{ATR\_NONE}, hdc, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}), 0);
81         ReleaseDC(control, hdc);
82 
83 \textcolor{preprocessor}{#if defined(WIN\_CE\_SMARTPHONE)}
84         \textcolor{comment}{/* special initialization for SmartPhone dialogs */} 
85         NHSPhoneDialogSetup(hWnd, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{GetNHApp}()->bFullScreen);
86 \textcolor{preprocessor}{#endif}
87         \textcolor{comment}{/* subclass edit control */}
88         \hyperlink{sys_2wince_2mhtext_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{editControlWndProc} = (WNDPROC)GetWindowLong(control, GWL\_WNDPROC);
89         SetWindowLong(control, GWL\_WNDPROC, (LONG)\hyperlink{sys_2wince_2mhtext_8c_aa789d211183f6c28b404242c21e8d3b1}{NHTextControlWndProc});
90 
91         \textcolor{keywordflow}{if}( !\hyperlink{decl_8h_a91c51d44f2b6e70f8a5d42a5b5218dcd}{program\_state}.\hyperlink{structsinfo_ac1f9d8fcec6871fb805fe566ac8a8823}{gameover} && \hyperlink{win_2win32_2mhtext_8c_afa11eb8c832e838349416cf3bbdd29fe}{GetNHApp}()->bWrapText ) \{
92             DWORD styles;
93             styles = GetWindowLong(control, GWL\_STYLE);
94             \textcolor{keywordflow}{if}( styles ) \{
95                 SetWindowLong(control, GWL\_STYLE, styles & (~WS\_HSCROLL));
96                 SetWindowPos(control, \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL}, 0, 0, 0, 0, 
97                               SWP\_FRAMECHANGED | SWP\_NOZORDER | SWP\_NOMOVE | SWP\_NOSIZE );
98             \}
99         \}
100 
101         SetFocus(control);
102     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
103 
104     \textcolor{keywordflow}{case} \hyperlink{sys_2wince_2mhmsg_8h_a55eac656fabe0d462816201ac756eab6}{WM\_MSNH\_COMMAND}:
105         \hyperlink{sys_2wince_2mhtext_8c_ab1f0aceef05a1dec643246c7cbf5353c}{onMSNHCommand}(hWnd, wParam, lParam);
106     \textcolor{keywordflow}{break};
107 
108     \textcolor{keywordflow}{case} WM\_SIZE:
109         \hyperlink{sys_2wince_2mhtext_8c_aafad889148472301230253fc2b8f1191}{LayoutText}(hWnd);
110     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
111 
112     \textcolor{keywordflow}{case} WM\_COMMAND:
113         \textcolor{keywordflow}{switch} (LOWORD(wParam)) 
114         \{ 
115           \textcolor{keywordflow}{case} IDOK: 
116           \textcolor{keywordflow}{case} IDCANCEL:
117             data->\hyperlink{structmswin__nethack__text__window_a7e683da7c6146eb8003bac175347383d}{done} = 1;
118             \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
119         \}
120     \textcolor{keywordflow}{break};
121 
122     \textcolor{keywordflow}{case} WM\_CTLCOLORBTN:
123     \textcolor{keywordflow}{case} WM\_CTLCOLOREDIT:
124     \textcolor{keywordflow}{case} WM\_CTLCOLORSTATIC: \{ \textcolor{comment}{/* sent by edit control before it is drawn */}
125         HDC hdcEdit = (HDC) wParam; 
126         HWND hwndEdit = (HWND) lParam;
127         \textcolor{keywordflow}{if}( hwndEdit == GetDlgItem(hWnd, \hyperlink{sys_2wince_2resource_8h_a5a3e3e31caaecfedcda0408c52a93b1e}{IDC\_TEXT\_CONTROL}) ) \{
128             SetBkColor(hdcEdit, \hyperlink{mhcolor_8c_ab1f83ed2725328b54f6d14fc76499f77}{mswin\_get\_color}(\hyperlink{wintype_8h_a7e2bcc8531c4c62e8d8f1c5279c5789b}{NHW\_TEXT}, 
      \hyperlink{mhcolor_8h_a95a6bcc0be3a6670574883b5814f5b53}{MSWIN\_COLOR\_BG}));
129             SetTextColor(hdcEdit, \hyperlink{mhcolor_8c_ab1f83ed2725328b54f6d14fc76499f77}{mswin\_get\_color}(\hyperlink{wintype_8h_a7e2bcc8531c4c62e8d8f1c5279c5789b}{NHW\_TEXT}, 
      \hyperlink{mhcolor_8h_adebe97ec6aadf867c14e22370fffe9d8}{MSWIN\_COLOR\_FG})); 
130             \textcolor{keywordflow}{return} (BOOL)\hyperlink{mhcolor_8c_ace6d2982c253de50f648605b5352e083}{mswin\_get\_brush}(\hyperlink{wintype_8h_a7e2bcc8531c4c62e8d8f1c5279c5789b}{NHW\_TEXT}, 
      \hyperlink{mhcolor_8h_a95a6bcc0be3a6670574883b5814f5b53}{MSWIN\_COLOR\_BG});
131         \}
132     \} \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
133 
134     \textcolor{keywordflow}{case} WM\_DESTROY:
135         \textcolor{keywordflow}{if}( data ) \{
136             \hyperlink{mhtxtbuf_8c_a63fe01aa79509551331fc693eb26b49d}{mswin\_free\_text\_buffer}(data->\hyperlink{structmswin__nethack__text__window_a103624299b7831b14459a3a7b47c0271}{window\_text});
137             \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(data);
138             SetWindowLong(hWnd, GWL\_USERDATA, (LONG)0);
139         \}
140     \textcolor{keywordflow}{break};
141 
142     \}
143     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
144 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{sys_2wince_2mhtext_8c_ad6488b0aa2546ac1e148bc6ca7b51087}{\index{sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}!edit\+Control\+Wnd\+Proc@{edit\+Control\+Wnd\+Proc}}
\index{edit\+Control\+Wnd\+Proc@{edit\+Control\+Wnd\+Proc}!sys/wince/mhtext.\+c@{sys/wince/mhtext.\+c}}
\subsubsection[{edit\+Control\+Wnd\+Proc}]{\setlength{\rightskip}{0pt plus 5cm}W\+N\+D\+P\+R\+O\+C edit\+Control\+Wnd\+Proc = {\bf N\+U\+L\+L}\hspace{0.3cm}{\ttfamily [static]}}}\label{sys_2wince_2mhtext_8c_ad6488b0aa2546ac1e148bc6ca7b51087}


Definition at line 16 of file mhtext.\+c.



Referenced by N\+H\+Text\+Control\+Wnd\+Proc(), and Text\+Wnd\+Proc().

