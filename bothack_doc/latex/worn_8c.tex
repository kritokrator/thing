\hypertarget{worn_8c}{\section{nethack/src/worn.c File Reference}
\label{worn_8c}\index{nethack/src/worn.\+c@{nethack/src/worn.\+c}}
}
{\ttfamily \#include \char`\"{}hack.\+h\char`\"{}}\\*
\subsection*{Data Structures}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structworn}{worn}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{worn_8c_a903e52306a23a5d2a7123f1e0eca01c8}{w\+\_\+blocks}(o, \hyperlink{muse_8c_a3ff7db235f25673e1fe2b7b1d66d305d}{m})
\item 
\#define \hyperlink{worn_8c_afd46ee9687c8edc75261c0d3ac5a55b9}{R\+A\+C\+E\+\_\+\+E\+X\+C\+E\+P\+T\+I\+O\+N}~\hyperlink{xpm2img_8c_aa8cecfc5c5c054d2875c03e77b7be15d}{T\+R\+U\+E}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{worn_8c_afc1a5ef7d3c77ee6721ee1d80cf8972c}{F\+D\+E\+C\+L} (\hyperlink{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}{m\+\_\+lose\+\_\+armor},(struct \hyperlink{structmonst}{monst} $\ast$, struct \hyperlink{structobj}{obj} $\ast$))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{worn_8c_a72f84ef6e9d9ff1840d6d6abe4877a0f}{F\+D\+E\+C\+L} (\hyperlink{worn_8c_a84588b4c1d29698164d2dc5583654edf}{m\+\_\+dowear\+\_\+type},(struct \hyperlink{structmonst}{monst} $\ast$, long, \hyperlink{wingem1_8c_aa2723cc3af18a5199ab4ce7cca84d82b}{B\+O\+O\+L\+E\+A\+N\+\_\+\+P}, \hyperlink{wingem1_8c_aa2723cc3af18a5199ab4ce7cca84d82b}{B\+O\+O\+L\+E\+A\+N\+\_\+\+P}))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} int \hyperlink{worn_8c_a5229ab83aba90e267b4c0765887601f4}{F\+D\+E\+C\+L} (\hyperlink{worn_8c_a5ebac5438558682a47fb6dd7e404e388}{extra\+\_\+pref},(struct \hyperlink{structmonst}{monst} $\ast$, struct \hyperlink{structobj}{obj} $\ast$))
\item 
void \hyperlink{worn_8c_ae7018d12ec8662328050dfd7bd8dc903}{setworn} (struct \hyperlink{structobj}{obj} $\ast$\hyperlink{structobj}{obj}, long mask)
\item 
void \hyperlink{worn_8c_ad72610189befffb6382242d8cb32a7c7}{setnotworn} (struct \hyperlink{structobj}{obj} $\ast$\hyperlink{structobj}{obj})
\item 
void \hyperlink{worn_8c_a56f8afd7b14461c6d2cb639b68d4c44d}{mon\+\_\+set\+\_\+minvis} (struct \hyperlink{structmonst}{monst} $\ast$mon)
\item 
void \hyperlink{worn_8c_adaf11e4f4e6b2b5d86738411700e6050}{mon\+\_\+adjust\+\_\+speed} (struct \hyperlink{structmonst}{monst} $\ast$mon, int adjust, struct \hyperlink{structobj}{obj} $\ast$\hyperlink{structobj}{obj})
\item 
void \hyperlink{worn_8c_af698b30adfe86cacfe152fa4010d46c8}{update\+\_\+mon\+\_\+intrinsics} (struct \hyperlink{structmonst}{monst} $\ast$mon, struct \hyperlink{structobj}{obj} $\ast$\hyperlink{structobj}{obj}, \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} on, \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} silently)
\item 
int \hyperlink{worn_8c_a03e1b53b51c959a61e4c205e65d1095a}{find\+\_\+mac} (struct \hyperlink{structmonst}{monst} $\ast$mon)
\item 
void \hyperlink{worn_8c_a7e0d383cf09a999a333ec1154d0d52f3}{m\+\_\+dowear} (struct \hyperlink{structmonst}{monst} $\ast$mon, \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} creation)
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{worn_8c_a84588b4c1d29698164d2dc5583654edf}{m\+\_\+dowear\+\_\+type} (struct \hyperlink{structmonst}{monst} $\ast$mon, long \hyperlink{structflag}{flag}, \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} creation, \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} racialexception)
\item 
struct \hyperlink{structobj}{obj} $\ast$ \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\+\_\+armor} (struct \hyperlink{structmonst}{monst} $\ast$mon, long \hyperlink{structflag}{flag})
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}{m\+\_\+lose\+\_\+armor} (struct \hyperlink{structmonst}{monst} $\ast$mon, struct \hyperlink{structobj}{obj} $\ast$\hyperlink{structobj}{obj})
\item 
void \hyperlink{worn_8c_a77195bfffea4cea88a90989296c348e2}{clear\+\_\+bypasses} ()
\item 
void \hyperlink{worn_8c_acd31fb3fce41b2fa37b0556364fe171f}{bypass\+\_\+obj} (struct \hyperlink{structobj}{obj} $\ast$\hyperlink{structobj}{obj})
\item 
void \hyperlink{worn_8c_af06e1b52b22b9e6641e37d0199a11132}{mon\+\_\+break\+\_\+armor} (struct \hyperlink{structmonst}{monst} $\ast$mon, \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} polyspot)
\item 
static int \hyperlink{worn_8c_a5ebac5438558682a47fb6dd7e404e388}{extra\+\_\+pref} (struct \hyperlink{structmonst}{monst} $\ast$mon, struct \hyperlink{structobj}{obj} $\ast$\hyperlink{structobj}{obj})
\item 
int \hyperlink{worn_8c_a5b642b7d8b636062537ac732cdcfc11f}{racial\+\_\+exception} (struct \hyperlink{structmonst}{monst} $\ast$mon, struct \hyperlink{structobj}{obj} $\ast$\hyperlink{structobj}{obj})
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{tradstdc_8h_a2c212835823e3c54a8ab6d95c652660e}{const} struct \hyperlink{structworn}{worn} \hyperlink{worn_8c_a43357cbafc724cfb16288dcb0c946059}{worn} \mbox{[}$\,$\mbox{]}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{worn_8c_afd46ee9687c8edc75261c0d3ac5a55b9}{\index{worn.\+c@{worn.\+c}!R\+A\+C\+E\+\_\+\+E\+X\+C\+E\+P\+T\+I\+O\+N@{R\+A\+C\+E\+\_\+\+E\+X\+C\+E\+P\+T\+I\+O\+N}}
\index{R\+A\+C\+E\+\_\+\+E\+X\+C\+E\+P\+T\+I\+O\+N@{R\+A\+C\+E\+\_\+\+E\+X\+C\+E\+P\+T\+I\+O\+N}!worn.\+c@{worn.\+c}}
\subsubsection[{R\+A\+C\+E\+\_\+\+E\+X\+C\+E\+P\+T\+I\+O\+N}]{\setlength{\rightskip}{0pt plus 5cm}\#define R\+A\+C\+E\+\_\+\+E\+X\+C\+E\+P\+T\+I\+O\+N~{\bf T\+R\+U\+E}}}\label{worn_8c_afd46ee9687c8edc75261c0d3ac5a55b9}


Referenced by m\+\_\+dowear().

\hypertarget{worn_8c_a903e52306a23a5d2a7123f1e0eca01c8}{\index{worn.\+c@{worn.\+c}!w\+\_\+blocks@{w\+\_\+blocks}}
\index{w\+\_\+blocks@{w\+\_\+blocks}!worn.\+c@{worn.\+c}}
\subsubsection[{w\+\_\+blocks}]{\setlength{\rightskip}{0pt plus 5cm}\#define w\+\_\+blocks(
\begin{DoxyParamCaption}
\item[{}]{o, }
\item[{}]{{\bf m}}
\end{DoxyParamCaption}
)}}\label{worn_8c_a903e52306a23a5d2a7123f1e0eca01c8}
{\bfseries Value\+:}
\begin{DoxyCode}
((o->otyp == MUMMY\_WRAPPING && ((\hyperlink{muse_8c_a3ff7db235f25673e1fe2b7b1d66d305d}{m}) & \hyperlink{prop_8h_ac1d6573f77f2d9fe6bf8fad682246773}{W\_ARMC})) ? \hyperlink{prop_8h_a40b95fa776ec998c74266a99b91b337b}{INVIS} : \(\backslash\)
         (o->otyp == CORNUTHAUM && ((\hyperlink{muse_8c_a3ff7db235f25673e1fe2b7b1d66d305d}{m}) & \hyperlink{prop_8h_a4e8958625f891ea2329369d5032d0d6d}{W\_ARMH}) && \(\backslash\)
            !\hyperlink{you_8h_a6087f5b8605964c19078b777da740258}{Role\_if}(PM\_WIZARD)) ? \hyperlink{prop_8h_a2f32c11f8a66c407ec854ca97e84ef67}{CLAIRVOYANT} : 0)
\end{DoxyCode}


Definition at line 37 of file worn.\+c.



Referenced by setnotworn(), setworn(), and update\+\_\+mon\+\_\+intrinsics().



\subsection{Function Documentation}
\hypertarget{worn_8c_acd31fb3fce41b2fa37b0556364fe171f}{\index{worn.\+c@{worn.\+c}!bypass\+\_\+obj@{bypass\+\_\+obj}}
\index{bypass\+\_\+obj@{bypass\+\_\+obj}!worn.\+c@{worn.\+c}}
\subsubsection[{bypass\+\_\+obj}]{\setlength{\rightskip}{0pt plus 5cm}void bypass\+\_\+obj (
\begin{DoxyParamCaption}
\item[{struct {\bf obj} $\ast$}]{obj}
\end{DoxyParamCaption}
)}}\label{worn_8c_acd31fb3fce41b2fa37b0556364fe171f}


Definition at line 586 of file worn.\+c.



References flag\+::bypasses, flags, and T\+R\+U\+E.



Referenced by mon\+\_\+break\+\_\+armor().


\begin{DoxyCode}
588 \{
589     obj->bypass = 1;
590     \hyperlink{flag_8h_a997133526e0c6bed44ebc0116a48b50a}{flags}.\hyperlink{structflag_acb3f84ce448189b0bbd519bfc0b2825f}{bypasses} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
591 \}
\end{DoxyCode}
\hypertarget{worn_8c_a77195bfffea4cea88a90989296c348e2}{\index{worn.\+c@{worn.\+c}!clear\+\_\+bypasses@{clear\+\_\+bypasses}}
\index{clear\+\_\+bypasses@{clear\+\_\+bypasses}!worn.\+c@{worn.\+c}}
\subsubsection[{clear\+\_\+bypasses}]{\setlength{\rightskip}{0pt plus 5cm}void clear\+\_\+bypasses (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{worn_8c_a77195bfffea4cea88a90989296c348e2}


Definition at line 546 of file worn.\+c.



References flag\+::bypasses, D\+E\+A\+D\+M\+O\+N\+S\+T\+E\+R, F\+A\+L\+S\+E, flags, fmon, fobj, migrating\+\_\+mons, migrating\+\_\+objs, monst\+::minvent, newsym(), monst\+::nmon, obj\+::nobj, nobj, objects, otmp, and obj\+::otyp.



Referenced by savebones().


\begin{DoxyCode}
547 \{
548     \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp}, *\hyperlink{lev__yacc_8c_a2ab61a372270bf9e1fb46f02f1fb8e0a}{nobj};
549     \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp;
550 
551     \textcolor{keywordflow}{for} (otmp = \hyperlink{rm_8h_a4d2866bf9ebea1c08c26174b5c8cfbb7}{fobj}; \hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp}; otmp = \hyperlink{lev__yacc_8c_a2ab61a372270bf9e1fb46f02f1fb8e0a}{nobj}) \{
552         nobj = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj};
553         \textcolor{keywordflow}{if} (otmp->bypass) \{
554         otmp->bypass = 0;
555         \textcolor{comment}{/* bypass will have inhibited any stacking, but since it's}
556 \textcolor{comment}{           used for polymorph handling, the objects here probably}
557 \textcolor{comment}{           have been transformed and won't be stacked in the usual}
558 \textcolor{comment}{           manner afterwards; so don't bother with this */}
559 \textcolor{preprocessor}{#if 0}
560         \textcolor{keywordflow}{if} (\hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].oc\_merge) \{
561             \hyperlink{global_8h_a2043b7d01ce89f4ee2fa6c345a752d32}{xchar} ox, oy;
562 
563             (void) get\_obj\_location(otmp, &ox, &oy, 0);
564             stack\_object(otmp);
565             \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(ox, oy);
566         \}
567 \textcolor{preprocessor}{#endif  }\textcolor{comment}{/*0*/}\textcolor{preprocessor}{}
568         \}
569     \}
570     \textcolor{comment}{/* invent and mydogs chains shouldn't matter here */}
571     \textcolor{keywordflow}{for} (otmp = \hyperlink{decl_8h_a9e736562f9d13a35004d49ab7c4c0ca7}{migrating\_objs}; \hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp}; otmp = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
572         otmp->bypass = 0;
573     for (mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon}; mtmp; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon}) \{
574         \textcolor{keywordflow}{if} (\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp)) \textcolor{keywordflow}{continue};
575         \textcolor{keywordflow}{for} (otmp = mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; otmp; otmp = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
576         otmp->bypass = 0;
577     \}
578     \textcolor{keywordflow}{for} (mtmp = \hyperlink{decl_8h_a10b9afc11cdab35fe16667bb8a5506d2}{migrating\_mons}; mtmp; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon}) \{
579         \textcolor{keywordflow}{for} (otmp = mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; otmp; otmp = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
580         otmp->bypass = 0;
581     \}
582     \hyperlink{flag_8h_a997133526e0c6bed44ebc0116a48b50a}{flags}.\hyperlink{structflag_acb3f84ce448189b0bbd519bfc0b2825f}{bypasses} = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
583 \}
\end{DoxyCode}
\hypertarget{worn_8c_a5ebac5438558682a47fb6dd7e404e388}{\index{worn.\+c@{worn.\+c}!extra\+\_\+pref@{extra\+\_\+pref}}
\index{extra\+\_\+pref@{extra\+\_\+pref}!worn.\+c@{worn.\+c}}
\subsubsection[{extra\+\_\+pref}]{\setlength{\rightskip}{0pt plus 5cm}static int extra\+\_\+pref (
\begin{DoxyParamCaption}
\item[{struct {\bf monst} $\ast$}]{mon, }
\item[{struct {\bf obj} $\ast$}]{obj}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [static]}}}\label{worn_8c_a5ebac5438558682a47fb6dd7e404e388}


Definition at line 759 of file worn.\+c.



References M\+F\+A\+S\+T, and obj\+::otyp.



Referenced by m\+\_\+dowear\+\_\+type().


\begin{DoxyCode}
762 \{
763     \textcolor{keywordflow}{if} (obj) \{
764     \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == SPEED\_BOOTS && mon->permspeed != \hyperlink{monst_8h_a90047ea950c28fed112016338f30437c}{MFAST})
765         \textcolor{keywordflow}{return} 20;
766     \}
767     \textcolor{keywordflow}{return} 0;
768 \}
\end{DoxyCode}
\hypertarget{worn_8c_afc1a5ef7d3c77ee6721ee1d80cf8972c}{\index{worn.\+c@{worn.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!worn.\+c@{worn.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf m\+\_\+lose\+\_\+armor}}]{, }
\item[{(struct {\bf monst} $\ast$, struct {\bf obj} $\ast$)}]{}
\end{DoxyParamCaption}
)}}\label{worn_8c_afc1a5ef7d3c77ee6721ee1d80cf8972c}
\hypertarget{worn_8c_a72f84ef6e9d9ff1840d6d6abe4877a0f}{\index{worn.\+c@{worn.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!worn.\+c@{worn.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf m\+\_\+dowear\+\_\+type}}]{, }
\item[{(struct {\bf monst} $\ast$, long, {\bf B\+O\+O\+L\+E\+A\+N\+\_\+\+P}, {\bf B\+O\+O\+L\+E\+A\+N\+\_\+\+P})}]{}
\end{DoxyParamCaption}
)}}\label{worn_8c_a72f84ef6e9d9ff1840d6d6abe4877a0f}
\hypertarget{worn_8c_a5229ab83aba90e267b4c0765887601f4}{\index{worn.\+c@{worn.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!worn.\+c@{worn.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} int F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf extra\+\_\+pref}}]{, }
\item[{(struct {\bf monst} $\ast$, struct {\bf obj} $\ast$)}]{}
\end{DoxyParamCaption}
)}}\label{worn_8c_a5229ab83aba90e267b4c0765887601f4}
\hypertarget{worn_8c_a03e1b53b51c959a61e4c205e65d1095a}{\index{worn.\+c@{worn.\+c}!find\+\_\+mac@{find\+\_\+mac}}
\index{find\+\_\+mac@{find\+\_\+mac}!worn.\+c@{worn.\+c}}
\subsubsection[{find\+\_\+mac}]{\setlength{\rightskip}{0pt plus 5cm}int find\+\_\+mac (
\begin{DoxyParamCaption}
\item[{struct {\bf monst} $\ast$}]{mon}
\end{DoxyParamCaption}
)}}\label{worn_8c_a03e1b53b51c959a61e4c205e65d1095a}


Definition at line 328 of file worn.\+c.



References A\+R\+M\+\_\+\+B\+O\+N\+U\+S, obj\+::nobj, and obj\+::owornmask.



Referenced by drag\+\_\+ball(), experience(), find\+\_\+roll\+\_\+to\+\_\+hit(), mbhitm(), and thitmonst().


\begin{DoxyCode}
330 \{
331     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{structobj}{obj};
332     \textcolor{keywordtype}{int} base = mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}->\hyperlink{structpermonst_ad5fd940cc9e0321d3856a88fc02f1c91}{ac};
333     \textcolor{keywordtype}{long} mwflags = mon->\hyperlink{structmonst_afc2bd39e2f3e797e15bea20ac7f69788}{misc\_worn\_check};
334 
335     \textcolor{keywordflow}{for} (obj = mon->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj}) \{
336         \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} & mwflags)
337         base -= \hyperlink{hack_8h_a6f8b3c40024cf8afd2f563673fb0efc6}{ARM\_BONUS}(obj);
338         \textcolor{comment}{/* since ARM\_BONUS is positive, subtracting it increases AC */}
339     \}
340     \textcolor{keywordflow}{return} base;
341 \}
\end{DoxyCode}
\hypertarget{worn_8c_a7e0d383cf09a999a333ec1154d0d52f3}{\index{worn.\+c@{worn.\+c}!m\+\_\+dowear@{m\+\_\+dowear}}
\index{m\+\_\+dowear@{m\+\_\+dowear}!worn.\+c@{worn.\+c}}
\subsubsection[{m\+\_\+dowear}]{\setlength{\rightskip}{0pt plus 5cm}void m\+\_\+dowear (
\begin{DoxyParamCaption}
\item[{struct {\bf monst} $\ast$}]{mon, }
\item[{{\bf boolean}}]{creation}
\end{DoxyParamCaption}
)}}\label{worn_8c_a7e0d383cf09a999a333ec1154d0d52f3}


Definition at line 359 of file worn.\+c.



References bimanual, cantweararm, F\+A\+L\+S\+E, is\+\_\+animal, m\+\_\+dowear\+\_\+type(), mindless, M\+O\+N\+\_\+\+W\+E\+P, mons, M\+Z\+\_\+\+S\+M\+A\+L\+L, nohands, R\+A\+C\+E\+\_\+\+E\+X\+C\+E\+P\+T\+I\+O\+N, S\+\_\+\+C\+E\+N\+T\+A\+U\+R, S\+\_\+\+M\+U\+M\+M\+Y, slithy, verysmall, W\+\_\+\+A\+M\+U\+L, W\+\_\+\+A\+R\+M, W\+\_\+\+A\+R\+M\+C, W\+\_\+\+A\+R\+M\+F, W\+\_\+\+A\+R\+M\+G, W\+\_\+\+A\+R\+M\+H, and W\+\_\+\+A\+R\+M\+S.



Referenced by mk\+\_\+mplayer(), and savebones().


\begin{DoxyCode}
362 \{
363 \textcolor{preprocessor}{#define RACE\_EXCEPTION TRUE}
364     \textcolor{comment}{/* Note the restrictions here are the same as in dowear in do\_wear.c}
365 \textcolor{comment}{     * except for the additional restriction on intelligence.  (Players}
366 \textcolor{comment}{     * are always intelligent, even if polymorphed).}
367 \textcolor{comment}{     */}
368     \textcolor{keywordflow}{if} (\hyperlink{mondata_8h_a655fd80b963b28e5f4b7a52fc8d1f32d}{verysmall}(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) || \hyperlink{mondata_8h_ae13d4a4d0a9842348cffbb5dae990771}{nohands}(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) || 
      \hyperlink{mondata_8h_a6633b7e5ce3955ef878c6890a72b9392}{is\_animal}(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}))
369         \textcolor{keywordflow}{return};
370     \textcolor{comment}{/* give mummies a chance to wear their wrappings}
371 \textcolor{comment}{     * and let skeletons wear their initial armor */}
372     \textcolor{keywordflow}{if} (\hyperlink{mondata_8h_a9b2e225376aeed6f19559b2c2dced2d0}{mindless}(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) && (!creation ||
373         (mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}->\hyperlink{structpermonst_ab402dbf1bed9d0e595a2b3da6558da92}{mlet} != \hyperlink{monsym_8h_af0c3ce0cab08d748710bf38390422cdd}{S\_MUMMY} && mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data} != &\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[PM\_SKELETON])))
374         \textcolor{keywordflow}{return};
375 
376     \hyperlink{worn_8c_a84588b4c1d29698164d2dc5583654edf}{m\_dowear\_type}(mon, \hyperlink{prop_8h_a1a4f9d6f31538cc9d677e617b49597d2}{W\_AMUL}, creation, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
377 \textcolor{preprocessor}{#ifdef TOURIST}
378     \textcolor{comment}{/* can't put on shirt if already wearing suit */}
379     \textcolor{keywordflow}{if} (!\hyperlink{mondata_8h_a08fcb907e85a73d4dbd5109fe1abdf5d}{cantweararm}(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) || (mon->\hyperlink{structmonst_afc2bd39e2f3e797e15bea20ac7f69788}{misc\_worn\_check} & 
      \hyperlink{prop_8h_a4f442d75a01cf88dcd71965d0d1f6155}{W\_ARM}))
380         \hyperlink{worn_8c_a84588b4c1d29698164d2dc5583654edf}{m\_dowear\_type}(mon, W\_ARMU, creation, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
381 \textcolor{preprocessor}{#endif}
382     \textcolor{comment}{/* treating small as a special case allows}
383 \textcolor{comment}{       hobbits, gnomes, and kobolds to wear cloaks */}
384     \textcolor{keywordflow}{if} (!\hyperlink{mondata_8h_a08fcb907e85a73d4dbd5109fe1abdf5d}{cantweararm}(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) || mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}->\hyperlink{structpermonst_a29f8d76dae8c7c96eab01dd8ec27717b}{msize} == 
      \hyperlink{monflag_8h_a202353ef2b65bee48c346db8a9ea7561}{MZ\_SMALL})
385         \hyperlink{worn_8c_a84588b4c1d29698164d2dc5583654edf}{m\_dowear\_type}(mon, \hyperlink{prop_8h_ac1d6573f77f2d9fe6bf8fad682246773}{W\_ARMC}, creation, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
386     \hyperlink{worn_8c_a84588b4c1d29698164d2dc5583654edf}{m\_dowear\_type}(mon, \hyperlink{prop_8h_a4e8958625f891ea2329369d5032d0d6d}{W\_ARMH}, creation, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
387     \textcolor{keywordflow}{if} (!\hyperlink{monst_8h_a19da8d7346e2a28afa6385a73cf36f86}{MON\_WEP}(mon) || !\hyperlink{obj_8h_a6cd644088e281f2bcc78f1d94dc91476}{bimanual}(\hyperlink{monst_8h_a19da8d7346e2a28afa6385a73cf36f86}{MON\_WEP}(mon)))
388         \hyperlink{worn_8c_a84588b4c1d29698164d2dc5583654edf}{m\_dowear\_type}(mon, \hyperlink{prop_8h_a14ac9957d8019d2304ceedb5d794fb4f}{W\_ARMS}, creation, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
389     \hyperlink{worn_8c_a84588b4c1d29698164d2dc5583654edf}{m\_dowear\_type}(mon, \hyperlink{prop_8h_ab96deae86360c93dcb4c33fdf246109f}{W\_ARMG}, creation, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
390     \textcolor{keywordflow}{if} (!\hyperlink{mondata_8h_a9be35efaf79658a7043053e73cc055de}{slithy}(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) && mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}->\hyperlink{structpermonst_ab402dbf1bed9d0e595a2b3da6558da92}{mlet} != \hyperlink{monsym_8h_a092e4d08a56151a274ba13e17f9aec39}{S\_CENTAUR})
391         \hyperlink{worn_8c_a84588b4c1d29698164d2dc5583654edf}{m\_dowear\_type}(mon, \hyperlink{prop_8h_a10a0477af46978e26b84ea4f7e1d5af0}{W\_ARMF}, creation, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
392     \textcolor{keywordflow}{if} (!\hyperlink{mondata_8h_a08fcb907e85a73d4dbd5109fe1abdf5d}{cantweararm}(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}))
393         \hyperlink{worn_8c_a84588b4c1d29698164d2dc5583654edf}{m\_dowear\_type}(mon, \hyperlink{prop_8h_a4f442d75a01cf88dcd71965d0d1f6155}{W\_ARM}, creation, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
394     \textcolor{keywordflow}{else}
395         \hyperlink{worn_8c_a84588b4c1d29698164d2dc5583654edf}{m\_dowear\_type}(mon, \hyperlink{prop_8h_a4f442d75a01cf88dcd71965d0d1f6155}{W\_ARM}, creation, \hyperlink{worn_8c_afd46ee9687c8edc75261c0d3ac5a55b9}{RACE\_EXCEPTION});
396 \}
\end{DoxyCode}
\hypertarget{worn_8c_a84588b4c1d29698164d2dc5583654edf}{\index{worn.\+c@{worn.\+c}!m\+\_\+dowear\+\_\+type@{m\+\_\+dowear\+\_\+type}}
\index{m\+\_\+dowear\+\_\+type@{m\+\_\+dowear\+\_\+type}!worn.\+c@{worn.\+c}}
\subsubsection[{m\+\_\+dowear\+\_\+type}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void m\+\_\+dowear\+\_\+type (
\begin{DoxyParamCaption}
\item[{struct {\bf monst} $\ast$}]{mon, }
\item[{long}]{flag, }
\item[{{\bf boolean}}]{creation, }
\item[{{\bf boolean}}]{racialexception}
\end{DoxyParamCaption}
)}}\label{worn_8c_a84588b4c1d29698164d2dc5583654edf}


Definition at line 399 of file worn.\+c.



References A\+M\+U\+L\+E\+T\+\_\+\+C\+L\+A\+S\+S, A\+R\+M\+\_\+\+B\+O\+N\+U\+S, buf, B\+U\+F\+S\+Z, canseemon, extra\+\_\+pref(), F\+A\+L\+S\+E, has\+\_\+horns, is\+\_\+boots, is\+\_\+cloak, is\+\_\+flimsy, is\+\_\+gloves, is\+\_\+helmet, is\+\_\+shield, is\+\_\+shirt, is\+\_\+suit, makeknown, nambuf, obj\+::nobj, objects, objclass\+::oc\+\_\+delay, obj\+::oclass, obj\+::otyp, obj\+::owornmask, racial\+\_\+exception(), See\+\_\+invisible, Sprintf, Strcpy, T\+O\+U\+R\+I\+S\+T, T\+R\+U\+E, update\+\_\+mon\+\_\+intrinsics(), W\+\_\+\+A\+M\+U\+L, W\+\_\+\+A\+R\+M, W\+\_\+\+A\+R\+M\+C, W\+\_\+\+A\+R\+M\+F, W\+\_\+\+A\+R\+M\+G, W\+\_\+\+A\+R\+M\+H, W\+\_\+\+A\+R\+M\+S, and which\+\_\+armor().



Referenced by m\+\_\+dowear().


\begin{DoxyCode}
404 \{
405     \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *old, *best, *\hyperlink{structobj}{obj};
406     \textcolor{keywordtype}{int} m\_delay = 0;
407     \textcolor{keywordtype}{int} unseen = !\hyperlink{display_8h_ad75e04a9624fe7ba0e1715ae3a3feb27}{canseemon}(mon);
408     \textcolor{keywordtype}{char} \hyperlink{questpgr_8c_a0d2e3145707b491c18fd62d7dd92f4a3}{nambuf}[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
409 
410     \textcolor{keywordflow}{if} (mon->mfrozen) \textcolor{keywordflow}{return}; \textcolor{comment}{/* probably putting previous item on */}
411 
412     \textcolor{comment}{/* Get a copy of monster's name before altering its visibility */}
413     \hyperlink{global_8h_add22f733d1f2c380499f495068e42b7c}{Strcpy}(nambuf, \hyperlink{youprop_8h_ae00ea7702fa1870643d604364b0640c7}{See\_invisible} ? Monnam(mon) : mon\_nam(mon));
414 
415     old = \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\_armor}(mon, \hyperlink{structflag}{flag});
416     \textcolor{keywordflow}{if} (old && old->cursed) \textcolor{keywordflow}{return};
417     \textcolor{keywordflow}{if} (old && \hyperlink{structflag}{flag} == \hyperlink{prop_8h_a1a4f9d6f31538cc9d677e617b49597d2}{W\_AMUL}) \textcolor{keywordflow}{return}; \textcolor{comment}{/* no such thing as better amulets */}
418     best = old;
419 
420     \textcolor{keywordflow}{for}(obj = mon->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj}) \{
421         \textcolor{keywordflow}{switch}(\hyperlink{structflag}{flag}) \{
422         \textcolor{keywordflow}{case} \hyperlink{prop_8h_a1a4f9d6f31538cc9d677e617b49597d2}{W\_AMUL}:
423             \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_a716ba3ee00602dede9ea5c68c74d45bd}{oclass} != \hyperlink{objclass_8h_af05e45a3c94a4a19096ee4f048ee96cd}{AMULET\_CLASS} ||
424                 (obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} != AMULET\_OF\_LIFE\_SAVING &&
425                 obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} != AMULET\_OF\_REFLECTION))
426             \textcolor{keywordflow}{continue};
427             best = obj;
428             \textcolor{keywordflow}{goto} outer\_break; \textcolor{comment}{/* no such thing as better amulets */}
429 \textcolor{preprocessor}{#ifdef TOURIST}
430         \textcolor{keywordflow}{case} W\_ARMU:
431             \textcolor{keywordflow}{if} (!\hyperlink{obj_8h_a96ac846294b8ac0ebf562c7887d8516d}{is\_shirt}(obj)) \textcolor{keywordflow}{continue};
432             \textcolor{keywordflow}{break};
433 \textcolor{preprocessor}{#endif}
434         \textcolor{keywordflow}{case} \hyperlink{prop_8h_ac1d6573f77f2d9fe6bf8fad682246773}{W\_ARMC}:
435             \textcolor{keywordflow}{if} (!\hyperlink{obj_8h_ad201bb666a33dcbecfe3293c2be06cc9}{is\_cloak}(obj)) \textcolor{keywordflow}{continue};
436             \textcolor{keywordflow}{break};
437         \textcolor{keywordflow}{case} \hyperlink{prop_8h_a4e8958625f891ea2329369d5032d0d6d}{W\_ARMH}:
438             \textcolor{keywordflow}{if} (!\hyperlink{obj_8h_ac319cdf71bb42b783da10680b2e8a3bf}{is\_helmet}(obj)) \textcolor{keywordflow}{continue};
439             \textcolor{comment}{/* (flimsy exception matches polyself handling) */}
440             \textcolor{keywordflow}{if} (\hyperlink{mondata_8h_a98e33091114b0f4ea59f7dea0ac1adcd}{has\_horns}(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) && !\hyperlink{obj_8h_abddc351efe0b64d02040a3ae8c320c19}{is\_flimsy}(obj)) \textcolor{keywordflow}{continue};
441             \textcolor{keywordflow}{break};
442         \textcolor{keywordflow}{case} \hyperlink{prop_8h_a14ac9957d8019d2304ceedb5d794fb4f}{W\_ARMS}:
443             \textcolor{keywordflow}{if} (!\hyperlink{obj_8h_a19ea1dc07bf84b8a73c76a7ec871c9d4}{is\_shield}(obj)) \textcolor{keywordflow}{continue};
444             \textcolor{keywordflow}{break};
445         \textcolor{keywordflow}{case} \hyperlink{prop_8h_ab96deae86360c93dcb4c33fdf246109f}{W\_ARMG}:
446             \textcolor{keywordflow}{if} (!\hyperlink{obj_8h_a99515fd3635a22bb6a9a41412d8ab172}{is\_gloves}(obj)) \textcolor{keywordflow}{continue};
447             \textcolor{keywordflow}{break};
448         \textcolor{keywordflow}{case} \hyperlink{prop_8h_a10a0477af46978e26b84ea4f7e1d5af0}{W\_ARMF}:
449             \textcolor{keywordflow}{if} (!\hyperlink{obj_8h_a1a3fe473d2d0a10c897156e3b13fc0c6}{is\_boots}(obj)) \textcolor{keywordflow}{continue};
450             \textcolor{keywordflow}{break};
451         \textcolor{keywordflow}{case} \hyperlink{prop_8h_a4f442d75a01cf88dcd71965d0d1f6155}{W\_ARM}:
452             \textcolor{keywordflow}{if} (!\hyperlink{obj_8h_a0aefa948a424ee03e424efb3b8a198a1}{is\_suit}(obj)) \textcolor{keywordflow}{continue};
453             \textcolor{keywordflow}{if} (racialexception && (\hyperlink{worn_8c_a5b642b7d8b636062537ac732cdcfc11f}{racial\_exception}(mon, obj) < 1)) \textcolor{keywordflow}{continue};
454             \textcolor{keywordflow}{break};
455         \}
456         \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask}) \textcolor{keywordflow}{continue};
457         \textcolor{comment}{/* I'd like to define a VISIBLE\_ARM\_BONUS which doesn't assume the}
458 \textcolor{comment}{         * monster knows obj->spe, but if I did that, a monster would keep}
459 \textcolor{comment}{         * switching forever between two -2 caps since when it took off one}
460 \textcolor{comment}{         * it would forget spe and once again think the object is better}
461 \textcolor{comment}{         * than what it already has.}
462 \textcolor{comment}{         */}
463         \textcolor{keywordflow}{if} (best && (\hyperlink{hack_8h_a6f8b3c40024cf8afd2f563673fb0efc6}{ARM\_BONUS}(best) + \hyperlink{worn_8c_a5ebac5438558682a47fb6dd7e404e388}{extra\_pref}(mon,best) >= 
      \hyperlink{hack_8h_a6f8b3c40024cf8afd2f563673fb0efc6}{ARM\_BONUS}(obj) + \hyperlink{worn_8c_a5ebac5438558682a47fb6dd7e404e388}{extra\_pref}(mon,obj)))
464         \textcolor{keywordflow}{continue};
465         best = obj;
466     \}
467 outer\_break:
468     \textcolor{keywordflow}{if} (!best || best == old) \textcolor{keywordflow}{return};
469 
470     \textcolor{comment}{/* if wearing a cloak, account for the time spent removing}
471 \textcolor{comment}{       and re-wearing it when putting on a suit or shirt */}
472     \textcolor{keywordflow}{if} ((\hyperlink{structflag}{flag} == \hyperlink{prop_8h_a4f442d75a01cf88dcd71965d0d1f6155}{W\_ARM}
473 #ifdef \hyperlink{config_8h_a5565af126ac9f8351b459d76cde1ee50}{TOURIST}
474       || \hyperlink{structflag}{flag} == W\_ARMU
475 #endif
476               ) && (mon->\hyperlink{structmonst_afc2bd39e2f3e797e15bea20ac7f69788}{misc\_worn\_check} & \hyperlink{prop_8h_ac1d6573f77f2d9fe6bf8fad682246773}{W\_ARMC}))
477         m\_delay += 2;
478     \textcolor{comment}{/* when upgrading a piece of armor, account for time spent}
479 \textcolor{comment}{       taking off current one */}
480     \textcolor{keywordflow}{if} (old)
481         m\_delay += \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[old->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].\hyperlink{structobjclass_a3469efe1c95970cd0360b882459a42ae}{oc\_delay};
482 
483     \textcolor{keywordflow}{if} (old) \textcolor{comment}{/* do this first to avoid "(being worn)" */}
484         old->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} = 0L;
485     \textcolor{keywordflow}{if} (!creation) \{
486         \textcolor{keywordflow}{if} (\hyperlink{display_8h_ad75e04a9624fe7ba0e1715ae3a3feb27}{canseemon}(mon)) \{
487         \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
488 
489         \textcolor{keywordflow}{if} (old)
490             \hyperlink{global_8h_aa55ba8f4e3c82fe00035e6b51d6c7dee}{Sprintf}(buf, \textcolor{stringliteral}{" removes %s and"}, distant\_name(old, doname));
491         \textcolor{keywordflow}{else}
492             buf[0] = \textcolor{charliteral}{'\(\backslash\)0'};
493         pline(\textcolor{stringliteral}{"%s%s puts on %s."}, Monnam(mon),
494               buf, distant\_name(best,doname));
495         \} \textcolor{comment}{/* can see it */}
496         m\_delay += \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[best->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].\hyperlink{structobjclass_a3469efe1c95970cd0360b882459a42ae}{oc\_delay};
497         mon->mfrozen = m\_delay;
498         \textcolor{keywordflow}{if} (mon->mfrozen) mon->mcanmove = 0;
499     \}
500     \textcolor{keywordflow}{if} (old)
501         \hyperlink{worn_8c_af698b30adfe86cacfe152fa4010d46c8}{update\_mon\_intrinsics}(mon, old, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, creation);
502     mon->\hyperlink{structmonst_afc2bd39e2f3e797e15bea20ac7f69788}{misc\_worn\_check} |= \hyperlink{structflag}{flag};
503     best->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} |= \hyperlink{structflag}{flag};
504     \hyperlink{worn_8c_af698b30adfe86cacfe152fa4010d46c8}{update\_mon\_intrinsics}(mon, best, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}, creation);
505     \textcolor{comment}{/* if couldn't see it but now can, or vice versa, */}
506     \textcolor{keywordflow}{if} (!creation && (unseen ^ !\hyperlink{display_8h_ad75e04a9624fe7ba0e1715ae3a3feb27}{canseemon}(mon))) \{
507         \textcolor{keywordflow}{if} (mon->minvis && !\hyperlink{youprop_8h_ae00ea7702fa1870643d604364b0640c7}{See\_invisible}) \{
508             pline(\textcolor{stringliteral}{"Suddenly you cannot see %s."}, nambuf);
509             \hyperlink{hack_8h_afbd3607e7cef2f888f4190d40d058011}{makeknown}(best->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp});
510         \} \textcolor{comment}{/* else if (!mon->minvis) pline("%s suddenly appears!", Amonnam(mon)); */}
511     \}
512 \}
\end{DoxyCode}
\hypertarget{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}{\index{worn.\+c@{worn.\+c}!m\+\_\+lose\+\_\+armor@{m\+\_\+lose\+\_\+armor}}
\index{m\+\_\+lose\+\_\+armor@{m\+\_\+lose\+\_\+armor}!worn.\+c@{worn.\+c}}
\subsubsection[{m\+\_\+lose\+\_\+armor}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void m\+\_\+lose\+\_\+armor (
\begin{DoxyParamCaption}
\item[{struct {\bf monst} $\ast$}]{mon, }
\item[{struct {\bf obj} $\ast$}]{obj}
\end{DoxyParamCaption}
)}}\label{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}


Definition at line 529 of file worn.\+c.



References F\+A\+L\+S\+E, newsym(), obj\+::owornmask, and update\+\_\+mon\+\_\+intrinsics().



Referenced by mon\+\_\+break\+\_\+armor().


\begin{DoxyCode}
532 \{
533     mon->\hyperlink{structmonst_afc2bd39e2f3e797e15bea20ac7f69788}{misc\_worn\_check} &= ~obj->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask};
534     \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask})
535         \hyperlink{worn_8c_af698b30adfe86cacfe152fa4010d46c8}{update\_mon\_intrinsics}(mon, obj, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
536     obj->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} = 0L;
537 
538     obj\_extract\_self(obj);
539     place\_object(obj, mon->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx}, mon->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my});
540     \textcolor{comment}{/* call stackobj() if we ever drop anything that can merge */}
541     \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(mon->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx}, mon->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my});
542 \}
\end{DoxyCode}
\hypertarget{worn_8c_adaf11e4f4e6b2b5d86738411700e6050}{\index{worn.\+c@{worn.\+c}!mon\+\_\+adjust\+\_\+speed@{mon\+\_\+adjust\+\_\+speed}}
\index{mon\+\_\+adjust\+\_\+speed@{mon\+\_\+adjust\+\_\+speed}!worn.\+c@{worn.\+c}}
\subsubsection[{mon\+\_\+adjust\+\_\+speed}]{\setlength{\rightskip}{0pt plus 5cm}void mon\+\_\+adjust\+\_\+speed (
\begin{DoxyParamCaption}
\item[{struct {\bf monst} $\ast$}]{mon, }
\item[{int}]{adjust, }
\item[{struct {\bf obj} $\ast$}]{obj}
\end{DoxyParamCaption}
)}}\label{worn_8c_adaf11e4f4e6b2b5d86738411700e6050}


Definition at line 144 of file worn.\+c.



References canseemon, F\+A\+L\+S\+E, F\+A\+S\+T, flags, in\+\_\+mklev, makeknown, M\+F\+A\+S\+T, M\+S\+L\+O\+W, obj\+::nobj, objects, objclass\+::oc\+\_\+class, objclass\+::oc\+\_\+oprop, otmp, obj\+::otyp, obj\+::owornmask, S\+P\+B\+O\+O\+K\+\_\+\+C\+L\+A\+S\+S, T\+R\+U\+E, and flag\+::verbose.



Referenced by damageum(), mon\+\_\+consume\+\_\+unstone(), update\+\_\+mon\+\_\+intrinsics(), and use\+\_\+misc().


\begin{DoxyCode}
148 \{
149     \textcolor{keyword}{struct }obj *\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
150     \textcolor{keywordtype}{boolean} give\_msg = !\hyperlink{decl_8h_abb694ef5acb9945ca69679a8360df51a}{in\_mklev}, petrify = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
151     \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} oldspeed = mon->mspeed;
152 
153     \textcolor{keywordflow}{switch} (adjust) \{
154      \textcolor{keywordflow}{case}  2:
155     mon->permspeed = \hyperlink{monst_8h_a90047ea950c28fed112016338f30437c}{MFAST};
156     give\_msg = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};  \textcolor{comment}{/* special case monster creation */}
157     \textcolor{keywordflow}{break};
158      \textcolor{keywordflow}{case}  1:
159     \textcolor{keywordflow}{if} (mon->permspeed == \hyperlink{monst_8h_a0791e61151c83c9f3bba131b79daadec}{MSLOW}) mon->permspeed = 0;
160     \textcolor{keywordflow}{else} mon->permspeed = \hyperlink{monst_8h_a90047ea950c28fed112016338f30437c}{MFAST};
161     \textcolor{keywordflow}{break};
162      \textcolor{keywordflow}{case}  0:           \textcolor{comment}{/* just check for worn speed boots */}
163     \textcolor{keywordflow}{break};
164      \textcolor{keywordflow}{case} -1:
165     \textcolor{keywordflow}{if} (mon->permspeed == \hyperlink{monst_8h_a90047ea950c28fed112016338f30437c}{MFAST}) mon->permspeed = 0;
166     \textcolor{keywordflow}{else} mon->permspeed = \hyperlink{monst_8h_a0791e61151c83c9f3bba131b79daadec}{MSLOW};
167     \textcolor{keywordflow}{break};
168      \textcolor{keywordflow}{case} -2:
169     mon->permspeed = \hyperlink{monst_8h_a0791e61151c83c9f3bba131b79daadec}{MSLOW};
170     give\_msg = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};  \textcolor{comment}{/* (not currently used) */}
171     \textcolor{keywordflow}{break};
172      \textcolor{keywordflow}{case} -3:           \textcolor{comment}{/* petrification */}
173     \textcolor{comment}{/* take away intrinsic speed but don't reduce normal speed */}
174     \textcolor{keywordflow}{if} (mon->permspeed == \hyperlink{monst_8h_a90047ea950c28fed112016338f30437c}{MFAST}) mon->permspeed = 0;
175     petrify = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
176     \textcolor{keywordflow}{break};
177     \}
178 
179     \textcolor{keywordflow}{for} (otmp = mon->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; otmp; otmp = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
180     \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} && \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].\hyperlink{structobjclass_a3a6ca47a71d5a816b8661d90442baf46}{oc\_oprop} == 
      \hyperlink{prop_8h_a8091c2bcff55cbe0a4a145fd5fb7c22d}{FAST})
181         \textcolor{keywordflow}{break};
182     \textcolor{keywordflow}{if} (otmp)       \textcolor{comment}{/* speed boots */}
183     mon->mspeed = \hyperlink{monst_8h_a90047ea950c28fed112016338f30437c}{MFAST};
184     \textcolor{keywordflow}{else}
185     mon->mspeed = mon->permspeed;
186 
187     \textcolor{keywordflow}{if} (give\_msg && (mon->mspeed != oldspeed || petrify) && \hyperlink{display_8h_ad75e04a9624fe7ba0e1715ae3a3feb27}{canseemon}(mon)) \{
188     \textcolor{comment}{/* fast to slow (skipping intermediate state) or vice versa */}
189     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *howmuch = (mon->mspeed + oldspeed == \hyperlink{monst_8h_a90047ea950c28fed112016338f30437c}{MFAST} + \hyperlink{monst_8h_a0791e61151c83c9f3bba131b79daadec}{MSLOW}) ?
190                 \textcolor{stringliteral}{"much "} : \textcolor{stringliteral}{""};
191 
192     \textcolor{keywordflow}{if} (petrify) \{
193         \textcolor{comment}{/* mimic the player's petrification countdown; "slowing down"}
194 \textcolor{comment}{           even if fast movement rate retained via worn speed boots */}
195         \textcolor{keywordflow}{if} (\hyperlink{flag_8h_a997133526e0c6bed44ebc0116a48b50a}{flags}.\hyperlink{structflag_afd7dfe45d35356d861ab5e9834231929}{verbose}) pline(\textcolor{stringliteral}{"%s is slowing down."}, Monnam(mon));
196     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (adjust > 0 || mon->mspeed == \hyperlink{monst_8h_a90047ea950c28fed112016338f30437c}{MFAST})
197         pline(\textcolor{stringliteral}{"%s is suddenly moving %sfaster."}, Monnam(mon), howmuch);
198     \textcolor{keywordflow}{else}
199         pline(\textcolor{stringliteral}{"%s seems to be moving %sslower."}, Monnam(mon), howmuch);
200 
201     \textcolor{comment}{/* might discover an object if we see the speed change happen, but}
202 \textcolor{comment}{       avoid making possibly forgotten book known when casting its spell */}
203     \textcolor{keywordflow}{if} (obj != 0 && obj->dknown &&
204         \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].\hyperlink{structobjclass_ae589e91e556e204c84f05597da510559}{oc\_class} != \hyperlink{objclass_8h_aba5935524b39b0fdd148a3d466a5c580}{SPBOOK\_CLASS})
205         \hyperlink{hack_8h_afbd3607e7cef2f888f4190d40d058011}{makeknown}(obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp});
206     \}
207 \}
\end{DoxyCode}
\hypertarget{worn_8c_af06e1b52b22b9e6641e37d0199a11132}{\index{worn.\+c@{worn.\+c}!mon\+\_\+break\+\_\+armor@{mon\+\_\+break\+\_\+armor}}
\index{mon\+\_\+break\+\_\+armor@{mon\+\_\+break\+\_\+armor}!worn.\+c@{worn.\+c}}
\subsubsection[{mon\+\_\+break\+\_\+armor}]{\setlength{\rightskip}{0pt plus 5cm}void mon\+\_\+break\+\_\+armor (
\begin{DoxyParamCaption}
\item[{struct {\bf monst} $\ast$}]{mon, }
\item[{{\bf boolean}}]{polyspot}
\end{DoxyParamCaption}
)}}\label{worn_8c_af06e1b52b22b9e6641e37d0199a11132}


Definition at line 594 of file worn.\+c.



References buf, B\+U\+F\+S\+Z, bypass\+\_\+obj(), cansee, D\+I\+S\+M\+O\+U\+N\+T\+\_\+\+F\+E\+L\+L, Dragon\+\_\+mail\+\_\+to\+\_\+pm, Dragon\+\_\+scales\+\_\+to\+\_\+pm, has\+\_\+horns, Is\+\_\+dragon\+\_\+mail, Is\+\_\+dragon\+\_\+scales, is\+\_\+flimsy, is\+\_\+whirly, m\+\_\+lose\+\_\+armor(), mhim, mhis, permonst\+::mlet, M\+O\+N\+\_\+\+W\+E\+P, nohands, obj\+::oartifact, otmp, S\+\_\+\+C\+E\+N\+T\+A\+U\+R, slithy, Sprintf, Stone\+\_\+resistance, touch\+\_\+petrifies, u, verysmall, W\+\_\+\+A\+R\+M, W\+\_\+\+A\+R\+M\+C, W\+\_\+\+A\+R\+M\+F, W\+\_\+\+A\+R\+M\+G, W\+\_\+\+A\+R\+M\+H, W\+\_\+\+A\+R\+M\+S, and which\+\_\+armor().


\begin{DoxyCode}
597 \{
598     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
599     \textcolor{keyword}{struct }\hyperlink{structpermonst}{permonst} *mdat = mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data};
600     \textcolor{keywordtype}{boolean} vis = \hyperlink{vision_8h_a857efc720262bc13a9e4b4bcbb079b5c}{cansee}(mon->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx}, mon->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my});
601     \textcolor{keywordtype}{boolean} handless\_or\_tiny = (\hyperlink{mondata_8h_ae13d4a4d0a9842348cffbb5dae990771}{nohands}(mdat) || \hyperlink{mondata_8h_a655fd80b963b28e5f4b7a52fc8d1f32d}{verysmall}(mdat));
602     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *pronoun = \hyperlink{you_8h_ad994e7a24679279ec24f0ef064a274d7}{mhim}(mon),
603             *ppronoun = \hyperlink{you_8h_aa53b72a15dda33a02f28703fbc551090}{mhis}(mon);
604 
605     \textcolor{keywordflow}{if} (breakarm(mdat)) \{
606         \textcolor{keywordflow}{if} ((otmp = \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\_armor}(mon, \hyperlink{prop_8h_a4f442d75a01cf88dcd71965d0d1f6155}{W\_ARM})) != 0) \{
607         \textcolor{keywordflow}{if} ((\hyperlink{obj_8h_ac74e03bc58e77a20c6478ad7061e0198}{Is\_dragon\_scales}(otmp) &&
608             mdat == \hyperlink{obj_8h_a02b387f55e41d65f41c2f4430352cba7}{Dragon\_scales\_to\_pm}(otmp)) ||
609             (\hyperlink{obj_8h_a73558b304aee9d9803e5e71d1ca5fa60}{Is\_dragon\_mail}(otmp) && mdat == \hyperlink{obj_8h_a143816c96e8c90f4d541dc6a4490fe90}{Dragon\_mail\_to\_pm}(otmp)))
610             ;   \textcolor{comment}{/* no message here;}
611 \textcolor{comment}{               "the dragon merges with his scaly armor" is odd}
612 \textcolor{comment}{               and the monster's previous form is already gone */}
613         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (vis)
614             pline(\textcolor{stringliteral}{"%s breaks out of %s armor!"}, Monnam(mon), ppronoun);
615         \textcolor{keywordflow}{else}
616             You\_hear(\textcolor{stringliteral}{"a cracking sound."});
617         m\_useup(mon, otmp);
618         \}
619         \textcolor{keywordflow}{if} ((otmp = \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\_armor}(mon, \hyperlink{prop_8h_ac1d6573f77f2d9fe6bf8fad682246773}{W\_ARMC})) != 0) \{
620         \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_af03ce8a6a0ca51e8d8954fb1a1a31fbe}{oartifact}) \{
621             \textcolor{keywordflow}{if} (vis)
622             pline(\textcolor{stringliteral}{"%s %s falls off!"}, s\_suffix(Monnam(mon)),
623                 cloak\_simple\_name(otmp));
624             \textcolor{keywordflow}{if} (polyspot) \hyperlink{worn_8c_acd31fb3fce41b2fa37b0556364fe171f}{bypass\_obj}(otmp);
625             \hyperlink{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}{m\_lose\_armor}(mon, otmp);
626         \} \textcolor{keywordflow}{else} \{
627             \textcolor{keywordflow}{if} (vis)
628             pline(\textcolor{stringliteral}{"%s %s tears apart!"}, s\_suffix(Monnam(mon)),
629                 cloak\_simple\_name(otmp));
630             \textcolor{keywordflow}{else}
631             You\_hear(\textcolor{stringliteral}{"a ripping sound."});
632             m\_useup(mon, otmp);
633         \}
634         \}
635 \textcolor{preprocessor}{#ifdef TOURIST}
636         \textcolor{keywordflow}{if} ((otmp = \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\_armor}(mon, W\_ARMU)) != 0) \{
637         \textcolor{keywordflow}{if} (vis)
638             pline(\textcolor{stringliteral}{"%s shirt rips to shreds!"}, s\_suffix(Monnam(mon)));
639         \textcolor{keywordflow}{else}
640             You\_hear(\textcolor{stringliteral}{"a ripping sound."});
641         m\_useup(mon, otmp);
642         \}
643 \textcolor{preprocessor}{#endif}
644     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sliparm(mdat)) \{
645         \textcolor{keywordflow}{if} ((otmp = \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\_armor}(mon, \hyperlink{prop_8h_a4f442d75a01cf88dcd71965d0d1f6155}{W\_ARM})) != 0) \{
646         \textcolor{keywordflow}{if} (vis)
647             pline(\textcolor{stringliteral}{"%s armor falls around %s!"},
648                  s\_suffix(Monnam(mon)), pronoun);
649         \textcolor{keywordflow}{else}
650             You\_hear(\textcolor{stringliteral}{"a thud."});
651         \textcolor{keywordflow}{if} (polyspot) \hyperlink{worn_8c_acd31fb3fce41b2fa37b0556364fe171f}{bypass\_obj}(otmp);
652         \hyperlink{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}{m\_lose\_armor}(mon, otmp);
653         \}
654         \textcolor{keywordflow}{if} ((otmp = \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\_armor}(mon, \hyperlink{prop_8h_ac1d6573f77f2d9fe6bf8fad682246773}{W\_ARMC})) != 0) \{
655         \textcolor{keywordflow}{if} (vis) \{
656             \textcolor{keywordflow}{if} (\hyperlink{mondata_8h_ad5ce5d0c9e98b8d48b288b01a961e8d0}{is\_whirly}(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}))
657             pline(\textcolor{stringliteral}{"%s %s falls, unsupported!"},
658                      s\_suffix(Monnam(mon)), cloak\_simple\_name(otmp));
659             \textcolor{keywordflow}{else}
660             pline(\textcolor{stringliteral}{"%s shrinks out of %s %s!"}, Monnam(mon),
661                         ppronoun, cloak\_simple\_name(otmp));
662         \}
663         \textcolor{keywordflow}{if} (polyspot) \hyperlink{worn_8c_acd31fb3fce41b2fa37b0556364fe171f}{bypass\_obj}(otmp);
664         \hyperlink{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}{m\_lose\_armor}(mon, otmp);
665         \}
666 \textcolor{preprocessor}{#ifdef TOURIST}
667         \textcolor{keywordflow}{if} ((otmp = \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\_armor}(mon, W\_ARMU)) != 0) \{
668         \textcolor{keywordflow}{if} (vis) \{
669             \textcolor{keywordflow}{if} (sliparm(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}))
670             pline(\textcolor{stringliteral}{"%s seeps right through %s shirt!"},
671                     Monnam(mon), ppronoun);
672             \textcolor{keywordflow}{else}
673             pline(\textcolor{stringliteral}{"%s becomes much too small for %s shirt!"},
674                     Monnam(mon), ppronoun);
675         \}
676         \textcolor{keywordflow}{if} (polyspot) \hyperlink{worn_8c_acd31fb3fce41b2fa37b0556364fe171f}{bypass\_obj}(otmp);
677         \hyperlink{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}{m\_lose\_armor}(mon, otmp);
678         \}
679 \textcolor{preprocessor}{#endif}
680     \}
681     \textcolor{keywordflow}{if} (handless\_or\_tiny) \{
682         \textcolor{comment}{/* [caller needs to handle weapon checks] */}
683         \textcolor{keywordflow}{if} ((otmp = \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\_armor}(mon, \hyperlink{prop_8h_ab96deae86360c93dcb4c33fdf246109f}{W\_ARMG})) != 0) \{
684         \textcolor{keywordflow}{if} (vis)
685             pline(\textcolor{stringliteral}{"%s drops %s gloves%s!"}, Monnam(mon), ppronoun,
686                     \hyperlink{monst_8h_a19da8d7346e2a28afa6385a73cf36f86}{MON\_WEP}(mon) ? \textcolor{stringliteral}{" and weapon"} : \textcolor{stringliteral}{""});
687         \textcolor{keywordflow}{if} (polyspot) \hyperlink{worn_8c_acd31fb3fce41b2fa37b0556364fe171f}{bypass\_obj}(otmp);
688         \hyperlink{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}{m\_lose\_armor}(mon, otmp);
689         \}
690         \textcolor{keywordflow}{if} ((otmp = \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\_armor}(mon, \hyperlink{prop_8h_a14ac9957d8019d2304ceedb5d794fb4f}{W\_ARMS})) != 0) \{
691         \textcolor{keywordflow}{if} (vis)
692             pline(\textcolor{stringliteral}{"%s can no longer hold %s shield!"}, Monnam(mon),
693                                 ppronoun);
694         \textcolor{keywordflow}{else}
695             You\_hear(\textcolor{stringliteral}{"a clank."});
696         \textcolor{keywordflow}{if} (polyspot) \hyperlink{worn_8c_acd31fb3fce41b2fa37b0556364fe171f}{bypass\_obj}(otmp);
697         \hyperlink{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}{m\_lose\_armor}(mon, otmp);
698         \}
699     \}
700     \textcolor{keywordflow}{if} (handless\_or\_tiny || \hyperlink{mondata_8h_a98e33091114b0f4ea59f7dea0ac1adcd}{has\_horns}(mdat)) \{
701         \textcolor{keywordflow}{if} ((otmp = \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\_armor}(mon, \hyperlink{prop_8h_a4e8958625f891ea2329369d5032d0d6d}{W\_ARMH})) != 0 &&
702             \textcolor{comment}{/* flimsy test for horns matches polyself handling */}
703             (handless\_or\_tiny || !\hyperlink{obj_8h_abddc351efe0b64d02040a3ae8c320c19}{is\_flimsy}(otmp))) \{
704         \textcolor{keywordflow}{if} (vis)
705             pline(\textcolor{stringliteral}{"%s helmet falls to the %s!"},
706               s\_suffix(Monnam(mon)), surface(mon->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx}, mon->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my}));
707         \textcolor{keywordflow}{else}
708             You\_hear(\textcolor{stringliteral}{"a clank."});
709         \textcolor{keywordflow}{if} (polyspot) \hyperlink{worn_8c_acd31fb3fce41b2fa37b0556364fe171f}{bypass\_obj}(otmp);
710         \hyperlink{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}{m\_lose\_armor}(mon, otmp);
711         \}
712     \}
713     \textcolor{keywordflow}{if} (handless\_or\_tiny || \hyperlink{mondata_8h_a9be35efaf79658a7043053e73cc055de}{slithy}(mdat) || mdat->\hyperlink{structpermonst_ab402dbf1bed9d0e595a2b3da6558da92}{mlet} == \hyperlink{monsym_8h_a092e4d08a56151a274ba13e17f9aec39}{S\_CENTAUR}) \{
714         \textcolor{keywordflow}{if} ((otmp = \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\_armor}(mon, \hyperlink{prop_8h_a10a0477af46978e26b84ea4f7e1d5af0}{W\_ARMF})) != 0) \{
715         \textcolor{keywordflow}{if} (vis) \{
716             \textcolor{keywordflow}{if} (\hyperlink{mondata_8h_ad5ce5d0c9e98b8d48b288b01a961e8d0}{is\_whirly}(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}))
717             pline(\textcolor{stringliteral}{"%s boots fall away!"},
718                        s\_suffix(Monnam(mon)));
719             \textcolor{keywordflow}{else} pline(\textcolor{stringliteral}{"%s boots %s off %s feet!"},
720             s\_suffix(Monnam(mon)),
721             \hyperlink{mondata_8h_a655fd80b963b28e5f4b7a52fc8d1f32d}{verysmall}(mdat) ? \textcolor{stringliteral}{"slide"} : \textcolor{stringliteral}{"are pushed"}, ppronoun);
722         \}
723         \textcolor{keywordflow}{if} (polyspot) \hyperlink{worn_8c_acd31fb3fce41b2fa37b0556364fe171f}{bypass\_obj}(otmp);
724         \hyperlink{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}{m\_lose\_armor}(mon, otmp);
725         \}
726     \}
727 \textcolor{preprocessor}{#ifdef STEED}
728     \textcolor{keywordflow}{if} (!can\_saddle(mon)) \{
729         \textcolor{keywordflow}{if} ((otmp = \hyperlink{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{which\_armor}(mon, W\_SADDLE)) != 0) \{
730         \textcolor{keywordflow}{if} (polyspot) \hyperlink{worn_8c_acd31fb3fce41b2fa37b0556364fe171f}{bypass\_obj}(otmp);
731         \hyperlink{worn_8c_a2ed9f1278ca77ca1b6f903bbd4150ba8}{m\_lose\_armor}(mon, otmp);
732         \textcolor{keywordflow}{if} (vis)
733             pline(\textcolor{stringliteral}{"%s saddle falls off."}, s\_suffix(Monnam(mon)));
734         \}
735         \textcolor{keywordflow}{if} (mon == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.usteed)
736         \textcolor{keywordflow}{goto} noride;
737     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (mon == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.usteed && !can\_ride(mon)) \{
738     noride:
739         You(\textcolor{stringliteral}{"can no longer ride %s."}, mon\_nam(mon));
740         \textcolor{keywordflow}{if} (\hyperlink{mondata_8h_ad1e85e493d27cdfdbe94c43710c4b191}{touch\_petrifies}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.usteed->data) &&
741             !\hyperlink{youprop_8h_a90b638323d50e1f8d52d4a9576d90551}{Stone\_resistance} && rnl(3)) \{
742         \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
743 
744         You(\textcolor{stringliteral}{"touch %s."}, mon\_nam(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.usteed));
745         \hyperlink{global_8h_aa55ba8f4e3c82fe00035e6b51d6c7dee}{Sprintf}(buf, \textcolor{stringliteral}{"falling off %s"},
746                 an(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.usteed->data->mname));
747         instapetrify(buf);
748         \}
749         dismount\_steed(\hyperlink{hack_8h_a90c6def474309a3671856e184151b13a}{DISMOUNT\_FELL});
750     \}
751 \textcolor{preprocessor}{#endif}
752     \textcolor{keywordflow}{return};
753 \}
\end{DoxyCode}
\hypertarget{worn_8c_a56f8afd7b14461c6d2cb639b68d4c44d}{\index{worn.\+c@{worn.\+c}!mon\+\_\+set\+\_\+minvis@{mon\+\_\+set\+\_\+minvis}}
\index{mon\+\_\+set\+\_\+minvis@{mon\+\_\+set\+\_\+minvis}!worn.\+c@{worn.\+c}}
\subsubsection[{mon\+\_\+set\+\_\+minvis}]{\setlength{\rightskip}{0pt plus 5cm}void mon\+\_\+set\+\_\+minvis (
\begin{DoxyParamCaption}
\item[{struct {\bf monst} $\ast$}]{mon}
\end{DoxyParamCaption}
)}}\label{worn_8c_a56f8afd7b14461c6d2cb639b68d4c44d}


Definition at line 132 of file worn.\+c.



References newsym(), and see\+\_\+wsegs().



Referenced by use\+\_\+misc().


\begin{DoxyCode}
134 \{
135     mon->perminvis = 1;
136     \textcolor{keywordflow}{if} (!mon->invis\_blkd) \{
137         mon->minvis = 1;
138         \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(mon->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx}, mon->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my});     \textcolor{comment}{/* make it disappear */}
139         \textcolor{keywordflow}{if} (mon->wormno) \hyperlink{worm_8c_ae1052541ce10767f111a9d22e7761ebc}{see\_wsegs}(mon);   \textcolor{comment}{/* and any tail too */}
140     \}
141 \}
\end{DoxyCode}
\hypertarget{worn_8c_a5b642b7d8b636062537ac732cdcfc11f}{\index{worn.\+c@{worn.\+c}!racial\+\_\+exception@{racial\+\_\+exception}}
\index{racial\+\_\+exception@{racial\+\_\+exception}!worn.\+c@{worn.\+c}}
\subsubsection[{racial\+\_\+exception}]{\setlength{\rightskip}{0pt plus 5cm}int racial\+\_\+exception (
\begin{DoxyParamCaption}
\item[{struct {\bf monst} $\ast$}]{mon, }
\item[{struct {\bf obj} $\ast$}]{obj}
\end{DoxyParamCaption}
)}}\label{worn_8c_a5b642b7d8b636062537ac732cdcfc11f}


Definition at line 778 of file worn.\+c.



References is\+\_\+elven\+\_\+armor, and mons.



Referenced by m\+\_\+dowear\+\_\+type().


\begin{DoxyCode}
781 \{
782     \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structpermonst}{permonst} *ptr = raceptr(mon);
783 
784     \textcolor{comment}{/* Acceptable Exceptions: */}
785     \textcolor{comment}{/* Allow hobbits to wear elven armor - LoTR */}
786     \textcolor{keywordflow}{if} (ptr == &\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[PM\_HOBBIT] && \hyperlink{obj_8h_a48a6133fb34208096017be32b0af9237}{is\_elven\_armor}(obj))
787     \textcolor{keywordflow}{return} 1;
788     \textcolor{comment}{/* Unacceptable Exceptions: */}
789     \textcolor{comment}{/* Checks for object that certain races should never use go here */}
790     \textcolor{comment}{/*  return -1; */}
791 
792     \textcolor{keywordflow}{return} 0;
793 \}
\end{DoxyCode}
\hypertarget{worn_8c_ad72610189befffb6382242d8cb32a7c7}{\index{worn.\+c@{worn.\+c}!setnotworn@{setnotworn}}
\index{setnotworn@{setnotworn}!worn.\+c@{worn.\+c}}
\subsubsection[{setnotworn}]{\setlength{\rightskip}{0pt plus 5cm}void setnotworn (
\begin{DoxyParamCaption}
\item[{struct {\bf obj} $\ast$}]{obj}
\end{DoxyParamCaption}
)}}\label{worn_8c_ad72610189befffb6382242d8cb32a7c7}


Definition at line 109 of file worn.\+c.



References prop\+::blocked, prop\+::extrinsic, objects, objclass\+::oc\+\_\+oprop, you\+::twoweap, u, update\+\_\+inventory, you\+::uprops, uswapwep, uwep, w\+\_\+blocks, worn\+::w\+\_\+mask, and worn\+::w\+\_\+obj.


\begin{DoxyCode}
111 \{
112     \textcolor{keyword}{register} \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structworn}{worn} *wp;
113     \textcolor{keyword}{register} \textcolor{keywordtype}{int} p;
114 
115     \textcolor{keywordflow}{if} (!obj) \textcolor{keywordflow}{return};
116     \textcolor{keywordflow}{if} (obj == \hyperlink{decl_8h_a1aefaef88eef9075d8136d19410fd3b1}{uwep} || obj == \hyperlink{decl_8h_ab2586a729017fc01f4612808c80c1945}{uswapwep}) \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ade2cee6956bba775aa796bba6ae857ec}{twoweap} = 0;
117     \textcolor{keywordflow}{for}(wp = \hyperlink{structworn}{worn}; wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask}; wp++)
118         \textcolor{keywordflow}{if}(obj == *(wp->\hyperlink{structworn_a630486081e658e9550c99e01e2779046}{w\_obj})) \{
119         *(wp->\hyperlink{structworn_a630486081e658e9550c99e01e2779046}{w\_obj}) = 0;
120         p = \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].\hyperlink{structobjclass_a3a6ca47a71d5a816b8661d90442baf46}{oc\_oprop};
121         \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a922add41f13d0ca6d1665b8754964030}{uprops}[p].\hyperlink{structprop_abb64d43d46c8fe8dda8be7af5343794f}{extrinsic} = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a922add41f13d0ca6d1665b8754964030}{uprops}[p].\hyperlink{structprop_abb64d43d46c8fe8dda8be7af5343794f}{extrinsic} & ~wp->
      \hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask};
122         obj->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} &= ~wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask};
123         \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_af03ce8a6a0ca51e8d8954fb1a1a31fbe}{oartifact})
124             set\_artifact\_intrinsic(obj, 0, wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask});
125         \textcolor{keywordflow}{if} ((p = \hyperlink{worn_8c_a903e52306a23a5d2a7123f1e0eca01c8}{w\_blocks}(obj,wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask})) != 0)
126             \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a922add41f13d0ca6d1665b8754964030}{uprops}[p].\hyperlink{structprop_abf63a816d40b9af51fbb3304372f4fa7}{blocked} &= ~wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask};
127         \}
128     \hyperlink{winprocs_8h_a12feb374290012aafc2340c5ba15f7e8}{update\_inventory}();
129 \}
\end{DoxyCode}
\hypertarget{worn_8c_ae7018d12ec8662328050dfd7bd8dc903}{\index{worn.\+c@{worn.\+c}!setworn@{setworn}}
\index{setworn@{setworn}!worn.\+c@{worn.\+c}}
\subsubsection[{setworn}]{\setlength{\rightskip}{0pt plus 5cm}void setworn (
\begin{DoxyParamCaption}
\item[{struct {\bf obj} $\ast$}]{obj, }
\item[{long}]{mask}
\end{DoxyParamCaption}
)}}\label{worn_8c_ae7018d12ec8662328050dfd7bd8dc903}


Definition at line 47 of file worn.\+c.



References prop\+::blocked, prop\+::extrinsic, I\+\_\+\+S\+P\+E\+C\+I\+A\+L, is\+\_\+weptool, obj\+::oartifact, objects, objclass\+::oc\+\_\+oprop, obj\+::otyp, obj\+::owornmask, you\+::twoweap, u, update\+\_\+inventory, you\+::uprops, uskin, W\+\_\+\+A\+R\+M, w\+\_\+blocks, worn\+::w\+\_\+mask, worn\+::w\+\_\+obj, W\+\_\+\+Q\+U\+I\+V\+E\+R, W\+\_\+\+S\+W\+A\+P\+W\+E\+P, W\+\_\+\+W\+E\+P, and W\+E\+A\+P\+O\+N\+\_\+\+C\+L\+A\+S\+S.



Referenced by dorecover(), ini\+\_\+inv(), restgamestate(), setuqwep(), setuswapwep(), setuwep(), throwit(), uqwepgone(), uswapwepgone(), and uwepgone().


\begin{DoxyCode}
50 \{
51     \textcolor{keyword}{register} \textcolor{keyword}{const} \textcolor{keyword}{struct }\hyperlink{structworn}{worn} *wp;
52     \textcolor{keyword}{register} \textcolor{keyword}{struct }obj *oobj;
53     \textcolor{keyword}{register} \textcolor{keywordtype}{int} p;
54 
55     \textcolor{keywordflow}{if} ((mask & (\hyperlink{prop_8h_a4f442d75a01cf88dcd71965d0d1f6155}{W\_ARM}|\hyperlink{prop_8h_aff6bdb685dfe46c115d9b2f133394c34}{I\_SPECIAL})) == (\hyperlink{prop_8h_a4f442d75a01cf88dcd71965d0d1f6155}{W\_ARM}|\hyperlink{prop_8h_aff6bdb685dfe46c115d9b2f133394c34}{I\_SPECIAL})) \{
56         \textcolor{comment}{/* restoring saved game; no properties are conferred via skin */}
57         \hyperlink{decl_8h_a585d9f19a7c4a6b419bceab43c687471}{uskin} = obj;
58      \textcolor{comment}{/* assert( !uarm ); */}
59     \} \textcolor{keywordflow}{else} \{
60         \textcolor{keywordflow}{for}(wp = \hyperlink{structworn}{worn}; wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask}; wp++) \textcolor{keywordflow}{if}(wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask} & mask) \{
61         oobj = *(wp->\hyperlink{structworn_a630486081e658e9550c99e01e2779046}{w\_obj});
62         \textcolor{keywordflow}{if}(oobj && !(oobj->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} & wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask}))
63             impossible(\textcolor{stringliteral}{"Setworn: mask = %ld."}, wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask});
64         \textcolor{keywordflow}{if}(oobj) \{
65             \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ade2cee6956bba775aa796bba6ae857ec}{twoweap} && (oobj->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} & (\hyperlink{prop_8h_abd75a55f67b13523ef4377d4eb6fb6ad}{W\_WEP}|
      \hyperlink{prop_8h_a4571f54e71d38d81a610eaf77e5fecd9}{W\_SWAPWEP})))
66             \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ade2cee6956bba775aa796bba6ae857ec}{twoweap} = 0;
67             oobj->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} &= ~wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask};
68             if (wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask} & ~(\hyperlink{prop_8h_a4571f54e71d38d81a610eaf77e5fecd9}{W\_SWAPWEP}|\hyperlink{prop_8h_a9b95d7c6e22f325a5bc0326d7673a4f4}{W\_QUIVER})) \{
69             \textcolor{comment}{/* leave as "x = x <op> y", here and below, for broken}
70 \textcolor{comment}{             * compilers */}
71             p = \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[oobj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].\hyperlink{structobjclass_a3a6ca47a71d5a816b8661d90442baf46}{oc\_oprop};
72             \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a922add41f13d0ca6d1665b8754964030}{uprops}[p].\hyperlink{structprop_abb64d43d46c8fe8dda8be7af5343794f}{extrinsic} =
73                     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a922add41f13d0ca6d1665b8754964030}{uprops}[p].\hyperlink{structprop_abb64d43d46c8fe8dda8be7af5343794f}{extrinsic} & ~wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask};
74             \textcolor{keywordflow}{if} ((p = \hyperlink{worn_8c_a903e52306a23a5d2a7123f1e0eca01c8}{w\_blocks}(oobj,mask)) != 0)
75                 \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a922add41f13d0ca6d1665b8754964030}{uprops}[p].\hyperlink{structprop_abf63a816d40b9af51fbb3304372f4fa7}{blocked} &= ~wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask};
76             if (oobj->\hyperlink{structobj_af03ce8a6a0ca51e8d8954fb1a1a31fbe}{oartifact})
77                 set\_artifact\_intrinsic(oobj, 0, mask);
78             \}
79         \}
80         *(wp->\hyperlink{structworn_a630486081e658e9550c99e01e2779046}{w\_obj}) = obj;
81         \textcolor{keywordflow}{if}(obj) \{
82             obj->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} |= wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask};
83             \textcolor{comment}{/* Prevent getting/blocking intrinsics from wielding}
84 \textcolor{comment}{             * potions, through the quiver, etc.}
85 \textcolor{comment}{             * Allow weapon-tools, too.}
86 \textcolor{comment}{             * wp\_mask should be same as mask at this point.}
87 \textcolor{comment}{             */}
88             \textcolor{keywordflow}{if} (wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask} & ~(\hyperlink{prop_8h_a4571f54e71d38d81a610eaf77e5fecd9}{W\_SWAPWEP}|\hyperlink{prop_8h_a9b95d7c6e22f325a5bc0326d7673a4f4}{W\_QUIVER})) \{
89             \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_a716ba3ee00602dede9ea5c68c74d45bd}{oclass} == \hyperlink{objclass_8h_a615c2dc6d3501d6b5e14c3373bc37ec1}{WEAPON\_CLASS} || \hyperlink{obj_8h_a5f347f7456e4da8284a9bc369bc32d45}{is\_weptool}(obj) ||
90                         mask != \hyperlink{prop_8h_abd75a55f67b13523ef4377d4eb6fb6ad}{W\_WEP}) \{
91                 p = \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].\hyperlink{structobjclass_a3a6ca47a71d5a816b8661d90442baf46}{oc\_oprop};
92                 \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a922add41f13d0ca6d1665b8754964030}{uprops}[p].\hyperlink{structprop_abb64d43d46c8fe8dda8be7af5343794f}{extrinsic} =
93                     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a922add41f13d0ca6d1665b8754964030}{uprops}[p].\hyperlink{structprop_abb64d43d46c8fe8dda8be7af5343794f}{extrinsic} | wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask};
94                 \textcolor{keywordflow}{if} ((p = \hyperlink{worn_8c_a903e52306a23a5d2a7123f1e0eca01c8}{w\_blocks}(obj, mask)) != 0)
95                 \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a922add41f13d0ca6d1665b8754964030}{uprops}[p].\hyperlink{structprop_abf63a816d40b9af51fbb3304372f4fa7}{blocked} |= wp->\hyperlink{structworn_ae7561ee72a51ddfe0e5a093e3b3eb645}{w\_mask};
96             \}
97             \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_af03ce8a6a0ca51e8d8954fb1a1a31fbe}{oartifact})
98                 set\_artifact\_intrinsic(obj, 1, mask);
99             \}
100         \}
101         \}
102     \}
103     \hyperlink{winprocs_8h_a12feb374290012aafc2340c5ba15f7e8}{update\_inventory}();
104 \}
\end{DoxyCode}
\hypertarget{worn_8c_af698b30adfe86cacfe152fa4010d46c8}{\index{worn.\+c@{worn.\+c}!update\+\_\+mon\+\_\+intrinsics@{update\+\_\+mon\+\_\+intrinsics}}
\index{update\+\_\+mon\+\_\+intrinsics@{update\+\_\+mon\+\_\+intrinsics}!worn.\+c@{worn.\+c}}
\subsubsection[{update\+\_\+mon\+\_\+intrinsics}]{\setlength{\rightskip}{0pt plus 5cm}void update\+\_\+mon\+\_\+intrinsics (
\begin{DoxyParamCaption}
\item[{struct {\bf monst} $\ast$}]{mon, }
\item[{struct {\bf obj} $\ast$}]{obj, }
\item[{{\bf boolean}}]{on, }
\item[{{\bf boolean}}]{silently}
\end{DoxyParamCaption}
)}}\label{worn_8c_af698b30adfe86cacfe152fa4010d46c8}


Definition at line 211 of file worn.\+c.



References A\+C\+I\+D\+\_\+\+R\+E\+S, A\+N\+T\+I\+M\+A\+G\+I\+C, canseemon, C\+L\+A\+I\+R\+V\+O\+Y\+A\+N\+T, C\+O\+L\+D\+\_\+\+R\+E\+S, D\+I\+S\+I\+N\+T\+\_\+\+R\+E\+S, D\+I\+S\+M\+O\+U\+N\+T\+\_\+\+F\+E\+L\+L, D\+I\+S\+P\+L\+A\+C\+E\+D, F\+A\+S\+T, F\+I\+R\+E\+\_\+\+R\+E\+S, F\+U\+M\+B\+L\+I\+N\+G, in\+\_\+mklev, I\+N\+V\+I\+S, J\+U\+M\+P\+I\+N\+G, L\+E\+V\+I\+T\+A\+T\+I\+O\+N, mon\+\_\+adjust\+\_\+speed(), newsym(), obj\+::nobj, objects, objclass\+::oc\+\_\+oprop, otmp, obj\+::otyp, obj\+::owornmask, P\+O\+I\+S\+O\+N\+\_\+\+R\+E\+S, P\+R\+O\+T\+E\+C\+T\+I\+O\+N, R\+E\+F\+L\+E\+C\+T\+I\+N\+G, S\+H\+O\+C\+K\+\_\+\+R\+E\+S, S\+L\+E\+E\+P\+\_\+\+R\+E\+S, S\+T\+E\+A\+L\+T\+H, S\+T\+O\+N\+E\+\_\+\+R\+E\+S, T\+E\+L\+E\+P\+A\+T, T\+R\+U\+E, u, w\+\_\+blocks, and W\+W\+A\+L\+K\+I\+N\+G.



Referenced by loot\+\_\+mon(), m\+\_\+dowear\+\_\+type(), m\+\_\+lose\+\_\+armor(), and steal\+\_\+it().


\begin{DoxyCode}
215 \{
216     \textcolor{keywordtype}{int} unseen;
217     \hyperlink{config_8h_a65f85814a8290f9797005d3b28e7e5fc}{uchar} mask;
218     \textcolor{keyword}{struct }obj *\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
219     \textcolor{keywordtype}{int} which = (int) \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].\hyperlink{structobjclass_a3a6ca47a71d5a816b8661d90442baf46}{oc\_oprop};
220 
221     unseen = !\hyperlink{display_8h_ad75e04a9624fe7ba0e1715ae3a3feb27}{canseemon}(mon);
222     \textcolor{keywordflow}{if} (!which) \textcolor{keywordflow}{goto} maybe\_blocks;
223 
224     \textcolor{keywordflow}{if} (on) \{
225     \textcolor{keywordflow}{switch} (which) \{
226      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a40b95fa776ec998c74266a99b91b337b}{INVIS}:
227         mon->minvis = !mon->invis\_blkd;
228         \textcolor{keywordflow}{break};
229      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a8091c2bcff55cbe0a4a145fd5fb7c22d}{FAST}:
230       \{
231         \textcolor{keywordtype}{boolean} save\_in\_mklev = \hyperlink{decl_8h_abb694ef5acb9945ca69679a8360df51a}{in\_mklev};
232         \textcolor{keywordflow}{if} (silently) \hyperlink{decl_8h_abb694ef5acb9945ca69679a8360df51a}{in\_mklev} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
233         \hyperlink{worn_8c_adaf11e4f4e6b2b5d86738411700e6050}{mon\_adjust\_speed}(mon, 0, obj);
234         \hyperlink{decl_8h_abb694ef5acb9945ca69679a8360df51a}{in\_mklev} = save\_in\_mklev;
235         \textcolor{keywordflow}{break};
236       \}
237     \textcolor{comment}{/* properties handled elsewhere */}
238      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a65d713df318a0dc9400618301e9d5207}{ANTIMAGIC}:
239      \textcolor{keywordflow}{case} \hyperlink{prop_8h_aa02de61bfc6d838502e4d11b3e36bd7f}{REFLECTING}:
240         \textcolor{keywordflow}{break};
241     \textcolor{comment}{/* properties which have no effect for monsters */}
242      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a2f32c11f8a66c407ec854ca97e84ef67}{CLAIRVOYANT}:
243      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a4b43e7e907bc8c94c0e89133bf42eb9e}{STEALTH}:
244      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a7a158e60673afd90ad1e7afd36ac8250}{TELEPAT}:
245         \textcolor{keywordflow}{break};
246     \textcolor{comment}{/* properties which should have an effect but aren't implemented */}
247      \textcolor{keywordflow}{case} \hyperlink{prop_8h_aa563130dd6683c115d2567364d79785b}{LEVITATION}:
248      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a9d9e3cbab7d5dd049e867977f8c5f73b}{WWALKING}:
249         \textcolor{keywordflow}{break};
250     \textcolor{comment}{/* properties which maybe should have an effect but don't */}
251      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a080f7ad78387cfab67726314242900d4}{DISPLACED}:
252      \textcolor{keywordflow}{case} \hyperlink{prop_8h_ae8ddbd7cfd9ecd76e11c80ed368b5014}{FUMBLING}:
253      \textcolor{keywordflow}{case} \hyperlink{prop_8h_ae8a4beac84265d4b9e17b174eb9a654d}{JUMPING}:
254      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a3edd319ff92fe698be953178dc1cec70}{PROTECTION}:
255         \textcolor{keywordflow}{break};
256      \textcolor{keywordflow}{default}:
257         \textcolor{keywordflow}{if} (which <= 8) \{   \textcolor{comment}{/* 1 thru 8 correspond to MR\_xxx mask values */}
258         \textcolor{comment}{/* FIRE,COLD,SLEEP,DISINT,SHOCK,POISON,ACID,STONE */}
259         mask = (\hyperlink{config_8h_a65f85814a8290f9797005d3b28e7e5fc}{uchar}) (1 << (which - 1));
260         mon->\hyperlink{structmonst_a75e177403095d3c7ce5636d6d20ed725}{mintrinsics} |= (\textcolor{keywordtype}{unsigned} short) mask;
261         \}
262         \textcolor{keywordflow}{break};
263     \}
264     \} \textcolor{keywordflow}{else} \{        \textcolor{comment}{/* off */}
265     \textcolor{keywordflow}{switch} (which) \{
266      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a40b95fa776ec998c74266a99b91b337b}{INVIS}:
267         mon->minvis = mon->perminvis;
268         \textcolor{keywordflow}{break};
269      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a8091c2bcff55cbe0a4a145fd5fb7c22d}{FAST}:
270       \{
271         \textcolor{keywordtype}{boolean} save\_in\_mklev = \hyperlink{decl_8h_abb694ef5acb9945ca69679a8360df51a}{in\_mklev};
272         \textcolor{keywordflow}{if} (silently) \hyperlink{decl_8h_abb694ef5acb9945ca69679a8360df51a}{in\_mklev} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
273         \hyperlink{worn_8c_adaf11e4f4e6b2b5d86738411700e6050}{mon\_adjust\_speed}(mon, 0, obj);
274         \hyperlink{decl_8h_abb694ef5acb9945ca69679a8360df51a}{in\_mklev} = save\_in\_mklev;
275         \textcolor{keywordflow}{break};
276       \}
277      \textcolor{keywordflow}{case} \hyperlink{prop_8h_ae98138d4a730a8fefc53e6ef8a347ff0}{FIRE\_RES}:
278      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a2d22c22d9cef4f961f6b52c91dc4b506}{COLD\_RES}:
279      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a13a876f838f8dffd73e22ad2ac05fb28}{SLEEP\_RES}:
280      \textcolor{keywordflow}{case} \hyperlink{prop_8h_aa5b34f1cf00dc14f9d93e20a0422eebb}{DISINT\_RES}:
281      \textcolor{keywordflow}{case} \hyperlink{prop_8h_aa226742be6ff37fe4b0689895747a8de}{SHOCK\_RES}:
282      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a8d953be53c86d4b99d1d2ed9ff8ac24f}{POISON\_RES}:
283      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a38627b460a9ab593488e01e2ffab920f}{ACID\_RES}:
284      \textcolor{keywordflow}{case} \hyperlink{prop_8h_ac6d70cfc95acfbacc8c8113ee181eb81}{STONE\_RES}:
285         mask = (\hyperlink{config_8h_a65f85814a8290f9797005d3b28e7e5fc}{uchar}) (1 << (which - 1));
286         \textcolor{comment}{/* If the monster doesn't have this resistance intrinsically,}
287 \textcolor{comment}{           check whether any other worn item confers it.  Note that}
288 \textcolor{comment}{           we don't currently check for anything conferred via simply}
289 \textcolor{comment}{           carrying an object. */}
290         \textcolor{keywordflow}{if} (!(mon->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}->\hyperlink{structpermonst_aa5260f69f42574bf223c5465b9c1858a}{mresists} & mask)) \{
291         \textcolor{keywordflow}{for} (otmp = mon->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; otmp; otmp = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
292             \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} &&
293                 (\textcolor{keywordtype}{int}) \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].\hyperlink{structobjclass_a3a6ca47a71d5a816b8661d90442baf46}{oc\_oprop} == which)
294             \textcolor{keywordflow}{break};
295         \textcolor{keywordflow}{if} (!otmp)
296             mon->\hyperlink{structmonst_a75e177403095d3c7ce5636d6d20ed725}{mintrinsics} &= ~((\textcolor{keywordtype}{unsigned} short) mask);
297         \}
298         \textcolor{keywordflow}{break};
299      \textcolor{keywordflow}{default}:
300         \textcolor{keywordflow}{break};
301     \}
302     \}
303 
304  maybe\_blocks:
305     \textcolor{comment}{/* obj->owornmask has been cleared by this point, so we can't use it.}
306 \textcolor{comment}{       However, since monsters don't wield armor, we don't have to guard}
307 \textcolor{comment}{       against that and can get away with a blanket worn-mask value. */}
308     \textcolor{keywordflow}{switch} (\hyperlink{worn_8c_a903e52306a23a5d2a7123f1e0eca01c8}{w\_blocks}(obj,~0L)) \{
309      \textcolor{keywordflow}{case} \hyperlink{prop_8h_a40b95fa776ec998c74266a99b91b337b}{INVIS}:
310     mon->invis\_blkd = on ? 1 : 0;
311     mon->minvis = on ? 0 : mon->perminvis;
312     \textcolor{keywordflow}{break};
313      \textcolor{keywordflow}{default}:
314     \textcolor{keywordflow}{break};
315     \}
316 
317 \textcolor{preprocessor}{#ifdef STEED}
318     \textcolor{keywordflow}{if} (!on && mon == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.usteed && obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == SADDLE)
319         dismount\_steed(\hyperlink{hack_8h_a90c6def474309a3671856e184151b13a}{DISMOUNT\_FELL});
320 \textcolor{preprocessor}{#endif}
321 
322     \textcolor{comment}{/* if couldn't see it but now can, or vice versa, update display */}
323     \textcolor{keywordflow}{if} (!silently && (unseen ^ !\hyperlink{display_8h_ad75e04a9624fe7ba0e1715ae3a3feb27}{canseemon}(mon)))
324     \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(mon->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx}, mon->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my});
325 \}
\end{DoxyCode}
\hypertarget{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}{\index{worn.\+c@{worn.\+c}!which\+\_\+armor@{which\+\_\+armor}}
\index{which\+\_\+armor@{which\+\_\+armor}!worn.\+c@{worn.\+c}}
\subsubsection[{which\+\_\+armor}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf obj}$\ast$ which\+\_\+armor (
\begin{DoxyParamCaption}
\item[{struct {\bf monst} $\ast$}]{mon, }
\item[{long}]{flag}
\end{DoxyParamCaption}
)}}\label{worn_8c_a260cadb0c77a7032f8e53716072e6cd7}


Definition at line 516 of file worn.\+c.



References obj\+::nobj, and obj\+::owornmask.



Referenced by find\+\_\+offensive(), fix\+\_\+worst\+\_\+trouble(), hurtmarmor(), in\+\_\+trouble(), loot\+\_\+mon(), m\+\_\+dowear\+\_\+type(), m\+\_\+slips\+\_\+free(), mon\+\_\+break\+\_\+armor(), mon\+\_\+reflects(), muse\+\_\+newcham\+\_\+mon(), rnd\+\_\+offensive\+\_\+item(), rndcurse(), and use\+\_\+offensive().


\begin{DoxyCode}
519 \{
520     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{structobj}{obj};
521 
522     \textcolor{keywordflow}{for}(obj = mon->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
523         \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} & \hyperlink{structflag}{flag}) \textcolor{keywordflow}{return} obj;
524     \textcolor{keywordflow}{return}((\textcolor{keyword}{struct} obj *)0);
525 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{worn_8c_a43357cbafc724cfb16288dcb0c946059}{\index{worn.\+c@{worn.\+c}!worn@{worn}}
\index{worn@{worn}!worn.\+c@{worn.\+c}}
\subsubsection[{worn}]{\setlength{\rightskip}{0pt plus 5cm}{\bf const} struct {\bf worn}  {\bf worn}\mbox{[}$\,$\mbox{]}}}\label{worn_8c_a43357cbafc724cfb16288dcb0c946059}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
    \{ \hyperlink{prop_8h_a4f442d75a01cf88dcd71965d0d1f6155}{W\_ARM}, &\hyperlink{decl_8h_ad6e6532c78ab5fe0078daf4cf352f3c1}{uarm} \},
    \{ \hyperlink{prop_8h_ac1d6573f77f2d9fe6bf8fad682246773}{W\_ARMC}, &\hyperlink{decl_8h_a586be55c11f20a38a490f6bb922a437d}{uarmc} \},
    \{ \hyperlink{prop_8h_a4e8958625f891ea2329369d5032d0d6d}{W\_ARMH}, &\hyperlink{decl_8h_a5990ad491dff32418089ab967be227a5}{uarmh} \},
    \{ \hyperlink{prop_8h_a14ac9957d8019d2304ceedb5d794fb4f}{W\_ARMS}, &\hyperlink{decl_8h_aee21972b230a8408f2b85e26f195e91d}{uarms} \},
    \{ \hyperlink{prop_8h_ab96deae86360c93dcb4c33fdf246109f}{W\_ARMG}, &\hyperlink{decl_8h_a374ab5e4582cfafa2d4ef57211f53293}{uarmg} \},
    \{ \hyperlink{prop_8h_a10a0477af46978e26b84ea4f7e1d5af0}{W\_ARMF}, &\hyperlink{decl_8h_a11e2d0f62fa1b42374054c939ebb288f}{uarmf} \},



    \{ \hyperlink{prop_8h_a750880dd0757deb1011ba6de88d81f93}{W\_RINGL}, &\hyperlink{decl_8h_abc75269125700f0668785d8f073a3646}{uleft} \},
    \{ \hyperlink{prop_8h_aa9b801a15e2c1553cb325f8058994063}{W\_RINGR}, &\hyperlink{decl_8h_a2d7c456e0ac88316ae0b9e8ae32d17b3}{uright} \},
    \{ \hyperlink{prop_8h_abd75a55f67b13523ef4377d4eb6fb6ad}{W\_WEP}, &\hyperlink{decl_8h_a1aefaef88eef9075d8136d19410fd3b1}{uwep} \},
    \{ \hyperlink{prop_8h_a4571f54e71d38d81a610eaf77e5fecd9}{W\_SWAPWEP}, &\hyperlink{decl_8h_ab2586a729017fc01f4612808c80c1945}{uswapwep} \},
    \{ \hyperlink{prop_8h_a9b95d7c6e22f325a5bc0326d7673a4f4}{W\_QUIVER}, &\hyperlink{decl_8h_a7544f9c7591e79476549f321400d269b}{uquiver} \},
    \{ \hyperlink{prop_8h_a1a4f9d6f31538cc9d677e617b49597d2}{W\_AMUL}, &\hyperlink{decl_8h_a602a9d34078660dd260aed96b2abd4ca}{uamul} \},
    \{ \hyperlink{prop_8h_ac2c824bec7fcb9f986b9e905d1f5ee8a}{W\_TOOL}, &\hyperlink{decl_8h_aaac1dc498d3597b63617d7056c3e1c1b}{ublindf} \},
    \{ \hyperlink{prop_8h_a25859525ceb89aa43d399c00eb73b063}{W\_BALL}, &\hyperlink{decl_8h_a043dece512e3c566986d7cfabc52d05e}{uball} \},
    \{ \hyperlink{prop_8h_a636326b82da508e3cf37c08c07014a1d}{W\_CHAIN}, &\hyperlink{decl_8h_ac83f46f409b88c6d6109ed04938ad52a}{uchain} \},
    \{ 0, 0 \}
\}
\end{DoxyCode}
