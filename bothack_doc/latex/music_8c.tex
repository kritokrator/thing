\hypertarget{music_8c}{\section{nethack/src/music.c File Reference}
\label{music_8c}\index{nethack/src/music.\+c@{nethack/src/music.\+c}}
}
{\ttfamily \#include \char`\"{}hack.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{music_8c_a0b66bbd7e8c48a78b0694ed7957a56f8}{F\+D\+E\+C\+L} (\hyperlink{music_8c_ad9841c8fc796cb9eea29b22bf495cc82}{awaken\+\_\+monsters},(int))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{music_8c_a15a29f7e8aa2366f6ca4aefdc8e9a137}{F\+D\+E\+C\+L} (\hyperlink{music_8c_a8758c9f4ca03fe7780a1da5710835702}{put\+\_\+monsters\+\_\+to\+\_\+sleep},(int))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{music_8c_a052b12c54e8ca6c34c47d625b97700f5}{F\+D\+E\+C\+L} (\hyperlink{music_8c_a4537a3d20f92ba30f7325be2967ba553}{charm\+\_\+snakes},(int))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{music_8c_a9e6bc3db1e18df81ef21b7cd3592bd1c}{F\+D\+E\+C\+L} (\hyperlink{music_8c_aace913e71e07ebb80800a18c0d52a342}{calm\+\_\+nymphs},(int))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{music_8c_aad2e710bfbe4bad2f286d26dc49867fb}{F\+D\+E\+C\+L} (\hyperlink{music_8c_a30bde4ddc5e1629ca7482ab34ef5b368}{charm\+\_\+monsters},(int))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{music_8c_a8fa7d6fe668f514e19734852d92176fd}{F\+D\+E\+C\+L} (\hyperlink{music_8c_af1d575299ce0239159297af4c2b33810}{do\+\_\+earthquake},(int))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} int \hyperlink{music_8c_a6abd62e5bf06eeb09a5f36b48f9e43fb}{F\+D\+E\+C\+L} (\hyperlink{music_8c_af9ca8df5ec8c5352e82afe2316a70e72}{do\+\_\+improvisation},(struct \hyperlink{structobj}{obj} $\ast$))
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{music_8c_ad9841c8fc796cb9eea29b22bf495cc82}{awaken\+\_\+monsters} (int distance)
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{music_8c_a8758c9f4ca03fe7780a1da5710835702}{put\+\_\+monsters\+\_\+to\+\_\+sleep} (int distance)
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{music_8c_a4537a3d20f92ba30f7325be2967ba553}{charm\+\_\+snakes} (int distance)
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{music_8c_aace913e71e07ebb80800a18c0d52a342}{calm\+\_\+nymphs} (int distance)
\item 
void \hyperlink{music_8c_a7f3337b0f8fa93a4030d1aa1ecd44706}{awaken\+\_\+soldiers} ()
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{music_8c_a30bde4ddc5e1629ca7482ab34ef5b368}{charm\+\_\+monsters} (int distance)
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{music_8c_af1d575299ce0239159297af4c2b33810}{do\+\_\+earthquake} (int force)
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} int \hyperlink{music_8c_af9ca8df5ec8c5352e82afe2316a70e72}{do\+\_\+improvisation} (struct \hyperlink{structobj}{obj} $\ast$instr)
\item 
int \hyperlink{music_8c_adc0c232611c8e0a27e63c2fef4989bd5}{do\+\_\+play\+\_\+instrument} (struct \hyperlink{structobj}{obj} $\ast$instr)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{music_8c_ad9841c8fc796cb9eea29b22bf495cc82}{\index{music.\+c@{music.\+c}!awaken\+\_\+monsters@{awaken\+\_\+monsters}}
\index{awaken\+\_\+monsters@{awaken\+\_\+monsters}!music.\+c@{music.\+c}}
\subsubsection[{awaken\+\_\+monsters}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void awaken\+\_\+monsters (
\begin{DoxyParamCaption}
\item[{int}]{distance}
\end{DoxyParamCaption}
)}}\label{music_8c_ad9841c8fc796cb9eea29b22bf495cc82}


Definition at line 61 of file music.\+c.



References D\+E\+A\+D\+M\+O\+N\+S\+T\+E\+R, distu, F\+A\+L\+S\+E, fmon, monst\+::mx, monst\+::my, monst\+::nmon, N\+O\+T\+E\+L\+L, T\+O\+O\+L\+\_\+\+C\+L\+A\+S\+S, and T\+R\+U\+E.



Referenced by do\+\_\+improvisation().


\begin{DoxyCode}
63 \{
64     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon};
65     \textcolor{keyword}{register} \textcolor{keywordtype}{int} distm;
66 
67     \textcolor{keywordflow}{while}(mtmp) \{
68         \textcolor{keywordflow}{if} (!\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp)) \{
69         distm = \hyperlink{hack_8h_a1f84afcae19c5b60124bc509ed647f84}{distu}(mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx}, mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my});
70         \textcolor{keywordflow}{if} (distm < distance) \{
71             mtmp->msleeping = 0;
72             mtmp->mcanmove = 1;
73             mtmp->mfrozen = 0;
74             \textcolor{comment}{/* May scare some monsters */}
75             \textcolor{keywordflow}{if} (distm < distance/3 &&
76                 !resist(mtmp, \hyperlink{objclass_8h_ad8e3b1b1f1bd8dff660c15840a3f2b03}{TOOL\_CLASS}, 0, \hyperlink{hack_8h_a7450be636c853f464d4b5c77a6b19844}{NOTELL}))
77             monflee(mtmp, 0, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
78         \}
79         \}
80         mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon};
81     \}
82 \}
\end{DoxyCode}
\hypertarget{music_8c_a7f3337b0f8fa93a4030d1aa1ecd44706}{\index{music.\+c@{music.\+c}!awaken\+\_\+soldiers@{awaken\+\_\+soldiers}}
\index{awaken\+\_\+soldiers@{awaken\+\_\+soldiers}!music.\+c@{music.\+c}}
\subsubsection[{awaken\+\_\+soldiers}]{\setlength{\rightskip}{0pt plus 5cm}void awaken\+\_\+soldiers (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{music_8c_a7f3337b0f8fa93a4030d1aa1ecd44706}


Definition at line 166 of file music.\+c.



References canseemon, monst\+::data, D\+E\+A\+D\+M\+O\+N\+S\+T\+E\+R, fmon, is\+\_\+mercenary, mons, and monst\+::nmon.



Referenced by do\+\_\+improvisation(), and use\+\_\+defensive().


\begin{DoxyCode}
167 \{
168     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon};
169 
170     \textcolor{keywordflow}{while}(mtmp) \{
171         \textcolor{keywordflow}{if} (!\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp) &&
172             \hyperlink{mondata_8h_a6d73bc7ae8f744da17f71450f865aacc}{is\_mercenary}(mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) && mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data} != &\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[PM\_GUARD]) \{
173         mtmp->mpeaceful = mtmp->msleeping = mtmp->mfrozen = 0;
174         mtmp->mcanmove = 1;
175         \textcolor{keywordflow}{if} (\hyperlink{display_8h_ad75e04a9624fe7ba0e1715ae3a3feb27}{canseemon}(mtmp))
176             pline(\textcolor{stringliteral}{"%s is now ready for battle!"}, Monnam(mtmp));
177         \textcolor{keywordflow}{else}
178             Norep(\textcolor{stringliteral}{"You hear the rattle of battle gear being readied."});
179         \}
180         mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon};
181     \}
182 \}
\end{DoxyCode}
\hypertarget{music_8c_aace913e71e07ebb80800a18c0d52a342}{\index{music.\+c@{music.\+c}!calm\+\_\+nymphs@{calm\+\_\+nymphs}}
\index{calm\+\_\+nymphs@{calm\+\_\+nymphs}!music.\+c@{music.\+c}}
\subsubsection[{calm\+\_\+nymphs}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void calm\+\_\+nymphs (
\begin{DoxyParamCaption}
\item[{int}]{distance}
\end{DoxyParamCaption}
)}}\label{music_8c_aace913e71e07ebb80800a18c0d52a342}


Definition at line 143 of file music.\+c.



References canseemon, monst\+::data, D\+E\+A\+D\+M\+O\+N\+S\+T\+E\+R, distu, fmon, permonst\+::mlet, monst\+::mx, monst\+::my, monst\+::nmon, and S\+\_\+\+N\+Y\+M\+P\+H.



Referenced by do\+\_\+improvisation().


\begin{DoxyCode}
145 \{
146     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon};
147 
148     \textcolor{keywordflow}{while} (mtmp) \{
149         \textcolor{keywordflow}{if} (!\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp) && mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}->\hyperlink{structpermonst_ab402dbf1bed9d0e595a2b3da6558da92}{mlet} == \hyperlink{monsym_8h_a9e0d9f6e11465919bac8252be7ead3f8}{S\_NYMPH} && mtmp->mcanmove 
      &&
150             \hyperlink{hack_8h_a1f84afcae19c5b60124bc509ed647f84}{distu}(mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx}, mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my}) < distance) \{
151         mtmp->msleeping = 0;
152         mtmp->mpeaceful = 1;
153         mtmp->mavenge = 0;
154         \textcolor{keywordflow}{if} (\hyperlink{display_8h_ad75e04a9624fe7ba0e1715ae3a3feb27}{canseemon}(mtmp))
155             pline(
156              \textcolor{stringliteral}{"%s listens cheerfully to the music, then seems quieter."},
157               Monnam(mtmp));
158         \}
159         mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon};
160     \}
161 \}
\end{DoxyCode}
\hypertarget{music_8c_a30bde4ddc5e1629ca7482ab34ef5b368}{\index{music.\+c@{music.\+c}!charm\+\_\+monsters@{charm\+\_\+monsters}}
\index{charm\+\_\+monsters@{charm\+\_\+monsters}!music.\+c@{music.\+c}}
\subsubsection[{charm\+\_\+monsters}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void charm\+\_\+monsters (
\begin{DoxyParamCaption}
\item[{int}]{distance}
\end{DoxyParamCaption}
)}}\label{music_8c_a30bde4ddc5e1629ca7482ab34ef5b368}


Definition at line 189 of file music.\+c.



References D\+E\+A\+D\+M\+O\+N\+S\+T\+E\+R, distu, fmon, monst\+::mx, monst\+::my, monst\+::nmon, N\+O\+T\+E\+L\+L, T\+O\+O\+L\+\_\+\+C\+L\+A\+S\+S, u, and you\+::ustuck.



Referenced by do\+\_\+improvisation().


\begin{DoxyCode}
191 \{
192     \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp, *mtmp2;
193 
194     \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uswallow) \{
195         \textcolor{keywordflow}{if} (!resist(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a774d4dad2da130ec9ed1d2e6c5e0fa80}{ustuck}, \hyperlink{objclass_8h_ad8e3b1b1f1bd8dff660c15840a3f2b03}{TOOL\_CLASS}, 0, \hyperlink{hack_8h_a7450be636c853f464d4b5c77a6b19844}{NOTELL}))
196         (void) tamedog(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a774d4dad2da130ec9ed1d2e6c5e0fa80}{ustuck}, (\textcolor{keyword}{struct} \hyperlink{structobj}{obj} *) 0);
197     \} \textcolor{keywordflow}{else} \{
198         \textcolor{keywordflow}{for} (mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon}; mtmp; mtmp = mtmp2) \{
199         mtmp2 = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon};
200         \textcolor{keywordflow}{if} (\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp)) \textcolor{keywordflow}{continue};
201 
202         \textcolor{keywordflow}{if} (\hyperlink{hack_8h_a1f84afcae19c5b60124bc509ed647f84}{distu}(mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx}, mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my}) <= distance) \{
203             \textcolor{keywordflow}{if} (!resist(mtmp, \hyperlink{objclass_8h_ad8e3b1b1f1bd8dff660c15840a3f2b03}{TOOL\_CLASS}, 0, \hyperlink{hack_8h_a7450be636c853f464d4b5c77a6b19844}{NOTELL}))
204             (\textcolor{keywordtype}{void}) tamedog(mtmp, (\textcolor{keyword}{struct} \hyperlink{structobj}{obj} *) 0);
205         \}
206         \}
207     \}
208 
209 \}
\end{DoxyCode}
\hypertarget{music_8c_a4537a3d20f92ba30f7325be2967ba553}{\index{music.\+c@{music.\+c}!charm\+\_\+snakes@{charm\+\_\+snakes}}
\index{charm\+\_\+snakes@{charm\+\_\+snakes}!music.\+c@{music.\+c}}
\subsubsection[{charm\+\_\+snakes}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void charm\+\_\+snakes (
\begin{DoxyParamCaption}
\item[{int}]{distance}
\end{DoxyParamCaption}
)}}\label{music_8c_a4537a3d20f92ba30f7325be2967ba553}


Definition at line 109 of file music.\+c.



References canseemon, monst\+::data, D\+E\+A\+D\+M\+O\+N\+S\+T\+E\+R, distu, fmon, permonst\+::mlet, monst\+::mx, monst\+::my, newsym(), monst\+::nmon, and S\+\_\+\+S\+N\+A\+K\+E.



Referenced by do\+\_\+improvisation().


\begin{DoxyCode}
111 \{
112     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon};
113     \textcolor{keywordtype}{int} could\_see\_mon, was\_peaceful;
114 
115     \textcolor{keywordflow}{while} (mtmp) \{
116         \textcolor{keywordflow}{if} (!\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp) && mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}->\hyperlink{structpermonst_ab402dbf1bed9d0e595a2b3da6558da92}{mlet} == \hyperlink{monsym_8h_a6685ecc90740a8c3fee524b92e50f9d3}{S\_SNAKE} && mtmp->mcanmove 
      &&
117             \hyperlink{hack_8h_a1f84afcae19c5b60124bc509ed647f84}{distu}(mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx}, mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my}) < distance) \{
118         was\_peaceful = mtmp->mpeaceful;
119         mtmp->mpeaceful = 1;
120         mtmp->mavenge = 0;
121         could\_see\_mon = \hyperlink{display_8h_ad75e04a9624fe7ba0e1715ae3a3feb27}{canseemon}(mtmp);
122         mtmp->mundetected = 0;
123         \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx}, mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my});
124         \textcolor{keywordflow}{if} (\hyperlink{display_8h_ad75e04a9624fe7ba0e1715ae3a3feb27}{canseemon}(mtmp)) \{
125             \textcolor{keywordflow}{if} (!could\_see\_mon)
126             You(\textcolor{stringliteral}{"notice %s, swaying with the music."},
127                 a\_monnam(mtmp));
128             \textcolor{keywordflow}{else}
129             pline(\textcolor{stringliteral}{"%s freezes, then sways with the music%s."},
130                   Monnam(mtmp),
131                   was\_peaceful ? \textcolor{stringliteral}{""} : \textcolor{stringliteral}{", and now seems quieter"});
132         \}
133         \}
134         mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon};
135     \}
136 \}
\end{DoxyCode}
\hypertarget{music_8c_af1d575299ce0239159297af4c2b33810}{\index{music.\+c@{music.\+c}!do\+\_\+earthquake@{do\+\_\+earthquake}}
\index{do\+\_\+earthquake@{do\+\_\+earthquake}!music.\+c@{music.\+c}}
\subsubsection[{do\+\_\+earthquake}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void do\+\_\+earthquake (
\begin{DoxyParamCaption}
\item[{int}]{force}
\end{DoxyParamCaption}
)}}\label{music_8c_af1d575299ce0239159297af4c2b33810}


Definition at line 216 of file music.\+c.



References A\+L\+T\+A\+R, A\+R\+T\+I\+C\+L\+E\+\_\+\+T\+H\+E, cansee, C\+O\+L\+N\+O, C\+O\+R\+R, D\+\_\+\+N\+O\+D\+O\+O\+R, monst\+::data, D\+O\+O\+R, doormask, F\+A\+L\+S\+E, flags, Flying, F\+O\+U\+N\+T\+A\+I\+N, G\+R\+A\+V\+E, humanoid, Is\+\_\+astralevel, is\+\_\+clinger, is\+\_\+flyer, is\+\_\+hider, Is\+\_\+sanctum, Levitation, levl, m\+\_\+at, monst\+::mhp, monst\+::mnamelth, monst\+::mtame, newsym(), N\+O\+\_\+\+K\+I\+L\+L\+E\+R\+\_\+\+P\+R\+E\+F\+I\+X, otmp, P\+I\+T, rn1, R\+O\+O\+M, R\+O\+W\+N\+O, S\+H\+O\+P\+B\+A\+S\+E, S\+I\+N\+K, flag\+::soundok, S\+U\+P\+P\+R\+E\+S\+S\+\_\+\+S\+A\+D\+D\+L\+E, T\+H\+R\+O\+N\+E, T\+R\+U\+E, T\+T\+\_\+\+P\+I\+T, u, unblock\+\_\+point(), you\+::utrap, you\+::utraptype, you\+::ux, you\+::uy, you\+::uz, trap\+::x, trap\+::y, and youmonst.



Referenced by do\+\_\+improvisation().


\begin{DoxyCode}
218 \{
219     \textcolor{keyword}{register} \textcolor{keywordtype}{int} x,y;
220     \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp;
221     \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
222     \textcolor{keyword}{struct }\hyperlink{structtrap}{trap} *chasm;
223     \textcolor{keywordtype}{int} start\_x, start\_y, end\_x, end\_y;
224 
225     start\_x = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} - (force * 2);
226     start\_y = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy} - (force * 2);
227     end\_x = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} + (force * 2);
228     end\_y = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy} + (force * 2);
229     \textcolor{keywordflow}{if} (start\_x < 1) start\_x = 1;
230     \textcolor{keywordflow}{if} (start\_y < 1) start\_y = 1;
231     \textcolor{keywordflow}{if} (end\_x >= \hyperlink{global_8h_a308dbfcc29f5a427c0315f3cbf03c3ed}{COLNO}) end\_x = \hyperlink{global_8h_a308dbfcc29f5a427c0315f3cbf03c3ed}{COLNO} - 1;
232     \textcolor{keywordflow}{if} (end\_y >= \hyperlink{global_8h_a9cce134868d97b23c35bcf1ff4a343d8}{ROWNO}) end\_y = \hyperlink{global_8h_a9cce134868d97b23c35bcf1ff4a343d8}{ROWNO} - 1;
233     \textcolor{keywordflow}{for} (x=start\_x; x<=end\_x; x++) \textcolor{keywordflow}{for} (y=start\_y; y<=end\_y; y++) \{
234         \textcolor{keywordflow}{if} ((mtmp = \hyperlink{rm_8h_a4d8dddf3df3fad65478980d2c8cbf53c}{m\_at}(x,y)) != 0) \{
235         wakeup(mtmp);   \textcolor{comment}{/* peaceful monster will become hostile */}
236         \textcolor{keywordflow}{if} (mtmp->mundetected && \hyperlink{mondata_8h_a40ebe51354acef5cc9591afbdd769c36}{is\_hider}(mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data})) \{
237             mtmp->mundetected = 0;
238             \textcolor{keywordflow}{if} (\hyperlink{vision_8h_a857efc720262bc13a9e4b4bcbb079b5c}{cansee}(x,y))
239             pline(\textcolor{stringliteral}{"%s is shaken loose from the ceiling!"},
240                                 Amonnam(mtmp));
241             \textcolor{keywordflow}{else}
242             You\_hear(\textcolor{stringliteral}{"a thumping sound."});
243             \textcolor{keywordflow}{if} (x==\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} && y==\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy})
244             You(\textcolor{stringliteral}{"easily dodge the falling %s."},
245                                 mon\_nam(mtmp));
246             \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(x,y);
247         \}
248         \}
249         \textcolor{keywordflow}{if} (!rn2(14 - force)) \textcolor{keywordflow}{switch} (\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].typ) \{
250           \textcolor{keywordflow}{case} \hyperlink{rm_8h_a88fabf28d6285490fea11089d88167ca}{FOUNTAIN} : \textcolor{comment}{/* Make the fountain disappear */}
251             \textcolor{keywordflow}{if} (\hyperlink{vision_8h_a857efc720262bc13a9e4b4bcbb079b5c}{cansee}(x,y))
252                 pline\_The(\textcolor{stringliteral}{"fountain falls into a chasm."});
253             \textcolor{keywordflow}{goto} do\_pit;
254 \textcolor{preprocessor}{#ifdef SINKS}
255           \textcolor{keywordflow}{case} \hyperlink{rm_8h_adb1aacb84dbc34f3a142a9d7bc80f375}{SINK} :
256             \textcolor{keywordflow}{if} (\hyperlink{vision_8h_a857efc720262bc13a9e4b4bcbb079b5c}{cansee}(x,y))
257                 pline\_The(\textcolor{stringliteral}{"kitchen sink falls into a chasm."});
258             \textcolor{keywordflow}{goto} do\_pit;
259 \textcolor{preprocessor}{#endif}
260           \textcolor{keywordflow}{case} \hyperlink{rm_8h_ae560558ed2367969c72e77c084a07ded}{ALTAR} :
261             \textcolor{keywordflow}{if} (\hyperlink{dungeon_8h_af69a19c1eec378c1cebe9143febbe2b5}{Is\_astralevel}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}) || \hyperlink{dungeon_8h_a59e2a0655c98162235eb90f2108fc3ee}{Is\_sanctum}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.
      \hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz})) \textcolor{keywordflow}{break};
262 
263             \textcolor{keywordflow}{if} (\hyperlink{vision_8h_a857efc720262bc13a9e4b4bcbb079b5c}{cansee}(x,y))
264                 pline\_The(\textcolor{stringliteral}{"altar falls into a chasm."});
265             \textcolor{keywordflow}{goto} do\_pit;
266           \textcolor{keywordflow}{case} \hyperlink{rm_8h_a32fd21ed4a83ac89900dd91a099a378d}{GRAVE} :
267             \textcolor{keywordflow}{if} (\hyperlink{vision_8h_a857efc720262bc13a9e4b4bcbb079b5c}{cansee}(x,y))
268                 pline\_The(\textcolor{stringliteral}{"headstone topples into a chasm."});
269             \textcolor{keywordflow}{goto} do\_pit;
270           \textcolor{keywordflow}{case} \hyperlink{rm_8h_aae56aa7aee61c8438097a0958ace54f9}{THRONE} :
271             \textcolor{keywordflow}{if} (\hyperlink{vision_8h_a857efc720262bc13a9e4b4bcbb079b5c}{cansee}(x,y))
272                 pline\_The(\textcolor{stringliteral}{"throne falls into a chasm."});
273             \textcolor{comment}{/* Falls into next case */}
274           \textcolor{keywordflow}{case} \hyperlink{rm_8h_ae635489e987ae17a3bf884376cc2fe34}{ROOM} :
275           \textcolor{keywordflow}{case} \hyperlink{rm_8h_aeffd57885964c3a9a5c3ce0f81c06339}{CORR} : \textcolor{comment}{/* Try to make a pit */}
276 do\_pit:         chasm = maketrap(x,y,\hyperlink{trap_8h_af181c9e6602b6432a0bf1a9243808968}{PIT});
277             \textcolor{keywordflow}{if} (!chasm) \textcolor{keywordflow}{break};  \textcolor{comment}{/* no pit if portal at that location */}
278             chasm->tseen = 1;
279 
280             \hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[\hyperlink{structtrap_aed25254cf556e3eae09dd98576d98d45}{x}][\hyperlink{structtrap_a3c7f72724bfcd0c4acb2a05ee75064df}{y}].doormask = 0;
281 
282             mtmp = \hyperlink{rm_8h_a4d8dddf3df3fad65478980d2c8cbf53c}{m\_at}(x,y);
283 
284             \textcolor{keywordflow}{if} ((otmp = sobj\_at(BOULDER, x, y)) != 0) \{
285             \textcolor{keywordflow}{if} (\hyperlink{vision_8h_a857efc720262bc13a9e4b4bcbb079b5c}{cansee}(x, y))
286                pline(\textcolor{stringliteral}{"KADOOM! The boulder falls into a chasm%s!"},
287                   ((x == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}) && (y == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy})) ? \textcolor{stringliteral}{" below you"} : \textcolor{stringliteral}{""});
288             \textcolor{keywordflow}{if} (mtmp)
289                 mtmp->mtrapped = 0;
290             obj\_extract\_self(otmp);
291             (void) flooreffects(otmp, x, y, \textcolor{stringliteral}{""});
292             \textcolor{keywordflow}{break};
293             \}
294 
295             \textcolor{comment}{/* We have to check whether monsters or player}
296 \textcolor{comment}{               falls in a chasm... */}
297 
298             \textcolor{keywordflow}{if} (mtmp) \{
299             \textcolor{keywordflow}{if}(!\hyperlink{mondata_8h_a4407b2600bc3b320829630ed895960c0}{is\_flyer}(mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) && !\hyperlink{mondata_8h_a5033772c28e21c8fad44f02e4a5eb4e1}{is\_clinger}(mtmp->
      \hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data})) \{
300                 mtmp->mtrapped = 1;
301                 \textcolor{keywordflow}{if}(\hyperlink{vision_8h_a857efc720262bc13a9e4b4bcbb079b5c}{cansee}(x,y))
302                 pline(\textcolor{stringliteral}{"%s falls into a chasm!"}, Monnam(mtmp));
303                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{flag_8h_a997133526e0c6bed44ebc0116a48b50a}{flags}.\hyperlink{structflag_ae3871fd2268fbc24b89cece8eb352dfc}{soundok} && \hyperlink{mondata_8h_a1f7524ff25e459cd9832bfa069188312}{humanoid}(mtmp->
      \hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}))
304                 You\_hear(\textcolor{stringliteral}{"a scream!"});
305                 mselftouch(mtmp, \textcolor{stringliteral}{"Falling, "}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
306                 \textcolor{keywordflow}{if} (mtmp->\hyperlink{structmonst_abe22e95755f1348a6a1c78252be5d76d}{mhp} > 0)
307                 \textcolor{keywordflow}{if} ((mtmp->\hyperlink{structmonst_abe22e95755f1348a6a1c78252be5d76d}{mhp} -= rnd(6)) <= 0) \{
308                     \textcolor{keywordflow}{if}(!\hyperlink{vision_8h_a857efc720262bc13a9e4b4bcbb079b5c}{cansee}(x,y))
309                     pline(\textcolor{stringliteral}{"It is destroyed!"});
310                     \textcolor{keywordflow}{else} \{
311                     You(\textcolor{stringliteral}{"destroy %s!"}, mtmp->\hyperlink{structmonst_a6d525ec48f9d38cda6accbb0cb39efba}{mtame} ?
312                         x\_monnam(mtmp, \hyperlink{decl_8h_aaded63563b8a938d1c68b3d404168c67}{ARTICLE\_THE}, \textcolor{stringliteral}{"poor"},
313                 mtmp->\hyperlink{structmonst_a03fe7192ae1efd428bc9a0d2f856125f}{mnamelth} ? \hyperlink{decl_8h_a252ac785b1ff056f716aee17a60a1c57}{SUPPRESS\_SADDLE} : 0, 
      \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}):
314                         mon\_nam(mtmp));
315                     \}
316                     xkilled(mtmp,0);
317                 \}
318             \}
319             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (x == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} && y == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}) \{
320                 \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a3dbdc08291ccd1d6de010d72e4b180fb}{Levitation} || \hyperlink{youprop_8h_a494ca244ec9dd2bffeb43777d53785e2}{Flying} ||
321                         \hyperlink{mondata_8h_a5033772c28e21c8fad44f02e4a5eb4e1}{is\_clinger}(\hyperlink{decl_8h_ad15893dbcb60e2777ae0dfac9f840858}{youmonst}.\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data})) \{
322                     pline(\textcolor{stringliteral}{"A chasm opens up under you!"});
323                     You(\textcolor{stringliteral}{"don't fall in!"});
324                 \} \textcolor{keywordflow}{else} \{
325                     You(\textcolor{stringliteral}{"fall into a chasm!"});
326                     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a7250d3b13a54b76d846b754a2a6f3fa6}{utrap} = \hyperlink{hack_8h_af107ca092682647f298989038020f9c8}{rn1}(6,2);
327                     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a1753632ed4b3b8dea40466c1c92fce19}{utraptype} = \hyperlink{you_8h_aea6a4ea47e82cae080755cd9c3ed8b9a}{TT\_PIT};
328                     losehp(rnd(6),\textcolor{stringliteral}{"fell into a chasm"},
329                     \hyperlink{decl_8h_aa2ea21bcf7bdd470bd96936d5b80e0ba}{NO\_KILLER\_PREFIX});
330                     selftouch(\textcolor{stringliteral}{"Falling, you"});
331                 \}
332             \} \textcolor{keywordflow}{else} \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(x,y);
333             \textcolor{keywordflow}{break};
334           \textcolor{keywordflow}{case} \hyperlink{rm_8h_aa19093eb0aa5c5af9c27464ae8f0d2de}{DOOR} : \textcolor{comment}{/* Make the door collapse */}
335             \textcolor{keywordflow}{if} (\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].\hyperlink{rm_8h_a745655ee52d1819ea5216d98e685f933}{doormask} == \hyperlink{rm_8h_a69d5ca6801252b3e635889365d7b9d28}{D\_NODOOR}) \textcolor{keywordflow}{goto} do\_pit;
336             \textcolor{keywordflow}{if} (\hyperlink{vision_8h_a857efc720262bc13a9e4b4bcbb079b5c}{cansee}(x,y))
337             pline\_The(\textcolor{stringliteral}{"door collapses."});
338             \textcolor{keywordflow}{if} (*in\_rooms(x, y, \hyperlink{mkroom_8h_a925701a88c7ed0db502cfac9d8fbcf9e}{SHOPBASE}))
339             add\_damage(x, y, 0L);
340             \hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[\hyperlink{structtrap_aed25254cf556e3eae09dd98576d98d45}{x}][\hyperlink{structtrap_a3c7f72724bfcd0c4acb2a05ee75064df}{y}].doormask = \hyperlink{rm_8h_a69d5ca6801252b3e635889365d7b9d28}{D\_NODOOR};
341             \hyperlink{vision_8c_ae35bdda13dee95d455874551be850a47}{unblock\_point}(x,y);
342             \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(x,y);
343             \textcolor{keywordflow}{break};
344         \}
345     \}
346 \}
\end{DoxyCode}
\hypertarget{music_8c_af9ca8df5ec8c5352e82afe2316a70e72}{\index{music.\+c@{music.\+c}!do\+\_\+improvisation@{do\+\_\+improvisation}}
\index{do\+\_\+improvisation@{do\+\_\+improvisation}!music.\+c@{music.\+c}}
\subsubsection[{do\+\_\+improvisation}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} int do\+\_\+improvisation (
\begin{DoxyParamCaption}
\item[{struct {\bf obj} $\ast$}]{instr}
\end{DoxyParamCaption}
)}}\label{music_8c_af9ca8df5ec8c5352e82afe2316a70e72}


Definition at line 353 of file music.\+c.



References A\+\_\+\+D\+E\+X, A\+\_\+\+W\+I\+S, A\+C\+U\+R\+R, A\+D\+\_\+\+C\+O\+L\+D, A\+D\+\_\+\+F\+I\+R\+E, A\+M\+I\+I\+\_\+\+O\+K\+A\+Y\+\_\+\+V\+O\+L\+U\+M\+E, amii\+\_\+speaker(), awaken\+\_\+monsters(), awaken\+\_\+soldiers(), buf, B\+U\+F\+S\+Z, calm\+\_\+nymphs(), charm\+\_\+monsters(), charm\+\_\+snakes(), C\+O\+L\+N\+O, Confusion, do\+\_\+earthquake(), you\+::dx, you\+::dy, you\+::dz, F\+A\+L\+S\+E, K\+I\+L\+L\+E\+D\+\_\+\+B\+Y, mac\+\_\+speaker(), makeknown, objects, obj\+::otyp, put\+\_\+monsters\+\_\+to\+\_\+sleep(), rn1, R\+O\+W\+N\+O, Sprintf, T\+R\+U\+E, u, uhim, you\+::ulevel, you\+::ux, and you\+::uy.



Referenced by do\+\_\+play\+\_\+instrument().


\begin{DoxyCode}
355 \{
356     \textcolor{keywordtype}{int} \hyperlink{structdamage}{damage}, do\_spec = !\hyperlink{youprop_8h_a85174462efda5cc2dc2a49a0249801bb}{Confusion};
357 \textcolor{preprocessor}{#if defined(MAC) || defined(AMIGA) || defined(VPIX\_MUSIC) || defined (PCMUSIC)}
358     \textcolor{keyword}{struct }\hyperlink{structobj}{obj} itmp;
359 
360     itmp = *instr;
361     \textcolor{comment}{/* if won't yield special effect, make sound of mundane counterpart */}
362     \textcolor{keywordflow}{if} (!do\_spec || instr->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe} <= 0)
363         \textcolor{keywordflow}{while} (\hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[itmp.otyp].oc\_magic) itmp.\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} -= 1;
364 \textcolor{preprocessor}{# ifdef MAC}
365     \hyperlink{macsnd_8c_a335c4f425c7088e8b4a2652c46299f05}{mac\_speaker}(&itmp, \textcolor{stringliteral}{"C"});
366 \textcolor{preprocessor}{# endif}
367 \textcolor{preprocessor}{# ifdef AMIGA}
368     \hyperlink{amisnd_8c_afa5675136ed62c49302acca9efba289a}{amii\_speaker}(&itmp, \textcolor{stringliteral}{"Cw"}, \hyperlink{amiconf_8h_ae318c543eacb3b51e83232c91f7cc115}{AMII\_OKAY\_VOLUME});
369 \textcolor{preprocessor}{# endif}
370 \textcolor{preprocessor}{# ifdef VPIX\_MUSIC}
371     \textcolor{keywordflow}{if} (sco\_flag\_console)
372         speaker(&itmp, \textcolor{stringliteral}{"C"});
373 \textcolor{preprocessor}{# endif}
374 \textcolor{preprocessor}{#ifdef PCMUSIC}
375       pc\_speaker ( &itmp, \textcolor{stringliteral}{"C"});
376 \textcolor{preprocessor}{#endif}
377 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* MAC || AMIGA || VPIX\_MUSIC || PCMUSIC */}\textcolor{preprocessor}{}
378 
379     \textcolor{keywordflow}{if} (!do\_spec)
380         pline(\textcolor{stringliteral}{"What you produce is quite far from music..."});
381     \textcolor{keywordflow}{else}
382         You(\textcolor{stringliteral}{"start playing %s."}, the(xname(instr)));
383 
384     \textcolor{keywordflow}{switch} (instr->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}) \{
385     \textcolor{keywordflow}{case} MAGIC\_FLUTE:       \textcolor{comment}{/* Make monster fall asleep */}
386         \textcolor{keywordflow}{if} (do\_spec && instr->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe} > 0) \{
387         consume\_obj\_charge(instr, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
388 
389         You(\textcolor{stringliteral}{"produce soft music."});
390         \hyperlink{music_8c_a8758c9f4ca03fe7780a1da5710835702}{put\_monsters\_to\_sleep}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a6c7263bb25b91825bf7ecaab470d771a}{ulevel} * 5);
391         exercise(\hyperlink{attrib_8h_ad8117dfaac470310d7540a3e8dcc00e0}{A\_DEX}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
392         \textcolor{keywordflow}{break};
393         \} \textcolor{comment}{/* else FALLTHRU */}
394     \textcolor{keywordflow}{case} WOODEN\_FLUTE:      \textcolor{comment}{/* May charm snakes */}
395         do\_spec &= (rn2(\hyperlink{attrib_8h_ab83869fac11f870c2193469440573f84}{ACURR}(\hyperlink{attrib_8h_ad8117dfaac470310d7540a3e8dcc00e0}{A\_DEX})) + \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a6c7263bb25b91825bf7ecaab470d771a}{ulevel} > 25);
396         pline(\textcolor{stringliteral}{"%s."}, Tobjnam(instr, do\_spec ? \textcolor{stringliteral}{"trill"} : \textcolor{stringliteral}{"toot"}));
397         \textcolor{keywordflow}{if} (do\_spec) \hyperlink{music_8c_a4537a3d20f92ba30f7325be2967ba553}{charm\_snakes}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a6c7263bb25b91825bf7ecaab470d771a}{ulevel} * 3);
398         exercise(\hyperlink{attrib_8h_ad8117dfaac470310d7540a3e8dcc00e0}{A\_DEX}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
399         \textcolor{keywordflow}{break};
400     \textcolor{keywordflow}{case} FROST\_HORN:        \textcolor{comment}{/* Idem wand of cold */}
401     \textcolor{keywordflow}{case} FIRE\_HORN:         \textcolor{comment}{/* Idem wand of fire */}
402         \textcolor{keywordflow}{if} (do\_spec && instr->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe} > 0) \{
403         consume\_obj\_charge(instr, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
404 
405         \textcolor{keywordflow}{if} (!getdir((\textcolor{keywordtype}{char} *)0)) \{
406             pline(\textcolor{stringliteral}{"%s."}, Tobjnam(instr, \textcolor{stringliteral}{"vibrate"}));
407             \textcolor{keywordflow}{break};
408         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a0b53da9e296cbebbc3dc2fc6ade21aeb}{dx} && !\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a80d068cfe5c15ae06e6f152be40a716f}{dy} && !\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a3fa7dbf98dab7ca2c40195268174c45f}{dz}) \{
409             \textcolor{keywordflow}{if} ((damage = zapyourself(instr, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE})) != 0) \{
410             \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
411             \hyperlink{global_8h_aa55ba8f4e3c82fe00035e6b51d6c7dee}{Sprintf}(buf, \textcolor{stringliteral}{"using a magical horn on %sself"}, \hyperlink{you_8h_a842295f0e58b1568b453630a0b7897c8}{uhim}());
412             losehp(damage, buf, \hyperlink{decl_8h_a0b77d6f094070ee1d9900156357f6f62}{KILLED\_BY});
413             \}
414         \} \textcolor{keywordflow}{else} \{
415             buzz((instr->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == FROST\_HORN) ? \hyperlink{monattk_8h_ad91817bd861d8b17fdfc7069122ab67e}{AD\_COLD}-1 : \hyperlink{monattk_8h_a2435fa84586bb5a35cf46f7abd380c86}{AD\_FIRE}-1,
416              \hyperlink{hack_8h_af107ca092682647f298989038020f9c8}{rn1}(6,6), \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a0b53da9e296cbebbc3dc2fc6ade21aeb}{dx}, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a80d068cfe5c15ae06e6f152be40a716f}{dy});
417         \}
418         \hyperlink{hack_8h_afbd3607e7cef2f888f4190d40d058011}{makeknown}(instr->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp});
419         \textcolor{keywordflow}{break};
420         \} \textcolor{comment}{/* else FALLTHRU */}
421     \textcolor{keywordflow}{case} TOOLED\_HORN:       \textcolor{comment}{/* Awaken or scare monsters */}
422         You(\textcolor{stringliteral}{"produce a frightful, grave sound."});
423         \hyperlink{music_8c_ad9841c8fc796cb9eea29b22bf495cc82}{awaken\_monsters}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a6c7263bb25b91825bf7ecaab470d771a}{ulevel} * 30);
424         exercise(\hyperlink{attrib_8h_a4206d6431732a698ede8a237d5c17142}{A\_WIS}, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
425         \textcolor{keywordflow}{break};
426     \textcolor{keywordflow}{case} BUGLE:         \textcolor{comment}{/* Awaken & attract soldiers */}
427         You(\textcolor{stringliteral}{"extract a loud noise from %s."}, the(xname(instr)));
428         \hyperlink{music_8c_a7f3337b0f8fa93a4030d1aa1ecd44706}{awaken\_soldiers}();
429         exercise(\hyperlink{attrib_8h_a4206d6431732a698ede8a237d5c17142}{A\_WIS}, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
430         \textcolor{keywordflow}{break};
431     \textcolor{keywordflow}{case} MAGIC\_HARP:        \textcolor{comment}{/* Charm monsters */}
432         \textcolor{keywordflow}{if} (do\_spec && instr->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe} > 0) \{
433         consume\_obj\_charge(instr, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
434 
435         pline(\textcolor{stringliteral}{"%s very attractive music."}, Tobjnam(instr, \textcolor{stringliteral}{"produce"}));
436         \hyperlink{music_8c_a30bde4ddc5e1629ca7482ab34ef5b368}{charm\_monsters}((\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a6c7263bb25b91825bf7ecaab470d771a}{ulevel} - 1) / 3 + 1);
437         exercise(\hyperlink{attrib_8h_ad8117dfaac470310d7540a3e8dcc00e0}{A\_DEX}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
438         \textcolor{keywordflow}{break};
439         \} \textcolor{comment}{/* else FALLTHRU */}
440     \textcolor{keywordflow}{case} WOODEN\_HARP:       \textcolor{comment}{/* May calm Nymph */}
441         do\_spec &= (rn2(\hyperlink{attrib_8h_ab83869fac11f870c2193469440573f84}{ACURR}(\hyperlink{attrib_8h_ad8117dfaac470310d7540a3e8dcc00e0}{A\_DEX})) + \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a6c7263bb25b91825bf7ecaab470d771a}{ulevel} > 25);
442         pline(\textcolor{stringliteral}{"%s %s."}, The(xname(instr)),
443           do\_spec ? \textcolor{stringliteral}{"produces a lilting melody"} : \textcolor{stringliteral}{"twangs"});
444         \textcolor{keywordflow}{if} (do\_spec) \hyperlink{music_8c_aace913e71e07ebb80800a18c0d52a342}{calm\_nymphs}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a6c7263bb25b91825bf7ecaab470d771a}{ulevel} * 3);
445         exercise(\hyperlink{attrib_8h_ad8117dfaac470310d7540a3e8dcc00e0}{A\_DEX}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
446         \textcolor{keywordflow}{break};
447     \textcolor{keywordflow}{case} DRUM\_OF\_EARTHQUAKE:    \textcolor{comment}{/* create several pits */}
448         \textcolor{keywordflow}{if} (do\_spec && instr->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe} > 0) \{
449         consume\_obj\_charge(instr, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
450 
451         You(\textcolor{stringliteral}{"produce a heavy, thunderous rolling!"});
452         pline\_The(\textcolor{stringliteral}{"entire dungeon is shaking around you!"});
453         \hyperlink{music_8c_af1d575299ce0239159297af4c2b33810}{do\_earthquake}((\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a6c7263bb25b91825bf7ecaab470d771a}{ulevel} - 1) / 3 + 1);
454         \textcolor{comment}{/* shake up monsters in a much larger radius... */}
455         \hyperlink{music_8c_ad9841c8fc796cb9eea29b22bf495cc82}{awaken\_monsters}(\hyperlink{global_8h_a9cce134868d97b23c35bcf1ff4a343d8}{ROWNO} * \hyperlink{global_8h_a308dbfcc29f5a427c0315f3cbf03c3ed}{COLNO});
456         \hyperlink{hack_8h_afbd3607e7cef2f888f4190d40d058011}{makeknown}(DRUM\_OF\_EARTHQUAKE);
457         \textcolor{keywordflow}{break};
458         \} \textcolor{comment}{/* else FALLTHRU */}
459     \textcolor{keywordflow}{case} LEATHER\_DRUM:      \textcolor{comment}{/* Awaken monsters */}
460         You(\textcolor{stringliteral}{"beat a deafening row!"});
461         \hyperlink{music_8c_ad9841c8fc796cb9eea29b22bf495cc82}{awaken\_monsters}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a6c7263bb25b91825bf7ecaab470d771a}{ulevel} * 40);
462         exercise(\hyperlink{attrib_8h_a4206d6431732a698ede8a237d5c17142}{A\_WIS}, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
463         \textcolor{keywordflow}{break};
464     \textcolor{keywordflow}{default}:
465         impossible(\textcolor{stringliteral}{"What a weird instrument (%d)!"}, instr->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp});
466         \textcolor{keywordflow}{break};
467     \}
468     \textcolor{keywordflow}{return} 2;       \textcolor{comment}{/* That takes time */}
469 \}
\end{DoxyCode}
\hypertarget{music_8c_adc0c232611c8e0a27e63c2fef4989bd5}{\index{music.\+c@{music.\+c}!do\+\_\+play\+\_\+instrument@{do\+\_\+play\+\_\+instrument}}
\index{do\+\_\+play\+\_\+instrument@{do\+\_\+play\+\_\+instrument}!music.\+c@{music.\+c}}
\subsubsection[{do\+\_\+play\+\_\+instrument}]{\setlength{\rightskip}{0pt plus 5cm}int do\+\_\+play\+\_\+instrument (
\begin{DoxyParamCaption}
\item[{struct {\bf obj} $\ast$}]{instr}
\end{DoxyParamCaption}
)}}\label{music_8c_adc0c232611c8e0a27e63c2fef4989bd5}


Definition at line 476 of file music.\+c.



References A\+\_\+\+W\+I\+S, A\+M\+I\+I\+\_\+\+O\+K\+A\+Y\+\_\+\+V\+O\+L\+U\+M\+E, amii\+\_\+speaker(), buf, B\+U\+F\+S\+Z, do\+\_\+improvisation(), D\+R\+A\+W\+B\+R\+I\+D\+G\+E\+\_\+\+D\+O\+W\+N, F\+A\+L\+S\+E, flags, getlin, I\+S\+\_\+\+D\+R\+A\+W\+B\+R\+I\+D\+G\+E, Is\+\_\+stronghold, levl, mac\+\_\+speaker(), plur, flag\+::soundok, Strcpy, T\+R\+U\+E, tune, u, you\+::uevent, Underwater, you\+::ux, you\+::uy, you\+::uz, and yn.


\begin{DoxyCode}
478 \{
479     \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}], c = \textcolor{charliteral}{'y'};
480     \textcolor{keywordtype}{char} *s;
481     \textcolor{keywordtype}{int} x,y;
482     \textcolor{keywordtype}{boolean} ok;
483 
484     \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a2eb59bdcba2c368fefd253bfcdaa3673}{Underwater}) \{
485     You\_cant(\textcolor{stringliteral}{"play music underwater!"});
486     \textcolor{keywordflow}{return}(0);
487     \}
488     \textcolor{keywordflow}{if} (instr->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} != LEATHER\_DRUM && instr->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} != DRUM\_OF\_EARTHQUAKE) \{
489     c = \hyperlink{hack_8h_a22ffd7fa35549db318337a497c38a1ae}{yn}(\textcolor{stringliteral}{"Improvise?"});
490     \}
491     \textcolor{keywordflow}{if} (c == \textcolor{charliteral}{'n'}) \{
492     \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_aaa426b9f3053502028edbe45d2031208}{uevent}.uheard\_tune == 2 && \hyperlink{hack_8h_a22ffd7fa35549db318337a497c38a1ae}{yn}(\textcolor{stringliteral}{"Play the passtune?"}) == \textcolor{charliteral}{'y'}) \{
493         \hyperlink{global_8h_add22f733d1f2c380499f495068e42b7c}{Strcpy}(buf, \hyperlink{decl_8h_a1233f8e41c964a3bae5a9b655ac1912d}{tune});
494     \} \textcolor{keywordflow}{else} \{
495         \hyperlink{winprocs_8h_ab09682cb017e224c23b0c4e7989a81a7}{getlin}(\textcolor{stringliteral}{"What tune are you playing? [5 notes, A-G]"}, buf);
496         (void)mungspaces(buf);
497         \textcolor{comment}{/* convert to uppercase and change any "H" to the expected "B" */}
498         \textcolor{keywordflow}{for} (s = buf; *s; s++) \{
499 \textcolor{preprocessor}{#ifndef AMIGA}
500         *s = highc(*s);
501 \textcolor{preprocessor}{#else}
502         \textcolor{comment}{/* The AMIGA supports two octaves of notes */}
503         \textcolor{keywordflow}{if} (*s == \textcolor{charliteral}{'h'}) *s = \textcolor{charliteral}{'b'};
504 \textcolor{preprocessor}{#endif}
505         \textcolor{keywordflow}{if} (*s == \textcolor{charliteral}{'H'}) *s = \textcolor{charliteral}{'B'};
506         \}
507     \}
508     You(\textcolor{stringliteral}{"extract a strange sound from %s!"}, the(xname(instr)));
509 \textcolor{preprocessor}{#ifdef UNIX386MUSIC}
510     \textcolor{comment}{/* if user is at the console, play through the console speaker */}
511     \textcolor{keywordflow}{if} (atconsole())
512         speaker(instr, buf);
513 \textcolor{preprocessor}{#endif}
514 \textcolor{preprocessor}{#ifdef VPIX\_MUSIC}
515     \textcolor{keywordflow}{if} (sco\_flag\_console)
516         speaker(instr, buf);
517 \textcolor{preprocessor}{#endif}
518 \textcolor{preprocessor}{#ifdef MAC}
519     \hyperlink{macsnd_8c_a335c4f425c7088e8b4a2652c46299f05}{mac\_speaker} ( instr , buf ) ;
520 \textcolor{preprocessor}{#endif}
521 \textcolor{preprocessor}{#ifdef PCMUSIC}
522     pc\_speaker ( instr, buf );
523 \textcolor{preprocessor}{#endif}
524 \textcolor{preprocessor}{#ifdef AMIGA}
525     \{
526         \textcolor{keywordtype}{char} nbuf[ 20 ];
527         \textcolor{keywordtype}{int} i;
528         \textcolor{keywordflow}{for}( i = 0; buf[i] && i < 5; ++i )
529         \{
530             nbuf[ i*2 ] = buf[ i ];
531             nbuf[ (i*2)+1 ] = \textcolor{charliteral}{'h'};
532         \}
533         nbuf[ i*2 ] = 0;
534         \hyperlink{amisnd_8c_afa5675136ed62c49302acca9efba289a}{amii\_speaker} ( instr , nbuf, \hyperlink{amiconf_8h_ae318c543eacb3b51e83232c91f7cc115}{AMII\_OKAY\_VOLUME} ) ;
535     \}
536 \textcolor{preprocessor}{#endif}
537     \textcolor{comment}{/* Check if there was the Stronghold drawbridge near}
538 \textcolor{comment}{     * and if the tune conforms to what we're waiting for.}
539 \textcolor{comment}{     */}
540     \textcolor{keywordflow}{if}(\hyperlink{dungeon_8h_a2985e445d6e532cc0d8e6ba93f5058fd}{Is\_stronghold}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz})) \{
541         exercise(\hyperlink{attrib_8h_a4206d6431732a698ede8a237d5c17142}{A\_WIS}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});     \textcolor{comment}{/* just for trying */}
542         \textcolor{keywordflow}{if}(!strcmp(buf,\hyperlink{decl_8h_a1233f8e41c964a3bae5a9b655ac1912d}{tune})) \{
543         \textcolor{comment}{/* Search for the drawbridge */}
544         \textcolor{keywordflow}{for}(y=\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}-1; y<=\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}+1; y++)
545             \textcolor{keywordflow}{for}(x=\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}-1;x<=\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}+1;x++)
546             \textcolor{keywordflow}{if}(isok(x,y))
547             \textcolor{keywordflow}{if}(find\_drawbridge(&x,&y)) \{
548                 \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_aaa426b9f3053502028edbe45d2031208}{uevent}.uheard\_tune = 2; \textcolor{comment}{/* tune now fully known */}
549                 \textcolor{keywordflow}{if}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].typ == \hyperlink{rm_8h_ab6103ae7f493570a01e00598434d3dd1}{DRAWBRIDGE\_DOWN})
550                 close\_drawbridge(x,y);
551                 \textcolor{keywordflow}{else}
552                 open\_drawbridge(x,y);
553                 \textcolor{keywordflow}{return} 0;
554             \}
555         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{flag_8h_a997133526e0c6bed44ebc0116a48b50a}{flags}.\hyperlink{structflag_ae3871fd2268fbc24b89cece8eb352dfc}{soundok}) \{
556         \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_aaa426b9f3053502028edbe45d2031208}{uevent}.uheard\_tune < 1) \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_aaa426b9f3053502028edbe45d2031208}{uevent}.uheard\_tune = 1;
557         \textcolor{comment}{/* Okay, it wasn't the right tune, but perhaps}
558 \textcolor{comment}{         * we can give the player some hints like in the}
559 \textcolor{comment}{         * Mastermind game */}
560         ok = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
561         \textcolor{keywordflow}{for}(y = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}-1; y <= \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}+1 && !ok; y++)
562             \textcolor{keywordflow}{for}(x = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}-1; x <= \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}+1 && !ok; x++)
563             \textcolor{keywordflow}{if}(isok(x,y))
564             \textcolor{keywordflow}{if}(\hyperlink{rm_8h_a0fc755681c9d727e384051fe943a902c}{IS\_DRAWBRIDGE}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].typ) ||
565                is\_drawbridge\_wall(x,y) >= 0)
566                 ok = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
567         \textcolor{keywordflow}{if}(ok) \{ \textcolor{comment}{/* There is a drawbridge near */}
568             \textcolor{keywordtype}{int} tumblers, gears;
569             \textcolor{keywordtype}{boolean} matched[5];
570 
571             tumblers = gears = 0;
572             \textcolor{keywordflow}{for}(x=0; x < 5; x++)
573             matched[x] = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
574 
575             \textcolor{keywordflow}{for}(x=0; x < (int)strlen(buf); x++)
576             \textcolor{keywordflow}{if}(x < 5) \{
577                 \textcolor{keywordflow}{if}(buf[x] == \hyperlink{decl_8h_a1233f8e41c964a3bae5a9b655ac1912d}{tune}[x]) \{
578                 gears++;
579                 matched[x] = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
580                 \} \textcolor{keywordflow}{else}
581                 \textcolor{keywordflow}{for}(y=0; y < 5; y++)
582                     \textcolor{keywordflow}{if}(!matched[y] &&
583                        buf[x] == \hyperlink{decl_8h_a1233f8e41c964a3bae5a9b655ac1912d}{tune}[y] &&
584                        buf[y] != \hyperlink{decl_8h_a1233f8e41c964a3bae5a9b655ac1912d}{tune}[y]) \{
585                     tumblers++;
586                     matched[y] = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
587                     \textcolor{keywordflow}{break};
588                     \}
589             \}
590             \textcolor{keywordflow}{if}(tumblers)
591             \textcolor{keywordflow}{if}(gears)
592                 You\_hear(\textcolor{stringliteral}{"%d tumbler%s click and %d gear%s turn."},
593                 tumblers, \hyperlink{hack_8h_a6ed0ab51b12ebf31e060e3dd26394db0}{plur}(tumblers), gears, \hyperlink{hack_8h_a6ed0ab51b12ebf31e060e3dd26394db0}{plur}(gears));
594             \textcolor{keywordflow}{else}
595                 You\_hear(\textcolor{stringliteral}{"%d tumbler%s click."},
596                 tumblers, \hyperlink{hack_8h_a6ed0ab51b12ebf31e060e3dd26394db0}{plur}(tumblers));
597             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(gears) \{
598             You\_hear(\textcolor{stringliteral}{"%d gear%s turn."}, gears, \hyperlink{hack_8h_a6ed0ab51b12ebf31e060e3dd26394db0}{plur}(gears));
599             \textcolor{comment}{/* could only get `gears == 5' by playing five}
600 \textcolor{comment}{               correct notes followed by excess; otherwise,}
601 \textcolor{comment}{               tune would have matched above */}
602             \textcolor{keywordflow}{if} (gears == 5) \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_aaa426b9f3053502028edbe45d2031208}{uevent}.uheard\_tune = 2;
603             \}
604         \}
605         \}
606       \}
607     \textcolor{keywordflow}{return} 1;
608     \} \textcolor{keywordflow}{else}
609         \textcolor{keywordflow}{return} \hyperlink{music_8c_af9ca8df5ec8c5352e82afe2316a70e72}{do\_improvisation}(instr);
610 \}
\end{DoxyCode}
\hypertarget{music_8c_a0b66bbd7e8c48a78b0694ed7957a56f8}{\index{music.\+c@{music.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!music.\+c@{music.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf awaken\+\_\+monsters}}]{, }
\item[{(int)}]{}
\end{DoxyParamCaption}
)}}\label{music_8c_a0b66bbd7e8c48a78b0694ed7957a56f8}
\hypertarget{music_8c_a15a29f7e8aa2366f6ca4aefdc8e9a137}{\index{music.\+c@{music.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!music.\+c@{music.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf put\+\_\+monsters\+\_\+to\+\_\+sleep}}]{, }
\item[{(int)}]{}
\end{DoxyParamCaption}
)}}\label{music_8c_a15a29f7e8aa2366f6ca4aefdc8e9a137}
\hypertarget{music_8c_a052b12c54e8ca6c34c47d625b97700f5}{\index{music.\+c@{music.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!music.\+c@{music.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf charm\+\_\+snakes}}]{, }
\item[{(int)}]{}
\end{DoxyParamCaption}
)}}\label{music_8c_a052b12c54e8ca6c34c47d625b97700f5}
\hypertarget{music_8c_a9e6bc3db1e18df81ef21b7cd3592bd1c}{\index{music.\+c@{music.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!music.\+c@{music.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf calm\+\_\+nymphs}}]{, }
\item[{(int)}]{}
\end{DoxyParamCaption}
)}}\label{music_8c_a9e6bc3db1e18df81ef21b7cd3592bd1c}
\hypertarget{music_8c_aad2e710bfbe4bad2f286d26dc49867fb}{\index{music.\+c@{music.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!music.\+c@{music.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf charm\+\_\+monsters}}]{, }
\item[{(int)}]{}
\end{DoxyParamCaption}
)}}\label{music_8c_aad2e710bfbe4bad2f286d26dc49867fb}
\hypertarget{music_8c_a8fa7d6fe668f514e19734852d92176fd}{\index{music.\+c@{music.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!music.\+c@{music.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf do\+\_\+earthquake}}]{, }
\item[{(int)}]{}
\end{DoxyParamCaption}
)}}\label{music_8c_a8fa7d6fe668f514e19734852d92176fd}
\hypertarget{music_8c_a6abd62e5bf06eeb09a5f36b48f9e43fb}{\index{music.\+c@{music.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!music.\+c@{music.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} int F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf do\+\_\+improvisation}}]{, }
\item[{(struct {\bf obj} $\ast$)}]{}
\end{DoxyParamCaption}
)}}\label{music_8c_a6abd62e5bf06eeb09a5f36b48f9e43fb}
\hypertarget{music_8c_a8758c9f4ca03fe7780a1da5710835702}{\index{music.\+c@{music.\+c}!put\+\_\+monsters\+\_\+to\+\_\+sleep@{put\+\_\+monsters\+\_\+to\+\_\+sleep}}
\index{put\+\_\+monsters\+\_\+to\+\_\+sleep@{put\+\_\+monsters\+\_\+to\+\_\+sleep}!music.\+c@{music.\+c}}
\subsubsection[{put\+\_\+monsters\+\_\+to\+\_\+sleep}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void put\+\_\+monsters\+\_\+to\+\_\+sleep (
\begin{DoxyParamCaption}
\item[{int}]{distance}
\end{DoxyParamCaption}
)}}\label{music_8c_a8758c9f4ca03fe7780a1da5710835702}


Definition at line 89 of file music.\+c.



References D\+E\+A\+D\+M\+O\+N\+S\+T\+E\+R, distu, fmon, monst\+::mx, monst\+::my, monst\+::nmon, and T\+O\+O\+L\+\_\+\+C\+L\+A\+S\+S.



Referenced by do\+\_\+improvisation().


\begin{DoxyCode}
91 \{
92     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon};
93 
94     \textcolor{keywordflow}{while}(mtmp) \{
95         \textcolor{keywordflow}{if} (!\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp) && \hyperlink{hack_8h_a1f84afcae19c5b60124bc509ed647f84}{distu}(mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx}, mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my}) < distance &&
96             sleep\_monst(mtmp, d(10,10), \hyperlink{objclass_8h_ad8e3b1b1f1bd8dff660c15840a3f2b03}{TOOL\_CLASS})) \{
97             mtmp->msleeping = 1; \textcolor{comment}{/* 10d10 turns + wake\_nearby to rouse */}
98             slept\_monst(mtmp);
99         \}
100         mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon};
101     \}
102 \}
\end{DoxyCode}
