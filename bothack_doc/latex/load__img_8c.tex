\hypertarget{load__img_8c}{\section{nethack/win/gem/load\+\_\+img.c File Reference}
\label{load__img_8c}\index{nethack/win/gem/load\+\_\+img.\+c@{nethack/win/gem/load\+\_\+img.\+c}}
}
{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$osbind.\+h$>$}\\*
{\ttfamily \#include $<$memory.\+h$>$}\\*
{\ttfamily \#include $<$aesbind.\+h$>$}\\*
{\ttfamily \#include $<$vdibind.\+h$>$}\\*
{\ttfamily \#include $<$gemfast.\+h$>$}\\*
{\ttfamily \#include $<$e\+\_\+gem.\+h$>$}\\*
{\ttfamily \#include \char`\"{}load\+\_\+img.\+h\char`\"{}}\\*
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \hyperlink{load__img_8c_a6ebf94d5eed587570c694ce1d663d8ab}{\+\_\+\+\_\+\+T\+C\+C\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+\_\+}
\item 
\#define \hyperlink{load__img_8c_aa93f0eb578d23995850d61f7d61c55c1}{F\+A\+L\+S\+E}~0
\item 
\#define \hyperlink{load__img_8c_aa8cecfc5c5c054d2875c03e77b7be15d}{T\+R\+U\+E}~!\hyperlink{xpm2img_8c_aa93f0eb578d23995850d61f7d61c55c1}{F\+A\+L\+S\+E}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{load__img_8c_adb63ce256aae1d1efd1f38050e1eb8eb}{get\+\_\+colors} (int handle, short $\ast$palette, int col)
\item 
void \hyperlink{load__img_8c_aa558dbb1744b4a5a95a6b767a4d005ea}{img\+\_\+set\+\_\+colors} (int handle, short $\ast$palette, int col)
\item 
int \hyperlink{load__img_8c_ab825ceec894ab10c30b85224dda4b2a5}{convert} (M\+F\+D\+B $\ast$\hyperlink{ppmwrite_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image}, long \hyperlink{structsize}{size})
\item 
int \hyperlink{load__img_8c_ada98b09ccce105673fc2b4d0525a7f6a}{transform\+\_\+img} (M\+F\+D\+B $\ast$\hyperlink{ppmwrite_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image})
\item 
int \hyperlink{load__img_8c_ac1cb57750b18907eab67de4f7cbca807}{depack\+\_\+img} (char $\ast$\hyperlink{lev__main_8c_a8f8f80d37794cde9472343e4487ba3eb}{name}, \hyperlink{load__img_8h_a76846b77e5f7fe66cd64f6531617f10e}{I\+M\+G\+\_\+header} $\ast$pic)
\item 
int \hyperlink{load__img_8c_a083f7f77b6e0ef8fa2684c501098daf6}{half\+\_\+img} (M\+F\+D\+B $\ast$s, M\+F\+D\+B $\ast$d)
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{load__img_8c_a3233ff15de80477a78e8591197052c17}{vdi2dev4} \mbox{[}$\,$\mbox{]} =\{0,15,1,2,4,6,3,5,7,8,9,10,12,14,11,13\}
\item 
int \hyperlink{load__img_8c_aad3b8ed248399e391bd9b27eb0f232cd}{vdi2dev2} \mbox{[}$\,$\mbox{]} =\{0,3,1,2\}
\end{DoxyCompactItemize}


\subsection{Macro Definition Documentation}
\hypertarget{load__img_8c_a6ebf94d5eed587570c694ce1d663d8ab}{\index{load\+\_\+img.\+c@{load\+\_\+img.\+c}!\+\_\+\+\_\+\+T\+C\+C\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+\_\+@{\+\_\+\+\_\+\+T\+C\+C\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+\+T\+C\+C\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+\_\+@{\+\_\+\+\_\+\+T\+C\+C\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+\_\+}!load\+\_\+img.\+c@{load\+\_\+img.\+c}}
\subsubsection[{\+\_\+\+\_\+\+T\+C\+C\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+\_\+}]{\setlength{\rightskip}{0pt plus 5cm}\#define \+\_\+\+\_\+\+T\+C\+C\+\_\+\+C\+O\+M\+P\+A\+T\+\_\+\+\_\+}}\label{load__img_8c_a6ebf94d5eed587570c694ce1d663d8ab}


Definition at line 1 of file load\+\_\+img.\+c.

\hypertarget{load__img_8c_aa93f0eb578d23995850d61f7d61c55c1}{\index{load\+\_\+img.\+c@{load\+\_\+img.\+c}!F\+A\+L\+S\+E@{F\+A\+L\+S\+E}}
\index{F\+A\+L\+S\+E@{F\+A\+L\+S\+E}!load\+\_\+img.\+c@{load\+\_\+img.\+c}}
\subsubsection[{F\+A\+L\+S\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define F\+A\+L\+S\+E~0}}\label{load__img_8c_aa93f0eb578d23995850d61f7d61c55c1}


Definition at line 13 of file load\+\_\+img.\+c.



Referenced by convert(), depack\+\_\+img(), half\+\_\+img(), and transform\+\_\+img().

\hypertarget{load__img_8c_aa8cecfc5c5c054d2875c03e77b7be15d}{\index{load\+\_\+img.\+c@{load\+\_\+img.\+c}!T\+R\+U\+E@{T\+R\+U\+E}}
\index{T\+R\+U\+E@{T\+R\+U\+E}!load\+\_\+img.\+c@{load\+\_\+img.\+c}}
\subsubsection[{T\+R\+U\+E}]{\setlength{\rightskip}{0pt plus 5cm}\#define T\+R\+U\+E~!{\bf F\+A\+L\+S\+E}}}\label{load__img_8c_aa8cecfc5c5c054d2875c03e77b7be15d}


Definition at line 14 of file load\+\_\+img.\+c.



Referenced by convert(), half\+\_\+img(), and transform\+\_\+img().



\subsection{Function Documentation}
\hypertarget{load__img_8c_ab825ceec894ab10c30b85224dda4b2a5}{\index{load\+\_\+img.\+c@{load\+\_\+img.\+c}!convert@{convert}}
\index{convert@{convert}!load\+\_\+img.\+c@{load\+\_\+img.\+c}}
\subsubsection[{convert}]{\setlength{\rightskip}{0pt plus 5cm}int convert (
\begin{DoxyParamCaption}
\item[{M\+F\+D\+B $\ast$}]{image, }
\item[{long}]{size}
\end{DoxyParamCaption}
)}}\label{load__img_8c_ab825ceec894ab10c30b85224dda4b2a5}


Definition at line 69 of file load\+\_\+img.\+c.



References F\+A\+L\+S\+E, free(), image, min, N\+U\+L\+L, planes, and T\+R\+U\+E.



Referenced by transform\+\_\+img().


\begin{DoxyCode}
69                                    \{
70     \textcolor{keywordtype}{int} plane, mplanes;
71     \textcolor{keywordtype}{char} *line\_addr, *buf\_addr, *new\_addr, *new1\_addr, *image\_addr, *screen\_addr;
72     MFDB  dev\_form, tmp;
73     \textcolor{keywordtype}{long}    new\_size;
74 
75     \textcolor{comment}{/* convert size from words to bytes */}
76     \hyperlink{structsize}{size} <<= 1;
77 
78     \textcolor{comment}{/* memory for the device raster */}
79     new\_size=\hyperlink{structsize}{size}*(long)\hyperlink{xpm2iff_8c_a0887fed8a7ea2f98b2b12e8866bee719}{planes};
80     \textcolor{keywordflow}{if}((new\_addr=(\textcolor{keywordtype}{char} *) calloc(1,new\_size)) == \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
81         \textcolor{keywordflow}{return}(\hyperlink{load__img_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
82 
83     \textcolor{comment}{/* initialize MFDBs */}
84     tmp=*\hyperlink{gifread_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image};
85     tmp.fd\_nplanes=\hyperlink{xpm2iff_8c_a0887fed8a7ea2f98b2b12e8866bee719}{planes};
86     tmp.fd\_addr=new\_addr;
87     tmp.fd\_stand=1;             \textcolor{comment}{/* standard format */}
88     dev\_form=tmp;
89     screen\_addr=new\_addr;
90     dev\_form.fd\_stand=0;          \textcolor{comment}{/* device format */}
91     image\_addr=(\textcolor{keywordtype}{char} *)\hyperlink{gifread_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image}->fd\_addr;
92 
93     \textcolor{comment}{/* initialize some variables and zero temp. line buffer */}
94     mplanes=\hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(\hyperlink{gifread_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image}->fd\_nplanes, \hyperlink{xpm2iff_8c_a0887fed8a7ea2f98b2b12e8866bee719}{planes});
95     \textcolor{comment}{/* convert image */}
96     line\_addr=image\_addr;
97     buf\_addr=screen\_addr;
98         \textcolor{keywordflow}{if}(mplanes>1)\{
99             \textcolor{comment}{/* cut/pad color planes into temp buf */}
100             \textcolor{keywordflow}{for}(plane=0; plane<mplanes; plane ++)\{
101             memcpy(buf\_addr, line\_addr, \hyperlink{structsize}{size});
102                 line\_addr += \hyperlink{structsize}{size};
103             buf\_addr += \hyperlink{structsize}{size};
104             \}
105         \}\textcolor{keywordflow}{else}\{
106             \textcolor{comment}{/* fill temp line bitplanes with a b&w line */}
107             \textcolor{keywordflow}{for}(plane=0; plane < \hyperlink{xpm2iff_8c_a0887fed8a7ea2f98b2b12e8866bee719}{planes}; plane ++)\{
108             memcpy(buf\_addr, line\_addr, \hyperlink{structsize}{size});
109             buf\_addr += \hyperlink{structsize}{size};
110             \}
111         \}
112     \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(\hyperlink{gifread_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image}->fd\_addr);
113         \textcolor{comment}{/* convert image line in temp into current device raster format */}
114     \textcolor{keywordflow}{if}((new1\_addr=(\textcolor{keywordtype}{char} *) calloc(1,new\_size)) == \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
115         \textcolor{keywordflow}{return}(\hyperlink{load__img_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
116     dev\_form.fd\_addr=new1\_addr;
117         vr\_trnfm(x\_handle, &tmp, &dev\_form);
118     \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(new\_addr);
119 
120     \textcolor{comment}{/* change image description */}
121     \hyperlink{gifread_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image}->fd\_stand=0;          \textcolor{comment}{/* device format */}
122     \hyperlink{gifread_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image}->fd\_addr=new1\_addr;
123     \hyperlink{gifread_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image}->fd\_nplanes=\hyperlink{xpm2iff_8c_a0887fed8a7ea2f98b2b12e8866bee719}{planes};
124     \textcolor{keywordflow}{return}(\hyperlink{load__img_8c_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
125 \}
\end{DoxyCode}
\hypertarget{load__img_8c_ac1cb57750b18907eab67de4f7cbca807}{\index{load\+\_\+img.\+c@{load\+\_\+img.\+c}!depack\+\_\+img@{depack\+\_\+img}}
\index{depack\+\_\+img@{depack\+\_\+img}!load\+\_\+img.\+c@{load\+\_\+img.\+c}}
\subsubsection[{depack\+\_\+img}]{\setlength{\rightskip}{0pt plus 5cm}int depack\+\_\+img (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{name, }
\item[{{\bf I\+M\+G\+\_\+header} $\ast$}]{pic}
\end{DoxyParamCaption}
)}}\label{load__img_8c_ac1cb57750b18907eab67de4f7cbca807}


Definition at line 144 of file load\+\_\+img.\+c.



References I\+M\+G\+\_\+\+H\+E\+A\+D\+E\+R\+::addr, B\+U\+F\+S\+I\+Z, E\+R\+R\+\_\+\+A\+L\+L\+O\+C, E\+R\+R\+\_\+\+C\+O\+L\+O\+R, E\+R\+R\+\_\+\+D\+E\+P\+A\+C\+K, E\+R\+R\+\_\+\+F\+I\+L\+E, E\+R\+R\+\_\+\+H\+E\+A\+D\+E\+R, error(), F\+A\+L\+S\+E, fp, free(), I\+M\+G\+\_\+\+H\+E\+A\+D\+E\+R\+::img\+\_\+h, I\+M\+G\+\_\+\+H\+E\+A\+D\+E\+R\+::img\+\_\+w, I\+M\+G\+\_\+\+H\+E\+A\+D\+E\+R\+::length, I\+M\+G\+\_\+\+H\+E\+A\+D\+E\+R\+::magic, N\+U\+L\+L, I\+M\+G\+\_\+\+H\+E\+A\+D\+E\+R\+::palette, I\+M\+G\+\_\+\+H\+E\+A\+D\+E\+R\+::paltype, I\+M\+G\+\_\+\+H\+E\+A\+D\+E\+R\+::pat\+\_\+len, I\+M\+G\+\_\+\+H\+E\+A\+D\+E\+R\+::planes, S\+E\+E\+K\+\_\+\+S\+E\+T, I\+M\+G\+\_\+\+H\+E\+A\+D\+E\+R\+::version, width, and X\+I\+M\+G.



Referenced by mar\+\_\+ask\+\_\+name(), mar\+\_\+display\+\_\+nhwindow(), and mar\+\_\+gem\+\_\+init().


\begin{DoxyCode}
144                                            \{
145     \textcolor{keywordtype}{int} b, line, plane, \hyperlink{xpm2img_8c_a2474a5474cbff19523a51eb1de01cda4}{width}, word\_aligned, opcode, patt\_len, pal\_size,
146             byte\_repeat, patt\_repeat, scan\_repeat, \hyperlink{txt2iff_8c_a64e632a682e311bde915784e6a17da31}{error} = \hyperlink{load__img_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
147     \textcolor{keywordtype}{char}    *pattern, *to, *endline, *puffer, sol\_pat;
148     \textcolor{keywordtype}{long}    \hyperlink{structsize}{size};
149     FILE *\hyperlink{tile2img_8c_aa065f30aa9f5f9a42132c82c787ee70b}{fp};
150 
151     \textcolor{keywordflow}{if}((fp = fopen(\hyperlink{lev__main_8c_a8f8f80d37794cde9472343e4487ba3eb}{name}, \textcolor{stringliteral}{"rb"})) == \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL})
152         \textcolor{keywordflow}{return}(\hyperlink{load__img_8h_a846551741a0d8ec6d1efd5491798d50d}{ERR\_FILE});
153 
154     setvbuf(fp,\hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL},\_IOLBF,\hyperlink{wceconf_8h_a72a591cf0a96cf23c63df5c78712dabe}{BUFSIZ});
155 
156     \textcolor{comment}{/* read header info (bw & ximg) into image structure */}
157     fread((\textcolor{keywordtype}{char} *)&(pic->\hyperlink{structIMG__HEADER_a1b1d98bc34d00dcc045621d7d108aa33}{version}), 2, 8 + 3, fp);
158 
159     \textcolor{comment}{/* only 2-256 color imgs */}
160     \textcolor{keywordflow}{if}(pic->\hyperlink{structIMG__HEADER_ad4657aaf83e1c3a89230a56177bdc7f4}{planes} < 1 || pic->\hyperlink{structIMG__HEADER_ad4657aaf83e1c3a89230a56177bdc7f4}{planes} > 8)\{
161         error = \hyperlink{load__img_8h_a59be80d1d80fc8a9dbfe8d823dbbac74}{ERR\_COLOR};
162         \textcolor{keywordflow}{goto} end\_depack;
163     \}
164 
165     \textcolor{comment}{/* if XIMG, read info */}
166     \textcolor{keywordflow}{if}(pic->\hyperlink{structIMG__HEADER_abbbc6e8856fd81c6feef3add32208f3f}{magic} == \hyperlink{bitmfile_8h_ae92db6ab7eef0759b429b39b83e0b06aa751c5502279504952b0f2ff9b0233e46}{XIMG} && pic->\hyperlink{structIMG__HEADER_a7670a47b02ace635063baec09703a7ed}{paltype} == 0)\{
167         pal\_size = (1 << pic->\hyperlink{structIMG__HEADER_ad4657aaf83e1c3a89230a56177bdc7f4}{planes}) * 3 * 2;
168         \textcolor{keywordflow}{if}((pic->\hyperlink{structIMG__HEADER_a62627863acc4854672b716af0f69a4b9}{palette} = (\textcolor{keywordtype}{short} *)calloc(1,pal\_size)))\{
169             fread((\textcolor{keywordtype}{char} *)pic->\hyperlink{structIMG__HEADER_a62627863acc4854672b716af0f69a4b9}{palette}, 1, pal\_size, fp);
170         \}
171     \}\textcolor{keywordflow}{else}\{
172         pic->\hyperlink{structIMG__HEADER_a62627863acc4854672b716af0f69a4b9}{palette} = \hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL};
173     \}
174 
175     \textcolor{comment}{/* width in bytes word aliged */}
176     word\_aligned = (pic->\hyperlink{structIMG__HEADER_acab9fca679b5827910e3c2a6e302e9f2}{img\_w} + 15) >> 4;
177     word\_aligned <<= 1;
178 
179     \textcolor{comment}{/* width byte aligned */}
180     width = (pic->\hyperlink{structIMG__HEADER_acab9fca679b5827910e3c2a6e302e9f2}{img\_w} + 7) >> 3;
181 
182     \textcolor{comment}{/* allocate memory for the picture */}
183     \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(pic->\hyperlink{structIMG__HEADER_a02e180ad82eed90e0aee536a3cfe62ac}{addr});
184     size = (long)((\textcolor{keywordtype}{long})word\_aligned * (long)pic->\hyperlink{structIMG__HEADER_aeae05d69855fcda61b9d2e9f5e7aec32}{img\_h} * (\textcolor{keywordtype}{long})pic->\hyperlink{structIMG__HEADER_ad4657aaf83e1c3a89230a56177bdc7f4}{planes}); \textcolor{comment}{/*MAR*/}
185 
186     \textcolor{comment}{/* check for header validity & malloc long... */}
187     \textcolor{keywordflow}{if} (pic->\hyperlink{structIMG__HEADER_a9b880fd83909bcba7f3e849b57a9a0c0}{length} > 7 && pic->\hyperlink{structIMG__HEADER_ad4657aaf83e1c3a89230a56177bdc7f4}{planes} < 33 && pic->\hyperlink{structIMG__HEADER_acab9fca679b5827910e3c2a6e302e9f2}{img\_w} > 0 && pic->
      \hyperlink{structIMG__HEADER_aeae05d69855fcda61b9d2e9f5e7aec32}{img\_h} > 0)\{
188         \textcolor{keywordflow}{if}(!(pic->\hyperlink{structIMG__HEADER_a02e180ad82eed90e0aee536a3cfe62ac}{addr}=(\textcolor{keywordtype}{char} *)calloc(1,size)))\{
189             error = \hyperlink{load__img_8h_a2c9fb4fea417072c7e6e47f926eb72f3}{ERR\_ALLOC};
190             \textcolor{keywordflow}{goto} end\_depack;
191         \}
192     \}\textcolor{keywordflow}{else}\{
193         error = \hyperlink{load__img_8h_aa31a6f27f6f6bc7c90d751efee31f4db}{ERR\_HEADER};
194         \textcolor{keywordflow}{goto} end\_depack;
195     \}
196 
197     patt\_len = pic->\hyperlink{structIMG__HEADER_a93e811df0ab124abb41aca253725e620}{pat\_len};
198 
199     \textcolor{comment}{/* jump over the header and possible (XIMG) info */}
200     fseek(fp, (\textcolor{keywordtype}{long}) pic->\hyperlink{structIMG__HEADER_a9b880fd83909bcba7f3e849b57a9a0c0}{length} * 2L, \hyperlink{dlb_8h_a0d112bae8fd35be772185b6ec6bcbe64}{SEEK\_SET});
201 
202     \textcolor{keywordflow}{for}(line=0,to=pic->\hyperlink{structIMG__HEADER_a02e180ad82eed90e0aee536a3cfe62ac}{addr}; line<pic->img\_h; line+=scan\_repeat)\{   \textcolor{comment}{/* depack whole img */}
203         \textcolor{keywordflow}{for}(plane=0,scan\_repeat=1; plane<pic->\hyperlink{structIMG__HEADER_ad4657aaf83e1c3a89230a56177bdc7f4}{planes}; plane++)\{   \textcolor{comment}{/* depack one scan line */}
204             puffer=to=pic->\hyperlink{structIMG__HEADER_a02e180ad82eed90e0aee536a3cfe62ac}{addr}+(long)(line+plane*pic->\hyperlink{structIMG__HEADER_aeae05d69855fcda61b9d2e9f5e7aec32}{img\_h})*(long)word\_aligned;
205             endline=puffer+\hyperlink{xpm2img_8c_a2474a5474cbff19523a51eb1de01cda4}{width};
206             \textcolor{keywordflow}{do}\{ \textcolor{comment}{/* depack one line in one bitplane */}
207                 \textcolor{keywordflow}{switch}((opcode= fgetc(fp)))\{
208                 \textcolor{keywordflow}{case} 0: \textcolor{comment}{/* pattern or scan repeat */}
209                     \textcolor{keywordflow}{if}((patt\_repeat=fgetc(fp)))\{    \textcolor{comment}{/* repeat a pattern */}
210                         fread(to,patt\_len,1,fp);
211                         pattern=to;
212                         to+=patt\_len;
213                         \textcolor{keywordflow}{while}(--patt\_repeat)\{   \textcolor{comment}{/* copy pattern */}
214                             memcpy(to,pattern,patt\_len);
215                             to+=patt\_len;
216                         \}
217                     \}\textcolor{keywordflow}{else}\{  \textcolor{comment}{/* repeat a line */}
218                         \textcolor{keywordflow}{if}(fgetc(fp)==0xFF)
219                             scan\_repeat=fgetc(fp);
220                         \textcolor{keywordflow}{else}\{
221                             error = \hyperlink{load__img_8h_a0d8fc9e953560d6691f337ff3d99294a}{ERR\_DEPACK};
222                             \textcolor{keywordflow}{goto} end\_depack;
223                         \}
224                     \}
225                     \textcolor{keywordflow}{break};
226                 \textcolor{keywordflow}{case} 0x80:  \textcolor{comment}{/* Literal */}
227                     byte\_repeat=fgetc(fp);
228                     fread(to,byte\_repeat,1,fp);
229                     to+=byte\_repeat;
230                     \textcolor{keywordflow}{break};
231                 \textcolor{keywordflow}{default}:    \textcolor{comment}{/* Solid run */}
232                     byte\_repeat = opcode & 0x7F;
233                     sol\_pat = opcode&0x80 ? 0xFF : 0x00;
234                     \textcolor{keywordflow}{while}(byte\_repeat--)    *to++=sol\_pat;
235                 \}
236             \}\textcolor{keywordflow}{while}(to<endline);
237 
238             \textcolor{keywordflow}{if}(to == endline)\{
239                 \textcolor{comment}{/* ensure that lines aren't repeated past the end of the img */}
240                 \textcolor{keywordflow}{if}(line + scan\_repeat > pic->\hyperlink{structIMG__HEADER_aeae05d69855fcda61b9d2e9f5e7aec32}{img\_h})
241                     scan\_repeat = pic->\hyperlink{structIMG__HEADER_aeae05d69855fcda61b9d2e9f5e7aec32}{img\_h} - line;
242                 \textcolor{comment}{/* copy line to image buffer */}
243                 \textcolor{keywordflow}{if}(scan\_repeat>1)\{
244                     \textcolor{comment}{/* calculate address of a current line in a current bitplane */}
245 \textcolor{comment}{/*                  to=pic->addr+(long)(line+1+plane*pic->img\_h)*(long)word\_aligned;*/}
246                     \textcolor{keywordflow}{for}(b=scan\_repeat-1; b; --b)\{
247                         memcpy(to, puffer, width);
248                         to+=word\_aligned;
249                     \}
250                 \}
251             \}\textcolor{keywordflow}{else}\{
252                 error = \hyperlink{load__img_8h_a0d8fc9e953560d6691f337ff3d99294a}{ERR\_DEPACK};
253                 \textcolor{keywordflow}{goto} end\_depack;
254             \}
255         \}
256     \}
257 
258     end\_depack:
259     fclose(fp);
260     \textcolor{keywordflow}{return}(error);
261 \}
\end{DoxyCode}
\hypertarget{load__img_8c_adb63ce256aae1d1efd1f38050e1eb8eb}{\index{load\+\_\+img.\+c@{load\+\_\+img.\+c}!get\+\_\+colors@{get\+\_\+colors}}
\index{get\+\_\+colors@{get\+\_\+colors}!load\+\_\+img.\+c@{load\+\_\+img.\+c}}
\subsubsection[{get\+\_\+colors}]{\setlength{\rightskip}{0pt plus 5cm}void get\+\_\+colors (
\begin{DoxyParamCaption}
\item[{int}]{handle, }
\item[{short $\ast$}]{palette, }
\item[{int}]{col}
\end{DoxyParamCaption}
)}}\label{load__img_8c_adb63ce256aae1d1efd1f38050e1eb8eb}


Definition at line 23 of file load\+\_\+img.\+c.



References planes, vdi2dev2, and vdi2dev4.



Referenced by mar\+\_\+gem\+\_\+init().


\begin{DoxyCode}
23                                                     \{
24     \textcolor{keywordtype}{int} i, idx;
25 
26     \textcolor{comment}{/* get current color palette */}
27     \textcolor{keywordflow}{for}(i=0; i < col; i ++)\{
28         \textcolor{comment}{/* device->vdi->device palette order */}
29         \textcolor{keywordflow}{switch}(\hyperlink{xpm2iff_8c_a0887fed8a7ea2f98b2b12e8866bee719}{planes})\{
30         \textcolor{keywordflow}{case} 1:
31             idx=i;\textcolor{keywordflow}{break};
32         \textcolor{keywordflow}{case} 2:
33             idx=\hyperlink{load__img_8c_aad3b8ed248399e391bd9b27eb0f232cd}{vdi2dev2}[i];\textcolor{keywordflow}{break};
34         \textcolor{keywordflow}{case} 4:
35             idx=\hyperlink{load__img_8c_a3233ff15de80477a78e8591197052c17}{vdi2dev4}[i];\textcolor{keywordflow}{break};
36         \textcolor{keywordflow}{default}:
37             \textcolor{keywordflow}{if}(i<16)
38                 idx=\hyperlink{load__img_8c_a3233ff15de80477a78e8591197052c17}{vdi2dev4}[i];
39             \textcolor{keywordflow}{else}
40                 idx= i==255 ? 1 : i;
41         \}
42         vq\_color(handle, i, 0, (\textcolor{keywordtype}{int} *)palette + idx * 3);
43     \}
44 \}
\end{DoxyCode}
\hypertarget{load__img_8c_a083f7f77b6e0ef8fa2684c501098daf6}{\index{load\+\_\+img.\+c@{load\+\_\+img.\+c}!half\+\_\+img@{half\+\_\+img}}
\index{half\+\_\+img@{half\+\_\+img}!load\+\_\+img.\+c@{load\+\_\+img.\+c}}
\subsubsection[{half\+\_\+img}]{\setlength{\rightskip}{0pt plus 5cm}int half\+\_\+img (
\begin{DoxyParamCaption}
\item[{M\+F\+D\+B $\ast$}]{s, }
\item[{M\+F\+D\+B $\ast$}]{d}
\end{DoxyParamCaption}
)}}\label{load__img_8c_a083f7f77b6e0ef8fa2684c501098daf6}


Definition at line 263 of file load\+\_\+img.\+c.



References F\+A\+L\+S\+E, free(), N\+U\+L\+L, and T\+R\+U\+E.


\begin{DoxyCode}
263                               \{
264     \textcolor{keywordtype}{int} pxy[8], i, j;
265     MFDB tmp;
266 
267     mfdb(&tmp,\hyperlink{windefs_8h_a070d2ce7b6bb7e5c05602aa8c308d0c4}{NULL},s->fd\_w/2,s->fd\_h,s->fd\_stand,s->fd\_nplanes);
268     tmp.fd\_w=s->fd\_w/2;
269     tmp.fd\_addr=calloc(1,mfdb\_size(&tmp));
270     \textcolor{keywordflow}{if}(!tmp.fd\_addr)
271         \textcolor{keywordflow}{return}(\hyperlink{load__img_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
272 
273     pxy[1]=pxy[5]=0;
274     pxy[3]=pxy[7]=s->fd\_h-1;
275     \textcolor{keywordflow}{for}(i=0;i<s->fd\_w/2;i++)\{
276         pxy[0]=pxy[2]=2*i;
277         pxy[4]=pxy[6]=i;
278         vro\_cpyfm(x\_handle,S\_ONLY,pxy,s,&tmp);
279     \}
280     pxy[0]=pxy[4]=0;
281     pxy[2]=pxy[6]=s->fd\_w/2-1;
282     \textcolor{keywordflow}{for}(j=0;j<s->fd\_h/2;j++)\{
283         pxy[1]=pxy[3]=2*j;
284         pxy[5]=pxy[7]=j;
285         vro\_cpyfm(x\_handle,S\_ONLY,pxy,&tmp,d);
286     \}
287     \hyperlink{winproto_8h_a4bbec68d324de17b99fecede64b383ba}{free}(tmp.fd\_addr);
288     \textcolor{keywordflow}{return}(\hyperlink{load__img_8c_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
289 \}
\end{DoxyCode}
\hypertarget{load__img_8c_aa558dbb1744b4a5a95a6b767a4d005ea}{\index{load\+\_\+img.\+c@{load\+\_\+img.\+c}!img\+\_\+set\+\_\+colors@{img\+\_\+set\+\_\+colors}}
\index{img\+\_\+set\+\_\+colors@{img\+\_\+set\+\_\+colors}!load\+\_\+img.\+c@{load\+\_\+img.\+c}}
\subsubsection[{img\+\_\+set\+\_\+colors}]{\setlength{\rightskip}{0pt plus 5cm}void img\+\_\+set\+\_\+colors (
\begin{DoxyParamCaption}
\item[{int}]{handle, }
\item[{short $\ast$}]{palette, }
\item[{int}]{col}
\end{DoxyParamCaption}
)}}\label{load__img_8c_aa558dbb1744b4a5a95a6b767a4d005ea}


Definition at line 46 of file load\+\_\+img.\+c.



References min, planes, vdi2dev2, and vdi2dev4.



Referenced by mar\+\_\+exit\+\_\+nhwindows(), and mar\+\_\+gem\+\_\+init().


\begin{DoxyCode}
46                                                         \{
47     \textcolor{keywordtype}{int} i, idx, end;
48 
49     \textcolor{comment}{/* set color palette */}
50     end=\hyperlink{hack_8h_abb702d8b501669a23aa0ab3b281b9384}{min}(1<<col,1<<\hyperlink{xpm2iff_8c_a0887fed8a7ea2f98b2b12e8866bee719}{planes});
51     \textcolor{keywordflow}{for}(i=0; i<end; i++)\{
52     \textcolor{keywordflow}{switch}(\hyperlink{xpm2iff_8c_a0887fed8a7ea2f98b2b12e8866bee719}{planes})\{   \textcolor{comment}{/* MAR -- war col 10.01.2001 */}
53         \textcolor{keywordflow}{case} 1:
54             idx=i;\textcolor{keywordflow}{break};
55         \textcolor{keywordflow}{case} 2:
56             idx=\hyperlink{load__img_8c_aad3b8ed248399e391bd9b27eb0f232cd}{vdi2dev2}[i];\textcolor{keywordflow}{break};
57         \textcolor{keywordflow}{case} 4:
58             idx=\hyperlink{load__img_8c_a3233ff15de80477a78e8591197052c17}{vdi2dev4}[i];\textcolor{keywordflow}{break};
59         \textcolor{keywordflow}{default}:
60             \textcolor{keywordflow}{if}(i<16)
61                 idx=\hyperlink{load__img_8c_a3233ff15de80477a78e8591197052c17}{vdi2dev4}[i];
62             \textcolor{keywordflow}{else}
63                 idx= i==255 ? 1 : i;
64     \}
65     vs\_color(handle, i, (\textcolor{keywordtype}{int} *)palette + idx * 3);
66   \}
67 \}
\end{DoxyCode}
\hypertarget{load__img_8c_ada98b09ccce105673fc2b4d0525a7f6a}{\index{load\+\_\+img.\+c@{load\+\_\+img.\+c}!transform\+\_\+img@{transform\+\_\+img}}
\index{transform\+\_\+img@{transform\+\_\+img}!load\+\_\+img.\+c@{load\+\_\+img.\+c}}
\subsubsection[{transform\+\_\+img}]{\setlength{\rightskip}{0pt plus 5cm}int transform\+\_\+img (
\begin{DoxyParamCaption}
\item[{M\+F\+D\+B $\ast$}]{image}
\end{DoxyParamCaption}
)}}\label{load__img_8c_ada98b09ccce105673fc2b4d0525a7f6a}


Definition at line 127 of file load\+\_\+img.\+c.



References convert(), F\+A\+L\+S\+E, and T\+R\+U\+E.



Referenced by mar\+\_\+ask\+\_\+name(), mar\+\_\+display\+\_\+nhwindow(), and mar\+\_\+gem\+\_\+init().


\begin{DoxyCode}
127                               \{     \textcolor{comment}{/* return FALSE if transform\_img fails */}
128     \textcolor{keywordtype}{int} success;
129     \textcolor{keywordtype}{long} \hyperlink{structsize}{size};
130 
131     \textcolor{keywordflow}{if}(!\hyperlink{gifread_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image}->fd\_addr)
132         \textcolor{keywordflow}{return}(\hyperlink{load__img_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
133 
134     size=(long)((\textcolor{keywordtype}{long})\hyperlink{gifread_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image}->fd\_wdwidth * (long)\hyperlink{gifread_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image}->fd\_h);
135     success=\hyperlink{load__img_8c_ab825ceec894ab10c30b85224dda4b2a5}{convert}(\hyperlink{gifread_8c_a2d8da73d47fd8a1304cbacafde81f61d}{image}, size);       \textcolor{comment}{/* Use vr\_trfm(), which needs quite a lot memory. */}
136     \textcolor{keywordflow}{if}(success)     \textcolor{keywordflow}{return}(\hyperlink{load__img_8c_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
137 \textcolor{comment}{/*  else                show\_error(ERR\_ALLOC);  */}
138     \textcolor{keywordflow}{return}(\hyperlink{load__img_8c_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
139 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{load__img_8c_aad3b8ed248399e391bd9b27eb0f232cd}{\index{load\+\_\+img.\+c@{load\+\_\+img.\+c}!vdi2dev2@{vdi2dev2}}
\index{vdi2dev2@{vdi2dev2}!load\+\_\+img.\+c@{load\+\_\+img.\+c}}
\subsubsection[{vdi2dev2}]{\setlength{\rightskip}{0pt plus 5cm}int vdi2dev2\mbox{[}$\,$\mbox{]} =\{0,3,1,2\}}}\label{load__img_8c_aad3b8ed248399e391bd9b27eb0f232cd}


Definition at line 21 of file load\+\_\+img.\+c.



Referenced by get\+\_\+colors(), and img\+\_\+set\+\_\+colors().

\hypertarget{load__img_8c_a3233ff15de80477a78e8591197052c17}{\index{load\+\_\+img.\+c@{load\+\_\+img.\+c}!vdi2dev4@{vdi2dev4}}
\index{vdi2dev4@{vdi2dev4}!load\+\_\+img.\+c@{load\+\_\+img.\+c}}
\subsubsection[{vdi2dev4}]{\setlength{\rightskip}{0pt plus 5cm}int vdi2dev4\mbox{[}$\,$\mbox{]} =\{0,15,1,2,4,6,3,5,7,8,9,10,12,14,11,13\}}}\label{load__img_8c_a3233ff15de80477a78e8591197052c17}


Definition at line 19 of file load\+\_\+img.\+c.



Referenced by get\+\_\+colors(), and img\+\_\+set\+\_\+colors().

