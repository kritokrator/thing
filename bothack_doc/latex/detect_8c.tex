\hypertarget{detect_8c}{\section{nethack/src/detect.c File Reference}
\label{detect_8c}\index{nethack/src/detect.\+c@{nethack/src/detect.\+c}}
}
{\ttfamily \#include \char`\"{}hack.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}artifact.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{detect_8c_a4fd77383888fc0c9c06a491e8b925f75}{F\+D\+E\+C\+L} (\hyperlink{detect_8c_ae607bee8dca5a7435a6e5a0a91f25a13}{do\+\_\+dknown\+\_\+of},(struct \hyperlink{structobj}{obj} $\ast$))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} \hyperlink{detect_8c_a9bb6048f96ab1a5e0643dc2e42933f61}{F\+D\+E\+C\+L} (\hyperlink{detect_8c_aec7dfd1d8bdd347726fefee276c4c325}{check\+\_\+map\+\_\+spot},(int, int, \hyperlink{wingem1_8c_ada878a8b4864a1658ee0f0acd5a89412}{C\+H\+A\+R\+\_\+\+P}, unsigned))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} \hyperlink{detect_8c_af55f02920a1ab85ee5320f1661ac5487}{F\+D\+E\+C\+L} (\hyperlink{detect_8c_af6afb66a1f38478d634e4b9aed6b8555}{clear\+\_\+stale\+\_\+map},(\hyperlink{wingem1_8c_ada878a8b4864a1658ee0f0acd5a89412}{C\+H\+A\+R\+\_\+\+P}, unsigned))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{detect_8c_ac59ef1e48c8e6b51e14a78b20f5efd8c}{F\+D\+E\+C\+L} (\hyperlink{detect_8c_a721910df42d2c5d119bffe5fbcf2afec}{sense\+\_\+trap},(struct \hyperlink{structtrap}{trap} $\ast$, \hyperlink{wingem1_8c_abea04566e20888dd08f477de5f4b9289}{X\+C\+H\+A\+R\+\_\+\+P}, \hyperlink{wingem1_8c_abea04566e20888dd08f477de5f4b9289}{X\+C\+H\+A\+R\+\_\+\+P}, int))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{detect_8c_a6ca92266c18237f862332cbceb148520}{F\+D\+E\+C\+L} (\hyperlink{detect_8c_a664d8840dadbb5a3896df395833fc708}{show\+\_\+map\+\_\+spot},(int, int))
\item 
\hyperlink{hack_8h_ac0f6cfba4138e5e6a773d15a80ea82ff}{S\+T\+A\+T\+I\+C\+\_\+\+P\+T\+R} void \hyperlink{detect_8c_a08b4e0d2e6891475cd59cdcea6aff8f5}{F\+D\+E\+C\+L} (\hyperlink{detect_8c_ae9b4697d87c5c4c1ee75abf087ea5f45}{findone},(int, int, \hyperlink{tradstdc_8h_ad4a7dab7269b4b00e3c7c7d2e66f31cd}{genericptr\+\_\+t}))
\item 
\hyperlink{hack_8h_ac0f6cfba4138e5e6a773d15a80ea82ff}{S\+T\+A\+T\+I\+C\+\_\+\+P\+T\+R} void \hyperlink{detect_8c_a4a2c801f7151c883f612a060f1335de1}{F\+D\+E\+C\+L} (\hyperlink{detect_8c_a14a42eb445eeb62597da11849b4eb162}{openone},(int, int, \hyperlink{tradstdc_8h_ad4a7dab7269b4b00e3c7c7d2e66f31cd}{genericptr\+\_\+t}))
\item 
struct \hyperlink{structobj}{obj} $\ast$ \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\+\_\+in} (struct \hyperlink{structobj}{obj} $\ast$\hyperlink{structobj}{obj}, char oclass)
\item 
struct \hyperlink{structobj}{obj} $\ast$ \hyperlink{detect_8c_a3482c89460e32650375743a33dbfb8b2}{o\+\_\+material} (struct \hyperlink{structobj}{obj} $\ast$\hyperlink{structobj}{obj}, unsigned material)
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{detect_8c_ae607bee8dca5a7435a6e5a0a91f25a13}{do\+\_\+dknown\+\_\+of} (struct \hyperlink{structobj}{obj} $\ast$\hyperlink{structobj}{obj})
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} \hyperlink{detect_8c_aec7dfd1d8bdd347726fefee276c4c325}{check\+\_\+map\+\_\+spot} (int x, int y, char oclass, unsigned material)
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} \hyperlink{detect_8c_af6afb66a1f38478d634e4b9aed6b8555}{clear\+\_\+stale\+\_\+map} (char oclass, unsigned material)
\item 
int \hyperlink{detect_8c_ae4491fc95530927e86d183cbb4d2bda6}{gold\+\_\+detect} (struct \hyperlink{structobj}{obj} $\ast$sobj)
\item 
int \hyperlink{detect_8c_a582da6acd8413b3828bb2593705e7712}{food\+\_\+detect} (struct \hyperlink{structobj}{obj} $\ast$sobj)
\item 
int \hyperlink{detect_8c_a92ef83bacedadaadc85d179db69b6e5f}{object\+\_\+detect} (struct \hyperlink{structobj}{obj} $\ast$detector, int class)
\item 
int \hyperlink{detect_8c_a24bcd3e85852ee1ee1088447f7273755}{monster\+\_\+detect} (struct \hyperlink{structobj}{obj} $\ast$\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp}, int mclass)
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{detect_8c_a721910df42d2c5d119bffe5fbcf2afec}{sense\+\_\+trap} (struct \hyperlink{structtrap}{trap} $\ast$\hyperlink{structtrap}{trap}, \hyperlink{global_8h_a2043b7d01ce89f4ee2fa6c345a752d32}{xchar} x, \hyperlink{global_8h_a2043b7d01ce89f4ee2fa6c345a752d32}{xchar} y, int src\+\_\+cursed)
\item 
int \hyperlink{detect_8c_a26ca894bc3ed71cb998be60d74d91334}{trap\+\_\+detect} (struct \hyperlink{structobj}{obj} $\ast$sobj)
\item 
\hyperlink{tradstdc_8h_a2c212835823e3c54a8ab6d95c652660e}{const} char $\ast$ \hyperlink{detect_8c_a76c278fd0bdb5a50382c6390dfa1409a}{level\+\_\+distance} (\hyperlink{structd__level}{d\+\_\+level} $\ast$\hyperlink{detect_8c_a8201fc0bfa35306851be2a25ab2d6263}{where})
\item 
void \hyperlink{detect_8c_a06e5c1bcb4aee50c208dd10d80e8d5bb}{use\+\_\+crystal\+\_\+ball} (struct \hyperlink{structobj}{obj} $\ast$\hyperlink{structobj}{obj})
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{detect_8c_a664d8840dadbb5a3896df395833fc708}{show\+\_\+map\+\_\+spot} (int x, int y)
\item 
void \hyperlink{detect_8c_a26334ff4693b156bc3e2ef122f06d163}{do\+\_\+mapping} ()
\item 
void \hyperlink{detect_8c_a2057bf4f5bd539fa0911162d3b65b781}{do\+\_\+vicinity\+\_\+map} ()
\item 
void \hyperlink{detect_8c_ae1de6d3f46bcb6ad8bd07ca5797a291f}{cvt\+\_\+sdoor\+\_\+to\+\_\+door} (struct \hyperlink{structrm}{rm} $\ast$lev)
\item 
\hyperlink{hack_8h_ac0f6cfba4138e5e6a773d15a80ea82ff}{S\+T\+A\+T\+I\+C\+\_\+\+P\+T\+R} void \hyperlink{detect_8c_ae9b4697d87c5c4c1ee75abf087ea5f45}{findone} (int zx, int zy, \hyperlink{tradstdc_8h_ad4a7dab7269b4b00e3c7c7d2e66f31cd}{genericptr\+\_\+t} num)
\item 
\hyperlink{hack_8h_ac0f6cfba4138e5e6a773d15a80ea82ff}{S\+T\+A\+T\+I\+C\+\_\+\+P\+T\+R} void \hyperlink{detect_8c_a14a42eb445eeb62597da11849b4eb162}{openone} (int zx, int zy, \hyperlink{tradstdc_8h_ad4a7dab7269b4b00e3c7c7d2e66f31cd}{genericptr\+\_\+t} num)
\item 
int \hyperlink{detect_8c_aecba6834af3b2a88b2b16ab428d5e23d}{findit} ()
\item 
int \hyperlink{detect_8c_a275d1ff7f47d63ac813aef688ce1a713}{openit} ()
\item 
void \hyperlink{detect_8c_a20d8772991f460323e17f8a984907ded}{find\+\_\+trap} (struct \hyperlink{structtrap}{trap} $\ast$\hyperlink{structtrap}{trap})
\item 
int \hyperlink{detect_8c_af61e42c8be2e07d13b384eed4939a9f7}{dosearch0} (int aflag)
\item 
int \hyperlink{detect_8c_a2827c79ecc0ddfc780702c84a7c55acb}{dosearch} ()
\item 
void \hyperlink{detect_8c_a6208a524bbc5d637bcaa36dcc63a1ec8}{sokoban\+\_\+detect} ()
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} \hyperlink{detect_8c_a2373e3a270d2b530119452501548080a}{known}
\item 
\begin{tabbing}
xx\=xx\=xx\=xx\=xx\=xx\=xx\=xx\=xx\=\kill
struct \{\\
\>\hyperlink{tradstdc_8h_a2c212835823e3c54a8ab6d95c652660e}{const} char $\ast$ \hyperlink{detect_8c_a951a98f1e2d69ca61adcd53c0f8faca3}{what}\\
\>\hyperlink{structd__level}{d\_level} $\ast$ \hyperlink{detect_8c_a8201fc0bfa35306851be2a25ab2d6263}{where}\\
\} \hyperlink{detect_8c_a701c9b5465f0123c8020466497624f6c}{level\_detects} \mbox{[}$\,$\mbox{]}\\

\end{tabbing}\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{detect_8c_aec7dfd1d8bdd347726fefee276c4c325}{\index{detect.\+c@{detect.\+c}!check\+\_\+map\+\_\+spot@{check\+\_\+map\+\_\+spot}}
\index{check\+\_\+map\+\_\+spot@{check\+\_\+map\+\_\+spot}!detect.\+c@{detect.\+c}}
\subsubsection[{check\+\_\+map\+\_\+spot}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} {\bf boolean} check\+\_\+map\+\_\+spot (
\begin{DoxyParamCaption}
\item[{int}]{x, }
\item[{int}]{y, }
\item[{char}]{oclass, }
\item[{unsigned}]{material}
\end{DoxyParamCaption}
)}}\label{detect_8c_aec7dfd1d8bdd347726fefee276c4c325}


Definition at line 78 of file detect.\+c.



References A\+L\+L\+\_\+\+C\+L\+A\+S\+S\+E\+S, C\+O\+I\+N\+\_\+\+C\+L\+A\+S\+S, F\+A\+L\+S\+E, glyph\+\_\+at(), glyph\+\_\+is\+\_\+object, glyph\+\_\+to\+\_\+obj, G\+O\+L\+D, level, m\+\_\+at, monst\+::mgold, monst\+::minvent, obj\+::nobj, o\+\_\+in(), o\+\_\+material(), objects, dlevel\+\_\+t\+::objects, otmp, and T\+R\+U\+E.



Referenced by clear\+\_\+stale\+\_\+map().


\begin{DoxyCode}
82 \{
83     \textcolor{keyword}{register} \textcolor{keywordtype}{int} glyph;
84     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
85     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp;
86 
87     glyph = \hyperlink{display_8c_ad3c1a65cc5e35e90067cb04eaf397d8a}{glyph\_at}(x,y);
88     \textcolor{keywordflow}{if} (\hyperlink{display_8h_a5a3c3067dbac4b44ad002fbe980a90dd}{glyph\_is\_object}(glyph)) \{
89         \textcolor{comment}{/* there's some object shown here */}
90         \textcolor{keywordflow}{if} (oclass == \hyperlink{objclass_8h_a6ec43df3638569a3e63d44058318540a}{ALL\_CLASSES}) \{
91         \textcolor{keywordflow}{return}((\textcolor{keywordtype}{boolean})( !(\hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_ac128f805d01d7746b499596dd3b92a53}{objects}[x][y] ||     \textcolor{comment}{/* stale if nothing here */}
92                 ((mtmp = \hyperlink{rm_8h_a4d8dddf3df3fad65478980d2c8cbf53c}{m\_at}(x,y)) != 0 &&
93                 (
94 #ifndef GOLDOBJ
95                  mtmp->\hyperlink{structmonst_a06dbdd0ca7ee096216aa10f86beed533}{mgold} ||
96 #endif
97                          mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent})))));
98         \} \textcolor{keywordflow}{else} \{
99         \textcolor{keywordflow}{if} (material && \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[\hyperlink{display_8h_afea03e8d4cb058f7ac029417c0f4d73f}{glyph\_to\_obj}(glyph)].oc\_material == material) \{
100             \textcolor{comment}{/* the object shown here is of interest because material matches */}
101             \textcolor{keywordflow}{for} (otmp = \hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_ac128f805d01d7746b499596dd3b92a53}{objects}[x][y]; otmp; otmp = otmp->nexthere)
102                 \textcolor{keywordflow}{if} (\hyperlink{detect_8c_a3482c89460e32650375743a33dbfb8b2}{o\_material}(otmp, \hyperlink{objclass_8h_af468028083c9e52aa2c94ef3b9940450}{GOLD})) \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
103             \textcolor{comment}{/* didn't find it; perhaps a monster is carrying it */}
104             \textcolor{keywordflow}{if} ((mtmp = \hyperlink{rm_8h_a4d8dddf3df3fad65478980d2c8cbf53c}{m\_at}(x,y)) != 0) \{
105                 \textcolor{keywordflow}{for} (otmp = mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; otmp; otmp = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
106                     \textcolor{keywordflow}{if} (\hyperlink{detect_8c_a3482c89460e32650375743a33dbfb8b2}{o\_material}(otmp, \hyperlink{objclass_8h_af468028083c9e52aa2c94ef3b9940450}{GOLD})) \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
107                 \}
108             \textcolor{comment}{/* detection indicates removal of this object from the map */}
109             \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
110         \}
111             \textcolor{keywordflow}{if} (oclass && \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[\hyperlink{display_8h_afea03e8d4cb058f7ac029417c0f4d73f}{glyph\_to\_obj}(glyph)].oc\_class == oclass) \{
112             \textcolor{comment}{/* the object shown here is of interest because its class matches */}
113             \textcolor{keywordflow}{for} (otmp = \hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_ac128f805d01d7746b499596dd3b92a53}{objects}[x][y]; otmp; otmp = otmp->nexthere)
114                 \textcolor{keywordflow}{if} (\hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(otmp, oclass)) \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
115             \textcolor{comment}{/* didn't find it; perhaps a monster is carrying it */}
116 \textcolor{preprocessor}{#ifndef GOLDOBJ}
117             \textcolor{keywordflow}{if} ((mtmp = \hyperlink{rm_8h_a4d8dddf3df3fad65478980d2c8cbf53c}{m\_at}(x,y)) != 0) \{
118                 \textcolor{keywordflow}{if} (oclass == \hyperlink{objclass_8h_a2999621925083659147349e261e4cb3d}{COIN\_CLASS} && mtmp->\hyperlink{structmonst_a06dbdd0ca7ee096216aa10f86beed533}{mgold})
119                     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
120                 \textcolor{keywordflow}{else} \textcolor{keywordflow}{for} (otmp = mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; otmp; otmp = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
121                     \textcolor{keywordflow}{if} (\hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(otmp, oclass)) \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
122                 \}
123 \textcolor{preprocessor}{#else}
124             \textcolor{keywordflow}{if} ((mtmp = \hyperlink{rm_8h_a4d8dddf3df3fad65478980d2c8cbf53c}{m\_at}(x,y)) != 0) \{
125                 \textcolor{keywordflow}{for} (otmp = mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; otmp; otmp = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
126                     \textcolor{keywordflow}{if} (\hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(otmp, oclass)) \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
127                 \}
128 \textcolor{preprocessor}{#endif}
129             \textcolor{comment}{/* detection indicates removal of this object from the map */}
130             \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
131             \}
132         \}
133     \}
134     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
135 \}
\end{DoxyCode}
\hypertarget{detect_8c_af6afb66a1f38478d634e4b9aed6b8555}{\index{detect.\+c@{detect.\+c}!clear\+\_\+stale\+\_\+map@{clear\+\_\+stale\+\_\+map}}
\index{clear\+\_\+stale\+\_\+map@{clear\+\_\+stale\+\_\+map}!detect.\+c@{detect.\+c}}
\subsubsection[{clear\+\_\+stale\+\_\+map}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} {\bf boolean} clear\+\_\+stale\+\_\+map (
\begin{DoxyParamCaption}
\item[{char}]{oclass, }
\item[{unsigned}]{material}
\end{DoxyParamCaption}
)}}\label{detect_8c_af6afb66a1f38478d634e4b9aed6b8555}


Definition at line 144 of file detect.\+c.



References check\+\_\+map\+\_\+spot(), C\+O\+L\+N\+O, F\+A\+L\+S\+E, R\+O\+W\+N\+O, T\+R\+U\+E, and unmap\+\_\+object().



Referenced by food\+\_\+detect(), gold\+\_\+detect(), and object\+\_\+detect().


\begin{DoxyCode}
147 \{
148     \textcolor{keyword}{register} \textcolor{keywordtype}{int} zx, zy;
149     \textcolor{keyword}{register} \textcolor{keywordtype}{boolean} change\_made = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
150 
151     \textcolor{keywordflow}{for} (zx = 1; zx < \hyperlink{global_8h_a308dbfcc29f5a427c0315f3cbf03c3ed}{COLNO}; zx++)
152         \textcolor{keywordflow}{for} (zy = 0; zy < \hyperlink{global_8h_a9cce134868d97b23c35bcf1ff4a343d8}{ROWNO}; zy++)
153         \textcolor{keywordflow}{if} (\hyperlink{detect_8c_aec7dfd1d8bdd347726fefee276c4c325}{check\_map\_spot}(zx, zy, oclass,material)) \{
154             \hyperlink{display_8c_ae4c63c21336f923f86fa95ca4c8055fb}{unmap\_object}(zx, zy);
155             change\_made = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
156         \}
157 
158     \textcolor{keywordflow}{return} change\_made;
159 \}
\end{DoxyCode}
\hypertarget{detect_8c_ae1de6d3f46bcb6ad8bd07ca5797a291f}{\index{detect.\+c@{detect.\+c}!cvt\+\_\+sdoor\+\_\+to\+\_\+door@{cvt\+\_\+sdoor\+\_\+to\+\_\+door}}
\index{cvt\+\_\+sdoor\+\_\+to\+\_\+door@{cvt\+\_\+sdoor\+\_\+to\+\_\+door}!detect.\+c@{detect.\+c}}
\subsubsection[{cvt\+\_\+sdoor\+\_\+to\+\_\+door}]{\setlength{\rightskip}{0pt plus 5cm}void cvt\+\_\+sdoor\+\_\+to\+\_\+door (
\begin{DoxyParamCaption}
\item[{struct {\bf rm} $\ast$}]{lev}
\end{DoxyParamCaption}
)}}\label{detect_8c_ae1de6d3f46bcb6ad8bd07ca5797a291f}


Definition at line 982 of file detect.\+c.



References D\+\_\+\+C\+L\+O\+S\+E\+D, D\+\_\+\+L\+O\+C\+K\+E\+D, D\+\_\+\+N\+O\+D\+O\+O\+R, D\+O\+O\+R, Is\+\_\+rogue\+\_\+level, u, you\+::uz, and W\+M\+\_\+\+M\+A\+S\+K.



Referenced by dokick(), dosearch0(), findone(), and openone().


\begin{DoxyCode}
984 \{
985     \textcolor{keywordtype}{int} newmask = lev->doormask & ~\hyperlink{rm_8h_aa8daf0cc89d46c79b0af7a430c725d25}{WM\_MASK};
986 
987 \textcolor{preprocessor}{#ifdef REINCARNATION}
988     \textcolor{keywordflow}{if} (\hyperlink{dungeon_8h_a2732117523c8540638daf4315dda16b9}{Is\_rogue\_level}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}))
989         \textcolor{comment}{/* rogue didn't have doors, only doorways */}
990         newmask = \hyperlink{rm_8h_a69d5ca6801252b3e635889365d7b9d28}{D\_NODOOR};
991     \textcolor{keywordflow}{else}
992 \textcolor{preprocessor}{#endif}
993         \textcolor{comment}{/* newly exposed door is closed */}
994         \textcolor{keywordflow}{if} (!(newmask & \hyperlink{rm_8h_a0996530515217dfd9f5e12878cb1dc8b}{D\_LOCKED})) newmask |= \hyperlink{rm_8h_a65f9ce7db71ac3d4c13edfe69732ec9a}{D\_CLOSED};
995 
996     lev->\hyperlink{structrm_aa144ade377ba175f037c4e637329d4dc}{typ} = \hyperlink{rm_8h_aa19093eb0aa5c5af9c27464ae8f0d2de}{DOOR};
997     lev->doormask = newmask;
998 \}
\end{DoxyCode}
\hypertarget{detect_8c_ae607bee8dca5a7435a6e5a0a91f25a13}{\index{detect.\+c@{detect.\+c}!do\+\_\+dknown\+\_\+of@{do\+\_\+dknown\+\_\+of}}
\index{do\+\_\+dknown\+\_\+of@{do\+\_\+dknown\+\_\+of}!detect.\+c@{detect.\+c}}
\subsubsection[{do\+\_\+dknown\+\_\+of}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void do\+\_\+dknown\+\_\+of (
\begin{DoxyParamCaption}
\item[{struct {\bf obj} $\ast$}]{obj}
\end{DoxyParamCaption}
)}}\label{detect_8c_ae607bee8dca5a7435a6e5a0a91f25a13}


Definition at line 64 of file detect.\+c.



References obj\+::cobj, Has\+\_\+contents, obj\+::nobj, and otmp.



Referenced by object\+\_\+detect().


\begin{DoxyCode}
66 \{
67     \textcolor{keyword}{struct }obj *\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
68 
69     obj->dknown = 1;
70     \textcolor{keywordflow}{if} (\hyperlink{obj_8h_ae2e47c7280efe98de2333e8078f8ce71}{Has\_contents}(obj)) \{
71     \textcolor{keywordflow}{for}(otmp = obj->\hyperlink{structobj_aa7bed832c417657c964b6f5893737586}{cobj}; otmp; otmp = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
72         \hyperlink{detect_8c_ae607bee8dca5a7435a6e5a0a91f25a13}{do\_dknown\_of}(otmp);
73     \}
74 \}
\end{DoxyCode}
\hypertarget{detect_8c_a26334ff4693b156bc3e2ef122f06d163}{\index{detect.\+c@{detect.\+c}!do\+\_\+mapping@{do\+\_\+mapping}}
\index{do\+\_\+mapping@{do\+\_\+mapping}!detect.\+c@{detect.\+c}}
\subsubsection[{do\+\_\+mapping}]{\setlength{\rightskip}{0pt plus 5cm}void do\+\_\+mapping (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{detect_8c_a26334ff4693b156bc3e2ef122f06d163}


Definition at line 942 of file detect.\+c.



References A\+\_\+\+W\+I\+S, C\+O\+L\+N\+O, display\+\_\+nhwindow, docrt(), dlevel\+\_\+t\+::flags, flush\+\_\+screen(), level, R\+O\+W\+N\+O, show\+\_\+map\+\_\+spot(), T\+R\+U\+E, u, Underwater, and W\+I\+N\+\_\+\+M\+A\+P.



Referenced by dosit().


\begin{DoxyCode}
943 \{
944     \textcolor{keyword}{register} \textcolor{keywordtype}{int} zx, zy;
945     \textcolor{keywordtype}{int} uw = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater;
946 
947     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater = 0;
948     \textcolor{keywordflow}{for} (zx = 1; zx < \hyperlink{global_8h_a308dbfcc29f5a427c0315f3cbf03c3ed}{COLNO}; zx++)
949     \textcolor{keywordflow}{for} (zy = 0; zy < \hyperlink{global_8h_a9cce134868d97b23c35bcf1ff4a343d8}{ROWNO}; zy++)
950         \hyperlink{detect_8c_a664d8840dadbb5a3896df395833fc708}{show\_map\_spot}(zx, zy);
951     exercise(\hyperlink{attrib_8h_a4206d6431732a698ede8a237d5c17142}{A\_WIS}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
952     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater = uw;
953     \textcolor{keywordflow}{if} (!\hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_ad52c01d015e2456cdae3300848115916}{flags}.hero\_memory || \hyperlink{youprop_8h_a2eb59bdcba2c368fefd253bfcdaa3673}{Underwater}) \{
954     \hyperlink{display_8c_a47cdbc8092c02ed856defd22a0952aeb}{flush\_screen}(1);            \textcolor{comment}{/* flush temp screen */}
955     \hyperlink{winprocs_8h_ac8e74d03fbb65b9f5651e63d79bebc60}{display\_nhwindow}(\hyperlink{decl_8h_afa1f7dd312c4c1b72afe3d2c8c2af691}{WIN\_MAP}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}); \textcolor{comment}{/* wait */}
956     \hyperlink{display_8c_aad46d5a3dee537d403163916114fd463}{docrt}();
957     \}
958 \}
\end{DoxyCode}
\hypertarget{detect_8c_a2057bf4f5bd539fa0911162d3b65b781}{\index{detect.\+c@{detect.\+c}!do\+\_\+vicinity\+\_\+map@{do\+\_\+vicinity\+\_\+map}}
\index{do\+\_\+vicinity\+\_\+map@{do\+\_\+vicinity\+\_\+map}!detect.\+c@{detect.\+c}}
\subsubsection[{do\+\_\+vicinity\+\_\+map}]{\setlength{\rightskip}{0pt plus 5cm}void do\+\_\+vicinity\+\_\+map (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{detect_8c_a2057bf4f5bd539fa0911162d3b65b781}


Definition at line 961 of file detect.\+c.



References C\+O\+L\+N\+O, display\+\_\+nhwindow, docrt(), dlevel\+\_\+t\+::flags, flush\+\_\+screen(), level, R\+O\+W\+N\+O, show\+\_\+map\+\_\+spot(), T\+R\+U\+E, u, Underwater, you\+::ux, you\+::uy, and W\+I\+N\+\_\+\+M\+A\+P.



Referenced by spelleffects().


\begin{DoxyCode}
962 \{
963     \textcolor{keyword}{register} \textcolor{keywordtype}{int} zx, zy;
964     \textcolor{keywordtype}{int} lo\_y = (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}-5 < 0 ? 0 : \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}-5),
965     hi\_y = (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}+6 > \hyperlink{global_8h_a9cce134868d97b23c35bcf1ff4a343d8}{ROWNO} ? \hyperlink{global_8h_a9cce134868d97b23c35bcf1ff4a343d8}{ROWNO} : \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}+6),
966     lo\_x = (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}-9 < 1 ? 1 : \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}-9), \textcolor{comment}{/* avoid column 0 */}
967     hi\_x = (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}+10 > \hyperlink{global_8h_a308dbfcc29f5a427c0315f3cbf03c3ed}{COLNO} ? \hyperlink{global_8h_a308dbfcc29f5a427c0315f3cbf03c3ed}{COLNO} : \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}+10);
968 
969     \textcolor{keywordflow}{for} (zx = lo\_x; zx < hi\_x; zx++)
970     \textcolor{keywordflow}{for} (zy = lo\_y; zy < hi\_y; zy++)
971         \hyperlink{detect_8c_a664d8840dadbb5a3896df395833fc708}{show\_map\_spot}(zx, zy);
972 
973     \textcolor{keywordflow}{if} (!\hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_ad52c01d015e2456cdae3300848115916}{flags}.hero\_memory || \hyperlink{youprop_8h_a2eb59bdcba2c368fefd253bfcdaa3673}{Underwater}) \{
974     \hyperlink{display_8c_a47cdbc8092c02ed856defd22a0952aeb}{flush\_screen}(1);            \textcolor{comment}{/* flush temp screen */}
975     \hyperlink{winprocs_8h_ac8e74d03fbb65b9f5651e63d79bebc60}{display\_nhwindow}(\hyperlink{decl_8h_afa1f7dd312c4c1b72afe3d2c8c2af691}{WIN\_MAP}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}); \textcolor{comment}{/* wait */}
976     \hyperlink{display_8c_aad46d5a3dee537d403163916114fd463}{docrt}();
977     \}
978 \}
\end{DoxyCode}
\hypertarget{detect_8c_a2827c79ecc0ddfc780702c84a7c55acb}{\index{detect.\+c@{detect.\+c}!dosearch@{dosearch}}
\index{dosearch@{dosearch}!detect.\+c@{detect.\+c}}
\subsubsection[{dosearch}]{\setlength{\rightskip}{0pt plus 5cm}int dosearch (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{detect_8c_a2827c79ecc0ddfc780702c84a7c55acb}


Definition at line 1267 of file detect.\+c.



References dosearch0().


\begin{DoxyCode}
1268 \{
1269     \textcolor{keywordflow}{return}(\hyperlink{detect_8c_af61e42c8be2e07d13b384eed4939a9f7}{dosearch0}(0));
1270 \}
\end{DoxyCode}
\hypertarget{detect_8c_af61e42c8be2e07d13b384eed4939a9f7}{\index{detect.\+c@{detect.\+c}!dosearch0@{dosearch0}}
\index{dosearch0@{dosearch0}!detect.\+c@{detect.\+c}}
\subsubsection[{dosearch0}]{\setlength{\rightskip}{0pt plus 5cm}int dosearch0 (
\begin{DoxyParamCaption}
\item[{int}]{aflag}
\end{DoxyParamCaption}
)}}\label{detect_8c_af61e42c8be2e07d13b384eed4939a9f7}


Definition at line 1159 of file detect.\+c.



References A\+\_\+\+W\+I\+S, Blind, canspotmon, C\+O\+R\+R, cvt\+\_\+sdoor\+\_\+to\+\_\+door(), monst\+::data, F\+A\+L\+S\+E, feel\+\_\+location(), find\+\_\+trap(), glyph\+\_\+is\+\_\+invisible, is\+\_\+hider, levl, monst\+::m\+\_\+ap\+\_\+type, m\+\_\+at, map\+\_\+invisible(), permonst\+::mlet, newsym(), obj\+::oartifact, obj\+::otyp, S\+\_\+\+E\+E\+L, S\+C\+O\+R\+R, S\+D\+O\+O\+R, sensemon, obj\+::spe, S\+P\+F\+X\+\_\+\+S\+E\+A\+R\+C\+H, S\+T\+A\+T\+U\+E\+\_\+\+T\+R\+A\+P, T\+R\+U\+E, u, ublindf, unblock\+\_\+point(), unmap\+\_\+object(), uwep, you\+::ux, and you\+::uy.



Referenced by dosearch().


\begin{DoxyCode}
1161 \{
1162 \textcolor{preprocessor}{#ifdef GCC\_BUG}
1163 \textcolor{comment}{/* some versions of gcc seriously muck up nested loops. if you get strange}
1164 \textcolor{comment}{   crashes while searching in a version compiled with gcc, try putting}
1165 \textcolor{comment}{   #define GCC\_BUG in *conf.h (or adding -DGCC\_BUG to CFLAGS in the}
1166 \textcolor{comment}{   makefile).}
1167 \textcolor{comment}{ */}
1168     \textcolor{keyword}{volatile} \hyperlink{global_8h_a2043b7d01ce89f4ee2fa6c345a752d32}{xchar} x, y;
1169 \textcolor{preprocessor}{#else}
1170     \textcolor{keyword}{register} \hyperlink{global_8h_a2043b7d01ce89f4ee2fa6c345a752d32}{xchar} x, y;
1171 \textcolor{preprocessor}{#endif}
1172     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structtrap}{trap} *\hyperlink{structtrap}{trap};
1173     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp;
1174 
1175     \textcolor{keywordflow}{if}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uswallow) \{
1176         \textcolor{keywordflow}{if} (!aflag)
1177             pline(\textcolor{stringliteral}{"What are you looking for?  The exit?"});
1178     \} \textcolor{keywordflow}{else} \{
1179         \textcolor{keywordtype}{int} fund = (\hyperlink{decl_8h_a1aefaef88eef9075d8136d19410fd3b1}{uwep} && \hyperlink{decl_8h_a1aefaef88eef9075d8136d19410fd3b1}{uwep}->\hyperlink{structobj_af03ce8a6a0ca51e8d8954fb1a1a31fbe}{oartifact} &&
1180             spec\_ability(\hyperlink{decl_8h_a1aefaef88eef9075d8136d19410fd3b1}{uwep}, \hyperlink{artifact_8h_aa6bd61b59360e9ac9b8ca38a06cb5da3}{SPFX\_SEARCH})) ?
1181             \hyperlink{decl_8h_a1aefaef88eef9075d8136d19410fd3b1}{uwep}->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe} : 0;
1182         if (\hyperlink{decl_8h_aaac1dc498d3597b63617d7056c3e1c1b}{ublindf} && \hyperlink{decl_8h_aaac1dc498d3597b63617d7056c3e1c1b}{ublindf}->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == LENSES && !\hyperlink{youprop_8h_a1b6e24068169af4177e15b48595c08c9}{Blind})
1183             fund += 2; \textcolor{comment}{/* JDS: lenses help searching */}
1184         \textcolor{keywordflow}{if} (fund > 5) fund = 5;
1185         \textcolor{keywordflow}{for}(x = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}-1; x < \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}+2; x++)
1186           \textcolor{keywordflow}{for}(y = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}-1; y < \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}+2; y++) \{
1187         \textcolor{keywordflow}{if}(!isok(x,y)) \textcolor{keywordflow}{continue};
1188         \textcolor{keywordflow}{if}(x != \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} || y != \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}) \{
1189             \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a1b6e24068169af4177e15b48595c08c9}{Blind} && !aflag) \hyperlink{display_8c_aeec8e3135efbd85fa3a197a9f8f61d96}{feel\_location}(x,y);
1190             \textcolor{keywordflow}{if}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].typ == \hyperlink{rm_8h_a03fd0fa1e0dbd19ea38dff0c79e656a5}{SDOOR}) \{
1191             \textcolor{keywordflow}{if}(rnl(7-fund)) \textcolor{keywordflow}{continue};
1192             \hyperlink{detect_8c_ae1de6d3f46bcb6ad8bd07ca5797a291f}{cvt\_sdoor\_to\_door}(&\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y]);    \textcolor{comment}{/* .typ = DOOR */}
1193             exercise(\hyperlink{attrib_8h_a4206d6431732a698ede8a237d5c17142}{A\_WIS}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
1194             nomul(0);
1195             \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a1b6e24068169af4177e15b48595c08c9}{Blind} && !aflag)
1196                 \hyperlink{display_8c_aeec8e3135efbd85fa3a197a9f8f61d96}{feel\_location}(x,y);    \textcolor{comment}{/* make sure it shows up */}
1197             \textcolor{keywordflow}{else}
1198                 \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(x,y);
1199             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].typ == \hyperlink{rm_8h_a35e6fdb78f87c982df30c7e9580ad95d}{SCORR}) \{
1200             \textcolor{keywordflow}{if}(rnl(7-fund)) \textcolor{keywordflow}{continue};
1201             \hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].typ = \hyperlink{rm_8h_aeffd57885964c3a9a5c3ce0f81c06339}{CORR};
1202             \hyperlink{vision_8c_ae35bdda13dee95d455874551be850a47}{unblock\_point}(x,y);    \textcolor{comment}{/* vision */}
1203             exercise(\hyperlink{attrib_8h_a4206d6431732a698ede8a237d5c17142}{A\_WIS}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
1204             nomul(0);
1205             \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(x,y);
1206             \} \textcolor{keywordflow}{else} \{
1207         \textcolor{comment}{/* Be careful not to find anything in an SCORR or SDOOR */}
1208             \textcolor{keywordflow}{if}((mtmp = \hyperlink{rm_8h_a4d8dddf3df3fad65478980d2c8cbf53c}{m\_at}(x, y)) && !aflag) \{
1209                 \textcolor{keywordflow}{if}(mtmp->\hyperlink{structmonst_aab8fc9a0be90b4db8333b09487e2620c}{m\_ap\_type}) \{
1210                 seemimic(mtmp);
1211         find:       exercise(\hyperlink{attrib_8h_a4206d6431732a698ede8a237d5c17142}{A\_WIS}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
1212                 \textcolor{keywordflow}{if} (!\hyperlink{display_8h_a13f0a7cac1ceb73885a59b8598de1648}{canspotmon}(mtmp)) \{
1213                     \textcolor{keywordflow}{if} (\hyperlink{display_8h_aab760a0bc2c5bad8dbfe7102628dafc6}{glyph\_is\_invisible}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].glyph)) \{
1214                     \textcolor{comment}{/* found invisible monster in a square}
1215 \textcolor{comment}{                     * which already has an 'I' in it.}
1216 \textcolor{comment}{                     * Logically, this should still take}
1217 \textcolor{comment}{                     * time and lead to a return(1), but if}
1218 \textcolor{comment}{                     * we did that the player would keep}
1219 \textcolor{comment}{                     * finding the same monster every turn.}
1220 \textcolor{comment}{                     */}
1221                     \textcolor{keywordflow}{continue};
1222                     \} \textcolor{keywordflow}{else} \{
1223                     You\_feel(\textcolor{stringliteral}{"an unseen monster!"});
1224                     \hyperlink{display_8c_add21782d0389d23fbc5a470ef91d77e9}{map\_invisible}(x, y);
1225                     \}
1226                 \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!\hyperlink{display_8h_a13881a5dc42ea2076abd050773eee913}{sensemon}(mtmp))
1227                     You(\textcolor{stringliteral}{"find %s."}, a\_monnam(mtmp));
1228                 \textcolor{keywordflow}{return}(1);
1229                 \}
1230                 \textcolor{keywordflow}{if}(!\hyperlink{display_8h_a13f0a7cac1ceb73885a59b8598de1648}{canspotmon}(mtmp)) \{
1231                 \textcolor{keywordflow}{if} (mtmp->mundetected &&
1232                    (\hyperlink{mondata_8h_a40ebe51354acef5cc9591afbdd769c36}{is\_hider}(mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) || mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}->\hyperlink{structpermonst_ab402dbf1bed9d0e595a2b3da6558da92}{mlet} == 
      \hyperlink{monsym_8h_a07cd4c997171ec30fbe1376341a26160}{S\_EEL}))
1233                     mtmp->mundetected = 0;
1234                 \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(x,y);
1235                 \textcolor{keywordflow}{goto} find;
1236                 \}
1237             \}
1238 
1239             \textcolor{comment}{/* see if an invisible monster has moved--if Blind,}
1240 \textcolor{comment}{             * feel\_location() already did it}
1241 \textcolor{comment}{             */}
1242             \textcolor{keywordflow}{if} (!aflag && !mtmp && !\hyperlink{youprop_8h_a1b6e24068169af4177e15b48595c08c9}{Blind} &&
1243                     \hyperlink{display_8h_aab760a0bc2c5bad8dbfe7102628dafc6}{glyph\_is\_invisible}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].glyph)) \{
1244                 \hyperlink{display_8c_ae4c63c21336f923f86fa95ca4c8055fb}{unmap\_object}(x,y);
1245                 \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(x,y);
1246             \}
1247 
1248             \textcolor{keywordflow}{if} ((trap = t\_at(x,y)) && !trap->tseen && !rnl(8)) \{
1249                 nomul(0);
1250 
1251                 \textcolor{keywordflow}{if} (trap->ttyp == \hyperlink{trap_8h_a608095451436b98ee954855f7661802d}{STATUE\_TRAP}) \{
1252                 \textcolor{keywordflow}{if} (activate\_statue\_trap(trap, x, y, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE}))
1253                     exercise(\hyperlink{attrib_8h_a4206d6431732a698ede8a237d5c17142}{A\_WIS}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
1254                 \textcolor{keywordflow}{return}(1);
1255                 \} \textcolor{keywordflow}{else} \{
1256                 \hyperlink{detect_8c_a20d8772991f460323e17f8a984907ded}{find\_trap}(trap);
1257                 \}
1258             \}
1259             \}
1260         \}
1261         \}
1262     \}
1263     \textcolor{keywordflow}{return}(1);
1264 \}
\end{DoxyCode}
\hypertarget{detect_8c_a4fd77383888fc0c9c06a491e8b925f75}{\index{detect.\+c@{detect.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!detect.\+c@{detect.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf do\+\_\+dknown\+\_\+of}}]{, }
\item[{(struct {\bf obj} $\ast$)}]{}
\end{DoxyParamCaption}
)}}\label{detect_8c_a4fd77383888fc0c9c06a491e8b925f75}
\hypertarget{detect_8c_a9bb6048f96ab1a5e0643dc2e42933f61}{\index{detect.\+c@{detect.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!detect.\+c@{detect.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} {\bf boolean} F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf check\+\_\+map\+\_\+spot}}]{, }
\item[{(int, int, {\bf C\+H\+A\+R\+\_\+\+P}, unsigned)}]{}
\end{DoxyParamCaption}
)}}\label{detect_8c_a9bb6048f96ab1a5e0643dc2e42933f61}
\hypertarget{detect_8c_af55f02920a1ab85ee5320f1661ac5487}{\index{detect.\+c@{detect.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!detect.\+c@{detect.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} {\bf boolean} F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf clear\+\_\+stale\+\_\+map}}]{, }
\item[{({\bf C\+H\+A\+R\+\_\+\+P}, unsigned)}]{}
\end{DoxyParamCaption}
)}}\label{detect_8c_af55f02920a1ab85ee5320f1661ac5487}
\hypertarget{detect_8c_ac59ef1e48c8e6b51e14a78b20f5efd8c}{\index{detect.\+c@{detect.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!detect.\+c@{detect.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf sense\+\_\+trap}}]{, }
\item[{(struct {\bf trap} $\ast$, {\bf X\+C\+H\+A\+R\+\_\+\+P}, {\bf X\+C\+H\+A\+R\+\_\+\+P}, int)}]{}
\end{DoxyParamCaption}
)}}\label{detect_8c_ac59ef1e48c8e6b51e14a78b20f5efd8c}
\hypertarget{detect_8c_a6ca92266c18237f862332cbceb148520}{\index{detect.\+c@{detect.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!detect.\+c@{detect.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf show\+\_\+map\+\_\+spot}}]{, }
\item[{(int, int)}]{}
\end{DoxyParamCaption}
)}}\label{detect_8c_a6ca92266c18237f862332cbceb148520}
\hypertarget{detect_8c_a08b4e0d2e6891475cd59cdcea6aff8f5}{\index{detect.\+c@{detect.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!detect.\+c@{detect.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+P\+T\+R} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf findone}}]{, }
\item[{(int, int, {\bf genericptr\+\_\+t})}]{}
\end{DoxyParamCaption}
)}}\label{detect_8c_a08b4e0d2e6891475cd59cdcea6aff8f5}
\hypertarget{detect_8c_a4a2c801f7151c883f612a060f1335de1}{\index{detect.\+c@{detect.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!detect.\+c@{detect.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+P\+T\+R} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf openone}}]{, }
\item[{(int, int, {\bf genericptr\+\_\+t})}]{}
\end{DoxyParamCaption}
)}}\label{detect_8c_a4a2c801f7151c883f612a060f1335de1}
\hypertarget{detect_8c_a20d8772991f460323e17f8a984907ded}{\index{detect.\+c@{detect.\+c}!find\+\_\+trap@{find\+\_\+trap}}
\index{find\+\_\+trap@{find\+\_\+trap}!detect.\+c@{detect.\+c}}
\subsubsection[{find\+\_\+trap}]{\setlength{\rightskip}{0pt plus 5cm}void find\+\_\+trap (
\begin{DoxyParamCaption}
\item[{struct {\bf trap} $\ast$}]{trap}
\end{DoxyParamCaption}
)}}\label{detect_8c_a20d8772991f460323e17f8a984907ded}


Definition at line 1129 of file detect.\+c.



References A\+\_\+\+W\+I\+S, Blind, cls(), defsyms, display\+\_\+nhwindow, display\+\_\+self, docrt(), F\+A\+L\+S\+E, feel\+\_\+location(), levl, map\+\_\+trap(), newsym(), trap\+\_\+to\+\_\+defsym, trap\+\_\+to\+\_\+glyph, T\+R\+U\+E, what\+\_\+trap, and W\+I\+N\+\_\+\+M\+A\+P.



Referenced by dosearch0(), and kick\+\_\+object().


\begin{DoxyCode}
1131 \{
1132     \textcolor{keywordtype}{int} tt = \hyperlink{display_8h_a0d1e25ef13d9e895603597e3f02b4ffe}{what\_trap}(trap->ttyp);
1133     \textcolor{keywordtype}{boolean} cleared = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
1134 
1135     trap->tseen = 1;
1136     exercise(\hyperlink{attrib_8h_a4206d6431732a698ede8a237d5c17142}{A\_WIS}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
1137     \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a1b6e24068169af4177e15b48595c08c9}{Blind})
1138     \hyperlink{display_8c_aeec8e3135efbd85fa3a197a9f8f61d96}{feel\_location}(trap->\hyperlink{structtrap_a8a3d31070852119ee66c8662b0c883c7}{tx}, trap->\hyperlink{structtrap_a579c4f0e2d31e3657c930d6741737b20}{ty});
1139     \textcolor{keywordflow}{else}
1140     \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(trap->\hyperlink{structtrap_a8a3d31070852119ee66c8662b0c883c7}{tx}, trap->\hyperlink{structtrap_a579c4f0e2d31e3657c930d6741737b20}{ty});
1141 
1142     \textcolor{keywordflow}{if} (\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[trap->\hyperlink{structtrap_a8a3d31070852119ee66c8662b0c883c7}{tx}][trap->\hyperlink{structtrap_a579c4f0e2d31e3657c930d6741737b20}{ty}].glyph != \hyperlink{display_8h_a29a24762d8eb2c98d7b90c0e7d294c7f}{trap\_to\_glyph}(trap)) \{
1143         \textcolor{comment}{/* There's too much clutter to see your find otherwise */}
1144     \hyperlink{display_8c_a4826277cc150ddc0f4de4bd464a34909}{cls}();
1145     \hyperlink{display_8c_ac74653df91c3a6b4f9c35d371bb55e6e}{map\_trap}(trap, 1);
1146     \hyperlink{display_8h_aa4ec7eb1f23db38f5e6bcbab8cb0c5e4}{display\_self}();
1147     cleared = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1148     \}
1149 
1150     You(\textcolor{stringliteral}{"find %s."}, an(\hyperlink{rm_8h_a207dbacb240eb4a71d449e59280a72a6}{defsyms}[\hyperlink{rm_8h_a8b3155eb0b52e1c13981b4dca943722c}{trap\_to\_defsym}(tt)].explanation));
1151 
1152     \textcolor{keywordflow}{if} (cleared) \{
1153     \hyperlink{winprocs_8h_ac8e74d03fbb65b9f5651e63d79bebc60}{display\_nhwindow}(\hyperlink{decl_8h_afa1f7dd312c4c1b72afe3d2c8c2af691}{WIN\_MAP}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE}); \textcolor{comment}{/* wait */}
1154     \hyperlink{display_8c_aad46d5a3dee537d403163916114fd463}{docrt}();
1155     \}
1156 \}
\end{DoxyCode}
\hypertarget{detect_8c_aecba6834af3b2a88b2b16ab428d5e23d}{\index{detect.\+c@{detect.\+c}!findit@{findit}}
\index{findit@{findit}!detect.\+c@{detect.\+c}}
\subsubsection[{findit}]{\setlength{\rightskip}{0pt plus 5cm}int findit (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{detect_8c_aecba6834af3b2a88b2b16ab428d5e23d}


Definition at line 1101 of file detect.\+c.



References B\+O\+L\+T\+\_\+\+L\+I\+M, do\+\_\+clear\+\_\+area(), findone(), u, you\+::ux, and you\+::uy.


\begin{DoxyCode}
1102 \{
1103     \textcolor{keywordtype}{int} num = 0;
1104 
1105     \textcolor{keywordflow}{if}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uswallow) \textcolor{keywordflow}{return}(0);
1106     \hyperlink{vision_8c_a1fafbadf4ed6faed2c37e05893ba273e}{do\_clear\_area}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}, \hyperlink{hack_8h_a26ee0a18384e9ca14b97a4f877791284}{BOLT\_LIM}, \hyperlink{detect_8c_ae9b4697d87c5c4c1ee75abf087ea5f45}{findone}, (
      \hyperlink{tradstdc_8h_ad4a7dab7269b4b00e3c7c7d2e66f31cd}{genericptr\_t}) &num);
1107     \textcolor{keywordflow}{return}(num);
1108 \}
\end{DoxyCode}
\hypertarget{detect_8c_ae9b4697d87c5c4c1ee75abf087ea5f45}{\index{detect.\+c@{detect.\+c}!findone@{findone}}
\index{findone@{findone}!detect.\+c@{detect.\+c}}
\subsubsection[{findone}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+P\+T\+R} void findone (
\begin{DoxyParamCaption}
\item[{int}]{zx, }
\item[{int}]{zy, }
\item[{{\bf genericptr\+\_\+t}}]{num}
\end{DoxyParamCaption}
)}}\label{detect_8c_ae9b4697d87c5c4c1ee75abf087ea5f45}


Definition at line 1002 of file detect.\+c.



References canspotmon, C\+O\+R\+R, cvt\+\_\+sdoor\+\_\+to\+\_\+door(), monst\+::data, glyph\+\_\+is\+\_\+invisible, is\+\_\+hider, levl, monst\+::m\+\_\+ap\+\_\+type, m\+\_\+at, magic\+\_\+map\+\_\+background(), map\+\_\+invisible(), permonst\+::mlet, newsym(), S\+\_\+\+E\+E\+L, S\+C\+O\+R\+R, S\+D\+O\+O\+R, S\+T\+A\+T\+U\+E\+\_\+\+T\+R\+A\+P, unblock\+\_\+point(), and unmap\+\_\+object().



Referenced by findit().


\begin{DoxyCode}
1005 \{
1006     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structtrap}{trap} *ttmp;
1007     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp;
1008 
1009     \textcolor{keywordflow}{if}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].typ == \hyperlink{rm_8h_a03fd0fa1e0dbd19ea38dff0c79e656a5}{SDOOR}) \{
1010         \hyperlink{detect_8c_ae1de6d3f46bcb6ad8bd07ca5797a291f}{cvt\_sdoor\_to\_door}(&\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy]);  \textcolor{comment}{/* .typ = DOOR */}
1011         \hyperlink{display_8c_ad4037a0d6b3771e04ffab76d8dc25a65}{magic\_map\_background}(zx, zy, 0);
1012         \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(zx, zy);
1013         (*(\textcolor{keywordtype}{int}*)num)++;
1014     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].typ == \hyperlink{rm_8h_a35e6fdb78f87c982df30c7e9580ad95d}{SCORR}) \{
1015         \hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].typ = \hyperlink{rm_8h_aeffd57885964c3a9a5c3ce0f81c06339}{CORR};
1016         \hyperlink{vision_8c_ae35bdda13dee95d455874551be850a47}{unblock\_point}(zx,zy);
1017         \hyperlink{display_8c_ad4037a0d6b3771e04ffab76d8dc25a65}{magic\_map\_background}(zx, zy, 0);
1018         \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(zx, zy);
1019         (*(\textcolor{keywordtype}{int}*)num)++;
1020     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((ttmp = t\_at(zx, zy)) != 0) \{
1021         \textcolor{keywordflow}{if}(!ttmp->tseen && ttmp->ttyp != \hyperlink{trap_8h_a608095451436b98ee954855f7661802d}{STATUE\_TRAP}) \{
1022             ttmp->tseen = 1;
1023             \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(zx,zy);
1024             (*(\textcolor{keywordtype}{int}*)num)++;
1025         \}
1026     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((mtmp = \hyperlink{rm_8h_a4d8dddf3df3fad65478980d2c8cbf53c}{m\_at}(zx, zy)) != 0) \{
1027         \textcolor{keywordflow}{if}(mtmp->\hyperlink{structmonst_aab8fc9a0be90b4db8333b09487e2620c}{m\_ap\_type}) \{
1028             seemimic(mtmp);
1029             (*(\textcolor{keywordtype}{int}*)num)++;
1030         \}
1031         \textcolor{keywordflow}{if} (mtmp->mundetected &&
1032             (\hyperlink{mondata_8h_a40ebe51354acef5cc9591afbdd769c36}{is\_hider}(mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) || mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}->\hyperlink{structpermonst_ab402dbf1bed9d0e595a2b3da6558da92}{mlet} == 
      \hyperlink{monsym_8h_a07cd4c997171ec30fbe1376341a26160}{S\_EEL})) \{
1033             mtmp->mundetected = 0;
1034             \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(zx, zy);
1035             (*(\textcolor{keywordtype}{int}*)num)++;
1036         \}
1037         \textcolor{keywordflow}{if} (!\hyperlink{display_8h_a13f0a7cac1ceb73885a59b8598de1648}{canspotmon}(mtmp) &&
1038                     !\hyperlink{display_8h_aab760a0bc2c5bad8dbfe7102628dafc6}{glyph\_is\_invisible}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].glyph))
1039             \hyperlink{display_8c_add21782d0389d23fbc5a470ef91d77e9}{map\_invisible}(zx, zy);
1040     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{display_8h_aab760a0bc2c5bad8dbfe7102628dafc6}{glyph\_is\_invisible}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].glyph)) \{
1041         \hyperlink{display_8c_ae4c63c21336f923f86fa95ca4c8055fb}{unmap\_object}(zx, zy);
1042         \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(zx, zy);
1043         (*(\textcolor{keywordtype}{int}*)num)++;
1044     \}
1045 \}
\end{DoxyCode}
\hypertarget{detect_8c_a582da6acd8413b3828bb2593705e7712}{\index{detect.\+c@{detect.\+c}!food\+\_\+detect@{food\+\_\+detect}}
\index{food\+\_\+detect@{food\+\_\+detect}!detect.\+c@{detect.\+c}}
\subsubsection[{food\+\_\+detect}]{\setlength{\rightskip}{0pt plus 5cm}int food\+\_\+detect (
\begin{DoxyParamCaption}
\item[{struct {\bf obj}	$\ast$}]{sobj}
\end{DoxyParamCaption}
)}}\label{detect_8c_a582da6acd8413b3828bb2593705e7712}


Definition at line 294 of file detect.\+c.



References A\+\_\+\+W\+I\+S, flag\+::beginner, buf, B\+U\+F\+S\+Z, clear\+\_\+stale\+\_\+map(), cls(), Confusion, display\+\_\+nhwindow, docrt(), F\+A\+L\+S\+E, flags, fmon, fobj, F\+O\+O\+D\+\_\+\+C\+L\+A\+S\+S, known, map\+\_\+object(), monst\+::minvent, monst\+::mx, monst\+::my, newsym(), monst\+::nmon, obj\+::nobj, N\+O\+S\+E, o\+\_\+in(), obj\+::ox, obj\+::oy, P\+O\+T\+I\+O\+N\+\_\+\+C\+L\+A\+S\+S, something, Sprintf, temp, T\+R\+U\+E, u, under\+\_\+ground(), under\+\_\+water(), Underwater, you\+::ux, you\+::uy, what, and W\+I\+N\+\_\+\+M\+A\+P.


\begin{DoxyCode}
296 \{
297     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{structobj}{obj};
298     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp;
299     \textcolor{keyword}{register} \textcolor{keywordtype}{int} ct = 0, ctu = 0;
300     \textcolor{keywordtype}{boolean} confused = (\hyperlink{youprop_8h_a85174462efda5cc2dc2a49a0249801bb}{Confusion} || (sobj && sobj->cursed)), stale;
301     \textcolor{keywordtype}{char} oclass = confused ? \hyperlink{objclass_8h_a05335e5ee18dfa33af1c40056fe8fab9}{POTION\_CLASS} : \hyperlink{objclass_8h_a98c4704dea5f0606fe545294b44f8fd6}{FOOD\_CLASS};
302     \textcolor{keyword}{const} \textcolor{keywordtype}{char} *\hyperlink{detect_8c_a951a98f1e2d69ca61adcd53c0f8faca3}{what} = confused ? \hyperlink{decl_8h_aa5c50bde0d16d15a08d32d8df49a80ae}{something} : \textcolor{stringliteral}{"food"};
303     \textcolor{keywordtype}{int} uw = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater;
304 
305     stale = \hyperlink{detect_8c_af6afb66a1f38478d634e4b9aed6b8555}{clear\_stale\_map}(oclass, 0);
306 
307     \textcolor{keywordflow}{for} (obj = \hyperlink{rm_8h_a4d2866bf9ebea1c08c26174b5c8cfbb7}{fobj}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
308     \textcolor{keywordflow}{if} (\hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, oclass)) \{
309         \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} && obj->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}) ctu++;
310         \textcolor{keywordflow}{else} ct++;
311     \}
312     \textcolor{keywordflow}{for} (mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon}; mtmp && !ct; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon}) \{
313     \textcolor{comment}{/* no DEADMONSTER(mtmp) check needed since dmons never have inventory */}
314     \textcolor{keywordflow}{for} (obj = mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
315         \textcolor{keywordflow}{if} (\hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, oclass)) \{
316         ct++;
317         \textcolor{keywordflow}{break};
318         \}
319     \}
320     
321     \textcolor{keywordflow}{if} (!ct && !ctu) \{
322     \hyperlink{detect_8c_a2373e3a270d2b530119452501548080a}{known} = stale && !confused;
323     \textcolor{keywordflow}{if} (stale) \{
324         \hyperlink{display_8c_aad46d5a3dee537d403163916114fd463}{docrt}();
325         You(\textcolor{stringliteral}{"sense a lack of %s nearby."}, what);
326         \textcolor{keywordflow}{if} (sobj && sobj->blessed) \{
327         \textcolor{keywordflow}{if} (!\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uedibility) Your(\textcolor{stringliteral}{"%s starts to tingle."}, body\_part(\hyperlink{hack_8h_ab2a6cf3c1f59ac96cfa6160f5dfff10a}{NOSE}));
328         \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uedibility = 1;
329         \}
330     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (sobj) \{
331         \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
332         \hyperlink{global_8h_aa55ba8f4e3c82fe00035e6b51d6c7dee}{Sprintf}(buf, \textcolor{stringliteral}{"Your %s twitches%s."}, body\_part(\hyperlink{hack_8h_ab2a6cf3c1f59ac96cfa6160f5dfff10a}{NOSE}),
333             (sobj->blessed && !\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uedibility) ? \textcolor{stringliteral}{" then starts to tingle"} : \textcolor{stringliteral}{""});
334         \textcolor{keywordflow}{if} (sobj->blessed && !\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uedibility) \{
335         \textcolor{keywordtype}{boolean} savebeginner = \hyperlink{flag_8h_a997133526e0c6bed44ebc0116a48b50a}{flags}.\hyperlink{structflag_ac488811edaec9208018e9abb54679274}{beginner}; \textcolor{comment}{/* prevent non-delivery of */}
336         \hyperlink{flag_8h_a997133526e0c6bed44ebc0116a48b50a}{flags}.\hyperlink{structflag_ac488811edaec9208018e9abb54679274}{beginner} = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};           \textcolor{comment}{/*  message            */}
337         strange\_feeling(sobj, buf);
338         \hyperlink{flag_8h_a997133526e0c6bed44ebc0116a48b50a}{flags}.\hyperlink{structflag_ac488811edaec9208018e9abb54679274}{beginner} = savebeginner;
339         \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uedibility = 1;
340         \} \textcolor{keywordflow}{else}
341         strange\_feeling(sobj, buf);
342     \}
343     \textcolor{keywordflow}{return} !stale;
344     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (!ct) \{
345     \hyperlink{detect_8c_a2373e3a270d2b530119452501548080a}{known} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
346     You(\textcolor{stringliteral}{"%s %s nearby."}, sobj ? \textcolor{stringliteral}{"smell"} : \textcolor{stringliteral}{"sense"}, what);
347     \textcolor{keywordflow}{if} (sobj && sobj->blessed) \{
348         \textcolor{keywordflow}{if} (!\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uedibility) pline(\textcolor{stringliteral}{"Your %s starts to tingle."}, body\_part(\hyperlink{hack_8h_ab2a6cf3c1f59ac96cfa6160f5dfff10a}{NOSE}));
349         \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uedibility = 1;
350     \}
351     \} \textcolor{keywordflow}{else} \{
352     \textcolor{keyword}{struct }obj *\hyperlink{makedefs_8c_a1eb0cd7f6bb3372ee8b5373484271c74}{temp};
353     \hyperlink{detect_8c_a2373e3a270d2b530119452501548080a}{known} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
354     \hyperlink{display_8c_a4826277cc150ddc0f4de4bd464a34909}{cls}();
355     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater = 0;
356     \textcolor{keywordflow}{for} (obj = \hyperlink{rm_8h_a4d2866bf9ebea1c08c26174b5c8cfbb7}{fobj}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
357         \textcolor{keywordflow}{if} ((temp = \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, oclass)) != 0) \{
358         \textcolor{keywordflow}{if} (temp != obj) \{
359             temp->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} = obj->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox};
360             temp->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} = obj->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy};
361         \}
362         \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(temp,1);
363         \}
364     \textcolor{keywordflow}{for} (mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon}; mtmp; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon})
365         \textcolor{comment}{/* no DEADMONSTER(mtmp) check needed since dmons never have inventory */}
366         \textcolor{keywordflow}{for} (obj = mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
367         \textcolor{keywordflow}{if} ((temp = \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, oclass)) != 0) \{
368             temp->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} = mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx};
369             temp->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} = mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my};
370             \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(temp,1);
371             \textcolor{keywordflow}{break};  \textcolor{comment}{/* skip rest of this monster's inventory */}
372         \}
373     \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux},\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy});
374     \textcolor{keywordflow}{if} (sobj) \{
375         \textcolor{keywordflow}{if} (sobj->blessed) \{
376             Your(\textcolor{stringliteral}{"%s %s to tingle and you smell %s."}, body\_part(\hyperlink{hack_8h_ab2a6cf3c1f59ac96cfa6160f5dfff10a}{NOSE}),
377                 \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uedibility ? \textcolor{stringliteral}{"continues"} : \textcolor{stringliteral}{"starts"}, what);
378         \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uedibility = 1;
379         \} \textcolor{keywordflow}{else}
380         Your(\textcolor{stringliteral}{"%s tingles and you smell %s."}, body\_part(\hyperlink{hack_8h_ab2a6cf3c1f59ac96cfa6160f5dfff10a}{NOSE}), what);
381     \}
382     \textcolor{keywordflow}{else} You(\textcolor{stringliteral}{"sense %s."}, what);
383     \hyperlink{winprocs_8h_ac8e74d03fbb65b9f5651e63d79bebc60}{display\_nhwindow}(\hyperlink{decl_8h_afa1f7dd312c4c1b72afe3d2c8c2af691}{WIN\_MAP}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
384     exercise(\hyperlink{attrib_8h_a4206d6431732a698ede8a237d5c17142}{A\_WIS}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
385     \hyperlink{display_8c_aad46d5a3dee537d403163916114fd463}{docrt}();
386     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater = uw;
387     \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a2eb59bdcba2c368fefd253bfcdaa3673}{Underwater}) \hyperlink{display_8c_a04df1dff0b7b4d1eafd5078265a3d451}{under\_water}(2);
388     \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uburied) \hyperlink{display_8c_af14bb89d2638ab90083214d1f9ed19f4}{under\_ground}(2);
389     \}
390     \textcolor{keywordflow}{return}(0);
391 \}
\end{DoxyCode}
\hypertarget{detect_8c_ae4491fc95530927e86d183cbb4d2bda6}{\index{detect.\+c@{detect.\+c}!gold\+\_\+detect@{gold\+\_\+detect}}
\index{gold\+\_\+detect@{gold\+\_\+detect}!detect.\+c@{detect.\+c}}
\subsubsection[{gold\+\_\+detect}]{\setlength{\rightskip}{0pt plus 5cm}int gold\+\_\+detect (
\begin{DoxyParamCaption}
\item[{struct {\bf obj} $\ast$}]{sobj}
\end{DoxyParamCaption}
)}}\label{detect_8c_ae4491fc95530927e86d183cbb4d2bda6}


Definition at line 163 of file detect.\+c.



References A\+\_\+\+W\+I\+S, buf, B\+U\+F\+S\+Z, clear\+\_\+stale\+\_\+map(), cls(), C\+O\+I\+N\+\_\+\+C\+L\+A\+S\+S, monst\+::data, D\+E\+A\+D\+M\+O\+N\+S\+T\+E\+R, display\+\_\+nhwindow, docrt(), fmon, fobj, F\+O\+O\+T, G\+O\+L\+D, invent, known, map\+\_\+object(), monst\+::mgold, monst\+::minvent, mons, monst\+::mx, monst\+::my, newsym(), monst\+::nmon, obj\+::nobj, o\+\_\+in(), o\+\_\+material(), obj\+::otyp, obj\+::ox, obj\+::oy, Sprintf, Strcpy, temp, T\+R\+U\+E, u, you\+::ugold, under\+\_\+ground(), under\+\_\+water(), Underwater, you\+::ux, you\+::uy, W\+I\+N\+\_\+\+M\+A\+P, and youmonst.


\begin{DoxyCode}
165 \{
166     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{structobj}{obj};
167     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp;
168     \textcolor{keywordtype}{int} uw = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater;
169     \textcolor{keyword}{struct }obj *\hyperlink{makedefs_8c_a1eb0cd7f6bb3372ee8b5373484271c74}{temp};
170     \textcolor{keywordtype}{boolean} stale;
171 
172     \hyperlink{detect_8c_a2373e3a270d2b530119452501548080a}{known} = stale = \hyperlink{detect_8c_af6afb66a1f38478d634e4b9aed6b8555}{clear\_stale\_map}(\hyperlink{objclass_8h_a2999621925083659147349e261e4cb3d}{COIN\_CLASS},
173                 (\textcolor{keywordtype}{unsigned})(sobj->blessed ? \hyperlink{objclass_8h_af468028083c9e52aa2c94ef3b9940450}{GOLD} : 0));
174 
175     \textcolor{comment}{/* look for gold carried by monsters (might be in a container) */}
176     \textcolor{keywordflow}{for} (mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon}; mtmp; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon}) \{
177         \textcolor{keywordflow}{if} (\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp)) \textcolor{keywordflow}{continue}; \textcolor{comment}{/* probably not needed in this case but... */}
178 \textcolor{preprocessor}{#ifndef GOLDOBJ}
179     \textcolor{keywordflow}{if} (mtmp->\hyperlink{structmonst_a06dbdd0ca7ee096216aa10f86beed533}{mgold} || monsndx(mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) == PM\_GOLD\_GOLEM) \{
180 \textcolor{preprocessor}{#else}
181     \textcolor{keywordflow}{if} (findgold(mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}) || monsndx(mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) == PM\_GOLD\_GOLEM) \{
182 \textcolor{preprocessor}{#endif}
183         \hyperlink{detect_8c_a2373e3a270d2b530119452501548080a}{known} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
184         \textcolor{keywordflow}{goto} outgoldmap;    \textcolor{comment}{/* skip further searching */}
185     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{for} (obj = mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
186         \textcolor{keywordflow}{if} (sobj->blessed && \hyperlink{detect_8c_a3482c89460e32650375743a33dbfb8b2}{o\_material}(obj, \hyperlink{objclass_8h_af468028083c9e52aa2c94ef3b9940450}{GOLD})) \{
187             \hyperlink{detect_8c_a2373e3a270d2b530119452501548080a}{known} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
188             \textcolor{keywordflow}{goto} outgoldmap;
189         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, \hyperlink{objclass_8h_a2999621925083659147349e261e4cb3d}{COIN\_CLASS})) \{
190         \hyperlink{detect_8c_a2373e3a270d2b530119452501548080a}{known} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
191         \textcolor{keywordflow}{goto} outgoldmap;    \textcolor{comment}{/* skip further searching */}
192         \}
193     \}
194     
195     \textcolor{comment}{/* look for gold objects */}
196     \textcolor{keywordflow}{for} (obj = \hyperlink{rm_8h_a4d2866bf9ebea1c08c26174b5c8cfbb7}{fobj}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj}) \{
197     \textcolor{keywordflow}{if} (sobj->blessed && \hyperlink{detect_8c_a3482c89460e32650375743a33dbfb8b2}{o\_material}(obj, \hyperlink{objclass_8h_af468028083c9e52aa2c94ef3b9940450}{GOLD})) \{
198         \hyperlink{detect_8c_a2373e3a270d2b530119452501548080a}{known} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
199         \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} != \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} || obj->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} != \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}) \textcolor{keywordflow}{goto} outgoldmap;
200     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, \hyperlink{objclass_8h_a2999621925083659147349e261e4cb3d}{COIN\_CLASS})) \{
201         \hyperlink{detect_8c_a2373e3a270d2b530119452501548080a}{known} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
202         \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} != \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} || obj->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} != \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}) \textcolor{keywordflow}{goto} outgoldmap;
203     \}
204     \}
205 
206     \textcolor{keywordflow}{if} (!\hyperlink{detect_8c_a2373e3a270d2b530119452501548080a}{known}) \{
207     \textcolor{comment}{/* no gold found on floor or monster's inventory.}
208 \textcolor{comment}{       adjust message if you have gold in your inventory */}
209     \textcolor{keywordflow}{if} (sobj) \{
210         \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
211         \textcolor{keywordflow}{if} (\hyperlink{decl_8h_ad15893dbcb60e2777ae0dfac9f840858}{youmonst}.\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data} == &\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[PM\_GOLD\_GOLEM]) \{
212             \hyperlink{global_8h_aa55ba8f4e3c82fe00035e6b51d6c7dee}{Sprintf}(buf, \textcolor{stringliteral}{"You feel like a million %s!"},
213                 currency(2L));
214         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (hidden\_gold() ||
215 #ifndef GOLDOBJ
216                 \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_af666e1fd44c5efe34df9053aef068245}{ugold})
217 \textcolor{preprocessor}{#else}
218                     money\_cnt(\hyperlink{decl_8h_a65d03deeacf265a14fa3af961820b33f}{invent}))
219 #endif
220             \hyperlink{global_8h_add22f733d1f2c380499f495068e42b7c}{Strcpy}(buf,
221                 \textcolor{stringliteral}{"You feel worried about your future financial situation."});
222         \textcolor{keywordflow}{else}
223             \hyperlink{global_8h_add22f733d1f2c380499f495068e42b7c}{Strcpy}(buf, \textcolor{stringliteral}{"You feel materially poor."});
224         strange\_feeling(sobj, buf);
225         \}
226     \textcolor{keywordflow}{return}(1);
227     \}
228     \textcolor{comment}{/* only under me - no separate display required */}
229     \textcolor{keywordflow}{if} (stale) \hyperlink{display_8c_aad46d5a3dee537d403163916114fd463}{docrt}();
230     You(\textcolor{stringliteral}{"notice some gold between your %s."}, makeplural(body\_part(\hyperlink{hack_8h_a9b1eabef4c7711550544eaeaa8f41fa1}{FOOT})));
231     \textcolor{keywordflow}{return}(0);
232 
233 outgoldmap:
234     \hyperlink{display_8c_a4826277cc150ddc0f4de4bd464a34909}{cls}();
235 
236     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater = 0;
237     \textcolor{comment}{/* Discover gold locations. */}
238     \textcolor{keywordflow}{for} (obj = \hyperlink{rm_8h_a4d2866bf9ebea1c08c26174b5c8cfbb7}{fobj}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj}) \{
239         \textcolor{keywordflow}{if} (sobj->blessed && (temp = \hyperlink{detect_8c_a3482c89460e32650375743a33dbfb8b2}{o\_material}(obj, \hyperlink{objclass_8h_af468028083c9e52aa2c94ef3b9940450}{GOLD}))) \{
240         \textcolor{keywordflow}{if} (temp != obj) \{
241         temp->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} = obj->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox};
242         temp->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} = obj->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy};
243         \}
244         \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(temp,1);
245     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((temp = \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, \hyperlink{objclass_8h_a2999621925083659147349e261e4cb3d}{COIN\_CLASS}))) \{
246         \textcolor{keywordflow}{if} (temp != obj) \{
247         temp->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} = obj->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox};
248         temp->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} = obj->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy};
249         \}
250         \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(temp,1);
251     \}
252     \}
253     \textcolor{keywordflow}{for} (mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon}; mtmp; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon}) \{
254         \textcolor{keywordflow}{if} (\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp)) \textcolor{keywordflow}{continue}; \textcolor{comment}{/* probably overkill here */}
255 \textcolor{preprocessor}{#ifndef GOLDOBJ}
256     \textcolor{keywordflow}{if} (mtmp->\hyperlink{structmonst_a06dbdd0ca7ee096216aa10f86beed533}{mgold} || monsndx(mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) == PM\_GOLD\_GOLEM) \{
257 \textcolor{preprocessor}{#else}
258     \textcolor{keywordflow}{if} (findgold(mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}) || monsndx(mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}) == PM\_GOLD\_GOLEM) \{
259 \textcolor{preprocessor}{#endif}
260         \textcolor{keyword}{struct }obj \hyperlink{structgold}{gold};
261 
262         \hyperlink{structgold}{gold}.otyp = GOLD\_PIECE;
263         \hyperlink{structgold}{gold}.ox = mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx};
264         \hyperlink{structgold}{gold}.oy = mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my};
265         \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(&\hyperlink{structgold}{gold},1);
266     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{for} (obj = mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
267         \textcolor{keywordflow}{if} (sobj->blessed && (temp = \hyperlink{detect_8c_a3482c89460e32650375743a33dbfb8b2}{o\_material}(obj, \hyperlink{objclass_8h_af468028083c9e52aa2c94ef3b9940450}{GOLD}))) \{
268         temp->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} = mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx};
269         temp->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} = mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my};
270         \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(temp,1);
271         \textcolor{keywordflow}{break};
272         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((temp = \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, \hyperlink{objclass_8h_a2999621925083659147349e261e4cb3d}{COIN\_CLASS}))) \{
273         temp->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} = mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx};
274         temp->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} = mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my};
275         \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(temp,1);
276         \textcolor{keywordflow}{break};
277         \}
278     \}
279     
280     \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux},\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy});
281     You\_feel(\textcolor{stringliteral}{"very greedy, and sense gold!"});
282     exercise(\hyperlink{attrib_8h_a4206d6431732a698ede8a237d5c17142}{A\_WIS}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
283     \hyperlink{winprocs_8h_ac8e74d03fbb65b9f5651e63d79bebc60}{display\_nhwindow}(\hyperlink{decl_8h_afa1f7dd312c4c1b72afe3d2c8c2af691}{WIN\_MAP}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
284     \hyperlink{display_8c_aad46d5a3dee537d403163916114fd463}{docrt}();
285     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater = uw;
286     \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a2eb59bdcba2c368fefd253bfcdaa3673}{Underwater}) \hyperlink{display_8c_a04df1dff0b7b4d1eafd5078265a3d451}{under\_water}(2);
287     \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uburied) \hyperlink{display_8c_af14bb89d2638ab90083214d1f9ed19f4}{under\_ground}(2);
288     \textcolor{keywordflow}{return}(0);
289 \}
\end{DoxyCode}
\hypertarget{detect_8c_a76c278fd0bdb5a50382c6390dfa1409a}{\index{detect.\+c@{detect.\+c}!level\+\_\+distance@{level\+\_\+distance}}
\index{level\+\_\+distance@{level\+\_\+distance}!detect.\+c@{detect.\+c}}
\subsubsection[{level\+\_\+distance}]{\setlength{\rightskip}{0pt plus 5cm}{\bf const} char$\ast$ level\+\_\+distance (
\begin{DoxyParamCaption}
\item[{{\bf d\+\_\+level} $\ast$}]{where}
\end{DoxyParamCaption}
)}}\label{detect_8c_a76c278fd0bdb5a50382c6390dfa1409a}


Definition at line 748 of file detect.\+c.



References d\+\_\+level\+::dnum, u, and you\+::uz.



Referenced by use\+\_\+crystal\+\_\+ball().


\begin{DoxyCode}
750 \{
751     \textcolor{keyword}{register} \hyperlink{config_8h_a0fd9ce9d735064461bebfe6037026093}{schar} ll = depth(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}) - depth(where);
752     \textcolor{keyword}{register} \textcolor{keywordtype}{boolean} indun = (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}.\hyperlink{structd__level_a035d301f0a8cafc6c757fbbda2b6935e}{dnum} == where->\hyperlink{structd__level_a035d301f0a8cafc6c757fbbda2b6935e}{dnum});
753 
754     \textcolor{keywordflow}{if} (ll < 0) \{
755     \textcolor{keywordflow}{if} (ll < (-8 - rn2(3)))
756         \textcolor{keywordflow}{if} (!indun) \textcolor{keywordflow}{return} \textcolor{stringliteral}{"far away"};
757         \textcolor{keywordflow}{else}    \textcolor{keywordflow}{return} \textcolor{stringliteral}{"far below"};
758     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ll < -1)
759         \textcolor{keywordflow}{if} (!indun) \textcolor{keywordflow}{return} \textcolor{stringliteral}{"away below you"};
760         \textcolor{keywordflow}{else}    \textcolor{keywordflow}{return} \textcolor{stringliteral}{"below you"};
761     \textcolor{keywordflow}{else}
762         \textcolor{keywordflow}{if} (!indun) \textcolor{keywordflow}{return} \textcolor{stringliteral}{"in the distance"};
763         \textcolor{keywordflow}{else}    \textcolor{keywordflow}{return} \textcolor{stringliteral}{"just below"};
764     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ll > 0) \{
765     \textcolor{keywordflow}{if} (ll > (8 + rn2(3)))
766         \textcolor{keywordflow}{if} (!indun) \textcolor{keywordflow}{return} \textcolor{stringliteral}{"far away"};
767         \textcolor{keywordflow}{else}    \textcolor{keywordflow}{return} \textcolor{stringliteral}{"far above"};
768     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (ll > 1)
769         \textcolor{keywordflow}{if} (!indun) \textcolor{keywordflow}{return} \textcolor{stringliteral}{"away above you"};
770         \textcolor{keywordflow}{else}    \textcolor{keywordflow}{return} \textcolor{stringliteral}{"above you"};
771     \textcolor{keywordflow}{else}
772         \textcolor{keywordflow}{if} (!indun) \textcolor{keywordflow}{return} \textcolor{stringliteral}{"in the distance"};
773         \textcolor{keywordflow}{else}    \textcolor{keywordflow}{return} \textcolor{stringliteral}{"just above"};
774     \} \textcolor{keywordflow}{else}
775         \textcolor{keywordflow}{if} (!indun) \textcolor{keywordflow}{return} \textcolor{stringliteral}{"in the distance"};
776         \textcolor{keywordflow}{else}    \textcolor{keywordflow}{return} \textcolor{stringliteral}{"near you"};
777 \}
\end{DoxyCode}
\hypertarget{detect_8c_a24bcd3e85852ee1ee1088447f7273755}{\index{detect.\+c@{detect.\+c}!monster\+\_\+detect@{monster\+\_\+detect}}
\index{monster\+\_\+detect@{monster\+\_\+detect}!detect.\+c@{detect.\+c}}
\subsubsection[{monster\+\_\+detect}]{\setlength{\rightskip}{0pt plus 5cm}int monster\+\_\+detect (
\begin{DoxyParamCaption}
\item[{struct {\bf obj} $\ast$}]{otmp, }
\item[{int}]{mclass}
\end{DoxyParamCaption}
)}}\label{detect_8c_a24bcd3e85852ee1ee1088447f7273755}


Definition at line 583 of file detect.\+c.



References cls(), monst\+::data, D\+E\+A\+D\+M\+O\+N\+S\+T\+E\+R, def\+\_\+monsyms, detect\+\_\+wsegs(), detected\+\_\+mon\+\_\+to\+\_\+glyph, display\+\_\+nhwindow, display\+\_\+self, docrt(), F\+A\+L\+S\+E, fmon, Hallucination, permonst\+::mlet, mon\+\_\+to\+\_\+glyph, mons, monst\+::mx, monst\+::my, monst\+::nmon, S\+\_\+\+W\+O\+R\+M\+\_\+\+T\+A\+I\+L, show\+\_\+glyph(), T\+R\+U\+E, u, under\+\_\+ground(), under\+\_\+water(), Underwater, and W\+I\+N\+\_\+\+M\+A\+P.



Referenced by drinkfountain(), and use\+\_\+crystal\+\_\+ball().


\begin{DoxyCode}
586 \{
587     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp;
588     \textcolor{keywordtype}{int} mcnt = 0;
589 
590 
591     \textcolor{comment}{/* Note: This used to just check fmon for a non-zero value}
592 \textcolor{comment}{     * but in versions since 3.3.0 fmon can test TRUE due to the}
593 \textcolor{comment}{     * presence of dmons, so we have to find at least one}
594 \textcolor{comment}{     * with positive hit-points to know for sure.}
595 \textcolor{comment}{     */}
596     \textcolor{keywordflow}{for} (mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon}; mtmp; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon})
597         \textcolor{keywordflow}{if} (!\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp)) \{
598         mcnt++;
599         \textcolor{keywordflow}{break};
600     \}
601 
602     \textcolor{keywordflow}{if} (!mcnt) \{
603     \textcolor{keywordflow}{if} (otmp)
604         strange\_feeling(otmp, \hyperlink{youprop_8h_aa873f7ea0a3d096ef94ff651907f7a76}{Hallucination} ?
605                 \textcolor{stringliteral}{"You get the heebie jeebies."} :
606                 \textcolor{stringliteral}{"You feel threatened."});
607     \textcolor{keywordflow}{return} 1;
608     \} \textcolor{keywordflow}{else} \{
609     \textcolor{keywordtype}{boolean} woken = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
610 
611     \hyperlink{display_8c_a4826277cc150ddc0f4de4bd464a34909}{cls}();
612     \textcolor{keywordflow}{for} (mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon}; mtmp; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon}) \{
613         \textcolor{keywordflow}{if} (\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp)) \textcolor{keywordflow}{continue};
614         \textcolor{keywordflow}{if} (!mclass || mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}->\hyperlink{structpermonst_ab402dbf1bed9d0e595a2b3da6558da92}{mlet} == mclass ||
615         (mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data} == &\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[PM\_LONG\_WORM] && mclass == \hyperlink{monsym_8h_a66ad7e92e8452ab4940058dcfffed833}{S\_WORM\_TAIL}))
616             \textcolor{keywordflow}{if} (mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx} > 0) \{
617                 \textcolor{keywordflow}{if} (mclass && \hyperlink{decl_8h_a3de70854a5691ea43068787e1f9e44cf}{def\_monsyms}[mclass] == \textcolor{charliteral}{' '})
618                 \hyperlink{display_8c_a60d3cfb0df75b80c36125ce154da217f}{show\_glyph}(mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx},mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my},
619                     \hyperlink{display_8h_ae2717e9b2518a649e2ff62f810b67dda}{detected\_mon\_to\_glyph}(mtmp));
620             \textcolor{keywordflow}{else}
621                 \hyperlink{display_8c_a60d3cfb0df75b80c36125ce154da217f}{show\_glyph}(mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx},mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my},\hyperlink{display_8h_a1fa83f592d6dcf87df43743338ece721}{mon\_to\_glyph}(mtmp));
622             \textcolor{comment}{/* don't be stingy - display entire worm */}
623             \textcolor{keywordflow}{if} (mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data} == &\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[PM\_LONG\_WORM]) \hyperlink{worm_8c_a84d834f52c6685d8bfcf9198c830ae10}{detect\_wsegs}(mtmp,0);
624             \}
625         \textcolor{keywordflow}{if} (otmp && otmp->cursed &&
626         (mtmp->msleeping || !mtmp->mcanmove)) \{
627         mtmp->msleeping = mtmp->mfrozen = 0;
628         mtmp->mcanmove = 1;
629         woken = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
630         \}
631     \}
632     \hyperlink{display_8h_aa4ec7eb1f23db38f5e6bcbab8cb0c5e4}{display\_self}();
633     You(\textcolor{stringliteral}{"sense the presence of monsters."});
634     \textcolor{keywordflow}{if} (woken)
635         pline(\textcolor{stringliteral}{"Monsters sense the presence of you."});
636     \hyperlink{winprocs_8h_ac8e74d03fbb65b9f5651e63d79bebc60}{display\_nhwindow}(\hyperlink{decl_8h_afa1f7dd312c4c1b72afe3d2c8c2af691}{WIN\_MAP}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
637     \hyperlink{display_8c_aad46d5a3dee537d403163916114fd463}{docrt}();
638     \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a2eb59bdcba2c368fefd253bfcdaa3673}{Underwater}) \hyperlink{display_8c_a04df1dff0b7b4d1eafd5078265a3d451}{under\_water}(2);
639     \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uburied) \hyperlink{display_8c_af14bb89d2638ab90083214d1f9ed19f4}{under\_ground}(2);
640     \}
641     \textcolor{keywordflow}{return} 0;
642 \}
\end{DoxyCode}
\hypertarget{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{\index{detect.\+c@{detect.\+c}!o\+\_\+in@{o\+\_\+in}}
\index{o\+\_\+in@{o\+\_\+in}!detect.\+c@{detect.\+c}}
\subsubsection[{o\+\_\+in}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf obj}$\ast$ o\+\_\+in (
\begin{DoxyParamCaption}
\item[{struct {\bf obj}$\ast$}]{obj, }
\item[{char}]{oclass}
\end{DoxyParamCaption}
)}}\label{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}


Definition at line 25 of file detect.\+c.



References obj\+::cobj, Has\+\_\+contents, obj\+::nobj, obj\+::oclass, otmp, and temp.



Referenced by check\+\_\+map\+\_\+spot(), food\+\_\+detect(), gold\+\_\+detect(), and object\+\_\+detect().


\begin{DoxyCode}
28 \{
29     \textcolor{keyword}{register} \textcolor{keyword}{struct }obj* \hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
30     \textcolor{keyword}{struct }obj *\hyperlink{makedefs_8c_a1eb0cd7f6bb3372ee8b5373484271c74}{temp};
31 
32     \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_a716ba3ee00602dede9ea5c68c74d45bd}{oclass} == \hyperlink{structobj_a716ba3ee00602dede9ea5c68c74d45bd}{oclass}) \textcolor{keywordflow}{return} obj;
33 
34     \textcolor{keywordflow}{if} (\hyperlink{obj_8h_ae2e47c7280efe98de2333e8078f8ce71}{Has\_contents}(obj)) \{
35     \textcolor{keywordflow}{for} (otmp = obj->\hyperlink{structobj_aa7bed832c417657c964b6f5893737586}{cobj}; otmp; otmp = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
36         \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_a716ba3ee00602dede9ea5c68c74d45bd}{oclass} == \hyperlink{structobj_a716ba3ee00602dede9ea5c68c74d45bd}{oclass}) \textcolor{keywordflow}{return} \hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
37         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{obj_8h_ae2e47c7280efe98de2333e8078f8ce71}{Has\_contents}(otmp) && (temp = \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(otmp, \hyperlink{structobj_a716ba3ee00602dede9ea5c68c74d45bd}{oclass})))
38         \textcolor{keywordflow}{return} \hyperlink{makedefs_8c_a1eb0cd7f6bb3372ee8b5373484271c74}{temp};
39     \}
40     \textcolor{keywordflow}{return} (\textcolor{keyword}{struct} obj *) 0;
41 \}
\end{DoxyCode}
\hypertarget{detect_8c_a3482c89460e32650375743a33dbfb8b2}{\index{detect.\+c@{detect.\+c}!o\+\_\+material@{o\+\_\+material}}
\index{o\+\_\+material@{o\+\_\+material}!detect.\+c@{detect.\+c}}
\subsubsection[{o\+\_\+material}]{\setlength{\rightskip}{0pt plus 5cm}struct {\bf obj}$\ast$ o\+\_\+material (
\begin{DoxyParamCaption}
\item[{struct {\bf obj}$\ast$}]{obj, }
\item[{unsigned}]{material}
\end{DoxyParamCaption}
)}}\label{detect_8c_a3482c89460e32650375743a33dbfb8b2}


Definition at line 45 of file detect.\+c.



References obj\+::cobj, Has\+\_\+contents, obj\+::nobj, objects, otmp, obj\+::otyp, and temp.



Referenced by check\+\_\+map\+\_\+spot(), and gold\+\_\+detect().


\begin{DoxyCode}
48 \{
49     \textcolor{keyword}{register} \textcolor{keyword}{struct }obj* \hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
50     \textcolor{keyword}{struct }obj *\hyperlink{makedefs_8c_a1eb0cd7f6bb3372ee8b5373484271c74}{temp};
51 
52     \textcolor{keywordflow}{if} (\hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].oc\_material == material) \textcolor{keywordflow}{return} obj;
53 
54     \textcolor{keywordflow}{if} (\hyperlink{obj_8h_ae2e47c7280efe98de2333e8078f8ce71}{Has\_contents}(obj)) \{
55     \textcolor{keywordflow}{for} (otmp = obj->\hyperlink{structobj_aa7bed832c417657c964b6f5893737586}{cobj}; otmp; otmp = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
56         \textcolor{keywordflow}{if} (\hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].oc\_material == material) \textcolor{keywordflow}{return} \hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
57         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{obj_8h_ae2e47c7280efe98de2333e8078f8ce71}{Has\_contents}(otmp) && (temp = \hyperlink{detect_8c_a3482c89460e32650375743a33dbfb8b2}{o\_material}(otmp, material)))
58         \textcolor{keywordflow}{return} \hyperlink{makedefs_8c_a1eb0cd7f6bb3372ee8b5373484271c74}{temp};
59     \}
60     \textcolor{keywordflow}{return} (\textcolor{keyword}{struct} obj *) 0;
61 \}
\end{DoxyCode}
\hypertarget{detect_8c_a92ef83bacedadaadc85d179db69b6e5f}{\index{detect.\+c@{detect.\+c}!object\+\_\+detect@{object\+\_\+detect}}
\index{object\+\_\+detect@{object\+\_\+detect}!detect.\+c@{detect.\+c}}
\subsubsection[{object\+\_\+detect}]{\setlength{\rightskip}{0pt plus 5cm}int object\+\_\+detect (
\begin{DoxyParamCaption}
\item[{struct {\bf obj}	$\ast$}]{detector, }
\item[{int}]{class}
\end{DoxyParamCaption}
)}}\label{detect_8c_a92ef83bacedadaadc85d179db69b6e5f}


Definition at line 400 of file detect.\+c.



References A\+L\+L\+\_\+\+C\+L\+A\+S\+S\+E\+S, B\+U\+F\+S\+Z, dlevel\+\_\+t\+::buriedobjlist, clear\+\_\+stale\+\_\+map(), cls(), C\+O\+I\+N\+\_\+\+C\+L\+A\+S\+S, C\+O\+L\+N\+O, obj\+::corpsenm, D\+E\+A\+D\+M\+O\+N\+S\+T\+E\+R, def\+\_\+oc\+\_\+syms, display\+\_\+nhwindow, do\+\_\+dknown\+\_\+of(), docrt(), fmon, level, M\+\_\+\+A\+P\+\_\+\+O\+B\+J\+E\+C\+T, monst\+::m\+\_\+ap\+\_\+type, map\+\_\+object(), monst\+::mappearance, M\+A\+X\+O\+C\+L\+A\+S\+S\+E\+S, monst\+::mgold, monst\+::minvent, monst\+::mx, monst\+::my, newsym(), monst\+::nmon, obj\+::nobj, nobj, o\+\_\+in(), objects, dlevel\+\_\+t\+::objects, objclass\+::oc\+\_\+class, obj\+::oclass, otmp, obj\+::otyp, obj\+::ox, obj\+::oy, P\+O\+T\+I\+O\+N\+\_\+\+C\+L\+A\+S\+S, R\+O\+C\+K\+\_\+\+C\+L\+A\+S\+S, R\+O\+W\+N\+O, S\+P\+B\+O\+O\+K\+\_\+\+C\+L\+A\+S\+S, Strcat, Strcpy, T\+R\+U\+E, u, under\+\_\+ground(), under\+\_\+water(), Underwater, you\+::ux, you\+::uy, and W\+I\+N\+\_\+\+M\+A\+P.



Referenced by use\+\_\+crystal\+\_\+ball().


\begin{DoxyCode}
403 \{
404     \textcolor{keyword}{register} \textcolor{keywordtype}{int} x, y;
405     \textcolor{keywordtype}{char} stuff[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
406     \textcolor{keywordtype}{int} is\_cursed = (detector && detector->cursed);
407     \textcolor{keywordtype}{int} do\_dknown = (detector && (detector->\hyperlink{structobj_a716ba3ee00602dede9ea5c68c74d45bd}{oclass} == \hyperlink{objclass_8h_a05335e5ee18dfa33af1c40056fe8fab9}{POTION\_CLASS} ||
408                     detector->\hyperlink{structobj_a716ba3ee00602dede9ea5c68c74d45bd}{oclass} == \hyperlink{objclass_8h_aba5935524b39b0fdd148a3d466a5c580}{SPBOOK\_CLASS}) &&
409             detector->blessed);
410     \textcolor{keywordtype}{int} ct = 0, ctu = 0;
411     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{structobj}{obj}, *\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp} = (\textcolor{keyword}{struct }obj *)0;
412     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp;
413     \textcolor{keywordtype}{int} uw = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater;
414     \textcolor{keywordtype}{int} sym, boulder = 0;
415 
416     \textcolor{keywordflow}{if} (class < 0 || class >= \hyperlink{objclass_8h_af51133138bfb718b55aaa7f29711a10a}{MAXOCLASSES}) \{
417     impossible(\textcolor{stringliteral}{"object\_detect:  illegal class %d"}, \textcolor{keyword}{class});
418     \textcolor{keyword}{class }= 0;
419     \}
420 
421     \textcolor{comment}{/* Special boulder symbol check - does the class symbol happen}
422 \textcolor{comment}{     * to match iflags.bouldersym which is a user-defined?}
423 \textcolor{comment}{     * If so, that means we aren't sure what they really wanted to}
424 \textcolor{comment}{     * detect. Rather than trump anything, show both possibilities.}
425 \textcolor{comment}{     * We can exclude checking the buried obj chain for boulders below.}
426 \textcolor{comment}{     */}
427     sym = \textcolor{keyword}{class }? \hyperlink{decl_8h_ab2de6953c2db763f00d7f3baf830fe50}{def\_oc\_syms}[class] : 0;
428     if (sym && iflags.bouldersym && sym == iflags.bouldersym)
429         boulder = \hyperlink{objclass_8h_aaf0eb1ef8fd79e34747c058357003983}{ROCK\_CLASS};
430 
431     if (Hallucination || (Confusion && class == SCROLL\_CLASS))
432     \hyperlink{global_8h_add22f733d1f2c380499f495068e42b7c}{Strcpy}(stuff, something);
433     else
434         \hyperlink{global_8h_add22f733d1f2c380499f495068e42b7c}{Strcpy}(stuff, class ? oclass\_names[class] : "objects");
435     if (boulder && class != ROCK\_CLASS) \hyperlink{global_8h_a6d985a6c569a61be75fcacf7623f0988}{Strcat}(stuff, " and/or large stones");
436 
437     if (do\_dknown) for(obj = invent; obj; obj = obj->\hyperlink{lev__yacc_8c_a2ab61a372270bf9e1fb46f02f1fb8e0a}{nobj}) \hyperlink{detect_8c_ae607bee8dca5a7435a6e5a0a91f25a13}{do\_dknown\_of}(obj);
438 
439     for (obj = fobj; obj; obj = obj->\hyperlink{lev__yacc_8c_a2ab61a372270bf9e1fb46f02f1fb8e0a}{nobj}) \{
440     \textcolor{keywordflow}{if} ((!\textcolor{keyword}{class} && !boulder) || \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, \textcolor{keyword}{class}) || \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, boulder)) \{
441         \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} && obj->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}) ctu++;
442         \textcolor{keywordflow}{else} ct++;
443     \}
444     \textcolor{keywordflow}{if} (do\_dknown) \hyperlink{detect_8c_ae607bee8dca5a7435a6e5a0a91f25a13}{do\_dknown\_of}(obj);
445     \}
446 
447     \textcolor{keywordflow}{for} (obj = \hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_a3f47ab569a36a0574eb4363915fe2fae}{buriedobjlist}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj}) \{
448     \textcolor{keywordflow}{if} (!\textcolor{keyword}{class} || \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, \textcolor{keyword}{class})) \{
449         \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} && obj->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} == \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}) ctu++;
450         \textcolor{keywordflow}{else} ct++;
451     \}
452     \textcolor{keywordflow}{if} (do\_dknown) \hyperlink{detect_8c_ae607bee8dca5a7435a6e5a0a91f25a13}{do\_dknown\_of}(obj);
453     \}
454 
455     \textcolor{keywordflow}{for} (mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon}; mtmp; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon}) \{
456     \textcolor{keywordflow}{if} (\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp)) \textcolor{keywordflow}{continue};
457     \textcolor{keywordflow}{for} (obj = mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj}) \{
458         \textcolor{keywordflow}{if} ((!\textcolor{keyword}{class} && !boulder) || \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, \textcolor{keyword}{class}) || \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, boulder)) ct++;
459         \textcolor{keywordflow}{if} (do\_dknown) \hyperlink{detect_8c_ae607bee8dca5a7435a6e5a0a91f25a13}{do\_dknown\_of}(obj);
460     \}
461     \textcolor{keywordflow}{if} ((is\_cursed && mtmp->\hyperlink{structmonst_aab8fc9a0be90b4db8333b09487e2620c}{m\_ap\_type} == \hyperlink{monst_8h_a398e3dada51d63d91d8d9a6fb3f90c62}{M\_AP\_OBJECT} &&
462         (!\textcolor{keyword}{class} || \textcolor{keyword}{class} == \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[mtmp->\hyperlink{structmonst_a60ba74caeb4e779b7ccdb99150823bb9}{mappearance}].
      \hyperlink{structobjclass_ae589e91e556e204c84f05597da510559}{oc\_class})) ||
463 #ifndef GOLDOBJ
464         (mtmp->\hyperlink{structmonst_a06dbdd0ca7ee096216aa10f86beed533}{mgold} && (!\textcolor{keyword}{class} || \textcolor{keyword}{class} == \hyperlink{objclass_8h_a2999621925083659147349e261e4cb3d}{COIN\_CLASS}))) \{
465 \textcolor{preprocessor}{#else}
466         (findgold(mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}) && (!\textcolor{keyword}{class }|| class == \hyperlink{objclass_8h_a2999621925083659147349e261e4cb3d}{COIN\_CLASS}))) \{
467 \textcolor{preprocessor}{#endif}
468         ct++;
469         \textcolor{keywordflow}{break};
470     \}
471     \}
472 
473     \textcolor{keywordflow}{if} (!\hyperlink{detect_8c_af6afb66a1f38478d634e4b9aed6b8555}{clear\_stale\_map}(!\textcolor{keyword}{class} ? \hyperlink{objclass_8h_a6ec43df3638569a3e63d44058318540a}{ALL\_CLASSES} : \textcolor{keyword}{class}, 0) && !ct) \{
474     \textcolor{keywordflow}{if} (!ctu) \{
475         \textcolor{keywordflow}{if} (detector)
476         strange\_feeling(detector, \textcolor{stringliteral}{"You feel a lack of something."});
477         \textcolor{keywordflow}{return} 1;
478     \}
479 
480     You(\textcolor{stringliteral}{"sense %s nearby."}, stuff);
481     \textcolor{keywordflow}{return} 0;
482     \}
483 
484     \hyperlink{display_8c_a4826277cc150ddc0f4de4bd464a34909}{cls}();
485 
486     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater = 0;
487 \textcolor{comment}{/*}
488 \textcolor{comment}{ *  Map all buried objects first.}
489 \textcolor{comment}{ */}
490     \textcolor{keywordflow}{for} (obj = \hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_a3f47ab569a36a0574eb4363915fe2fae}{buriedobjlist}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
491     \textcolor{keywordflow}{if} (!\textcolor{keyword}{class} || (otmp = \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, \textcolor{keyword}{class}))) \{
492         \textcolor{keywordflow}{if} (\textcolor{keyword}{class}) \{
493         \textcolor{keywordflow}{if} (otmp != obj) \{
494             otmp->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} = obj->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox};
495             otmp->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} = obj->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy};
496         \}
497         \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(otmp, 1);
498         \} \textcolor{keywordflow}{else}
499         \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(obj, 1);
500     \}
501     \textcolor{comment}{/*}
502 \textcolor{comment}{     * If we are mapping all objects, map only the top object of a pile or}
503 \textcolor{comment}{     * the first object in a monster's inventory.  Otherwise, go looking}
504 \textcolor{comment}{     * for a matching object class and display the first one encountered}
505 \textcolor{comment}{     * at each location.}
506 \textcolor{comment}{     *}
507 \textcolor{comment}{     * Objects on the floor override buried objects.}
508 \textcolor{comment}{     */}
509     \textcolor{keywordflow}{for} (x = 1; x < \hyperlink{global_8h_a308dbfcc29f5a427c0315f3cbf03c3ed}{COLNO}; x++)
510     \textcolor{keywordflow}{for} (y = 0; y < \hyperlink{global_8h_a9cce134868d97b23c35bcf1ff4a343d8}{ROWNO}; y++)
511         \textcolor{keywordflow}{for} (obj = \hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_ac128f805d01d7746b499596dd3b92a53}{objects}[x][y]; obj; obj = obj->nexthere)
512         \textcolor{keywordflow}{if} ((!\textcolor{keyword}{class} && !boulder) ||
513             (otmp = \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, \textcolor{keyword}{class})) || (otmp = \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, boulder))) \{
514             \textcolor{keywordflow}{if} (\textcolor{keyword}{class} || boulder) \{
515             \textcolor{keywordflow}{if} (otmp != obj) \{
516                 otmp->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} = obj->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox};
517                 otmp->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} = obj->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy};
518             \}
519             \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(otmp, 1);
520             \} \textcolor{keywordflow}{else}
521             \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(obj, 1);
522             \textcolor{keywordflow}{break};
523         \}
524 
525     \textcolor{comment}{/* Objects in the monster's inventory override floor objects. */}
526     \textcolor{keywordflow}{for} (mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon} ; mtmp ; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon}) \{
527     \textcolor{keywordflow}{if} (\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp)) \textcolor{keywordflow}{continue};
528     \textcolor{keywordflow}{for} (obj = mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
529         \textcolor{keywordflow}{if} ((!\textcolor{keyword}{class} && !boulder) ||
530          (otmp = \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, \textcolor{keyword}{class})) || (otmp = \hyperlink{detect_8c_a7a9c385e8fe4014a3e0f90b1d40ed793}{o\_in}(obj, boulder))) \{
531         \textcolor{keywordflow}{if} (!\textcolor{keyword}{class} && !boulder) otmp = obj;
532         otmp->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} = mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx};        \textcolor{comment}{/* at monster location */}
533         otmp->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} = mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my};
534         \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(otmp, 1);
535         \textcolor{keywordflow}{break};
536         \}
537     \textcolor{comment}{/* Allow a mimic to override the detected objects it is carrying. */}
538     \textcolor{keywordflow}{if} (is\_cursed && mtmp->\hyperlink{structmonst_aab8fc9a0be90b4db8333b09487e2620c}{m\_ap\_type} == \hyperlink{monst_8h_a398e3dada51d63d91d8d9a6fb3f90c62}{M\_AP\_OBJECT} &&
539         (!\textcolor{keyword}{class} || \textcolor{keyword}{class} == \hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[mtmp->\hyperlink{structmonst_a60ba74caeb4e779b7ccdb99150823bb9}{mappearance}].
      \hyperlink{structobjclass_ae589e91e556e204c84f05597da510559}{oc\_class})) \{
540         \textcolor{keyword}{struct }obj \hyperlink{makedefs_8c_a1eb0cd7f6bb3372ee8b5373484271c74}{temp};
541 
542         \hyperlink{makedefs_8c_a1eb0cd7f6bb3372ee8b5373484271c74}{temp}.otyp = mtmp->\hyperlink{structmonst_a60ba74caeb4e779b7ccdb99150823bb9}{mappearance};   \textcolor{comment}{/* needed for obj\_to\_glyph() */}
543         \hyperlink{makedefs_8c_a1eb0cd7f6bb3372ee8b5373484271c74}{temp}.ox = mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx};
544         \hyperlink{makedefs_8c_a1eb0cd7f6bb3372ee8b5373484271c74}{temp}.oy = mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my};
545         \hyperlink{makedefs_8c_a1eb0cd7f6bb3372ee8b5373484271c74}{temp}.corpsenm = PM\_TENGU;       \textcolor{comment}{/* if mimicing a corpse */}
546         \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(&\hyperlink{makedefs_8c_a1eb0cd7f6bb3372ee8b5373484271c74}{temp}, 1);
547 \textcolor{preprocessor}{#ifndef GOLDOBJ}
548     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (mtmp->\hyperlink{structmonst_a06dbdd0ca7ee096216aa10f86beed533}{mgold} && (!\textcolor{keyword}{class} || \textcolor{keyword}{class} == \hyperlink{objclass_8h_a2999621925083659147349e261e4cb3d}{COIN\_CLASS})) \{
549 \textcolor{preprocessor}{#else}
550     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (findgold(mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent}) && (!\textcolor{keyword}{class} || \textcolor{keyword}{class} == \hyperlink{objclass_8h_a2999621925083659147349e261e4cb3d}{COIN\_CLASS})) \{
551 \textcolor{preprocessor}{#endif}
552         \textcolor{keyword}{struct }obj \hyperlink{structgold}{gold};
553 
554         \hyperlink{structgold}{gold}.otyp = GOLD\_PIECE;
555         \hyperlink{structgold}{gold}.ox = mtmp->\hyperlink{structmonst_a9bc20171e986845daccff8aafd8b5194}{mx};
556         \hyperlink{structgold}{gold}.oy = mtmp->\hyperlink{structmonst_a0b969d9b6af5b55393f6acfe508c6f08}{my};
557         \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(&\hyperlink{structgold}{gold}, 1);
558     \}
559     \}
560 
561     \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux},\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy});
562     You(\textcolor{stringliteral}{"detect the %s of %s."}, ct ? \textcolor{stringliteral}{"presence"} : \textcolor{stringliteral}{"absence"}, stuff);
563     \hyperlink{winprocs_8h_ac8e74d03fbb65b9f5651e63d79bebc60}{display\_nhwindow}(\hyperlink{decl_8h_afa1f7dd312c4c1b72afe3d2c8c2af691}{WIN\_MAP}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
564     \textcolor{comment}{/*}
565 \textcolor{comment}{     * What are we going to do when the hero does an object detect while blind}
566 \textcolor{comment}{     * and the detected object covers a known pool?}
567 \textcolor{comment}{     */}
568     \hyperlink{display_8c_aad46d5a3dee537d403163916114fd463}{docrt}();   \textcolor{comment}{/* this will correctly reset vision */}
569 
570     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater = uw;
571     \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a2eb59bdcba2c368fefd253bfcdaa3673}{Underwater}) \hyperlink{display_8c_a04df1dff0b7b4d1eafd5078265a3d451}{under\_water}(2);
572     \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uburied) \hyperlink{display_8c_af14bb89d2638ab90083214d1f9ed19f4}{under\_ground}(2);
573     \textcolor{keywordflow}{return} 0;
574 \}
\end{DoxyCode}
\hypertarget{detect_8c_a275d1ff7f47d63ac813aef688ce1a713}{\index{detect.\+c@{detect.\+c}!openit@{openit}}
\index{openit@{openit}!detect.\+c@{detect.\+c}}
\subsubsection[{openit}]{\setlength{\rightskip}{0pt plus 5cm}int openit (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{detect_8c_a275d1ff7f47d63ac813aef688ce1a713}


Definition at line 1111 of file detect.\+c.



References Blind, B\+O\+L\+T\+\_\+\+L\+I\+M, monst\+::data, do\+\_\+clear\+\_\+area(), is\+\_\+animal, openone(), T\+R\+U\+E, u, you\+::ustuck, you\+::ux, and you\+::uy.


\begin{DoxyCode}
1112 \{
1113     \textcolor{keywordtype}{int} num = 0;
1114 
1115     \textcolor{keywordflow}{if}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uswallow) \{
1116         \textcolor{keywordflow}{if} (\hyperlink{mondata_8h_a6633b7e5ce3955ef878c6890a72b9392}{is\_animal}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a774d4dad2da130ec9ed1d2e6c5e0fa80}{ustuck}->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data})) \{
1117             \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a1b6e24068169af4177e15b48595c08c9}{Blind}) pline(\textcolor{stringliteral}{"Its mouth opens!"});
1118             \textcolor{keywordflow}{else} pline(\textcolor{stringliteral}{"%s opens its mouth!"}, Monnam(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a774d4dad2da130ec9ed1d2e6c5e0fa80}{ustuck}));
1119         \}
1120         expels(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a774d4dad2da130ec9ed1d2e6c5e0fa80}{ustuck}, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a774d4dad2da130ec9ed1d2e6c5e0fa80}{ustuck}->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
1121         \textcolor{keywordflow}{return}(-1);
1122     \}
1123 
1124     \hyperlink{vision_8c_a1fafbadf4ed6faed2c37e05893ba273e}{do\_clear\_area}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}, \hyperlink{hack_8h_a26ee0a18384e9ca14b97a4f877791284}{BOLT\_LIM}, \hyperlink{detect_8c_a14a42eb445eeb62597da11849b4eb162}{openone}, (
      \hyperlink{tradstdc_8h_ad4a7dab7269b4b00e3c7c7d2e66f31cd}{genericptr\_t}) &num);
1125     \textcolor{keywordflow}{return}(num);
1126 \}
\end{DoxyCode}
\hypertarget{detect_8c_a14a42eb445eeb62597da11849b4eb162}{\index{detect.\+c@{detect.\+c}!openone@{openone}}
\index{openone@{openone}!detect.\+c@{detect.\+c}}
\subsubsection[{openone}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+P\+T\+R} void openone (
\begin{DoxyParamCaption}
\item[{int}]{zx, }
\item[{int}]{zy, }
\item[{{\bf genericptr\+\_\+t}}]{num}
\end{DoxyParamCaption}
)}}\label{detect_8c_a14a42eb445eeb62597da11849b4eb162}


Definition at line 1048 of file detect.\+c.



References cansee, C\+O\+R\+R, cvt\+\_\+sdoor\+\_\+to\+\_\+door(), D\+\_\+\+C\+L\+O\+S\+E\+D, D\+\_\+\+I\+S\+O\+P\+E\+N, D\+\_\+\+L\+O\+C\+K\+E\+D, D\+\_\+\+N\+O\+D\+O\+O\+R, D\+\_\+\+T\+R\+A\+P\+P\+E\+D, distu, D\+O\+O\+R, doormask, flags, Is\+\_\+box, level, levl, newsym(), O\+B\+J\+\_\+\+A\+T, dlevel\+\_\+t\+::objects, otmp, S\+C\+O\+R\+R, S\+D\+O\+O\+R, flag\+::soundok, S\+T\+A\+T\+U\+E\+\_\+\+T\+R\+A\+P, and unblock\+\_\+point().



Referenced by openit().


\begin{DoxyCode}
1051 \{
1052     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structtrap}{trap} *ttmp;
1053     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
1054 
1055     \textcolor{keywordflow}{if}(\hyperlink{rm_8h_a8c5e05f917fa75d3b54c8c5045d6665b}{OBJ\_AT}(zx, zy)) \{
1056         \textcolor{keywordflow}{for}(otmp = \hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_ac128f805d01d7746b499596dd3b92a53}{objects}[zx][zy];
1057                 otmp; otmp = otmp->nexthere) \{
1058             \textcolor{keywordflow}{if}(\hyperlink{obj_8h_a670bbe6ea7092fc0194149cc57131af9}{Is\_box}(otmp) && otmp->olocked) \{
1059             otmp->olocked = 0;
1060             (*(\textcolor{keywordtype}{int}*)num)++;
1061             \}
1062         \}
1063         \textcolor{comment}{/* let it fall to the next cases. could be on trap. */}
1064     \}
1065     \textcolor{keywordflow}{if}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].typ == \hyperlink{rm_8h_a03fd0fa1e0dbd19ea38dff0c79e656a5}{SDOOR} || (\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].typ == \hyperlink{rm_8h_aa19093eb0aa5c5af9c27464ae8f0d2de}{DOOR} &&
1066               (\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].\hyperlink{rm_8h_a745655ee52d1819ea5216d98e685f933}{doormask} & (\hyperlink{rm_8h_a65f9ce7db71ac3d4c13edfe69732ec9a}{D\_CLOSED}|\hyperlink{rm_8h_a0996530515217dfd9f5e12878cb1dc8b}{D\_LOCKED})))) \{
1067         \textcolor{keywordflow}{if}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].typ == \hyperlink{rm_8h_a03fd0fa1e0dbd19ea38dff0c79e656a5}{SDOOR})
1068             \hyperlink{detect_8c_ae1de6d3f46bcb6ad8bd07ca5797a291f}{cvt\_sdoor\_to\_door}(&\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy]);  \textcolor{comment}{/* .typ = DOOR */}
1069         \textcolor{keywordflow}{if}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].\hyperlink{rm_8h_a745655ee52d1819ea5216d98e685f933}{doormask} & \hyperlink{rm_8h_a8e6ade17f05acca6896948b28917e3d2}{D\_TRAPPED}) \{
1070             \textcolor{keywordflow}{if}(\hyperlink{hack_8h_a1f84afcae19c5b60124bc509ed647f84}{distu}(zx, zy) < 3) b\_trapped(\textcolor{stringliteral}{"door"}, 0);
1071             \textcolor{keywordflow}{else} Norep(\textcolor{stringliteral}{"You %s an explosion!"},
1072                 \hyperlink{vision_8h_a857efc720262bc13a9e4b4bcbb079b5c}{cansee}(zx, zy) ? \textcolor{stringliteral}{"see"} :
1073                    (\hyperlink{flag_8h_a997133526e0c6bed44ebc0116a48b50a}{flags}.\hyperlink{structflag_ae3871fd2268fbc24b89cece8eb352dfc}{soundok} ? \textcolor{stringliteral}{"hear"} :
1074                         \textcolor{stringliteral}{"feel the shock of"}));
1075             wake\_nearto(zx, zy, 11*11);
1076             \hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].doormask = \hyperlink{rm_8h_a69d5ca6801252b3e635889365d7b9d28}{D\_NODOOR};
1077         \} \textcolor{keywordflow}{else}
1078             \hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].doormask = \hyperlink{rm_8h_a2b0c9bae4b5dacb4bf4dcd784655c55d}{D\_ISOPEN};
1079         \hyperlink{vision_8c_ae35bdda13dee95d455874551be850a47}{unblock\_point}(zx, zy);
1080         \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(zx, zy);
1081         (*(\textcolor{keywordtype}{int}*)num)++;
1082     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if}(\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].typ == \hyperlink{rm_8h_a35e6fdb78f87c982df30c7e9580ad95d}{SCORR}) \{
1083         \hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[zx][zy].typ = \hyperlink{rm_8h_aeffd57885964c3a9a5c3ce0f81c06339}{CORR};
1084         \hyperlink{vision_8c_ae35bdda13dee95d455874551be850a47}{unblock\_point}(zx, zy);
1085         \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(zx, zy);
1086         (*(\textcolor{keywordtype}{int}*)num)++;
1087     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((ttmp = t\_at(zx, zy)) != 0) \{
1088         \textcolor{keywordflow}{if} (!ttmp->tseen && ttmp->ttyp != \hyperlink{trap_8h_a608095451436b98ee954855f7661802d}{STATUE\_TRAP}) \{
1089             ttmp->tseen = 1;
1090             \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(zx,zy);
1091             (*(\textcolor{keywordtype}{int}*)num)++;
1092         \}
1093     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (find\_drawbridge(&zx, &zy)) \{
1094         \textcolor{comment}{/* make sure it isn't an open drawbridge */}
1095         open\_drawbridge(zx, zy);
1096         (*(\textcolor{keywordtype}{int}*)num)++;
1097     \}
1098 \}
\end{DoxyCode}
\hypertarget{detect_8c_a721910df42d2c5d119bffe5fbcf2afec}{\index{detect.\+c@{detect.\+c}!sense\+\_\+trap@{sense\+\_\+trap}}
\index{sense\+\_\+trap@{sense\+\_\+trap}!detect.\+c@{detect.\+c}}
\subsubsection[{sense\+\_\+trap}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void sense\+\_\+trap (
\begin{DoxyParamCaption}
\item[{struct {\bf trap} $\ast$}]{trap, }
\item[{{\bf xchar}}]{x, }
\item[{{\bf xchar}}]{y, }
\item[{int}]{src\+\_\+cursed}
\end{DoxyParamCaption}
)}}\label{detect_8c_a721910df42d2c5d119bffe5fbcf2afec}


Definition at line 645 of file detect.\+c.



References B\+E\+A\+R\+\_\+\+T\+R\+A\+P, obj\+::corpsenm, Hallucination, map\+\_\+object(), map\+\_\+trap(), obj\+::otyp, obj\+::ox, obj\+::oy, random\+\_\+monster, random\+\_\+object, trap\+::tx, trap\+::ty, trap\+::x, and trap\+::y.



Referenced by trap\+\_\+detect().


\begin{DoxyCode}
649 \{
650     \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_aa873f7ea0a3d096ef94ff651907f7a76}{Hallucination} || src\_cursed) \{
651     \textcolor{keyword}{struct }\hyperlink{structobj}{obj} \hyperlink{structobj}{obj};           \textcolor{comment}{/* fake object */}
652     \textcolor{keywordflow}{if} (trap) \{
653         \hyperlink{structobj}{obj}.\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} = trap->\hyperlink{structtrap_a8a3d31070852119ee66c8662b0c883c7}{tx};
654         \hyperlink{structobj}{obj}.\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} = trap->\hyperlink{structtrap_a579c4f0e2d31e3657c930d6741737b20}{ty};
655     \} \textcolor{keywordflow}{else} \{
656         \hyperlink{structobj}{obj}.\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} = x;
657         \hyperlink{structobj}{obj}.\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} = y;
658     \}
659     \hyperlink{structobj}{obj}.\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} = (src\_cursed) ? GOLD\_PIECE : \hyperlink{display_8h_a067a2f1e90703cc439d97778aee356d7}{random\_object}();
660     \hyperlink{structobj}{obj}.\hyperlink{structobj_ad5db7220e2b815d06c3c80027ab9924f}{corpsenm} = \hyperlink{display_8h_a7bee8693ffbd11a818f0fadcb2e1568a}{random\_monster}();   \textcolor{comment}{/* if otyp == CORPSE */}
661     \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(&\hyperlink{structobj}{obj},1);
662     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (trap) \{
663     \hyperlink{display_8c_ac74653df91c3a6b4f9c35d371bb55e6e}{map\_trap}(trap,1);
664     trap->tseen = 1;
665     \} \textcolor{keywordflow}{else} \{
666     \textcolor{keyword}{struct }trap temp\_trap;      \textcolor{comment}{/* fake trap */}
667     temp\_trap.\hyperlink{structtrap_a8a3d31070852119ee66c8662b0c883c7}{tx} = \hyperlink{structtrap_aed25254cf556e3eae09dd98576d98d45}{x};
668     temp\_trap.ty = \hyperlink{structtrap_a3c7f72724bfcd0c4acb2a05ee75064df}{y};
669     temp\_trap.ttyp = \hyperlink{trap_8h_a8e0f0f3d80f6253a98c39fe9e9ac1a1f}{BEAR\_TRAP};    \textcolor{comment}{/* some kind of trap */}
670     \hyperlink{display_8c_ac74653df91c3a6b4f9c35d371bb55e6e}{map\_trap}(&temp\_trap,1);
671     \}
672 
673 \}
\end{DoxyCode}
\hypertarget{detect_8c_a664d8840dadbb5a3896df395833fc708}{\index{detect.\+c@{detect.\+c}!show\+\_\+map\+\_\+spot@{show\+\_\+map\+\_\+spot}}
\index{show\+\_\+map\+\_\+spot@{show\+\_\+map\+\_\+spot}!detect.\+c@{detect.\+c}}
\subsubsection[{show\+\_\+map\+\_\+spot}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void show\+\_\+map\+\_\+spot (
\begin{DoxyParamCaption}
\item[{int}]{x, }
\item[{int}]{y}
\end{DoxyParamCaption}
)}}\label{detect_8c_a664d8840dadbb5a3896df395833fc708}


Definition at line 911 of file detect.\+c.



References Confusion, C\+O\+R\+R, dlevel\+\_\+t\+::flags, rm\+::glyph, glyph\+\_\+is\+\_\+cmap, glyph\+\_\+is\+\_\+object, glyph\+\_\+is\+\_\+trap, glyph\+\_\+to\+\_\+cmap, level, levl, magic\+\_\+map\+\_\+background(), newsym(), R\+O\+O\+M, S\+C\+O\+R\+R, rm\+::seenv, S\+V\+A\+L\+L, rm\+::typ, and unblock\+\_\+point().



Referenced by do\+\_\+mapping(), and do\+\_\+vicinity\+\_\+map().


\begin{DoxyCode}
913 \{
914     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structrm}{rm} *lev;
915 
916     \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a85174462efda5cc2dc2a49a0249801bb}{Confusion} && rn2(7)) \textcolor{keywordflow}{return};
917     lev = &\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y];
918 
919     lev->\hyperlink{structrm_a34555313c127be5f736123f994cb1770}{seenv} = \hyperlink{rm_8h_a7371c7cf9793ebc9f7b14bc8a0309abc}{SVALL};
920 
921     \textcolor{comment}{/* Secret corridors are found, but not secret doors. */}
922     \textcolor{keywordflow}{if} (lev->\hyperlink{structrm_aa144ade377ba175f037c4e637329d4dc}{typ} == \hyperlink{rm_8h_a35e6fdb78f87c982df30c7e9580ad95d}{SCORR}) \{
923     lev->\hyperlink{structrm_aa144ade377ba175f037c4e637329d4dc}{typ} = \hyperlink{rm_8h_aeffd57885964c3a9a5c3ce0f81c06339}{CORR};
924     \hyperlink{vision_8c_ae35bdda13dee95d455874551be850a47}{unblock\_point}(x,y);
925     \}
926 
927     \textcolor{comment}{/* if we don't remember an object or trap there, map it */}
928     \textcolor{keywordflow}{if} (lev->\hyperlink{structrm_aa144ade377ba175f037c4e637329d4dc}{typ} == \hyperlink{rm_8h_ae635489e987ae17a3bf884376cc2fe34}{ROOM} ?
929         (\hyperlink{display_8h_ae849bd5a5de7fbf41783c5af0d81aecd}{glyph\_is\_cmap}(lev->\hyperlink{structrm_a35df3d254aba2b97739aed75313cbe5c}{glyph}) && !\hyperlink{display_8h_a495f25bc3868092a11dfa723c138b93b}{glyph\_is\_trap}(lev->
      \hyperlink{structrm_a35df3d254aba2b97739aed75313cbe5c}{glyph}) &&
930         \hyperlink{display_8h_a7bbc740e05e67c80b7b7dd81f2dd825d}{glyph\_to\_cmap}(lev->\hyperlink{structrm_a35df3d254aba2b97739aed75313cbe5c}{glyph}) != \hyperlink{rm_8h_ae635489e987ae17a3bf884376cc2fe34}{ROOM}) :
931         (!\hyperlink{display_8h_a5a3c3067dbac4b44ad002fbe980a90dd}{glyph\_is\_object}(lev->\hyperlink{structrm_a35df3d254aba2b97739aed75313cbe5c}{glyph}) && !\hyperlink{display_8h_a495f25bc3868092a11dfa723c138b93b}{glyph\_is\_trap}(lev->
      \hyperlink{structrm_a35df3d254aba2b97739aed75313cbe5c}{glyph}))) \{
932     \textcolor{keywordflow}{if} (\hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_ad52c01d015e2456cdae3300848115916}{flags}.hero\_memory) \{
933         \hyperlink{display_8c_ad4037a0d6b3771e04ffab76d8dc25a65}{magic\_map\_background}(x,y,0);
934         \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(x,y);          \textcolor{comment}{/* show it, if not blocked */}
935     \} \textcolor{keywordflow}{else} \{
936         \hyperlink{display_8c_ad4037a0d6b3771e04ffab76d8dc25a65}{magic\_map\_background}(x,y,1);    \textcolor{comment}{/* display it */}
937     \}
938     \}
939 \}
\end{DoxyCode}
\hypertarget{detect_8c_a6208a524bbc5d637bcaa36dcc63a1ec8}{\index{detect.\+c@{detect.\+c}!sokoban\+\_\+detect@{sokoban\+\_\+detect}}
\index{sokoban\+\_\+detect@{sokoban\+\_\+detect}!detect.\+c@{detect.\+c}}
\subsubsection[{sokoban\+\_\+detect}]{\setlength{\rightskip}{0pt plus 5cm}void sokoban\+\_\+detect (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{detect_8c_a6208a524bbc5d637bcaa36dcc63a1ec8}


Definition at line 1274 of file detect.\+c.



References C\+O\+L\+N\+O, ftrap, level, levl, map\+\_\+background(), map\+\_\+object(), map\+\_\+trap(), trap\+::ntrap, dlevel\+\_\+t\+::objects, obj\+::otyp, R\+O\+W\+N\+O, S\+V\+A\+L\+L, and T\+R\+U\+E.



Referenced by fixup\+\_\+special().


\begin{DoxyCode}
1275 \{
1276     \textcolor{keyword}{register} \textcolor{keywordtype}{int} x, y;
1277     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structtrap}{trap} *ttmp;
1278     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{structobj}{obj};
1279 
1280     \textcolor{comment}{/* Map the background and boulders */}
1281     \textcolor{keywordflow}{for} (x = 1; x < \hyperlink{global_8h_a308dbfcc29f5a427c0315f3cbf03c3ed}{COLNO}; x++)
1282         \textcolor{keywordflow}{for} (y = 0; y < \hyperlink{global_8h_a9cce134868d97b23c35bcf1ff4a343d8}{ROWNO}; y++) \{
1283             \hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].seenv = \hyperlink{rm_8h_a7371c7cf9793ebc9f7b14bc8a0309abc}{SVALL};
1284             \hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].waslit = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
1285             \hyperlink{display_8c_abe2bc3c09d117e9c709ac1c01d73c8fb}{map\_background}(x, y, 1);
1286             \textcolor{keywordflow}{for} (obj = \hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_ac128f805d01d7746b499596dd3b92a53}{objects}[x][y]; obj; obj = obj->nexthere)
1287                 \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == BOULDER)
1288                     \hyperlink{display_8c_a5c4fd462bd2806ee7e870039c75022e4}{map\_object}(obj, 1);
1289         \}
1290 
1291     \textcolor{comment}{/* Map the traps */}
1292     \textcolor{keywordflow}{for} (ttmp = \hyperlink{trap_8h_a442e327ae9fbb5d15e2df82e488de313}{ftrap}; ttmp; ttmp = ttmp->\hyperlink{structtrap_aef8ea4650dce701fde7f7f3e1310c892}{ntrap}) \{
1293         ttmp->tseen = 1;
1294         \hyperlink{display_8c_ac74653df91c3a6b4f9c35d371bb55e6e}{map\_trap}(ttmp, 1);
1295     \}
1296 \}
\end{DoxyCode}
\hypertarget{detect_8c_a26ca894bc3ed71cb998be60d74d91334}{\index{detect.\+c@{detect.\+c}!trap\+\_\+detect@{trap\+\_\+detect}}
\index{trap\+\_\+detect@{trap\+\_\+detect}!detect.\+c@{detect.\+c}}
\subsubsection[{trap\+\_\+detect}]{\setlength{\rightskip}{0pt plus 5cm}int trap\+\_\+detect (
\begin{DoxyParamCaption}
\item[{struct {\bf obj} $\ast$}]{sobj}
\end{DoxyParamCaption}
)}}\label{detect_8c_a26ca894bc3ed71cb998be60d74d91334}


Definition at line 680 of file detect.\+c.



References buf, cls(), D\+\_\+\+T\+R\+A\+P\+P\+E\+D, display\+\_\+nhwindow, docrt(), doorindex, doors, F\+A\+L\+S\+E, fobj, ftrap, levl, newsym(), obj\+::nobj, trap\+::ntrap, obj\+::otyp, obj\+::ox, obj\+::oy, sense\+\_\+trap(), Sprintf, T\+O\+E, T\+R\+U\+E, trap\+::tx, trap\+::ty, u, under\+\_\+ground(), under\+\_\+water(), Underwater, you\+::ux, you\+::uy, W\+I\+N\+\_\+\+M\+A\+P, coord\+::x, and coord\+::y.



Referenced by use\+\_\+crystal\+\_\+ball().


\begin{DoxyCode}
683 \{
684     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structtrap}{trap} *ttmp;
685     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{structobj}{obj};
686     \textcolor{keyword}{register} \textcolor{keywordtype}{int} \hyperlink{structdoor}{door};
687     \textcolor{keywordtype}{int} uw = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater;
688     \textcolor{keywordtype}{boolean} found = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
689     \hyperlink{structcoord}{coord} cc;
690 
691     \textcolor{keywordflow}{for} (ttmp = \hyperlink{trap_8h_a442e327ae9fbb5d15e2df82e488de313}{ftrap}; ttmp; ttmp = ttmp->\hyperlink{structtrap_aef8ea4650dce701fde7f7f3e1310c892}{ntrap}) \{
692     \textcolor{keywordflow}{if} (ttmp->\hyperlink{structtrap_a8a3d31070852119ee66c8662b0c883c7}{tx} != \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} || ttmp->\hyperlink{structtrap_a579c4f0e2d31e3657c930d6741737b20}{ty} != \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy})
693         \textcolor{keywordflow}{goto} outtrapmap;
694     \textcolor{keywordflow}{else} found = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
695     \}
696     \textcolor{keywordflow}{for} (obj = \hyperlink{rm_8h_a4d2866bf9ebea1c08c26174b5c8cfbb7}{fobj}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj}) \{
697     \textcolor{keywordflow}{if} ((obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}==LARGE\_BOX || obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}==CHEST) && obj->otrapped) \{
698         \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox} != \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} || obj->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy} != \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy})
699         \textcolor{keywordflow}{goto} outtrapmap;
700         \textcolor{keywordflow}{else} found = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
701     \}
702     \}
703     \textcolor{keywordflow}{for} (door = 0; door < \hyperlink{decl_8h_a1982a8fa5c64011b962995dac72b6eff}{doorindex}; door++) \{
704     cc = \hyperlink{mkroom_8h_a2f0608010228278f7299277b3a67d492}{doors}[door];
705     \textcolor{keywordflow}{if} (\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[cc.\hyperlink{structcoord_ac3e93ff628aa19d2888c5f6fa26f430d}{x}][cc.\hyperlink{structcoord_a2b099692d87f98e4844b615136ca37fb}{y}].doormask & \hyperlink{rm_8h_a8e6ade17f05acca6896948b28917e3d2}{D\_TRAPPED}) \{
706         \textcolor{keywordflow}{if} (cc.\hyperlink{structcoord_ac3e93ff628aa19d2888c5f6fa26f430d}{x} != \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} || cc.\hyperlink{structcoord_a2b099692d87f98e4844b615136ca37fb}{y} != \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy})
707         \textcolor{keywordflow}{goto} outtrapmap;
708         \textcolor{keywordflow}{else} found = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
709     \}
710     \}
711     \textcolor{keywordflow}{if} (!found) \{
712     \textcolor{keywordtype}{char} \hyperlink{xpm2iff_8c_a6f4b9854141692d23b0d072176044ca6}{buf}[42];
713     \hyperlink{global_8h_aa55ba8f4e3c82fe00035e6b51d6c7dee}{Sprintf}(buf, \textcolor{stringliteral}{"Your %s stop itching."}, makeplural(body\_part(\hyperlink{hack_8h_a6e3739d1e68346bd22d8c862b70c5444}{TOE})));
714     strange\_feeling(sobj,buf);
715     \textcolor{keywordflow}{return}(1);
716     \}
717     \textcolor{comment}{/* traps exist, but only under me - no separate display required */}
718     Your(\textcolor{stringliteral}{"%s itch."}, makeplural(body\_part(\hyperlink{hack_8h_a6e3739d1e68346bd22d8c862b70c5444}{TOE})));
719     \textcolor{keywordflow}{return}(0);
720 outtrapmap:
721     \hyperlink{display_8c_a4826277cc150ddc0f4de4bd464a34909}{cls}();
722 
723     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater = 0;
724     \textcolor{keywordflow}{for} (ttmp = \hyperlink{trap_8h_a442e327ae9fbb5d15e2df82e488de313}{ftrap}; ttmp; ttmp = ttmp->\hyperlink{structtrap_aef8ea4650dce701fde7f7f3e1310c892}{ntrap})
725     \hyperlink{detect_8c_a721910df42d2c5d119bffe5fbcf2afec}{sense\_trap}(ttmp, 0, 0, sobj && sobj->cursed);
726 
727     \textcolor{keywordflow}{for} (obj = \hyperlink{rm_8h_a4d2866bf9ebea1c08c26174b5c8cfbb7}{fobj}; obj; obj = obj->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj})
728     \textcolor{keywordflow}{if} ((obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}==LARGE\_BOX || obj->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}==CHEST) && obj->otrapped)
729     \hyperlink{detect_8c_a721910df42d2c5d119bffe5fbcf2afec}{sense\_trap}((\textcolor{keyword}{struct} \hyperlink{structtrap}{trap} *)0, obj->\hyperlink{structobj_aac936c7da6b4f1eca0a94f75c242e5cc}{ox}, obj->\hyperlink{structobj_a72dace5e678b56ae42c3fb19292e5839}{oy}, sobj && sobj->cursed);
730 
731     \textcolor{keywordflow}{for} (door = 0; door < \hyperlink{decl_8h_a1982a8fa5c64011b962995dac72b6eff}{doorindex}; door++) \{
732     cc = \hyperlink{mkroom_8h_a2f0608010228278f7299277b3a67d492}{doors}[door];
733     \textcolor{keywordflow}{if} (\hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[cc.\hyperlink{structcoord_ac3e93ff628aa19d2888c5f6fa26f430d}{x}][cc.\hyperlink{structcoord_a2b099692d87f98e4844b615136ca37fb}{y}].doormask & D\_TRAPPED)
734     \hyperlink{detect_8c_a721910df42d2c5d119bffe5fbcf2afec}{sense\_trap}((\textcolor{keyword}{struct} \hyperlink{structtrap}{trap} *)0, cc.\hyperlink{structcoord_ac3e93ff628aa19d2888c5f6fa26f430d}{x}, cc.\hyperlink{structcoord_a2b099692d87f98e4844b615136ca37fb}{y}, sobj && sobj->cursed);
735     \}
736 
737     \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux},\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy});
738     You\_feel(\textcolor{stringliteral}{"%s."}, sobj && sobj->cursed ? \textcolor{stringliteral}{"very greedy"} : \textcolor{stringliteral}{"entrapped"});
739     \hyperlink{winprocs_8h_ac8e74d03fbb65b9f5651e63d79bebc60}{display\_nhwindow}(\hyperlink{decl_8h_afa1f7dd312c4c1b72afe3d2c8c2af691}{WIN\_MAP}, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
740     \hyperlink{display_8c_aad46d5a3dee537d403163916114fd463}{docrt}();
741     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uinwater = uw;
742     \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a2eb59bdcba2c368fefd253bfcdaa3673}{Underwater}) \hyperlink{display_8c_a04df1dff0b7b4d1eafd5078265a3d451}{under\_water}(2);
743     \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uburied) \hyperlink{display_8c_af14bb89d2638ab90083214d1f9ed19f4}{under\_ground}(2);
744     \textcolor{keywordflow}{return}(0);
745 \}
\end{DoxyCode}
\hypertarget{detect_8c_a06e5c1bcb4aee50c208dd10d80e8d5bb}{\index{detect.\+c@{detect.\+c}!use\+\_\+crystal\+\_\+ball@{use\+\_\+crystal\+\_\+ball}}
\index{use\+\_\+crystal\+\_\+ball@{use\+\_\+crystal\+\_\+ball}!detect.\+c@{detect.\+c}}
\subsubsection[{use\+\_\+crystal\+\_\+ball}]{\setlength{\rightskip}{0pt plus 5cm}void use\+\_\+crystal\+\_\+ball (
\begin{DoxyParamCaption}
\item[{struct {\bf obj} $\ast$}]{obj}
\end{DoxyParamCaption}
)}}\label{detect_8c_a06e5c1bcb4aee50c208dd10d80e8d5bb}


Definition at line 790 of file detect.\+c.



References A\+\_\+\+I\+N\+T, A\+C\+U\+R\+R, Blind, Blinded, instance\+\_\+flags\+::bouldersym, def\+\_\+char\+\_\+to\+\_\+monclass(), def\+\_\+char\+\_\+to\+\_\+objclass(), D\+E\+F\+\_\+\+M\+I\+M\+I\+C, D\+E\+F\+\_\+\+M\+I\+M\+I\+C\+\_\+\+D\+E\+F, def\+\_\+monsyms, F\+A\+L\+S\+E, flags, Hallucination, H\+Confusion, H\+Hallucination, iflags, index(), K\+I\+L\+L\+E\+D\+\_\+\+B\+Y\+\_\+\+A\+N, level\+\_\+detects, level\+\_\+distance(), makeknown, M\+A\+X\+M\+C\+L\+A\+S\+S\+E\+S, M\+A\+X\+O\+C\+L\+A\+S\+S\+E\+S, monster\+\_\+detect(), Never\+\_\+mind, nomovemsg, object\+\_\+detect(), quitchars, R\+O\+C\+K\+\_\+\+C\+L\+A\+S\+S, S\+\_\+\+G\+H\+O\+S\+T, S\+I\+Z\+E, trap\+\_\+detect(), T\+R\+U\+E, flag\+::verbose, vision\+\_\+clears, what, where, and youmonst.


\begin{DoxyCode}
792 \{
793     \textcolor{keywordtype}{char} ch;
794     \textcolor{keywordtype}{int} oops;
795 
796     \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_a1b6e24068169af4177e15b48595c08c9}{Blind}) \{
797     pline(\textcolor{stringliteral}{"Too bad you can't see %s."}, the(xname(obj)));
798     \textcolor{keywordflow}{return};
799     \}
800     oops = (rnd(20) > \hyperlink{attrib_8h_ab83869fac11f870c2193469440573f84}{ACURR}(\hyperlink{attrib_8h_a583ef0a9b22ce89bcf0df81228b424b5}{A\_INT}) || obj->cursed);
801     \textcolor{keywordflow}{if} (oops && (obj->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe} > 0)) \{
802     \textcolor{keywordflow}{switch} (rnd(obj->\hyperlink{structobj_af03ce8a6a0ca51e8d8954fb1a1a31fbe}{oartifact} ? 4 : 5)) \{
803     \textcolor{keywordflow}{case} 1 : pline(\textcolor{stringliteral}{"%s too much to comprehend!"}, Tobjnam(obj, \textcolor{stringliteral}{"are"}));
804         \textcolor{keywordflow}{break};
805     \textcolor{keywordflow}{case} 2 : pline(\textcolor{stringliteral}{"%s you!"}, Tobjnam(obj, \textcolor{stringliteral}{"confuse"}));
806         make\_confused(\hyperlink{youprop_8h_a7e27468d62b489163905cdc2de895adf}{HConfusion} + rnd(100),\hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
807         \textcolor{keywordflow}{break};
808     \textcolor{keywordflow}{case} 3 : \textcolor{keywordflow}{if} (!resists\_blnd(&\hyperlink{decl_8h_ad15893dbcb60e2777ae0dfac9f840858}{youmonst})) \{
809         pline(\textcolor{stringliteral}{"%s your vision!"}, Tobjnam(obj, \textcolor{stringliteral}{"damage"}));
810         make\_blinded(\hyperlink{youprop_8h_a769ae4ea1360ffb2b8b4679bd129db09}{Blinded} + rnd(100),\hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
811         \textcolor{keywordflow}{if} (!\hyperlink{youprop_8h_a1b6e24068169af4177e15b48595c08c9}{Blind}) Your(\hyperlink{decl_8h_afc711d0b47c16d911b717d063b8dec60}{vision\_clears});
812         \} \textcolor{keywordflow}{else} \{
813         pline(\textcolor{stringliteral}{"%s your vision."}, Tobjnam(obj, \textcolor{stringliteral}{"assault"}));
814         You(\textcolor{stringliteral}{"are unaffected!"});
815         \}
816         \textcolor{keywordflow}{break};
817     \textcolor{keywordflow}{case} 4 : pline(\textcolor{stringliteral}{"%s your mind!"}, Tobjnam(obj, \textcolor{stringliteral}{"zap"}));
818         (void) make\_hallucinated(\hyperlink{youprop_8h_a33f1b522e10eb5005b1077eeb0269f8f}{HHallucination} + rnd(100),\hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE},0L);
819         \textcolor{keywordflow}{break};
820     \textcolor{keywordflow}{case} 5 : pline(\textcolor{stringliteral}{"%s!"}, Tobjnam(obj, \textcolor{stringliteral}{"explode"}));
821         useup(obj);
822         obj = 0;    \textcolor{comment}{/* it's gone */}
823         losehp(rnd(30), \textcolor{stringliteral}{"exploding crystal ball"}, \hyperlink{decl_8h_af4e54910b730baa32b2dfbe4dd2942c1}{KILLED\_BY\_AN});
824         \textcolor{keywordflow}{break};
825     \}
826     \textcolor{keywordflow}{if} (obj) consume\_obj\_charge(obj, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
827     \textcolor{keywordflow}{return};
828     \}
829 
830     \textcolor{keywordflow}{if} (\hyperlink{youprop_8h_aa873f7ea0a3d096ef94ff651907f7a76}{Hallucination}) \{
831     \textcolor{keywordflow}{if} (!obj->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe}) \{
832         pline(\textcolor{stringliteral}{"All you see is funky %s haze."}, hcolor((\textcolor{keywordtype}{char} *)0));
833     \} \textcolor{keywordflow}{else} \{
834         \textcolor{keywordflow}{switch}(rnd(6)) \{
835         \textcolor{keywordflow}{case} 1 : You(\textcolor{stringliteral}{"grok some groovy globs of incandescent lava."});
836         \textcolor{keywordflow}{break};
837         \textcolor{keywordflow}{case} 2 : pline(\textcolor{stringliteral}{"Whoa!  Psychedelic colors, %s!"},
838                poly\_gender() == 1 ? \textcolor{stringliteral}{"babe"} : \textcolor{stringliteral}{"dude"});
839         \textcolor{keywordflow}{break};
840         \textcolor{keywordflow}{case} 3 : pline\_The(\textcolor{stringliteral}{"crystal pulses with sinister %s light!"},
841                 hcolor((\textcolor{keywordtype}{char} *)0));
842         \textcolor{keywordflow}{break};
843         \textcolor{keywordflow}{case} 4 : You(\textcolor{stringliteral}{"see goldfish swimming above fluorescent rocks."});
844         \textcolor{keywordflow}{break};
845         \textcolor{keywordflow}{case} 5 : You(\textcolor{stringliteral}{"see tiny snowflakes spinning around a miniature farmhouse."});
846         \textcolor{keywordflow}{break};
847         \textcolor{keywordflow}{default}: pline(\textcolor{stringliteral}{"Oh wow... like a kaleidoscope!"});
848         \textcolor{keywordflow}{break};
849         \}
850         consume\_obj\_charge(obj, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
851     \}
852     \textcolor{keywordflow}{return};
853     \}
854 
855     \textcolor{comment}{/* read a single character */}
856     \textcolor{keywordflow}{if} (\hyperlink{flag_8h_a997133526e0c6bed44ebc0116a48b50a}{flags}.\hyperlink{structflag_afd7dfe45d35356d861ab5e9834231929}{verbose}) You(\textcolor{stringliteral}{"may look for an object or monster symbol."});
857     ch = yn\_function(\textcolor{stringliteral}{"What do you look for?"}, (\textcolor{keywordtype}{char} *)0, \textcolor{charliteral}{'\(\backslash\)0'});
858     \textcolor{comment}{/* Don't filter out ' ' here; it has a use */}
859     \textcolor{keywordflow}{if} ((ch != \hyperlink{decl_8h_a3de70854a5691ea43068787e1f9e44cf}{def\_monsyms}[\hyperlink{monsym_8h_a6a49698b20c68f36bcef22d45c3ef986}{S\_GHOST}]) && \hyperlink{uudecode_8c_ac82f3cc16110a05458f2b2483236afb7}{index}(\hyperlink{decl_8h_acf3ecfe1055b7bede365ef39613f2b7c}{quitchars},ch)) \{ 
860     \textcolor{keywordflow}{if} (\hyperlink{flag_8h_a997133526e0c6bed44ebc0116a48b50a}{flags}.\hyperlink{structflag_afd7dfe45d35356d861ab5e9834231929}{verbose}) pline(\hyperlink{decl_8h_acb87d027cf5540d045f904097a40f5f8}{Never\_mind});
861     \textcolor{keywordflow}{return};
862     \}
863     You(\textcolor{stringliteral}{"peer into %s..."}, the(xname(obj)));
864     nomul(-rnd(10));
865     \hyperlink{decl_8h_a03b001040702c25afae477b18b1692c3}{nomovemsg} = \textcolor{stringliteral}{""};
866     \textcolor{keywordflow}{if} (obj->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe} <= 0)
867     pline\_The(\textcolor{stringliteral}{"vision is unclear."});
868     \textcolor{keywordflow}{else} \{
869     \textcolor{keywordtype}{int} \textcolor{keyword}{class};
870     \textcolor{keywordtype}{int} ret = 0;
871 
872     \hyperlink{hack_8h_afbd3607e7cef2f888f4190d40d058011}{makeknown}(CRYSTAL\_BALL);
873     consume\_obj\_charge(obj, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
874 
875     \textcolor{comment}{/* special case: accept ']' as synonym for mimic}
876 \textcolor{comment}{     * we have to do this before the def\_char\_to\_objclass check}
877 \textcolor{comment}{     */}
878     \textcolor{keywordflow}{if} (ch == \hyperlink{monsym_8h_a0d2c2e8913abf186ddb41fb70de299bf}{DEF\_MIMIC\_DEF}) ch = \hyperlink{monsym_8h_aab08ca9a47dbba7cd7c12f9d8da83512}{DEF\_MIMIC};
879 
880     \textcolor{keywordflow}{if} ((\textcolor{keyword}{class} = \hyperlink{drawing_8c_a590c649cc5a0ec129bc65368e7202b55}{def\_char\_to\_objclass}(ch)) != \hyperlink{objclass_8h_af51133138bfb718b55aaa7f29711a10a}{MAXOCLASSES})
881         ret = \hyperlink{detect_8c_a92ef83bacedadaadc85d179db69b6e5f}{object\_detect}((\textcolor{keyword}{struct} obj *)0, \textcolor{keyword}{class});
882     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} ((\textcolor{keyword}{class} = \hyperlink{drawing_8c_a96d46e83653ce0f583dbced270cdf106}{def\_char\_to\_monclass}(ch)) != 
      \hyperlink{monsym_8h_a8c6bb361baecfba17240e1e0af655e1b}{MAXMCLASSES})
883         ret = \hyperlink{detect_8c_a24bcd3e85852ee1ee1088447f7273755}{monster\_detect}((\textcolor{keyword}{struct} obj *)0, \textcolor{keyword}{class});
884     \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{flag_8h_ae9cd54937dcb00432131e49e5e324075}{iflags}.\hyperlink{structinstance__flags_a13b4941aee2fefcb8d1d6a24b77396a3}{bouldersym} && (ch == \hyperlink{flag_8h_ae9cd54937dcb00432131e49e5e324075}{iflags}.\hyperlink{structinstance__flags_a13b4941aee2fefcb8d1d6a24b77396a3}{bouldersym}))
885         ret = \hyperlink{detect_8c_a92ef83bacedadaadc85d179db69b6e5f}{object\_detect}((\textcolor{keyword}{struct} obj *)0, \hyperlink{objclass_8h_aaf0eb1ef8fd79e34747c058357003983}{ROCK\_CLASS});
886     \textcolor{keywordflow}{else} \textcolor{keywordflow}{switch}(ch) \{
887         \textcolor{keywordflow}{case} \textcolor{charliteral}{'^'}:
888             ret = \hyperlink{detect_8c_a26ca894bc3ed71cb998be60d74d91334}{trap\_detect}((\textcolor{keyword}{struct} obj *)0);
889             \textcolor{keywordflow}{break};
890         \textcolor{keywordflow}{default}:
891             \{
892             \textcolor{keywordtype}{int} i = rn2(\hyperlink{global_8h_afd2537d19a3cb6556b0f727580ec6ee7}{SIZE}(\hyperlink{detect_8c_a701c9b5465f0123c8020466497624f6c}{level\_detects}));
893             You(\textcolor{stringliteral}{"see %s, %s."},
894             \hyperlink{detect_8c_a701c9b5465f0123c8020466497624f6c}{level\_detects}[i].\hyperlink{detect_8c_a951a98f1e2d69ca61adcd53c0f8faca3}{what},
895             \hyperlink{detect_8c_a76c278fd0bdb5a50382c6390dfa1409a}{level\_distance}(\hyperlink{detect_8c_a701c9b5465f0123c8020466497624f6c}{level\_detects}[i].\hyperlink{detect_8c_a8201fc0bfa35306851be2a25ab2d6263}{where}));
896             \}
897             ret = 0;
898             \textcolor{keywordflow}{break};
899     \}
900 
901     \textcolor{keywordflow}{if} (ret) \{
902         \textcolor{keywordflow}{if} (!rn2(100))  \textcolor{comment}{/* make them nervous */}
903         You(\textcolor{stringliteral}{"see the Wizard of Yendor gazing out at you."});
904         \textcolor{keywordflow}{else} pline\_The(\textcolor{stringliteral}{"vision is unclear."});
905     \}
906     \}
907     \textcolor{keywordflow}{return};
908 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{detect_8c_a2373e3a270d2b530119452501548080a}{\index{detect.\+c@{detect.\+c}!known@{known}}
\index{known@{known}!detect.\+c@{detect.\+c}}
\subsubsection[{known}]{\setlength{\rightskip}{0pt plus 5cm}{\bf boolean} known}}\label{detect_8c_a2373e3a270d2b530119452501548080a}


Referenced by food\+\_\+detect(), gold\+\_\+detect(), and use\+\_\+defensive().

\hypertarget{detect_8c_a701c9b5465f0123c8020466497624f6c}{\index{detect.\+c@{detect.\+c}!level\+\_\+detects@{level\+\_\+detects}}
\index{level\+\_\+detects@{level\+\_\+detects}!detect.\+c@{detect.\+c}}
\subsubsection[{level\+\_\+detects}]{\setlength{\rightskip}{0pt plus 5cm}const \{ ... \}   level\+\_\+detects\mbox{[}$\,$\mbox{]}\hspace{0.3cm}{\ttfamily [static]}}}\label{detect_8c_a701c9b5465f0123c8020466497624f6c}
{\bfseries Initial value\+:}
\begin{DoxyCode}
= \{
  \{ \textcolor{stringliteral}{"Delphi"}, &\hyperlink{decl_8h_a88d80dae8fd8c7863cc9fd422aa6dc02}{oracle\_level} \},
  \{ \textcolor{stringliteral}{"Medusa's lair"}, &\hyperlink{decl_8h_ad834c4abc150f144d9da7641e53cfcde}{medusa\_level} \},
  \{ \textcolor{stringliteral}{"a castle"}, &\hyperlink{decl_8h_a4e54fc4d32ee936ad6575e637fdf1a5c}{stronghold\_level} \},
  \{ \textcolor{stringliteral}{"the Wizard of Yendor's tower"}, &\hyperlink{decl_8h_abdaabae046b547407ef448fac3dcc922}{wiz1\_level} \},
\}
\end{DoxyCode}


Referenced by use\+\_\+crystal\+\_\+ball().

\hypertarget{detect_8c_a951a98f1e2d69ca61adcd53c0f8faca3}{\index{detect.\+c@{detect.\+c}!what@{what}}
\index{what@{what}!detect.\+c@{detect.\+c}}
\subsubsection[{what}]{\setlength{\rightskip}{0pt plus 5cm}{\bf const} char$\ast$ what}}\label{detect_8c_a951a98f1e2d69ca61adcd53c0f8faca3}


Definition at line 780 of file detect.\+c.



Referenced by fix\+\_\+worst\+\_\+trouble(), food\+\_\+detect(), hmon\+\_\+hitmon(), impact\+\_\+drop(), kickstr(), mar\+\_\+set\+\_\+rogue(), pickup(), stumble\+\_\+onto\+\_\+mimic(), use\+\_\+crystal\+\_\+ball(), and wield\+\_\+tool().

\hypertarget{detect_8c_a8201fc0bfa35306851be2a25ab2d6263}{\index{detect.\+c@{detect.\+c}!where@{where}}
\index{where@{where}!detect.\+c@{detect.\+c}}
\subsubsection[{where}]{\setlength{\rightskip}{0pt plus 5cm}{\bf d\+\_\+level}$\ast$ where}}\label{detect_8c_a8201fc0bfa35306851be2a25ab2d6263}


Definition at line 781 of file detect.\+c.



Referenced by carry\+\_\+count(), done(), event\+Loop(), mac\+Click\+Term(), mac\+Cursor\+Term(), obj\+\_\+delivery(), open\+\_\+levelfile(), query\+\_\+classes(), and use\+\_\+crystal\+\_\+ball().

