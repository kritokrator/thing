\hypertarget{bones_8c}{\section{nethack/src/bones.c File Reference}
\label{bones_8c}\index{nethack/src/bones.\+c@{nethack/src/bones.\+c}}
}
{\ttfamily \#include \char`\"{}hack.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}lev.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} \hyperlink{bones_8c_ab622a98920d32b052af4f2e7bae186c6}{F\+D\+E\+C\+L} (\hyperlink{bones_8c_a22df165bcc8acdd69f568b9abe5e883e}{no\+\_\+bones\+\_\+level},(\hyperlink{structd__level}{d\+\_\+level} $\ast$))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{bones_8c_a14daf90e4b91f206ee42b0e8ecae7f35}{F\+D\+E\+C\+L} (\hyperlink{bones_8c_afded3e2e4c2d2947d6026923d35a45e7}{goodfruit},(int))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{bones_8c_aa03ea8923fbf7a60a8b44a6129e3581c}{F\+D\+E\+C\+L} (\hyperlink{bones_8c_a6c677e6be28512ef74ab3c1af5ffc1a7}{resetobjs},(struct \hyperlink{structobj}{obj} $\ast$, \hyperlink{wingem1_8c_aa2723cc3af18a5199ab4ce7cca84d82b}{B\+O\+O\+L\+E\+A\+N\+\_\+\+P}))
\item 
\hyperlink{hack_8h_a0c2ce0eef98596c51b3a10e50a29dd5e}{S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void \hyperlink{bones_8c_a166fe94ef95a064d4934c70633165a11}{F\+D\+E\+C\+L} (\hyperlink{bones_8c_a98618383f52f14f6fdc928c13a638fa1}{drop\+\_\+upon\+\_\+death},(struct \hyperlink{structmonst}{monst} $\ast$, struct \hyperlink{structobj}{obj} $\ast$))
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} \hyperlink{bones_8c_a22df165bcc8acdd69f568b9abe5e883e}{no\+\_\+bones\+\_\+level} (\hyperlink{structd__level}{d\+\_\+level} $\ast$lev)
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{bones_8c_afded3e2e4c2d2947d6026923d35a45e7}{goodfruit} (int id)
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{bones_8c_a6c677e6be28512ef74ab3c1af5ffc1a7}{resetobjs} (struct \hyperlink{structobj}{obj} $\ast$ochain, \hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} restore)
\item 
\hyperlink{hack_8h_a6584b0687fb4e0040a85bbcdaa3e0ee1}{S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void \hyperlink{bones_8c_a98618383f52f14f6fdc928c13a638fa1}{drop\+\_\+upon\+\_\+death} (struct \hyperlink{structmonst}{monst} $\ast$mtmp, struct \hyperlink{structobj}{obj} $\ast$cont)
\item 
\hyperlink{global_8h_a531b10dd351aa162d7dcccd1966308b8}{boolean} \hyperlink{bones_8c_a1fd15580e0b84acfbb6e6de030a78290}{can\+\_\+make\+\_\+bones} ()
\item 
void \hyperlink{bones_8c_aaa45d59230d30fec700f7a97fd5aafda}{savebones} (struct \hyperlink{structobj}{obj} $\ast$corpse)
\item 
int \hyperlink{bones_8c_a3ea0150187f749027ae1c669b60e3fcc}{getbones} ()
\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
char \hyperlink{bones_8c_a2f969fbc0e4886ed7141c90431e764bb}{bones} \mbox{[}$\,$\mbox{]}
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\hypertarget{bones_8c_a1fd15580e0b84acfbb6e6de030a78290}{\index{bones.\+c@{bones.\+c}!can\+\_\+make\+\_\+bones@{can\+\_\+make\+\_\+bones}}
\index{can\+\_\+make\+\_\+bones@{can\+\_\+make\+\_\+bones}!bones.\+c@{bones.\+c}}
\subsubsection[{can\+\_\+make\+\_\+bones}]{\setlength{\rightskip}{0pt plus 5cm}{\bf boolean} can\+\_\+make\+\_\+bones (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{bones_8c_a1fd15580e0b84acfbb6e6de030a78290}


Definition at line 162 of file bones.\+c.



References discover, F\+A\+L\+S\+E, ftrap, M\+A\+G\+I\+C\+\_\+\+P\+O\+R\+T\+A\+L, no\+\_\+bones\+\_\+level(), trap\+::ntrap, T\+R\+U\+E, u, you\+::uz, wizard, and W\+I\+Z\+A\+R\+D.



Referenced by done().


\begin{DoxyCode}
163 \{
164     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structtrap}{trap} *ttmp;
165 
166     \textcolor{keywordflow}{if} (ledger\_no(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}) <= 0 || ledger\_no(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}) > maxledgerno())
167         \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
168     \textcolor{keywordflow}{if} (\hyperlink{bones_8c_a22df165bcc8acdd69f568b9abe5e883e}{no\_bones\_level}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}))
169         \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};      \textcolor{comment}{/* no bones for specific levels */}
170     \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.uswallow) \{
171         \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};      \textcolor{comment}{/* no bones when swallowed */}
172     \}
173     \textcolor{keywordflow}{if} (!Is\_branchlev(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz})) \{
174         \textcolor{comment}{/* no bones on non-branches with portals */}
175         \textcolor{keywordflow}{for}(ttmp = \hyperlink{trap_8h_a442e327ae9fbb5d15e2df82e488de313}{ftrap}; ttmp; ttmp = ttmp->\hyperlink{structtrap_aef8ea4650dce701fde7f7f3e1310c892}{ntrap})
176         \textcolor{keywordflow}{if} (ttmp->ttyp == \hyperlink{trap_8h_a64bfa610e12179ef4bfa46c65166b2fe}{MAGIC\_PORTAL}) \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
177     \}
178 
179     \textcolor{keywordflow}{if}(depth(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}) <= 0 ||      \textcolor{comment}{/* bulletproofing for endgame */}
180        (!rn2(1 + (depth(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz})>>2))  \textcolor{comment}{/* fewer ghosts on low levels */}
181 #ifdef \hyperlink{config_8h_a7d25468f2993889250dd6664a4e6b011}{WIZARD}
182         && !\hyperlink{flag_8h_a5f48dc2f029e22c05489fb20a491db4b}{wizard}
183 #endif
184         )) \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
185     \textcolor{comment}{/* don't let multiple restarts generate multiple copies of objects}
186 \textcolor{comment}{     * in bones files */}
187     \textcolor{keywordflow}{if} (\hyperlink{flag_8h_adb6a5941e60dcb9dff8f2230d31180f9}{discover}) \textcolor{keywordflow}{return} \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
188     \textcolor{keywordflow}{return} \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
189 \}
\end{DoxyCode}
\hypertarget{bones_8c_a98618383f52f14f6fdc928c13a638fa1}{\index{bones.\+c@{bones.\+c}!drop\+\_\+upon\+\_\+death@{drop\+\_\+upon\+\_\+death}}
\index{drop\+\_\+upon\+\_\+death@{drop\+\_\+upon\+\_\+death}!bones.\+c@{bones.\+c}}
\subsubsection[{drop\+\_\+upon\+\_\+death}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void drop\+\_\+upon\+\_\+death (
\begin{DoxyParamCaption}
\item[{struct {\bf monst} $\ast$}]{mtmp, }
\item[{struct {\bf obj} $\ast$}]{cont}
\end{DoxyParamCaption}
)}}\label{bones_8c_a98618383f52f14f6fdc928c13a638fa1}


Definition at line 122 of file bones.\+c.



References goodfruit(), invent, otmp, obj\+::otyp, obj\+::owornmask, obj\+::owt, obj\+::spe, T\+R\+U\+E, u, you\+::ugold, uswapwep, you\+::ux, and you\+::uy.



Referenced by savebones().


\begin{DoxyCode}
125 \{
126     \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
127 
128     \hyperlink{decl_8h_ab2586a729017fc01f4612808c80c1945}{uswapwep} = 0; \textcolor{comment}{/* ensure curse() won't cause swapwep to drop twice */}
129     \textcolor{keywordflow}{while} ((otmp = \hyperlink{decl_8h_a65d03deeacf265a14fa3af961820b33f}{invent}) != 0) \{
130         obj\_extract\_self(otmp);
131         obj\_no\_longer\_held(otmp);
132 
133         otmp->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} = 0;
134         \textcolor{comment}{/* lamps don't go out when dropped */}
135         \textcolor{keywordflow}{if} ((cont || artifact\_light(otmp)) && obj\_is\_burning(otmp))
136             end\_burn(otmp, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});   \textcolor{comment}{/* smother in statue */}
137 
138         \textcolor{keywordflow}{if}(otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == SLIME\_MOLD) \hyperlink{bones_8c_afded3e2e4c2d2947d6026923d35a45e7}{goodfruit}(otmp->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe});
139 
140         \textcolor{keywordflow}{if}(rn2(5)) curse(otmp);
141         \textcolor{keywordflow}{if} (mtmp)
142             (void) add\_to\_minv(mtmp, otmp);
143         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (cont)
144             (void) add\_to\_container(cont, otmp);
145         \textcolor{keywordflow}{else}
146             place\_object(otmp, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy});
147     \}
148 \textcolor{preprocessor}{#ifndef GOLDOBJ}
149     \textcolor{keywordflow}{if}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_af666e1fd44c5efe34df9053aef068245}{ugold}) \{
150         \textcolor{keywordtype}{long} ugold = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_af666e1fd44c5efe34df9053aef068245}{ugold};
151         \textcolor{keywordflow}{if} (mtmp) mtmp->\hyperlink{structmonst_a06dbdd0ca7ee096216aa10f86beed533}{mgold} = ugold;
152         \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (cont) (void) add\_to\_container(cont, mkgoldobj(ugold));
153         \textcolor{keywordflow}{else} (\textcolor{keywordtype}{void})mkgold(ugold, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy});
154         \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_af666e1fd44c5efe34df9053aef068245}{ugold} = ugold;  \textcolor{comment}{/* undo mkgoldobj()'s removal */}
155     \}
156 \textcolor{preprocessor}{#endif}
157     \textcolor{keywordflow}{if} (cont) cont->\hyperlink{structobj_a606b1d5b273b814049cc1b1991adfeec}{owt} = weight(cont);
158 \}
\end{DoxyCode}
\hypertarget{bones_8c_ab622a98920d32b052af4f2e7bae186c6}{\index{bones.\+c@{bones.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!bones.\+c@{bones.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} {\bf boolean} F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf no\+\_\+bones\+\_\+level}}]{, }
\item[{({\bf d\+\_\+level} $\ast$)}]{}
\end{DoxyParamCaption}
)}}\label{bones_8c_ab622a98920d32b052af4f2e7bae186c6}
\hypertarget{bones_8c_a14daf90e4b91f206ee42b0e8ecae7f35}{\index{bones.\+c@{bones.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!bones.\+c@{bones.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf goodfruit}}]{, }
\item[{(int)}]{}
\end{DoxyParamCaption}
)}}\label{bones_8c_a14daf90e4b91f206ee42b0e8ecae7f35}
\hypertarget{bones_8c_aa03ea8923fbf7a60a8b44a6129e3581c}{\index{bones.\+c@{bones.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!bones.\+c@{bones.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf resetobjs}}]{, }
\item[{(struct {\bf obj} $\ast$, {\bf B\+O\+O\+L\+E\+A\+N\+\_\+\+P})}]{}
\end{DoxyParamCaption}
)}}\label{bones_8c_aa03ea8923fbf7a60a8b44a6129e3581c}
\hypertarget{bones_8c_a166fe94ef95a064d4934c70633165a11}{\index{bones.\+c@{bones.\+c}!F\+D\+E\+C\+L@{F\+D\+E\+C\+L}}
\index{F\+D\+E\+C\+L@{F\+D\+E\+C\+L}!bones.\+c@{bones.\+c}}
\subsubsection[{F\+D\+E\+C\+L}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+D\+C\+L} void F\+D\+E\+C\+L (
\begin{DoxyParamCaption}
\item[{{\bf drop\+\_\+upon\+\_\+death}}]{, }
\item[{(struct {\bf monst} $\ast$, struct {\bf obj} $\ast$)}]{}
\end{DoxyParamCaption}
)}}\label{bones_8c_a166fe94ef95a064d4934c70633165a11}
\hypertarget{bones_8c_a3ea0150187f749027ae1c669b60e3fcc}{\index{bones.\+c@{bones.\+c}!getbones@{getbones}}
\index{getbones@{getbones}!bones.\+c@{bones.\+c}}
\subsubsection[{getbones}]{\setlength{\rightskip}{0pt plus 5cm}int getbones (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{bones_8c_a3ea0150187f749027ae1c669b60e3fcc}


Definition at line 375 of file bones.\+c.



References bones, B\+U\+F\+S\+Z, dlevel\+\_\+t\+::buriedobjlist, close(), compress\+\_\+bonesfile(), monst\+::data, D\+E\+F\+U\+N\+C\+T\+\_\+\+M\+O\+N\+S\+T\+E\+R, delete\+\_\+bonesfile(), discover, F\+A\+L\+S\+E, fmon, fobj, getlev(), level, monst\+::mhpmax, monst\+::minvent, permonst\+::mname, mread(), monst\+::nmon, no\+\_\+bones\+\_\+level(), open\+\_\+bonesfile(), resetobjs(), Sprintf, trickery(), T\+R\+U\+E, u, uptodate(), you\+::uz, wizard, W\+I\+Z\+A\+R\+D, and yn.



Referenced by mklev().


\begin{DoxyCode}
376 \{
377     \textcolor{keyword}{register} \textcolor{keywordtype}{int} fd;
378     \textcolor{keyword}{register} \textcolor{keywordtype}{int} ok;
379     \textcolor{keywordtype}{char} c, *bonesid, oldbonesid[10];
380 
381     \textcolor{keywordflow}{if}(\hyperlink{flag_8h_adb6a5941e60dcb9dff8f2230d31180f9}{discover})        \textcolor{comment}{/* save bones files for real games */}
382         \textcolor{keywordflow}{return}(0);
383 
384     \textcolor{comment}{/* wizard check added by GAN 02/05/87 */}
385     \textcolor{keywordflow}{if}(rn2(3)   \textcolor{comment}{/* only once in three times do we find bones */}
386 #ifdef \hyperlink{config_8h_a7d25468f2993889250dd6664a4e6b011}{WIZARD}
387         && !\hyperlink{flag_8h_a5f48dc2f029e22c05489fb20a491db4b}{wizard}
388 #endif
389         ) \textcolor{keywordflow}{return}(0);
390     \textcolor{keywordflow}{if}(\hyperlink{bones_8c_a22df165bcc8acdd69f568b9abe5e883e}{no\_bones\_level}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz})) \textcolor{keywordflow}{return}(0);
391     fd = \hyperlink{files_8c_a7d258860f78390865f62e2205374082f}{open\_bonesfile}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}, &bonesid);
392     \textcolor{keywordflow}{if} (fd < 0) \textcolor{keywordflow}{return}(0);
393 
394     \textcolor{keywordflow}{if} ((ok = \hyperlink{version_8c_a058fe6d05cab8d612e8f622186b83693}{uptodate}(fd, \hyperlink{bones_8c_a2f969fbc0e4886ed7141c90431e764bb}{bones})) == 0) \{
395 \textcolor{preprocessor}{#ifdef WIZARD}
396         \textcolor{keywordflow}{if} (!\hyperlink{flag_8h_a5f48dc2f029e22c05489fb20a491db4b}{wizard})
397 \textcolor{preprocessor}{#endif}
398         pline(\textcolor{stringliteral}{"Discarding unuseable bones; no need to panic..."});
399     \} \textcolor{keywordflow}{else} \{
400 \textcolor{preprocessor}{#ifdef WIZARD}
401         \textcolor{keywordflow}{if}(\hyperlink{flag_8h_a5f48dc2f029e22c05489fb20a491db4b}{wizard})  \{
402             \textcolor{keywordflow}{if}(\hyperlink{hack_8h_a22ffd7fa35549db318337a497c38a1ae}{yn}(\textcolor{stringliteral}{"Get bones?"}) == \textcolor{charliteral}{'n'}) \{
403                 (void) \hyperlink{wceconf_8h_aaf66f9bf47dbed159bf1a600f11c785e}{close}(fd);
404                 \hyperlink{files_8c_a6ecb145d3bc4237de33261102e576a19}{compress\_bonesfile}();
405                 \textcolor{keywordflow}{return}(0);
406             \}
407         \}
408 \textcolor{preprocessor}{#endif}
409         \hyperlink{restore_8c_a4ca409c62ced3355b984139d6499732c}{mread}(fd, (\hyperlink{tradstdc_8h_ad4a7dab7269b4b00e3c7c7d2e66f31cd}{genericptr\_t}) &c, \textcolor{keyword}{sizeof} c);    \textcolor{comment}{/* length incl. '\(\backslash\)0' */}
410         \hyperlink{restore_8c_a4ca409c62ced3355b984139d6499732c}{mread}(fd, (\hyperlink{tradstdc_8h_ad4a7dab7269b4b00e3c7c7d2e66f31cd}{genericptr\_t}) oldbonesid, (\textcolor{keywordtype}{unsigned}) c); \textcolor{comment}{/* DD.nnn */}
411         \textcolor{keywordflow}{if} (strcmp(bonesid, oldbonesid) != 0) \{
412             \textcolor{keywordtype}{char} errbuf[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
413 
414             \hyperlink{global_8h_aa55ba8f4e3c82fe00035e6b51d6c7dee}{Sprintf}(errbuf, \textcolor{stringliteral}{"This is bones level '%s', not '%s'!"},
415                 oldbonesid, bonesid);
416 \textcolor{preprocessor}{#ifdef WIZARD}
417             \textcolor{keywordflow}{if} (\hyperlink{flag_8h_a5f48dc2f029e22c05489fb20a491db4b}{wizard}) \{
418                 pline(\textcolor{stringliteral}{"%s"}, errbuf);
419                 ok = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};    \textcolor{comment}{/* won't die of trickery */}
420             \}
421 \textcolor{preprocessor}{#endif}
422             \hyperlink{restore_8c_a3418c2e55f272194ad0d941d453e3879}{trickery}(errbuf);
423         \} \textcolor{keywordflow}{else} \{
424             \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp;
425 
426             \hyperlink{restore_8c_ab39927b02273a97a807663df0d02d0f4}{getlev}(fd, 0, 0, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
427 
428             \textcolor{comment}{/* Note that getlev() now keeps tabs on unique}
429 \textcolor{comment}{             * monsters such as demon lords, and tracks the}
430 \textcolor{comment}{             * birth counts of all species just as makemon()}
431 \textcolor{comment}{             * does.  If a bones monster is extinct or has been}
432 \textcolor{comment}{             * subject to genocide, their mhpmax will be}
433 \textcolor{comment}{             * set to the magic DEFUNCT\_MONSTER cookie value.}
434 \textcolor{comment}{             */}
435             \textcolor{keywordflow}{for}(mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon}; mtmp; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon}) \{
436                 \textcolor{keywordflow}{if} (mtmp->\hyperlink{structmonst_a66c107319bb7bb318c04e6a0f5f03c60}{mhpmax} == \hyperlink{hack_8h_aba651309065b8f0d3d8c9c2d146e83e3}{DEFUNCT\_MONSTER}) \{
437 \textcolor{preprocessor}{#if defined(DEBUG) && defined(WIZARD)}
438                 \textcolor{keywordflow}{if} (\hyperlink{flag_8h_a5f48dc2f029e22c05489fb20a491db4b}{wizard})
439                     pline(\textcolor{stringliteral}{"Removing defunct monster %s from bones."},
440                     mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data}->\hyperlink{structpermonst_ae92da7d141243d7e37d4a12340bb248f}{mname});
441 \textcolor{preprocessor}{#endif}
442                 mongone(mtmp);
443                 \} \textcolor{keywordflow}{else}
444                 \textcolor{comment}{/* to correctly reset named artifacts on the level */}
445                 \hyperlink{bones_8c_a6c677e6be28512ef74ab3c1af5ffc1a7}{resetobjs}(mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent},\hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
446             \}
447             \hyperlink{bones_8c_a6c677e6be28512ef74ab3c1af5ffc1a7}{resetobjs}(\hyperlink{rm_8h_a4d2866bf9ebea1c08c26174b5c8cfbb7}{fobj},\hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
448             \hyperlink{bones_8c_a6c677e6be28512ef74ab3c1af5ffc1a7}{resetobjs}(\hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_a3f47ab569a36a0574eb4363915fe2fae}{buriedobjlist},\hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
449         \}
450     \}
451     (void) \hyperlink{wceconf_8h_aaf66f9bf47dbed159bf1a600f11c785e}{close}(fd);
452 
453 \textcolor{preprocessor}{#ifdef WIZARD}
454     \textcolor{keywordflow}{if}(\hyperlink{flag_8h_a5f48dc2f029e22c05489fb20a491db4b}{wizard}) \{
455         \textcolor{keywordflow}{if}(\hyperlink{hack_8h_a22ffd7fa35549db318337a497c38a1ae}{yn}(\textcolor{stringliteral}{"Unlink bones?"}) == \textcolor{charliteral}{'n'}) \{
456             \hyperlink{files_8c_a6ecb145d3bc4237de33261102e576a19}{compress\_bonesfile}();
457             \textcolor{keywordflow}{return}(ok);
458         \}
459     \}
460 \textcolor{preprocessor}{#endif}
461     \textcolor{keywordflow}{if} (!\hyperlink{files_8c_a960b4d82be9a017423ee0f25c1c5a0bf}{delete\_bonesfile}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz})) \{
462         \textcolor{comment}{/* When N games try to simultaneously restore the same}
463 \textcolor{comment}{         * bones file, N-1 of them will fail to delete it}
464 \textcolor{comment}{         * (the first N-1 under AmigaDOS, the last N-1 under UNIX).}
465 \textcolor{comment}{         * So no point in a mysterious message for a normal event}
466 \textcolor{comment}{         * -- just generate a new level for those N-1 games.}
467 \textcolor{comment}{         */}
468         \textcolor{comment}{/* pline("Cannot unlink bones."); */}
469         \textcolor{keywordflow}{return}(0);
470     \}
471     \textcolor{keywordflow}{return}(ok);
472 \}
\end{DoxyCode}
\hypertarget{bones_8c_afded3e2e4c2d2947d6026923d35a45e7}{\index{bones.\+c@{bones.\+c}!goodfruit@{goodfruit}}
\index{goodfruit@{goodfruit}!bones.\+c@{bones.\+c}}
\subsubsection[{goodfruit}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void goodfruit (
\begin{DoxyParamCaption}
\item[{int}]{id}
\end{DoxyParamCaption}
)}}\label{bones_8c_afded3e2e4c2d2947d6026923d35a45e7}


Definition at line 43 of file bones.\+c.



References ffruit, fruit\+::fid, and fruit\+::nextf.



Referenced by drop\+\_\+upon\+\_\+death(), parseoptions(), and resetobjs().


\begin{DoxyCode}
45 \{
46     \textcolor{keyword}{register} \textcolor{keyword}{struct }\hyperlink{structfruit}{fruit} *f;
47 
48     \textcolor{keywordflow}{for}(f=\hyperlink{decl_8h_ad67dc437078ce8705a8bff226f87076f}{ffruit}; f; f=f->\hyperlink{structfruit_abdefc7da964abc0fe643d941b7ab3057}{nextf}) \{
49         \textcolor{keywordflow}{if}(f->\hyperlink{structfruit_ad6877c834bde1a6c94370dab88feb2f1}{fid} == -\textcolor{keywordtype}{id}) \{
50             f->\hyperlink{structfruit_ad6877c834bde1a6c94370dab88feb2f1}{fid} = id;
51             \textcolor{keywordflow}{return};
52         \}
53     \}
54 \}
\end{DoxyCode}
\hypertarget{bones_8c_a22df165bcc8acdd69f568b9abe5e883e}{\index{bones.\+c@{bones.\+c}!no\+\_\+bones\+\_\+level@{no\+\_\+bones\+\_\+level}}
\index{no\+\_\+bones\+\_\+level@{no\+\_\+bones\+\_\+level}!bones.\+c@{bones.\+c}}
\subsubsection[{no\+\_\+bones\+\_\+level}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} {\bf boolean} no\+\_\+bones\+\_\+level (
\begin{DoxyParamCaption}
\item[{{\bf d\+\_\+level} $\ast$}]{lev}
\end{DoxyParamCaption}
)}}\label{bones_8c_a22df165bcc8acdd69f568b9abe5e883e}


Definition at line 19 of file bones.\+c.



References s\+\_\+level\+::boneid, dungeon\+::boneid, and dungeons.



Referenced by can\+\_\+make\+\_\+bones(), and getbones().


\begin{DoxyCode}
21 \{
22     \textcolor{keyword}{extern} \hyperlink{structd__level}{d\_level} save\_dlevel;      \textcolor{comment}{/* in do.c */}
23     \hyperlink{structs__level}{s\_level} *sptr;
24 
25     \textcolor{keywordflow}{if} (ledger\_no(&save\_dlevel)) assign\_level(lev, &save\_dlevel);
26 
27     \textcolor{keywordflow}{return} (\textcolor{keywordtype}{boolean})(((sptr = Is\_special(lev)) != 0 && !sptr->\hyperlink{structs__level_a440fc05f49167454dedf1b64d814222e}{boneid})
28         || !\hyperlink{decl_8h_ac5ded4d65e561a90b475dc626c392a18}{dungeons}[lev->\hyperlink{structd__level_a035d301f0a8cafc6c757fbbda2b6935e}{dnum}].\hyperlink{structdungeon_a105405e0dbaba92c0de41def0513b280}{boneid}
29            \textcolor{comment}{/* no bones on the last or multiway branch levels */}
30            \textcolor{comment}{/* in any dungeon (level 1 isn't multiway).       */}
31         || Is\_botlevel(lev) || (Is\_branchlev(lev) && lev->\hyperlink{structd__level_a7878568dc81a7efd40bea0206dbd109d}{dlevel} > 1)
32            \textcolor{comment}{/* no bones in the invocation level               */}
33         || (In\_hell(lev) && lev->\hyperlink{structd__level_a7878568dc81a7efd40bea0206dbd109d}{dlevel} == dunlevs\_in\_dungeon(lev) - 1)
34         );
35 \}
\end{DoxyCode}
\hypertarget{bones_8c_a6c677e6be28512ef74ab3c1af5ffc1a7}{\index{bones.\+c@{bones.\+c}!resetobjs@{resetobjs}}
\index{resetobjs@{resetobjs}!bones.\+c@{bones.\+c}}
\subsubsection[{resetobjs}]{\setlength{\rightskip}{0pt plus 5cm}{\bf S\+T\+A\+T\+I\+C\+\_\+\+O\+V\+L} void resetobjs (
\begin{DoxyParamCaption}
\item[{struct {\bf obj} $\ast$}]{ochain, }
\item[{{\bf boolean}}]{restore}
\end{DoxyParamCaption}
)}}\label{bones_8c_a6c677e6be28512ef74ab3c1af5ffc1a7}


Definition at line 57 of file bones.\+c.



References obj\+::age, obj\+::cobj, obj\+::corpsenm, G\+\_\+\+U\+N\+I\+Q, permonst\+::geno, goodfruit(), obj\+::invlet, is\+\_\+quest\+\_\+artifact(), L\+O\+W\+\_\+\+P\+M, mons, obj\+::nobj, N\+O\+N\+\_\+\+P\+M, obj\+::oartifact, objects, O\+N\+A\+M\+E, obj\+::onamelth, otmp, obj\+::otyp, obj\+::owt, obj\+::quan, obj\+::spe, S\+P\+E\+C\+I\+A\+L\+\_\+\+P\+M, and T\+R\+U\+E.



Referenced by getbones(), and savebones().


\begin{DoxyCode}
60 \{
61     \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
62 
63     \textcolor{keywordflow}{for} (otmp = ochain; \hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp}; otmp = otmp->\hyperlink{structobj_ad1c5d790528ee1d8349ef302994789d8}{nobj}) \{
64         \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_aa7bed832c417657c964b6f5893737586}{cobj})
65             \hyperlink{bones_8c_a6c677e6be28512ef74ab3c1af5ffc1a7}{resetobjs}(otmp->\hyperlink{structobj_aa7bed832c417657c964b6f5893737586}{cobj},restore);
66 
67         \textcolor{keywordflow}{if} (((otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} != CORPSE || otmp->\hyperlink{structobj_ad5db7220e2b815d06c3c80027ab9924f}{corpsenm} < \hyperlink{permonst_8h_a3f241dd2d853d0d814ca915fcfd50d06}{SPECIAL\_PM})
68             && otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} != STATUE)
69             && (!otmp->\hyperlink{structobj_af03ce8a6a0ca51e8d8954fb1a1a31fbe}{oartifact} ||
70                (restore && (exist\_artifact(otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}, \hyperlink{obj_8h_a1cbe5aea8be676f47a4597882a411c37}{ONAME}(otmp))
71                     || \hyperlink{questpgr_8c_a883c5ecd485acd110958e3a233cf9b57}{is\_quest\_artifact}(otmp))))) \{
72             otmp->\hyperlink{structobj_af03ce8a6a0ca51e8d8954fb1a1a31fbe}{oartifact} = 0;
73             otmp->\hyperlink{structobj_a032663f21fa617948660e1102147b47d}{onamelth} = 0;
74             *\hyperlink{obj_8h_a1cbe5aea8be676f47a4597882a411c37}{ONAME}(otmp) = \textcolor{charliteral}{'\(\backslash\)0'};
75         \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_af03ce8a6a0ca51e8d8954fb1a1a31fbe}{oartifact} && restore)
76             artifact\_exists(otmp,\hyperlink{obj_8h_a1cbe5aea8be676f47a4597882a411c37}{ONAME}(otmp),\hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
77         \textcolor{keywordflow}{if} (!restore) \{
78             \textcolor{comment}{/* do not zero out o\_ids for ghost levels anymore */}
79 
80             \textcolor{keywordflow}{if}(\hyperlink{objclass_8h_a6fc960ca847bc1bef7559abb7bf29209}{objects}[otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp}].oc\_uses\_known) otmp->known = 0;
81             otmp->dknown = otmp->bknown = 0;
82             otmp->rknown = 0;
83             otmp->\hyperlink{structobj_a15d874124e5aacf167531decaca972b8}{invlet} = 0;
84             otmp->no\_charge = 0;
85 
86             \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == SLIME\_MOLD) \hyperlink{bones_8c_afded3e2e4c2d2947d6026923d35a45e7}{goodfruit}(otmp->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe});
87 \textcolor{preprocessor}{#ifdef MAIL}
88             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == SCR\_MAIL) otmp->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe} = 1;
89 \textcolor{preprocessor}{#endif}
90             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == EGG) otmp->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe} = 0;
91             \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == TIN) \{
92                 \textcolor{comment}{/* make tins of unique monster's meat be empty */}
93                 \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_ad5db7220e2b815d06c3c80027ab9924f}{corpsenm} >= \hyperlink{permonst_8h_aedc8e4764f8cf4d681f6f6226eeaa6af}{LOW\_PM} &&
94                     (\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[otmp->\hyperlink{structobj_ad5db7220e2b815d06c3c80027ab9924f}{corpsenm}].\hyperlink{structpermonst_a0f9f93635f6228a61551c835640b3c1d}{geno} & \hyperlink{monflag_8h_ab99532c9310183c20279ce79e7f594dd}{G\_UNIQ}))
95                 otmp->\hyperlink{structobj_ad5db7220e2b815d06c3c80027ab9924f}{corpsenm} = \hyperlink{permonst_8h_a6485376b5cfc1627d2c68fcb98432cb0}{NON\_PM};
96             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == AMULET\_OF\_YENDOR) \{
97                 \textcolor{comment}{/* no longer the real Amulet */}
98                 otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} = FAKE\_AMULET\_OF\_YENDOR;
99                 curse(otmp);
100             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == CANDELABRUM\_OF\_INVOCATION) \{
101                 \textcolor{keywordflow}{if} (otmp->lamplit)
102                 end\_burn(otmp, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
103                 otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} = WAX\_CANDLE;
104                 otmp->\hyperlink{structobj_a3dd6f7cf99f6a946d0ca406cfca5c23d}{age} = 50L;  \textcolor{comment}{/* assume used */}
105                 \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe} > 0)
106                 otmp->\hyperlink{structobj_ad08c0ed1a746fbb52377ecd7e4220578}{quan} = (long)otmp->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe};
107                 otmp->\hyperlink{structobj_a14fc8dc59e9073bfbf1e170875a98448}{spe} = 0;
108                 otmp->\hyperlink{structobj_a606b1d5b273b814049cc1b1991adfeec}{owt} = weight(otmp);
109                 curse(otmp);
110             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == BELL\_OF\_OPENING) \{
111                 otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} = BELL;
112                 curse(otmp);
113             \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} == SPE\_BOOK\_OF\_THE\_DEAD) \{
114                 otmp->\hyperlink{structobj_a95eb282afebd3599996035e8aab71751}{otyp} = SPE\_BLANK\_PAPER;
115                 curse(otmp);
116             \}
117         \}
118     \}
119 \}
\end{DoxyCode}
\hypertarget{bones_8c_aaa45d59230d30fec700f7a97fd5aafda}{\index{bones.\+c@{bones.\+c}!savebones@{savebones}}
\index{savebones@{savebones}!bones.\+c@{bones.\+c}}
\subsubsection[{savebones}]{\setlength{\rightskip}{0pt plus 5cm}void savebones (
\begin{DoxyParamCaption}
\item[{struct {\bf obj} $\ast$}]{corpse}
\end{DoxyParamCaption}
)}}\label{bones_8c_aaa45d59230d30fec700f7a97fd5aafda}


Definition at line 193 of file bones.\+c.



References bclose(), bflush(), bones, B\+U\+F\+S\+Z, dlevel\+\_\+t\+::buriedobjlist, bwrite(), clear\+\_\+bypasses(), close(), cmap\+\_\+to\+\_\+glyph, C\+O\+L\+N\+O, commit\+\_\+bonesfile(), compress\+\_\+bonesfile(), C\+O\+U\+N\+T\+\_\+\+S\+A\+V\+E, create\+\_\+bonesfile(), monst\+::data, D\+E\+A\+D\+M\+O\+N\+S\+T\+E\+R, delete\+\_\+bonesfile(), D\+I\+S\+M\+O\+U\+N\+T\+\_\+\+B\+O\+N\+E\+S, display\+\_\+nhwindow, drop\+\_\+upon\+\_\+death(), F\+A\+L\+S\+E, flag\+::female, ffruit, fruit\+::fid, flags, fmon, fobj, F\+R\+E\+E\+\_\+\+S\+A\+V\+E, ftrap, H\+O\+L\+E, iflags, in\+\_\+mklev, level, levl, L\+O\+W\+\_\+\+P\+M, m\+\_\+dowear(), monst\+::m\+\_\+id, monst\+::m\+\_\+lev, monst\+::mhp, monst\+::mhpmax, monst\+::minvent, monst\+::mlstmv, M\+M\+\_\+\+N\+O\+N\+A\+M\+E, permonst\+::mname, mons, M\+S\+\_\+\+L\+E\+A\+D\+E\+R, M\+S\+\_\+\+N\+E\+M\+E\+S\+I\+S, permonst\+::msound, monst\+::mtame, newsym(), fruit\+::nextf, monst\+::nmon, N\+O\+\_\+\+M\+M\+\_\+\+F\+L\+A\+G\+S, N\+O\+N\+\_\+\+P\+M, trap\+::ntrap, open\+\_\+bonesfile(), otmp, obj\+::owornmask, paniclog(), plname, resetobjs(), R\+O\+W\+N\+O, S\+\_\+stone, savefruitchn(), savelev(), store\+\_\+version(), T\+R\+U\+E, u, uball, uchain, you\+::ugrave\+\_\+arise, you\+::uhpmax, you\+::ulevel, you\+::umonnum, you\+::ux, you\+::uy, you\+::uz, W\+I\+N\+\_\+\+M\+E\+S\+S\+A\+G\+E, wizard, W\+R\+I\+T\+E\+\_\+\+S\+A\+V\+E, trap\+::x, trap\+::y, and yn.



Referenced by done().


\begin{DoxyCode}
195 \{
196     \textcolor{keywordtype}{int} fd, x, y;
197     \textcolor{keyword}{struct }\hyperlink{structtrap}{trap} *ttmp;
198     \textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *mtmp;
199     \textcolor{keyword}{struct }\hyperlink{structpermonst}{permonst} *mptr;
200     \textcolor{keyword}{struct }\hyperlink{structfruit}{fruit} *f;
201     \textcolor{keywordtype}{char} c, *bonesid;
202     \textcolor{keywordtype}{char} whynot[\hyperlink{global_8h_ab26c26cbf7a0c97d8960c3cfb413f882}{BUFSZ}];
203 
204     \textcolor{comment}{/* caller has already checked `can\_make\_bones()' */}
205 
206     \hyperlink{worn_8c_a77195bfffea4cea88a90989296c348e2}{clear\_bypasses}();
207     fd = \hyperlink{files_8c_a7d258860f78390865f62e2205374082f}{open\_bonesfile}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}, &bonesid);
208     \textcolor{keywordflow}{if} (fd >= 0) \{
209         (void) \hyperlink{wceconf_8h_aaf66f9bf47dbed159bf1a600f11c785e}{close}(fd);
210         \hyperlink{files_8c_a6ecb145d3bc4237de33261102e576a19}{compress\_bonesfile}();
211 \textcolor{preprocessor}{#ifdef WIZARD}
212         \textcolor{keywordflow}{if} (\hyperlink{flag_8h_a5f48dc2f029e22c05489fb20a491db4b}{wizard}) \{
213             \textcolor{keywordflow}{if} (\hyperlink{hack_8h_a22ffd7fa35549db318337a497c38a1ae}{yn}(\textcolor{stringliteral}{"Bones file already exists.  Replace it?"}) == \textcolor{charliteral}{'y'}) \{
214             \textcolor{keywordflow}{if} (\hyperlink{files_8c_a960b4d82be9a017423ee0f25c1c5a0bf}{delete\_bonesfile}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz})) \textcolor{keywordflow}{goto} make\_bones;
215             \textcolor{keywordflow}{else} pline(\textcolor{stringliteral}{"Cannot unlink old bones."});
216             \}
217         \}
218 \textcolor{preprocessor}{#endif}
219         \textcolor{keywordflow}{return};
220     \}
221 
222 \textcolor{preprocessor}{#ifdef WIZARD}
223  make\_bones:
224 \textcolor{preprocessor}{#endif}
225     unleash\_all();
226     \textcolor{comment}{/* in case these characters are not in their home bases */}
227     \textcolor{keywordflow}{for} (mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon}; mtmp; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon}) \{
228         \textcolor{keywordflow}{if} (\hyperlink{monst_8h_a87ebcb12436dc12747fed36e83561249}{DEADMONSTER}(mtmp)) \textcolor{keywordflow}{continue};
229         mptr = mtmp->\hyperlink{structmonst_a5c8369d63f2ae0ca4466258542edecbe}{data};
230         \textcolor{keywordflow}{if} (mtmp->iswiz || mptr == &\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[PM\_MEDUSA] ||
231             mptr->\hyperlink{structpermonst_a8f9cc062b40fa92ce38e504987326190}{msound} == \hyperlink{monflag_8h_ad3e95482807ad66e48de9c5e1c865e63}{MS\_NEMESIS} || mptr->\hyperlink{structpermonst_a8f9cc062b40fa92ce38e504987326190}{msound} == 
      \hyperlink{monflag_8h_a57dd24aec371766f02747931edfcad46}{MS\_LEADER} ||
232             mptr == &\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[PM\_VLAD\_THE\_IMPALER])
233         mongone(mtmp);
234     \}
235 \textcolor{preprocessor}{#ifdef STEED}
236     \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.usteed) dismount\_steed(\hyperlink{hack_8h_aca0be8c9dd2ebf9c91a959c11ae5d132}{DISMOUNT\_BONES});
237 \textcolor{preprocessor}{#endif}
238     dmonsfree();        \textcolor{comment}{/* discard dead or gone monsters */}
239 
240     \textcolor{comment}{/* mark all fruits as nonexistent; when we come to them we'll mark}
241 \textcolor{comment}{     * them as existing (using goodfruit())}
242 \textcolor{comment}{     */}
243     \textcolor{keywordflow}{for}(f=\hyperlink{decl_8h_ad67dc437078ce8705a8bff226f87076f}{ffruit}; f; f=f->\hyperlink{structfruit_abdefc7da964abc0fe643d941b7ab3057}{nextf}) f->\hyperlink{structfruit_ad6877c834bde1a6c94370dab88feb2f1}{fid} = -f->\hyperlink{structfruit_ad6877c834bde1a6c94370dab88feb2f1}{fid};
244 
245     \textcolor{comment}{/* check iron balls separately--maybe they're not carrying it */}
246     if (\hyperlink{decl_8h_a043dece512e3c566986d7cfabc52d05e}{uball}) \hyperlink{decl_8h_a043dece512e3c566986d7cfabc52d05e}{uball}->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} = \hyperlink{decl_8h_ac83f46f409b88c6d6109ed04938ad52a}{uchain}->\hyperlink{structobj_a7906e045755ba4099705764a4eb076c6}{owornmask} = 0;
247 
248     \textcolor{comment}{/* dispose of your possessions, usually cursed */}
249     \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_af66a5ecd2d2a4f3443af9cc10fb928f3}{ugrave\_arise} == (\hyperlink{permonst_8h_a6485376b5cfc1627d2c68fcb98432cb0}{NON\_PM} - 1)) \{
250         \textcolor{keyword}{struct }\hyperlink{structobj}{obj} *\hyperlink{mhitu_8c_a8cf94e09e1a72daf7050a2817ba70974}{otmp};
251 
252         \textcolor{comment}{/* embed your possessions in your statue */}
253         otmp = mk\_named\_object(STATUE, &\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ae0b7ade89d09cd3b6d5e05eb8c859b35}{umonnum}],
254                        \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}, \hyperlink{decl_8h_a362b24d8378ea9e5a611cc50d66e354b}{plname});
255 
256         \hyperlink{bones_8c_a98618383f52f14f6fdc928c13a638fa1}{drop\_upon\_death}((\textcolor{keyword}{struct} \hyperlink{structmonst}{monst} *)0, otmp);
257         \textcolor{keywordflow}{if} (!otmp) \textcolor{keywordflow}{return};  \textcolor{comment}{/* couldn't make statue */}
258         mtmp = (\textcolor{keyword}{struct }\hyperlink{structmonst}{monst} *)0;
259     \} \textcolor{keywordflow}{else} \textcolor{keywordflow}{if} (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_af66a5ecd2d2a4f3443af9cc10fb928f3}{ugrave\_arise} < \hyperlink{permonst_8h_aedc8e4764f8cf4d681f6f6226eeaa6af}{LOW\_PM}) \{
260         \textcolor{comment}{/* drop everything */}
261         \hyperlink{bones_8c_a98618383f52f14f6fdc928c13a638fa1}{drop\_upon\_death}((\textcolor{keyword}{struct} \hyperlink{structmonst}{monst} *)0, (\textcolor{keyword}{struct} \hyperlink{structobj}{obj} *)0);
262         \textcolor{comment}{/* trick makemon() into allowing monster creation}
263 \textcolor{comment}{         * on your location}
264 \textcolor{comment}{         */}
265         \hyperlink{decl_8h_abb694ef5acb9945ca69679a8360df51a}{in\_mklev} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
266         mtmp = makemon(&\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[PM\_GHOST], \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}, \hyperlink{hack_8h_a5d5a01be741383c3f65cf13efc3b1b3d}{MM\_NONAME});
267         \hyperlink{decl_8h_abb694ef5acb9945ca69679a8360df51a}{in\_mklev} = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
268         \textcolor{keywordflow}{if} (!mtmp) \textcolor{keywordflow}{return};
269         mtmp = christen\_monst(mtmp, \hyperlink{decl_8h_a362b24d8378ea9e5a611cc50d66e354b}{plname});
270         \textcolor{keywordflow}{if} (corpse)
271             (void) obj\_attach\_mid(corpse, mtmp->\hyperlink{structmonst_ad8084d1c794f3903b9ffa85fca798abd}{m\_id}); 
272     \} \textcolor{keywordflow}{else} \{
273         \textcolor{comment}{/* give your possessions to the monster you become */}
274         \hyperlink{decl_8h_abb694ef5acb9945ca69679a8360df51a}{in\_mklev} = \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE};
275         mtmp = makemon(&\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_af66a5ecd2d2a4f3443af9cc10fb928f3}{ugrave\_arise}], \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy}, 
      \hyperlink{hack_8h_ae449582f467baa0da531a6ea116a18f2}{NO\_MM\_FLAGS});
276         \hyperlink{decl_8h_abb694ef5acb9945ca69679a8360df51a}{in\_mklev} = \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE};
277         \textcolor{keywordflow}{if} (!mtmp) \{
278             \hyperlink{bones_8c_a98618383f52f14f6fdc928c13a638fa1}{drop\_upon\_death}((\textcolor{keyword}{struct} \hyperlink{structmonst}{monst} *)0, (\textcolor{keyword}{struct} \hyperlink{structobj}{obj} *)0);
279             \textcolor{keywordflow}{return};
280         \}
281         mtmp = christen\_monst(mtmp, \hyperlink{decl_8h_a362b24d8378ea9e5a611cc50d66e354b}{plname});
282         \hyperlink{display_8c_a185c6ad6e4c5a6be26a371b9aa17c32e}{newsym}(\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux}, \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy});
283         Your(\textcolor{stringliteral}{"body rises from the dead as %s..."},
284             an(\hyperlink{permonst_8h_ab96e7c4682ea5ae4f83339a15c06f676}{mons}[\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_af66a5ecd2d2a4f3443af9cc10fb928f3}{ugrave\_arise}].\hyperlink{structpermonst_ae92da7d141243d7e37d4a12340bb248f}{mname}));
285         \hyperlink{winprocs_8h_ac8e74d03fbb65b9f5651e63d79bebc60}{display\_nhwindow}(\hyperlink{decl_8h_a4a1cc9e693dbdfad3ea32b10ce19f337}{WIN\_MESSAGE}, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
286         \hyperlink{bones_8c_a98618383f52f14f6fdc928c13a638fa1}{drop\_upon\_death}(mtmp, (\textcolor{keyword}{struct} \hyperlink{structobj}{obj} *)0);
287         \hyperlink{worn_8c_a7e0d383cf09a999a333ec1154d0d52f3}{m\_dowear}(mtmp, \hyperlink{global_8h_aa8cecfc5c5c054d2875c03e77b7be15d}{TRUE});
288     \}
289     \textcolor{keywordflow}{if} (mtmp) \{
290         mtmp->\hyperlink{structmonst_a80ec1118166ea76d347e47d088bd1f7c}{m\_lev} = (\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a6c7263bb25b91825bf7ecaab470d771a}{ulevel} ? \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a6c7263bb25b91825bf7ecaab470d771a}{ulevel} : 1);
291         mtmp->\hyperlink{structmonst_abe22e95755f1348a6a1c78252be5d76d}{mhp} = mtmp->\hyperlink{structmonst_a66c107319bb7bb318c04e6a0f5f03c60}{mhpmax} = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ade36670a142a7d38051c74740d02002b}{uhpmax};
292         mtmp->female = \hyperlink{flag_8h_a997133526e0c6bed44ebc0116a48b50a}{flags}.\hyperlink{structflag_ae3f866c572c50c676ecadf8acccf0c50}{female};
293         mtmp->msleeping = 1;
294     \}
295     \textcolor{keywordflow}{for}(mtmp = \hyperlink{rm_8h_a9b7eba07f916406d6d62f5f82d273e40}{fmon}; mtmp; mtmp = mtmp->\hyperlink{structmonst_a4c4bcdcf3c4ec4a85313ade9f9c27b72}{nmon}) \{
296         \hyperlink{bones_8c_a6c677e6be28512ef74ab3c1af5ffc1a7}{resetobjs}(mtmp->\hyperlink{structmonst_a480856d6a5db5610593c9816e525a978}{minvent},\hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
297         \textcolor{comment}{/* do not zero out m\_ids for bones levels any more */}
298         mtmp->\hyperlink{structmonst_a942c3eb47c3057fe67733f1a7be5e63b}{mlstmv} = 0L;
299         \textcolor{keywordflow}{if}(mtmp->\hyperlink{structmonst_a6d525ec48f9d38cda6accbb0cb39efba}{mtame}) mtmp->\hyperlink{structmonst_a6d525ec48f9d38cda6accbb0cb39efba}{mtame} = mtmp->mpeaceful = 0;
300     \}
301     \textcolor{keywordflow}{for}(ttmp = \hyperlink{trap_8h_a442e327ae9fbb5d15e2df82e488de313}{ftrap}; ttmp; ttmp = ttmp->\hyperlink{structtrap_aef8ea4650dce701fde7f7f3e1310c892}{ntrap}) \{
302         ttmp->madeby\_u = 0;
303         ttmp->tseen = (ttmp->ttyp == \hyperlink{trap_8h_a8049ef47c05eee8156bccee8d819c506}{HOLE});
304     \}
305     \hyperlink{bones_8c_a6c677e6be28512ef74ab3c1af5ffc1a7}{resetobjs}(\hyperlink{rm_8h_a4d2866bf9ebea1c08c26174b5c8cfbb7}{fobj},\hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
306     \hyperlink{bones_8c_a6c677e6be28512ef74ab3c1af5ffc1a7}{resetobjs}(\hyperlink{rm_8h_a721c99bfa099c4225215ba102e91fa39}{level}.\hyperlink{structdlevel__t_a3f47ab569a36a0574eb4363915fe2fae}{buriedobjlist}, \hyperlink{global_8h_aa93f0eb578d23995850d61f7d61c55c1}{FALSE});
307 
308     \textcolor{comment}{/* Hero is no longer on the map. */}
309     \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_ace2fd92f7f1a640e45775efe6e5f6cf7}{ux} = \hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a8571cf3a9cfc41c3f877d0f56cda11a9}{uy} = 0;
310 
311     \textcolor{comment}{/* Clear all memory from the level. */}
312     \textcolor{keywordflow}{for}(x=0; x<\hyperlink{global_8h_a308dbfcc29f5a427c0315f3cbf03c3ed}{COLNO}; x++) \textcolor{keywordflow}{for}(y=0; y<\hyperlink{global_8h_a9cce134868d97b23c35bcf1ff4a343d8}{ROWNO}; y++) \{
313         \hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].seenv = 0;
314         \hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].waslit = 0;
315         \hyperlink{rm_8h_a8cd681fba60fdedbabfd71a0b4bbfc00}{levl}[x][y].glyph = \hyperlink{display_8h_a77e69d3b11c3296576f840c9d11ae8fb}{cmap\_to\_glyph}(\hyperlink{rm_8h_a342b42eb0fe3236adbc700b6e725d781}{S\_stone});
316     \}
317 
318     fd = \hyperlink{files_8c_a05dbdf42500297101953ab983702fa66}{create\_bonesfile}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}, &bonesid, whynot);
319     \textcolor{keywordflow}{if}(fd < 0) \{
320 \textcolor{preprocessor}{#ifdef WIZARD}
321         \textcolor{keywordflow}{if}(\hyperlink{flag_8h_a5f48dc2f029e22c05489fb20a491db4b}{wizard})
322             pline(\textcolor{stringliteral}{"%s"}, whynot);
323 \textcolor{preprocessor}{#endif}
324         \textcolor{comment}{/* bones file creation problems are silent to the player.}
325 \textcolor{comment}{         * Keep it that way, but place a clue into the paniclog.}
326 \textcolor{comment}{         */}
327         \hyperlink{end_8c_af1a422a8c13793b2fb4f10f470f671b3}{paniclog}(\textcolor{stringliteral}{"savebones"}, whynot);
328         \textcolor{keywordflow}{return};
329     \}
330     c = (char) (strlen(bonesid) + 1);
331 
332 \textcolor{preprocessor}{#ifdef MFLOPPY  }\textcolor{comment}{/* check whether there is room */}\textcolor{preprocessor}{}
333     \textcolor{keywordflow}{if} (\hyperlink{flag_8h_ae9cd54937dcb00432131e49e5e324075}{iflags}.checkspace) \{
334         \hyperlink{save_8c_a4f571c1f71c62a3eb08fb1db1319442e}{savelev}(fd, ledger\_no(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}), \hyperlink{lev_8h_af278f508ebfcebe77bc078316e7a2d18}{COUNT\_SAVE});
335         \textcolor{comment}{/* savelev() initializes bytes\_counted to 0, so it must come}
336 \textcolor{comment}{         * first here even though it does not in the real save.  the}
337 \textcolor{comment}{         * resulting extra bflush() at the end of savelev() may increase}
338 \textcolor{comment}{         * bytes\_counted by a couple over what the real usage will be.}
339 \textcolor{comment}{         *}
340 \textcolor{comment}{         * note it is safe to call store\_version() here only because}
341 \textcolor{comment}{         * bufon() is null for ZEROCOMP, which MFLOPPY uses -- otherwise}
342 \textcolor{comment}{         * this code would have to know the size of the version}
343 \textcolor{comment}{         * information itself.}
344 \textcolor{comment}{         */}
345         \hyperlink{version_8c_aa7fde5122fc8cf75dbc460ac3b3a6507}{store\_version}(fd);
346         \hyperlink{save_8c_a2e7663422968049372dd9cc6b325a84a}{bwrite}(fd, (\hyperlink{tradstdc_8h_ad4a7dab7269b4b00e3c7c7d2e66f31cd}{genericptr\_t}) &c, \textcolor{keyword}{sizeof} c);
347         \hyperlink{save_8c_a2e7663422968049372dd9cc6b325a84a}{bwrite}(fd, (\hyperlink{tradstdc_8h_ad4a7dab7269b4b00e3c7c7d2e66f31cd}{genericptr\_t}) bonesid, (\textcolor{keywordtype}{unsigned}) c); \textcolor{comment}{/* DD.nnn */}
348         \hyperlink{save_8c_aff4b6aa0a5610dd3645ab6c37311d5c7}{savefruitchn}(fd, \hyperlink{lev_8h_af278f508ebfcebe77bc078316e7a2d18}{COUNT\_SAVE});
349         \hyperlink{save_8c_ae1317b09b119a1374b2b587aedf5f721}{bflush}(fd);
350         \textcolor{keywordflow}{if} (bytes\_counted > freediskspace(\hyperlink{bones_8c_a2f969fbc0e4886ed7141c90431e764bb}{bones})) \{ \textcolor{comment}{/* not enough room */}
351 \textcolor{preprocessor}{# ifdef WIZARD}
352         \textcolor{keywordflow}{if} (\hyperlink{flag_8h_a5f48dc2f029e22c05489fb20a491db4b}{wizard})
353             pline(\textcolor{stringliteral}{"Insufficient space to create bones file."});
354 \textcolor{preprocessor}{# endif}
355         (void) \hyperlink{wceconf_8h_aaf66f9bf47dbed159bf1a600f11c785e}{close}(fd);
356         cancel\_bonesfile();
357         \textcolor{keywordflow}{return};
358         \}
359         co\_false(); \textcolor{comment}{/* make sure stuff before savelev() gets written */}
360     \}
361 \textcolor{preprocessor}{#endif }\textcolor{comment}{/* MFLOPPY */}\textcolor{preprocessor}{}
362 
363     \hyperlink{version_8c_aa7fde5122fc8cf75dbc460ac3b3a6507}{store\_version}(fd);
364     \hyperlink{save_8c_a2e7663422968049372dd9cc6b325a84a}{bwrite}(fd, (\hyperlink{tradstdc_8h_ad4a7dab7269b4b00e3c7c7d2e66f31cd}{genericptr\_t}) &c, \textcolor{keyword}{sizeof} c);
365     \hyperlink{save_8c_a2e7663422968049372dd9cc6b325a84a}{bwrite}(fd, (\hyperlink{tradstdc_8h_ad4a7dab7269b4b00e3c7c7d2e66f31cd}{genericptr\_t}) bonesid, (\textcolor{keywordtype}{unsigned}) c); \textcolor{comment}{/* DD.nnn */}
366     \hyperlink{save_8c_aff4b6aa0a5610dd3645ab6c37311d5c7}{savefruitchn}(fd, \hyperlink{lev_8h_a5743e308b58e25a32b7629de505bc991}{WRITE\_SAVE} | \hyperlink{lev_8h_a39f3d47170c994b6ac6ec401c34cebd3}{FREE\_SAVE});
367     update\_mlstmv();    \textcolor{comment}{/* update monsters for eventual restoration */}
368     \hyperlink{save_8c_a4f571c1f71c62a3eb08fb1db1319442e}{savelev}(fd, ledger\_no(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz}), \hyperlink{lev_8h_a5743e308b58e25a32b7629de505bc991}{WRITE\_SAVE} | \hyperlink{lev_8h_a39f3d47170c994b6ac6ec401c34cebd3}{FREE\_SAVE});
369     \hyperlink{save_8c_ada08c9aeb3924f3573f774f08a5cbc5b}{bclose}(fd);
370     \hyperlink{files_8c_adaf9c63bbc3c42662a963bc9caf67b2f}{commit\_bonesfile}(&\hyperlink{decl_8h_a342ae6d3415cd569bcea437201040743}{u}.\hyperlink{structyou_a89878490db5d54221f04b3fb44ebdaa2}{uz});
371     \hyperlink{files_8c_a6ecb145d3bc4237de33261102e576a19}{compress\_bonesfile}();
372 \}
\end{DoxyCode}


\subsection{Variable Documentation}
\hypertarget{bones_8c_a2f969fbc0e4886ed7141c90431e764bb}{\index{bones.\+c@{bones.\+c}!bones@{bones}}
\index{bones@{bones}!bones.\+c@{bones.\+c}}
\subsubsection[{bones}]{\setlength{\rightskip}{0pt plus 5cm}char bones\mbox{[}$\,$\mbox{]}}}\label{bones_8c_a2f969fbc0e4886ed7141c90431e764bb}


Definition at line 60 of file files.\+c.



Referenced by commit\+\_\+bonesfile(), compress\+\_\+bonesfile(), create\+\_\+bonesfile(), delete\+\_\+bonesfile(), getbones(), open\+\_\+bonesfile(), read\+\_\+config\+\_\+file(), and savebones().

